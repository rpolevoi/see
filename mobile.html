
<!DOCTYPE html>
<html>
<head>
<title>Shale Equities Explorer -- A Data-viz Encyclopedia of Public Companies Operating in U.S. Shale Plays</title>
<meta charset="utf-8">
<meta name="description" content="Data-viz Encyclopedia of Public Oil and Gas Companies Operating in U.S. Shale Plays">
<meta name="keywords" content="shale, oil, gas, production, proved reserves">
<link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=EB Garamond|Quattrocento Sans">
<style>

body  { text-rendering: optimizeLegibility; }

.label {
    font: 13px Quattrocento Sans;
    font-weight: 500;
}

.axis {
  font: 10px Quattrocento Sans;
}

.axis path,
.axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

.x.axis path {
  //display: none;
}

.x.axis
{
  font: 11px Quattrocento Sans;
}

.x.axis.small
{
  font: 11px Quattrocento Sans;
}



</style>
</head>
<body style="background-color:#EEEEEE">

<svg width="0" height="0" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <linearGradient id="total" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:rgb(0,0,220);stop-opacity:1" />
      <stop offset="33%" style="stop-color:rgb(0,0,220);stop-opacity:1" />
      <stop offset="34%" style="stop-color:rgb(255,255,0);stop-opacity:1" />
      <stop offset="66%" style="stop-color:rgb(255,255,0);stop-opacity:1" />
      <stop offset="67%" style="stop-color:rgb(220,0,0);stop-opacity:1" />
      <stop offset="100%" style="stop-color:rgb(220,0,0);stop-opacity:1" />
    </linearGradient>
    
    <radialGradient id="total_r" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:rgb(0,0,220);stop-opacity:1" />
      <stop offset="33%" style="stop-color:rgb(0,0,220);stop-opacity:1" />
      <stop offset="34%" style="stop-color:rgb(255,255,0);stop-opacity:1" />
      <stop offset="66%" style="stop-color:rgb(255,255,0);stop-opacity:1" />
      <stop offset="67%" style="stop-color:rgb(220,0,0);stop-opacity:1" />
      <stop offset="100%" style="stop-color:rgb(220,0,0);stop-opacity:1" />
    </radialGradient>
  
    <linearGradient id="liquids" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:rgb(225,225,0);stop-opacity:1" />
      <stop offset="49%" style="stop-color:rgb(255,255,0);stop-opacity:1" />
      <stop offset="50%" style="stop-color:rgb(220,0,0);stop-opacity:1" />
      <stop offset="100%" style="stop-color:rgb(220,0,0);stop-opacity:1" />
    </linearGradient>
    

    <linearGradient id="pud" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:rgb(100,100,255);stop-opacity:1" />
      <stop offset="33%" style="stop-color:rgb(100,100,255);stop-opacity:1" />
      <stop offset="34%" style="stop-color:rgb(255,250,110);stop-opacity:1" />
      <stop offset="66%" style="stop-color:rgb(255,250,110);stop-opacity:1" />
      <stop offset="67%" style="stop-color:rgb(255,70,150);stop-opacity:1" />
      <stop offset="100%" style="stop-color:rgb(255,70,150);stop-opacity:1" />
    </linearGradient>
    
    <linearGradient id="pr" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:rgb(100,100,255);stop-opacity:1" />
      <stop offset="16%" style="stop-color:rgb(100,100,255);stop-opacity:1" />
      <stop offset="17%" style="stop-color:rgb(255,250,110);stop-opacity:1" />
      <stop offset="33%" style="stop-color:rgb(255,250,110);stop-opacity:1" />
      <stop offset="34%" style="stop-color:rgb(255,70,150);stop-opacity:1" />
      <stop offset="49%" style="stop-color:rgb(255,70,150);stop-opacity:1" />
      <stop offset="50%" style="stop-color:rgb(0,0,220);stop-opacity:1" />
      <stop offset="66%" style="stop-color:rgb(0,0,220);stop-opacity:1" />
      <stop offset="67%" style="stop-color:rgb(255,255,0);stop-opacity:1" />
      <stop offset="83%" style="stop-color:rgb(255,255,0);stop-opacity:1" />
      <stop offset="84%" style="stop-color:rgb(220,0,0);stop-opacity:1" />
      <stop offset="100%" style="stop-color:rgb(220,0,0);stop-opacity:1" />
    </linearGradient>
    
    
    <linearGradient id="pr_oil" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:rgb(255,70,150);stop-opacity:1" />
      <stop offset="49%" style="stop-color:rgb(255,70,150);stop-opacity:1" />
      <stop offset="50%" style="stop-color:rgb(220,0,0);stop-opacity:1" />
      <stop offset="100%" style="stop-color:rgb(220,0,0);stop-opacity:1" />
    </linearGradient>
    
    <linearGradient id="pr_liquids" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:rgb(255,250,110);stop-opacity:1" />
      <stop offset="24%" style="stop-color:rgb(255,250,110);stop-opacity:1" />
      <stop offset="25%" style="stop-color:rgb(255,70,150);stop-opacity:1" />
      <stop offset="49%" style="stop-color:rgb(255,70,150);stop-opacity:1" />
      <stop offset="50%" style="stop-color:rgb(255,255,0);stop-opacity:1" />
      <stop offset="74%" style="stop-color:rgb(255,255,0);stop-opacity:1" />
      <stop offset="75%" style="stop-color:rgb(220,0,0);stop-opacity:1" />
      <stop offset="100%" style="stop-color:rgb(220,0,0);stop-opacity:1" />
    </linearGradient>
    
    <linearGradient id="pr_gas" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:rgb(100,100,255);stop-opacity:1" />
      <stop offset="49%" style="stop-color:rgb(100,100,255);stop-opacity:1" />
      <stop offset="50%" style="stop-color:rgb(0,0,220);stop-opacity:1" />
      <stop offset="100%" style="stop-color:rgb(0,0,220);stop-opacity:1" />
    </linearGradient>
    
      <linearGradient id="ev" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:rgb(144,238,144);stop-opacity:1" /> //light green
      <stop offset="49%" style="stop-color:rgb(144,238,144);stop-opacity:1" />
      <stop offset="50%" style="stop-color:rgb(0,100,0);stop-opacity:1" /> //dark green
      <stop offset="100%" style="stop-color:rgb(0,100,0);stop-opacity:1" />
    </linearGradient>
    
    
  </defs>
  
  
</svg>

<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js" charset="utf-8"></script>

<script>


//  GENERAL SETUP BLOCK

//Q2 2015

  var data = [
            {
              "company" : "APA+", //q2
              "name" : "Apache Corp.",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed" : 302.3, "price": 58.50},
                             {"product":"ngl","mboed": 62.8, "price": 10.15},
                             {"product":"gas","mboed": 198.6, "price": 16.33}
                             
                             ],

                            "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .652},
                             {"metric":"cashMargin","percent": .620},
                             {"metric":"net","percent": .150}
                            ],
                            
                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 784},
                            {"div":"ngl pd", "mmboe" : 205},
                            {"div":"gas pd", "mmboe" : 661.9},
                            {"div":"oil pud", "mmboe" : 290},
                            {"div":"ngl pud", "mmboe" : 77},
                            {"div":"gas pud", "mmboe" : 378}
                            ]
                          },
              "hedge" : 0,
              "capex"  : 1059,
              "debt" : 6726,
              "stock" : [
                {"key":"price", "value" : 44.83},
                {"key":"shares", "value" : 378}
                ],
              "groups" : [
                "Canada Shales",
                "Eagle Ford (East)",
                "Gulf of Mexico",
                "International",
                "Mid-Continent",
                "Permian (Delaware)",
                "Permian (Midland)",
                "Permian (Other)"
                ],
              "selected":"no"
            },
            {
              "company" : "APC+",//q2
              "name" : "Anadarko Petroleum Corp",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed": 318, "price": 55.78},
                             {"product":"ngl", "mboed": 136, "price": 18.50},
                             {"product":"gas","mboed": 392.3, "price": 13.68}
                             
                             ],

                           "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .605},
                             {"metric":"cashMargin","percent": .522},
                             {"metric":"net","percent": .018}
                            ],
                            
                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 542},
                            {"div":"ngl pd", "mmboe" : 317},
                            {"div":"gas pd", "mmboe" : 1110.3},
                            {"div":"oil pud", "mmboe" : 387},
                            {"div":"ngl pud", "mmboe" : 162},
                            {"div":"gas pud", "mmboe" : 339.5}
                            ]
                          },
              "hedge" : 81.0,
              "capex"  : 1410,
              "debt" :  13885,
              "stock" : [
                {"key":"price", "value" : 70.90},
                {"key":"shares", "value" : 508}
                ],
              "groups" : [
                "DJ/Powder River",
                "Eagle Ford",
                "Eagle Ford (East)",
                "Gulf of Mexico",
                "East Texas/Haynesville",
                "International(+)",
                "Marcellus/Utica",
                "Mid-Continent",
                "Permian (Delaware)",
                "Western Rockies"
                ],
              "selected":"yes"
            },
            {
              "company" : "AR", //q2
              "name" : "Antero Resources",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed": 5.7, "price": 44.06},
                             {"product":"ngl", "mboed": 40.2, "price": 16.29},
                             {"product":"gas","mboed": 201.5, "price": 13.20}
                             
                             ],

                            "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .517},
                             {"metric":"cashMargin","percent": .402},
                             {"metric":"net","percent": .060}
                            ],
                            
                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 6.0},
                            {"div":"ngl pd", "mmboe" : 80.0},
                            {"div":"gas pd", "mmboe" : 547.5},
                            {"div":"oil pud", "mmboe" : 22.0},
                            {"div":"ngl pud", "mmboe" : 250.0},
                            {"div":"gas pud", "mmboe" : 1208.3}
                            ]
                          },
              "hedge" : 195.9,
              "capex"  : 499,
              "debt" :  4357,
              "stock" : [
                {"key":"price", "value" : 25.19},
                {"key":"shares", "value" : 277}
                ],
              "groups" : [
                "Marcellus/Utica"
                ],
              "selected":"no"
            },
            {
              "company" : "BBG",  //q2
              "name" : "Bill Barrett Corp",
              "values" : {
 
                           "prods" : [
                             {"product":"oil", "mboed": 12.3, "price": 48.68},
                             {"product":"ngl", "mboed": 2.3, "price": 12.76},
                             {"product":"gas","mboed": 3.3, "price": 13.98}
                             
                             ],

                           "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .711},
                             {"metric":"cashMargin","percent": .535},
                             {"metric":"net","percent": -.003}
                            ],

                            "reserves" : [
                            {"div":"oil pd", "mmboe" :  29.3},
                            {"div":"ngl pd", "mmboe" : 3.8},
                            {"div":"gas pd", "mmboe" : 8.4},
                            {"div":"oil pud", "mmboe" : 54.5 },
                            {"div":"ngl pud", "mmboe" : 9.0},
                            {"div":"gas pud", "mmboe" : 17.2}
                            ]
                          },
              "hedge" : 36.5,
              "capex" : 65.1,
              "debt" :  769,
              "stock" : [
                {"key":"price", "value" : 5.05},
                {"key":"shares", "value" : 50}
                ],
              "groups" : [
                  "DJ/Powder River",
                  "Western Rockies"
                ],
              "selected":"yes"
            },
            {
              "company" : "BCEI",//q2
              "name" : "Bonanza Creek Energy",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed": 16.9, "price": 49.90},
                             {"product":"ngl", "mboed": 4.7, "price": 16.28	},
                             {"product":"gas","mboed": 6.5, "price": 11.72}
                             
                             ],

                            "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .600},
                             {"metric":"cashMargin","percent": .463},
                             {"metric":"net","percent": -.199}
                            ],
                            
                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 28.3},
                            {"div":"ngl pd", "mmboe" : 2.2},
                            {"div":"gas pd", "mmboe" : 15.8},
                            {"div":"oil pud", "mmboe" : 26.4},
                            {"div":"ngl pud", "mmboe" : 1.2},
                            {"div":"gas pud", "mmboe" : 15.7}
                            ]
                          },
              "hedge" : 15.2,
              "capex" : 164,
              "debt" :  835,
              "stock" : [
                {"key":"price", "value" : 6.70},
                {"key":"shares", "value" : 49.7}
                ],
              "groups" : [
                "DJ/Powder River",
                "East Texas/Haynesville"
                ],
              "selected":"no"
            },            {
              "company" : "CHK",
              "name" : "Chesapeake Energy",  //q2
              "values" : {
 
                           "prods" : [
                             {"product":"oil", "mboed": 118.7, "price": 51.21},
                             {"product":"ngl", "mboed": 79.1, "price": 1.90},
                             {"product":"gas","mboed": 504.4, "price": 4.50}
                             
                             ],

                           "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .650},
                             {"metric":"cashMargin","percent": .581},
                             {"metric":"net","percent": -.005}
                            ],

                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 229},
                            {"div":"ngl pd", "mmboe" : 198},
                            {"div":"gas pd", "mmboe" : 1437},
                            {"div":"oil pud", "mmboe" : 192},
                            {"div":"ngl pud", "mmboe" :  68},
                            {"div":"gas pud", "mmboe" : 345}
                            ]
                          },
              "hedge" : 253,
              "capex" : 957,
              "debt" :  8604,
              "stock" : [
                {"key":"price", "value" : 7.36},
                {"key":"shares", "value" : 665.4}
                ],
              "groups" : [
                  "Eagle Ford",
                  "East Texas/Haynesville",
                  "Marcellus/Utica",
                  "Mid-Continent",
                  "DJ/Powder River"
                ],
              "selected":"no"
            },
            {
              "company" : "CLR*",//q2
              "name" : "Continental Resources",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed": 149.9, "price": 50.50},
                             {"product":"ngl", "mboed": 0.0, "price": 0.0},
                             {"product":"gas","mboed": 76.65, "price": 14.50}
                             
                             ],

                           "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .774},
                             {"metric":"cashMargin","percent": .677},
                             {"metric":"net","percent": .113}
                            ],
                            
                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 342.1},
                            {"div":"ngl pd", "mmboe" : 0.0},
                            {"div":"gas pd", "mmboe" : 160.3},
                            {"div":"oil pud", "mmboe" : 524.2},
                            {"div":"ngl pud", "mmboe" : 0.0},
                            {"div":"gas pud", "mmboe" : 324.4}
                            ]
                          },
              "hedge" : 13.2,
              "capex" : 592,
              "debt" : 6965,
              "stock" : [
                {"key":"price", "value" : 30.88},
                {"key":"shares", "value" : 373.1}
                ],
              "groups" : [
                "Bakken/Three Forks",
                "Mid-Continent"
                ],
              "selected":"no"
            },
            {
              "company" : "COG",  //Q2
              "name" : "Cabot Oil and Gas",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed": 17.7, "price": 50.39 },
                             {"product":"ngl", "mboed": 0 , "price": 0},
                             {"product":"gas","mboed": 235.2, "price": 10.50}
                             
                             ],

                           "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .558},
                             {"metric":"cashMargin","percent": .490},
                             {"metric":"net","percent": .062}
                            ],
                            
                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 27.2},
                            {"div":"ngl pd", "mmboe" : 0},
                            {"div":"gas pd", "mmboe" : 723.2},
                            {"div":"oil pud", "mmboe" : 25.9},
                            {"div":"ngl pud", "mmboe" : 0},
                            {"div":"gas pud", "mmboe" : 457.2}
                            ]
                          },
              "hedge" : 51,
              "capex" : 228.2,
              "debt" :  1995,
              "stock" : [
                {"key":"price", "value" : 23.30},
                {"key":"shares", "value" : 413.8}
                ],
              "groups" : [
                "Eagle Ford",
                "Marcellus/Utica"
                ],
              "selected":"yes"
            },
            {
              "company" : "CRK",//q2
              "name" : "Comstock Resources",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed": 10.2, "price": 55.34},
                             {"product":"ngl", "mboed": 0.0, "price": 0.0},
                             {"product":"gas","mboed": 20.3, "price": 14.22}
                             
                             ],

                           "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .615},
                             {"metric":"cashMargin","percent": .180},
                             {"metric":"net","percent": -.987}
                            ],

                            "reserves" : [
                            {"div":"oil pd", "mmboe" :  16.2},
                            {"div":"ngl pd", "mmboe" : 0.0},
                            {"div":"gas pd", "mmboe" : 54.1},
                            {"div":"oil pud", "mmboe" : 4.6},
                            {"div":"ngl pud", "mmboe" :  0.0},
                            {"div":"gas pud", "mmboe" : 28.5}
                            ]
                          },
              "hedge" : 0,
              "capex" : 53.5,
              "debt" :  1249,
              "stock" : [
                {"key":"price", "value" : 3.06},
                {"key":"shares", "value" : 47.7}
                ],
              "groups" : [
                "Eagle Ford",
                "Eagle Ford (East)",
                "East Texas/Haynesville",
                "Tuscaloosa"
                ],
              "selected":"yes"
            },
            {
              "company" : "CRZO", //q2
              "name" : "Carrizo Oil and Gas",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed": 22.3, "price": 54.86},
                             {"product":"ngl", "mboed": 3.5, "price": 11.95},
                             {"product":"gas","mboed": 10.3, "price": 8.94}
                             
                             ],

                            "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .756},
                             {"metric":"cashMargin","percent": .656},
                             {"metric":"net","percent": .186}
                            ],
                            
                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 35.2},
                            {"div":"ngl pd", "mmboe" : 5.3},
                            {"div":"gas pd", "mmboe" : 25.0},
                            {"div":"oil pud", "mmboe" : 65.5},
                            {"div":"ngl pud", "mmboe" : 8.2},
                            {"div":"gas pud", "mmboe" : 11.9}
                            ]
                          },
              "hedge" : 45.1,
              "capex" : 136,
              "debt" :  1371,
              "stock" : [
                {"key":"price", "value" : 35.38},
                {"key":"shares", "value" : 52}
                ],
              "groups" : [
                "DJ/Powder River",
                "Eagle Ford",
                "Marcellus/Utica"
                ],
              "selected":"no"
            },
            {
              "company" : "CXO*",  //q2
              "name" : "Concho Resources",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed": 99.2, "price": 52.14},
                             {"product":"ngl", "mboed": 0.0, "price": 0.0},
                             {"product":"gas","mboed": 48.1, "price": 15.18}
                             
                             ],

                            "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .711},
                             {"metric":"cashMargin","percent": .629},
                             {"metric":"net","percent": .160}
                            ],
                            
                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 211.4},
                            {"div":"ngl pd", "mmboe" : 0.0},
                            {"div":"gas pd", "mmboe" : 165.4},
                            {"div":"oil pud", "mmboe" : 158.9},
                            {"div":"ngl pud", "mmboe" : 0.0},
                            {"div":"gas pud", "mmboe" : 101.4}
                            ]
                          },
              "hedge" : 112.3,
              "capex" : 584.7,
              "debt" :  3382,
              "stock" : [
                {"key":"price", "value" : 105.83},
                {"key":"shares", "value" : 120.3}
                ],
              "groups" : [
                "Permian (Delaware)",
                "Permian (Midland)",
                "Permian (Other)"
                ],
              "selected":"no"
            },
          {
              "company" : "DVN", //q2
              "name" : "Devon Energy Corp",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed": 270, "price": 46.69},
                             {"product":"ngl", "mboed": 134, "price": 10.31},
                             {"product":"gas","mboed": 271.2, "price": 12.78}
                             
                             ],

                           "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .589},
                             {"metric":"cashMargin","percent": .529},
                             {"metric":"net","percent": .182}
                            ],

                            "reserves" : [
                            {"div":"oil pd", "mmboe" :  415},
                            {"div":"ngl pd", "mmboe" : 486},
                            {"div":"gas pd", "mmboe" : 1164},
                            {"div":"oil pud", "mmboe" : 480},
                            {"div":"ngl pud", "mmboe" :  92},
                            {"div":"gas pud", "mmboe" : 117.2}
                            ]
                          },
              "hedge" : 480,
              "capex" : 998,
              "debt" :  7565,
              "stock" : [
                {"key":"price", "value" : 42.22},
                {"key":"shares", "value" : 411}
                ],
              "groups" : [
                "Barnett Shale",
                "Canada Bitumen",
                "Eagle Ford",
                "Mid-Continent",
                "Permian (Delaware)",
                "Permian (Midland)",
                ],
              "selected":"no"
            },
            {
              "company" : "ECA",//q2
              "name" : "Encana Corp",
              "values" : {
 
                           "prods" : [
                             {"product":"oil", "mboed": 127.3, "price": 43.83},
                             {"product":"ngl", "mboed": 0, "price": 0},
                             {"product":"gas","mboed": 261.3, "price": 14.22}
                             
                             ],

                           "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .387},
                             {"metric":"cashMargin","percent": .112},
                             {"metric":"net","percent": -.278}
                            ],

                            "reserves" : [
                            {"div":"oil pd", "mmboe" :  120.5},
                            {"div":"ngl pd", "mmboe" : 85},
                            {"div":"gas pd", "mmboe" : 647.8},
                            {"div":"oil pud", "mmboe" : 84.5},
                            {"div":"ngl pud", "mmboe" :  71.7},
                            {"div":"gas pud", "mmboe" : 267.8}
                            ]
                          },
              "hedge" : 163.7,
              "capex" : 742,
              "debt" :  5616,
              "stock" : [
                {"key":"price", "value" : 7.08},
                {"key":"shares", "value" : 842.5}
                ],
              "groups" : [
                  "Canada Shales",
                  "Eagle Ford",
                  "San Juan/Raton Basins",
                ],
              "selected":"yes"
            },
            {
              "company" : "ECR",//q2
              "name" : "Eclipse Resources",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed": 6.6, "price": 45.48 },
                             {"product":"ngl", "mboed": 7.5, "price": 14.01},
                             {"product":"gas","mboed": 19.0, "price": 16.26}
                             
                             ],

                            "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .448},
                             {"metric":"cashMargin","percent": .252},
                             {"metric":"net","percent": -.573}
                            ],
                            
                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 3.9},
                            {"div":"ngl pd", "mmboe" : 6.8},
                            {"div":"gas pd", "mmboe" : 22.2},
                            {"div":"oil pud", "mmboe" : 4.1},
                            {"div":"ngl pud", "mmboe" : 1.8},
                            {"div":"gas pud", "mmboe" : 20.6}
                            ]
                          },
              "hedge" : 8.5,
              "capex" : 113.8,
              "debt" :  172,
              "stock" : [
                {"key":"price", "value" : 3.74},
                {"key":"shares", "value" : 222.7}
                ],
              "groups" : [
                "Marcellus/Utica"
                ],
              "selected":"no"
            },
            {
              "company" : "EGN", //q2
              "name" : "Energen Corp",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed" : 39.5, "price": 52.48},
                             {"product":"ngl","mboed": 11.7, "price": 13.86},
                             {"product":"gas","mboed": 13.1, "price": 13.38}
                            
                             ],

                            "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .652},
                             {"metric":"cashMargin","percent": .612},
                             {"metric":"net","percent": .087}
                            ],
                            
                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 118.7},
                            {"div":"ngl pd", "mmboe" : 47.6},
                            {"div":"gas pd", "mmboe" : 98.2},
                            {"div":"oil pud", "mmboe" : 62.5},
                            {"div":"ngl pud", "mmboe" : 25.8},
                            {"div":"gas pud", "mmboe" : 19.8}
                            ]
                          },
              "hedge" : 65.9,
              "capex"  : 285,
              "debt" :  685,
              "stock" : [
                {"key":"price", "value" : 50.37},
                {"key":"shares", "value" : 78.8}
                ],
              "groups" : [
                "Permian (Delaware)",
                "Permian (Midland)",
                "Permian (Other)"
                ],
              "selected":"no"
            },
            {
              "company" : "EOG",  //q2
              "name" : "EOG Resources",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed" : 277.5, "price": 57.45},
                             {"product":"ngl","mboed": 73.4, "price": 15.54},
                             {"product":"gas","mboed": 209.5, "price": 14.40}
                             
                             ],

                            "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .644},
                             {"metric":"cashMargin","percent": .614},
                             {"metric":"net","percent": .165}
                            ],
                            
                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 495.1},
                            {"div":"ngl pd", "mmboe" : 264.7},
                            {"div":"gas pd", "mmboe" : 588.1},
                            {"div":"oil pud", "mmboe" : 644.6},
                            {"div":"ngl pud", "mmboe" : 202.3},
                            {"div":"gas pud", "mmboe" : 302.4}
                            ]
                          },
              "hedge" : 193.4,
              "capex" : 1269,
              "debt" :  5033,
              "stock" : [
                {"key":"price", "value" :77.31},
                {"key":"shares", "value" : 549.2}
                ],
              "groups" : [
                "Bakken/Three Forks",
                "DJ/Powder River",
                "Eagle Ford",
                "Permian (Delaware)"
                ],
              "selected":"no"
            },
            {
              "company" : "EPE", //q2
              "name" : "EP Energy",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed" : 63.4, "price": 53.17},
                             {"product":"ngl","mboed": 14.5, "price": 11.91},
                             {"product":"gas","mboed": 31.2, "price": 16.20}
                            
                             ],

                            "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .750},
                             {"metric":"cashMargin","percent": .602},
                             {"metric":"net","percent": .138}
                            ],
                            
                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 128.4},
                            {"div":"ngl pd", "mmboe" : 32.4},
                            {"div":"gas pd", "mmboe" : 77.3},
                            {"div":"oil pud", "mmboe" : 192.4},
                            {"div":"ngl pud", "mmboe" : 61.8},
                            {"div":"gas pud", "mmboe" : 129.9}
                            ]
                          },
              "hedge" : 177,
              "capex"  : 341,
              "debt" :  4893,
              "stock" : [
                {"key":"price", "value" : 6.22},
                {"key":"shares", "value" : 248.8}
                ],
              "groups" : [
                "Eagle Ford",
                "East Texas/Haynesville",
                "Permian (Midland)",
                "Western Rockies"
                ],
              "selected":"no"
            },
            {
              "company" : "FANG",//q2
              "name" : "Diamondback Energy",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed": 22.1, "price": 53.49},
                             {"product":"ngl", "mboed": 4.6, "price": 16.93},
                             {"product":"gas","mboed": 3.3, "price": 14.70}
                             
                             ],

                            "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .781},
                             {"metric":"cashMargin","percent": .709},
                             {"metric":"net","percent": .313}
                            ],
                            
                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 43.9},
                            {"div":"ngl pd", "mmboe" : 11.2},
                            {"div":"gas pd", "mmboe" : 11.4},
                            {"div":"oil pud", "mmboe" : 31.8},
                            {"div":"ngl pud", "mmboe" : 7.3},
                            {"div":"gas pud", "mmboe" : 7.2}
                            ]
                          },
              "hedge" : 25.3,
              "capex" : 88.5,
              "debt" :  673.3,
              "stock" : [
                {"key":"price", "value" : 66.56},
                {"key":"shares", "value" : 66.2}
                ],
              "groups" : [
                "Permian (Midland)"
                ],
              "selected":"no"
            },
            {
              "company" : "GPOR", //q2
              "name" : "Gulfport Energy",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed": 8.0, "price": 50.15},
                             {"product":"ngl", "mboed": 10.3, "price": 12.60},
                             {"product":"gas","mboed": 60.66, "price": 13.38}
                             
                             ],

                            "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .588},
                             {"metric":"cashMargin","percent": .507},
                             {"metric":"net","percent": -.017}
                            ],
                            
                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 5.7},
                            {"div":"ngl pd", "mmboe" : 12.4},
                            {"div":"gas pd", "mmboe" : 57.5},
                            {"div":"oil pud", "mmboe" : 3.8},
                            {"div":"ngl pud", "mmboe" : 13.9},
                            {"div":"gas pud", "mmboe" : 62.3}
                            ]
                          },
              "hedge" : 24.6,
              "capex" : 203,
              "debt" :  411,
              "stock" : [
                {"key":"price", "value" : 35.04},
                {"key":"shares", "value" : 108.2}
                ],
              "groups" : [
                "Marcellus/Utica"
                ],
              "selected":"no"
            },
                      {
              "company" : "HK",//q2
              "name" : "Halcon Resources",
              "values" : {
 
                          "prods" : [
                             {"product":"oil", "mboed": 33.1, "price": 52.58},
                             {"product":"ngl", "mboed": 3.7, "price": 11.68},
                             {"product":"gas","mboed": 4.6, "price": 13.32}
                             ],

                           "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .731},
                             {"metric":"cashMargin","percent": .493},
                             {"metric":"net","percent": .097}
                            ],

                            "reserves" : [
                            {"div":"oil pd", "mmboe" :  62.8},
                            {"div":"ngl pd", "mmboe" : 6.7},
                            {"div":"gas pd", "mmboe" : 8.0},
                            {"div":"oil pud", "mmboe" : 92.8 },
                            {"div":"ngl pud", "mmboe" : 9.6},
                            {"div":"gas pud", "mmboe" : 9.3}
                            ]
                          },
              "hedge" : 88.2,
              "capex" : 112.8,
              "debt" :  3651,
              "stock" : [
                {"key":"price", "value" : 1.05},
                {"key":"shares", "value" : 590.2}
                ],
              "groups" : [
                  "Bakken/Three Forks",
                  "Eagle Ford (East)",
                ],
              "selected":"no"
            },
            {
              "company" : "LPI",//q2
              "name" : "Laredo Petroleum",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed" : 21.3, "price": 50.77},
                             {"product":"ngl","mboed": 12.0, "price": 12.85},
                             {"product":"gas","mboed": 12.4, "price": 10.92}
                             
                             ],

                            "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .675},
                             {"metric":"cashMargin","percent": .535},
                             {"metric":"net","percent": .113}
                            ],
                            
                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 57.0},
                            {"div":"ngl pd", "mmboe" : 0},
                            {"div":"gas pd", "mmboe" : 48.6},
                            {"div":"oil pud", "mmboe" : 83.2},
                            {"div":"ngl pud", "mmboe" : 0},
                            {"div":"gas pud", "mmboe" : 58.6}
                            ]
                          },
              "hedge" : 46.6,
              "capex" : 114,
              "debt" :  1367,
              "stock" : [
                {"key":"price", "value" : 9.92},
                {"key":"shares", "value" : 213.9}
                ],
              "groups" : [
                "Permian (Midland)"
                ],
              "selected":"no"
            },
           {
              "company" : "NBL+", //Q2
              "name" : "Noble Energy",
              "values" : {
 
                          "prods" : [
                             {"product":"oil", "mboed": 97, "price": 54.91},
                             {"product":"ngl", "mboed": 27, "price": 9.64},
                             {"product":"gas","mboed": 171.7, "price": 13.80}
                             ],

                           "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .671},
                             {"metric":"cashMargin","percent": .611},
                             {"metric":"net","percent": .116}
                            ],

                            "reserves" : [
                            {"div":"oil pd", "mmboe" :  174},
                            {"div":"ngl pd", "mmboe" : 72},
                            {"div":"gas pd", "mmboe" : 634.8},
                            {"div":"oil pud", "mmboe" : 130 },
                            {"div":"ngl pud", "mmboe" : 56},
                            {"div":"gas pud", "mmboe" : 337.3}
                            ]
                          },
              "hedge" : 187,
              "capex" : 807,
              "debt" :  4834,
              "stock" : [
                {"key":"price", "value" : 34.53},
                {"key":"shares", "value" : 390}
                ],
              "groups" : [
                  "DJ/Powder River",
                  "Gulf of Mexico",
                  "International(+)",
                  "Marcellus/Utica"
                ],
              "selected":"yes"
            },
            {
              "company" : "NFX",  //q2
              "name" : "Newfield Exploration",
              "values" : {
 
                           "prods" : [
                             {"product":"oil", "mboed": 79.1, "price": 50.49},
                             {"product":"ngl", "mboed": 22.0, "price": 19.17},
                             {"product":"gas","mboed": 54.6, "price": 14.16}
                             
                             ],

                           "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .692},
                             {"metric":"cashMargin","percent": .629},
                             {"metric":"net","percent": .212}
                            ],

                            "reserves" : [
                            {"div":"oil pd", "mmboe" :  144},
                            {"div":"ngl pd", "mmboe" : 38},
                            {"div":"gas pd", "mmboe" : 156.3},
                            {"div":"oil pud", "mmboe" : 157 },
                            {"div":"ngl pud", "mmboe" :  38},
                            {"div":"gas pud", "mmboe" : 111.5}
                            ]
                          },
              "hedge" : 123,
              "capex" : 401,
              "debt" :  2408,
              "stock" : [
                {"key":"price", "value" : 31.60},
                {"key":"shares", "value" : 163}
                ],
              "groups" : [
                  "Bakken/Three Forks",
                  "Eagle Ford",
                  "Mid-Continent",
                  "Western Rockies"
                ],
              "selected":"yes"
            },
          {
              "company" : "OAS*",  //q2
              "name" : "Oasis Petroleum",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed": 44.0, "price": 52.04},
                             {"product":"ngl", "mboed": 0, "price": 0},
                             {"product":"gas","mboed": 6.2, "price": 9.78}
                             
                             ],

                           "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .745},
                             {"metric":"cashMargin","percent": .628},
                             {"metric":"net","percent": .254}
                            ],
                            
                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 127.3},
                            {"div":"ngl pd", "mmboe" : 0},
                            {"div":"gas pd", "mmboe" : 19},
                            {"div":"oil pud", "mmboe" : 108.1},
                            {"div":"ngl pud", "mmboe" : 0},
                            {"div":"gas pud", "mmboe" : 17.7}
                            ]
                          },
              "hedge" : 104.7,
              "capex" : 106.2,
              "debt" :  2341,
              "stock" : [
                {"key":"price", "value" : 10.00},
                {"key":"shares", "value" : 139.2}
                ],
              "groups" : [
                "Bakken/ThreeForks"
                ],
              "selected":"yes"
            },
            {
              "company" : "PDCE",//q2
              "name" : "PDC Energy",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed": 17.4, "price": 48.31},
                             {"product":"ngl", "mboed": 6.2, "price": 10.01},
                             {"product":"gas","mboed": 13.4, "price": 12.18}
                             
                             ],

                            "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .747},
                             {"metric":"cashMargin","percent": .673},
                             {"metric":"net","percent": .172}
                            ],
                            
                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 26.8},
                            {"div":"ngl pd", "mmboe" : 17.0},
                            {"div":"gas pd", "mmboe" : 31.1},
                            {"div":"oil pud", "mmboe" : 73.7},
                            {"div":"ngl pud", "mmboe" : 43.1},
                            {"div":"gas pud", "mmboe" : 58.4}
                            ]
                          },
              "hedge" : 44.1,
              "capex" : 176,
              "debt" :  554,
              "stock" : [
                {"key":"price", "value" : 54.94},
                {"key":"shares", "value" : 40.1}
                ],
              "groups" : [
                "DJ/Powder River",
                "Marcellus/Utica"
                ],
              "selected":"no"
            },
            {
              "company" : "PE",//q2
              "name" : "Parsley Energy",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed": 13.0, "price": 53.61},
                             {"product":"ngl", "mboed": 4.3, "price": 19.76},
                             {"product":"gas","mboed": 4.9, "price": 14.88}
                             
                             ],

                            "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .579},
                             {"metric":"cashMargin","percent": .454},
                             {"metric":"net","percent": -.063}
                            ],
                            
                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 23.5},
                            {"div":"ngl pd", "mmboe" : 11.5},
                            {"div":"gas pd", "mmboe" : 10.9},
                            {"div":"oil pud", "mmboe" : 24.1},
                            {"div":"ngl pud", "mmboe" : 11.2},
                            {"div":"gas pud", "mmboe" : 9.7}
                            ]
                          },
              "hedge" : 8.1,
              "capex" : 74.9,
              "debt" :  580,
              "stock" : [
                {"key":"price", "value" : 16.54},
                {"key":"shares", "value" : 108.8}
                ],
              "groups" : [
                "Permian (Midland)"
                ],
              "selected":"no"
            },
            {
              "company" : "PVA", //q2
              "name" : "Penn Virginia Corp.",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed" : 14.1, "price": 55.22},
                             {"product":"ngl","mboed": 4.2, "price": 13.53},
                             {"product":"gas","mboed": 5.2, "price": 15.24}
                             
                             ],

                            "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .723},
                             {"metric":"cashMargin","percent": .528},
                             {"metric":"net","percent": -.197}
                            ],
                            
                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 22.1},
                            {"div":"ngl pd", "mmboe" : 8.1},
                            {"div":"gas pd", "mmboe" : 15.8},
                            {"div":"oil pud", "mmboe" : 47.0},
                            {"div":"ngl pud", "mmboe" : 11.2},
                            {"div":"gas pud", "mmboe" : 10.8}
                            ]
                          },
              "hedge" : 34.8,
              "capex" : 94,
              "debt" :  1260,
              "stock" : [
                {"key":"price", "value" : 1.09},
                {"key":"shares", "value" : 71.7}
                ],
              "groups" : [
                "Eagle Ford"
                ],
              "selected":"no"
            },
            {
              "company" : "PXD",  //q2
              "name" : "Pioneer Natural Resources",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed": 100.6, "price": 51.64},
                             {"product":"ngl", "mboed": 36.7, "price": 14.03},
                             {"product":"gas","mboed": 59.4, "price": 14.22}
                             
                             ],

                           "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .662},
                             {"metric":"cashMargin","percent": .601},
                             {"metric":"net","percent": .160}
                            ],
                            
                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 267.2},
                            {"div":"ngl pd", "mmboe" : 130.2},
                            {"div":"gas pd", "mmboe" : 247.7},
                            {"div":"oil pud", "mmboe" : 84.9},
                            {"div":"ngl pud", "mmboe" : 39.0},
                            {"div":"gas pud", "mmboe" : 30.5}
                            ]
                          },
              "hedge" : 150,
              "capex" : 360,
              "debt" :  2453,
              "stock" : [
                {"key":"price", "value" : 121.33},
                {"key":"shares", "value" : 149.3}
                ],
              "groups" : [
                "Eagle Ford",
                "Mid-Continent",
                "Permian (Midland)",
                "San Juan/Raton Basins",
                ],
              "selected":"yes"
            },
            {
              "company" : "QEP",  //q2
              "name" : "QEP Resources",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed": 53.6, "price": 51.34},
                             {"product":"ngl", "mboed": 13.2, "price": 21.68},
                             {"product":"gas","mboed": 81.5, "price":  15.12}
                             
                             ],

                           "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .565},
                             {"metric":"cashMargin","percent": .463},
                             {"metric":"net","percent": .020}
                            ],
                            
                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 99.3},
                            {"div":"ngl pd", "mmboe" : 52.2},
                            {"div":"gas pd", "mmboe" : 214.7},
                            {"div":"oil pud", "mmboe" : 73.2},
                            {"div":"ngl pud", "mmboe" : 44.4},
                            {"div":"gas pud", "mmboe" : 171.5}
                            ]
                          },
              "hedge" : 92,
              "capex" : 274,
              "debt" :  1773,
              "stock" : [
                {"key":"price", "value" : 13.70},
                {"key":"shares", "value" : 176.7}
                ],
              "groups" : [
                "Bakken/ThreeForks",
                "DJ/Powder River",
                "East Texas/Haynesville",
                "Permian (Midland)",
                "Western Rockies"
                ],
              "selected":"yes"
            },
            {
              "company" : "RICE", //q2
              "name" : "Rice Energy",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed": 0, "price": 0},
                             {"product":"ngl", "mboed": 0, "price": 0},
                             {"product":"gas","mboed": 88.1, "price": 12.54}
                             
                             ],

                           "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .573},
                             {"metric":"cashMargin","percent": .409},
                             {"metric":"net","percent": -.103}
                            ],

                            "reserves" : [
                            {"div":"oil pd", "mmboe" :  0},
                            {"div":"ngl pd", "mmboe" : 0},
                            {"div":"gas pd", "mmboe" : 107.3},
                            {"div":"oil pud", "mmboe" : 0},
                            {"div":"ngl pud", "mmboe" :  0},
                            {"div":"gas pud", "mmboe" : 110.4}
                            ]
                          },
              "hedge" : 42.3,
              "capex" : 212,
              "debt" :  1161,
              "stock" : [
                {"key":"price", "value" : 18.78},
                {"key":"shares", "value" : 136.4}
                ],
              "groups" : [
                "Marcellus/Utica"
                ],
              "selected":"yes"
            },
            {
              "company" : "RRC",//q2
              "name" : "Range Resources",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed" : 12.0, "price": 41.71},
                             {"product":"ngl","mboed": 56.1 , "price": 8.02},
                             {"product":"gas","mboed": 160.7, "price": 11.76}
                             
                             ],

                            "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .542},
                             {"metric":"cashMargin","percent": .428},
                             {"metric":"net","percent": .031}
                            ],
                            
                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 24.2},
                            {"div":"ngl pd", "mmboe" : 270.3},
                            {"div":"gas pd", "mmboe" : 597.2},
                            {"div":"oil pud", "mmboe" : 24.5},
                            {"div":"ngl pud", "mmboe" : 245.6},
                            {"div":"gas pud", "mmboe" : 555.6}
                            ]
                          },
              "hedge" : 125.2,
              "capex" : 285,
              "debt" :  3464,
              "stock" : [
                {"key":"price", "value" : 38.33},
                {"key":"shares", "value" : 169.4}
                ],
              "groups" : [
                "Marcellus/Utica"
                ],
              "selected":"no"
            },
            {
              "company" : "RSPP", //q2
              "name" : "RSP Permian",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed": 15.1, "price": 53.68},
                             {"product":"ngl", "mboed": 2.9, "price": 9.69},
                             {"product":"gas","mboed": 1.9, "price": 11.82}
                             
                             ],

                            "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .746},
                             {"metric":"cashMargin","percent": .649},
                             {"metric":"net","percent": .241}
                            ],
                            
                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 27.7},
                            {"div":"ngl pd", "mmboe" : 8.2},
                            {"div":"gas pd", "mmboe" : 6.0},
                            {"div":"oil pud", "mmboe" : 41.6},
                            {"div":"ngl pud", "mmboe" : 13.5},
                            {"div":"gas pud", "mmboe" : 9.4}
                            ]
                          },
              "hedge" : 18.6,
              "capex" : 147,
              "debt" :  456,
              "stock" : [
                {"key":"price", "value" : 22.80},
                {"key":"shares", "value" : 84}
                ],
              "groups" : [
                "Permian (Midland)"
                ],
              "selected":"no"
            },
            {
              "company" : "SM",//q2
              "name" : "SM Energy",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed": 55.9, "price": 51.45},
                             {"product":"ngl", "mboed": 44.2, "price": 16.85},
                             {"product":"gas","mboed": 81.0, "price": 15.18}
                             
                             ],

                            "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .635},
                             {"metric":"cashMargin","percent": .581},
                             {"metric":"net","percent": .198}
                            ],
                            
                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 89.3},
                            {"div":"ngl pd", "mmboe" : 66.7},
                            {"div":"gas pd", "mmboe" : 130.8},
                            {"div":"oil pud", "mmboe" : 80.4},
                            {"div":"ngl pud", "mmboe" : 66.8},
                            {"div":"gas pud", "mmboe" : 113.7}
                            ]
                          },
              "hedge" : 131.5,
              "capex" : 339,
              "debt" :  2390,
              "stock" : [
                {"key":"price", "value" : 34.73},
                {"key":"shares", "value" : 67.6}
                ],
              "groups" : [
                "Bakken/Three Forks",
                "Eagle Ford"
                ],
              "selected":"no"
            },
            {
              "company" : "SN",  //q2
              "name" : "Sanchez Energy",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed": 21.1, "price": 51.90},
                             {"product":"ngl", "mboed": 16.1, "price": 12.06},
                             {"product":"gas","mboed": 16.7, "price": 15.72}
                             
                             ],

                           "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .656},
                             {"metric":"cashMargin","percent": .470},
                             {"metric":"net","percent": -.149}
                            ],

                            "reserves" : [
                            {"div":"oil pd", "mmboe" :  27.4},
                            {"div":"ngl pd", "mmboe" : 18.6},
                            {"div":"gas pd", "mmboe" : 18.4},
                            {"div":"oil pud", "mmboe" : 37.1},
                            {"div":"ngl pud", "mmboe" : 16.7},
                            {"div":"gas pud", "mmboe" : 16.5}
                            ]
                          },
              "hedge" : 28.1,
              "capex" : 133,
              "debt" :  1476,
              "stock" : [
                {"key":"price", "value" : 5.94},
                {"key":"shares", "value" : 61.9}
                ],
              "groups" : [
                "Eagle Ford",
                "Tuscaloosa"
                ],
              "selected":"yes"
            },
            {
              "company" : "SWN", //Q2
              "name" : "Southwestern Energy",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed": 6.5, "price": 40.88},
                             {"product":"ngl", "mboed": 28.3, "price": 5.77},
                             {"product":"gas","mboed": 413.9, "price": 10.56}
                             
                             ],

                           "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .444},
                             {"metric":"cashMargin","percent": .442},
                             {"metric":"net","percent": -.094}
                            ],
                            
                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 7.4},
                            {"div":"ngl pd", "mmboe" : 38.6},
                            {"div":"gas pd", "mmboe" : 945.8},
                            {"div":"oil pud", "mmboe" : 30.2},
                            {"div":"ngl pud", "mmboe" : 80.1},
                            {"div":"gas pud", "mmboe" : 689}
                            ]
                          },
              "hedge" : 106,
              "capex" : 389,
              "debt" :  4502,
              "stock" : [
                {"key":"price", "value" : 16.00},
                {"key":"shares", "value" : 384.5}
                ],
              "groups" : [
                "Fayetteville",
                "Marcellus/Utica"
                ],
              "selected":"yes"
            },
            {
              "company" : "UPL", //q2
              "name" : "Ultra Petroleum",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed": 9.9, "price": 48.64},
                             {"product":"ngl", "mboed": 0, "price": 0},
                             {"product":"gas","mboed": 119.3, "price":  15.12}
                             
                             ],

                            "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .671},
                             {"metric":"cashMargin","percent": .524},
                             {"metric":"net","percent": .206}
                            ],
                            
                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 28.5},
                            {"div":"ngl pd", "mmboe" : 9.1},
                            {"div":"gas pd", "mmboe" : 374.2},
                            {"div":"oil pud", "mmboe" : 39.3},
                            {"div":"ngl pud", "mmboe" : 12.9},
                            {"div":"gas pud", "mmboe" : 431.0}
                            ]
                          },
              "hedge" : 81.9,
              "capex" : 135.4,
              "debt" :  3363,
              "stock" : [
                {"key":"price", "value" : 8.36},
                {"key":"shares", "value" : 153.2}
                ],
              "groups" : [
                "DJ/Powder River",
                "Western Rockies"
                ],
              "selected":"no"
            },
            {
              "company" : "WLL",  //q2
              "name" : "Whiting Petroleum",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed": 136.5, "price": 48.95},
                             {"product":"ngl", "mboed": 14.3, "price": 16.86},
                             {"product":"gas","mboed": 19.4, "price": 11.52}
                             
                             ],

                           "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .630},
                             {"metric":"cashMargin","percent": .497},
                             {"metric":"net","percent": .018}
                            ],
                            
                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 198.2},
                            {"div":"ngl pd", "mmboe" : 23.7},
                            {"div":"gas pd", "mmboe" : 30.5},
                            {"div":"oil pud", "mmboe" : 149.2},
                            {"div":"ngl pud", "mmboe" : 21.1},
                            {"div":"gas pud", "mmboe" : 15.7}
                            ]
                          },
              "hedge" : 22.9,
              "capex" : 751.3,
              "debt" :  5185,
              "stock" : [
                {"key":"price", "value" : 17.60},
                {"key":"shares", "value" : 204.1}
                ],
              "groups" : [
                "Bakken/Three Forks",
                "DJ/Powder River"
                ],
              "selected":"yes"
            },
            {
              "company" : "WPX",  //q2
              "name" : "WPX Energy",
              "values" : {
 
                           "prods" : [
                             
                             
                             {"product":"oil", "mboed": 32.7, "price": 48.73},
                             {"product":"ngl", "mboed": 19.7, "price": 13.95},
                             {"product":"gas","mboed": 112.5, "price": 12.41}
                             
                             ],

                           "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .524},
                             {"metric":"cashMargin","percent": .450},
                             {"metric":"net","percent": -.079}
                            ],
                            
                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 60.0},
                            {"div":"ngl pd", "mmboe" : 44.0},
                            {"div":"gas pd", "mmboe" : 348.3},
                            {"div":"oil pud", "mmboe" : 70.8},
                            {"div":"ngl pud", "mmboe" : 26.9},
                            {"div":"gas pud", "mmboe" : 176.6}
                            ]
                          },
              "hedge" : 132,
              "capex" : 138,
              "debt" :  1683,
              "stock" : [
                {"key":"price", "value" : 7.06},
                {"key":"shares", "value" : 235.2}
                ],
              "groups" : [
                "Bakken/ThreeForks",
                "Western Rockies",
                "San Juan/Raton Basins",
                ],
              "selected":"yes"
            },
            {
              "company" : "XCO", //q2
              "name" : "EXCO Resources",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed" : 6.5, "price": 53.11},
                             {"product":"ngl","mboed": 0, "price": 0},
                             {"product":"gas","mboed": 53.7, "price": 12.72}
                            
                             ],

                            "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .515},
                             {"metric":"cashMargin","percent": .307},
                             {"metric":"net","percent": -.195}
                            ],
                            
                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 14.4},
                            {"div":"ngl pd", "mmboe" : 0},
                            {"div":"gas pd", "mmboe" : 84.1},
                            {"div":"oil pud", "mmboe" : 3.3},
                            {"div":"ngl pud", "mmboe" : 0},
                            {"div":"gas pud", "mmboe" : 108.8}
                            ]
                          },
              "hedge" : 29.4,
              "capex"  : 75,
              "debt" :  1475,
              "stock" : [
                {"key":"price", "value" : 0.77},
                {"key":"shares", "value" : 277.2}
                ],
              "groups" : [
                "Eagle Ford",
                "East Texas/Haynesville",
                "Marcellus/Utica"
                ],
              "selected":"no"
            },            {
              "company" : "XEC", //q2
              "name" : "Cimarex Energy",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed": 56.3, "price": 50.66},
                             {"product":"ngl", "mboed": 37.1, "price": 14.67},
                             {"product":"gas","mboed": 77.7, "price": 15.06}
                             
                             ],

                           "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .623},
                             {"metric":"cashMargin","percent": .593},
                             {"metric":"net","percent": .070}
                            ],
                            
                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 100.1},
                            {"div":"ngl pd", "mmboe" : 89.6},
                            {"div":"gas pd", "mmboe" : 210.7},
                            {"div":"oil pud", "mmboe" : 19.1},
                            {"div":"ngl pud", "mmboe" : 35.6},
                            {"div":"gas pud", "mmboe" : 67.1}
                            ]
                          },
              "hedge" : 0,
              "capex" : 190,
              "debt" :  643,
              "stock" : [
                {"key":"price", "value" : 107.75},
                {"key":"shares", "value" : 94.5}
                ],
              "groups" : [
                "Mid-Continent",
                "Permian (Delaware)"
                ],
              "selected":"yes"
            }
            ];
var q2 = 91;

var global_prod = 0;
var global_prod_oil = 0;
var global_prod_ngl = 0;
var global_prod_gas = 0;

var global_rev = 0;
var global_rev_oil = 0;
var global_rev_ngl = 0;
var global_rev_gas = 0;

var global_pr = 0;
var global_pr_oil_pd = 0;
var global_pr_oil_pud = 0;
var global_pr_ngl_pd = 0;
var global_pr_ngl_pud = 0;
var global_pr_gas_pd = 0;
var global_pr_gas_pud = 0;

var global_average_ebitda = 0;
var global_average_cashMargin = 0;
var global_average_net = 0;

var global_average_pretax_net = 0;
var global_average_DDA = 0;
var global_average_interest = 0;
var global_average_ebitdaCst = 0;

var alt_oil_price = 50;


var rand = [0,1,2,3];

rand.forEach(function (d,i) { rand[i] = Math.floor (Math.random() * data.length);} );

data.forEach(function (d,i) {
  if (i == rand[0] || i == rand[1] || i == rand[2] || i == rand[3])
  {data[i].selected = "yes";}
  else {data[i].selected = "no";}
})


function addData (d) {
  d.prod_total = 0;
  d.rev_total = 0;
  d.rev_total_alt = 0;
  d.pr_total = 0;
  d.pr_oil = 0;
  d.pr_liquids = 0;

  
  d.values.prods.forEach(function(e) {
    if (e.product == "oil") {e.price_alt = alt_oil_price;}
    else {e.price_alt = e.price;}
    d.prod_total += e.mboed;
    d.rev_total += (e.mboed * e.price * q2 / 1000);
    d.rev_total_alt += (e.mboed * e.price_alt * q2 / 1000);

    });
    
  d.boe_price = (d.rev_total/ q2 * 1000)/d.prod_total;
  d.boe_price_hedged = d.boe_price + ((d.hedge/ q2 * 1000)/d.prod_total);
  d.ev = [
    {"name": "market cap", "value": d.stock[0].value * d.stock[1].value},
    {"name": "debt", "value": d.debt}
    ];
    
  d.da_shares = (d.ev[1].value/d.stock[0].value) + d.stock[1].value;
 

  d.values.corp.reverse();
      var base = 0;
  d.values.corp.forEach(function(e) {
    e.dollars = (d.rev_total + d.hedge) * e.percent;
    e.difference = e.percent - base;
    e.dif_dollars = (d.rev_total + d.hedge) * e.difference;
    base = e.percent;
    e.dollars_alt = d.rev_total_alt - ((d.rev_total + d.hedge) * (1- e.percent));
  });
  
  d.capex = [
    {"name":"capex", "value" : d.capex},
    {"name":"cash margin","value": d.values.corp[1].dollars}
    ];
    
  d.values.reserves.forEach(function(e) {
    
    d.pr_total += e.mmboe;
  });
  
  var pud_temp_total = 0;
  d.values.reserves.filter(function (d) {return d.div == "oil pud" || d.div == "ngl pud" || d.div == "gas pud";}).forEach(function(e) {
    pud_temp_total += e.mmboe;
    d.pr_pud_percent = pud_temp_total/d.pr_total;
  });
  
  d.values.reserves.filter(function (d) {return d.div == "oil pd" || d.div == "ngl pd" || d.div ==  "oil pud" || d.div == "ngl pud" ;}).forEach(function(e) {
    d.pr_liquids += e.mmboe;
  });
  
    d.values.reserves.filter(function (d) {return d.div == "oil pd" || d.div ==  "oil pud" ;}).forEach(function(e) {d.pr_oil += e.mmboe;});
 
 global_prod += d.prod_total;
 global_prod_oil += d.values.prods[0].mboed;
 global_prod_ngl += d.values.prods[1].mboed;
 global_prod_gas += d.values.prods[2].mboed;
 
 global_rev += d.rev_total;
 global_rev_oil += d.values.prods[0].mboed * d.values.prods[0].price * q2 / 1000;
 global_rev_ngl += d.values.prods[1].mboed * d.values.prods[1].price * q2 / 1000;
 global_rev_gas += d.values.prods[2].mboed * d.values.prods[2].price * q2 / 1000;
 
 global_pr += d.pr_total;
 global_pr_oil_pd += d.values.reserves[0].mmboe;
 global_pr_oil_pud += d.values.reserves[3].mmboe;
 global_pr_ngl_pd += d.values.reserves[1].mmboe;
 global_pr_ngl_pud += d.values.reserves[4].mmboe;
 global_pr_gas_pd += d.values.reserves[2].mmboe;
 global_pr_gas_pud += d.values.reserves[5].mmboe;

}
                       


data.forEach(addData);

var global_pud_percent = (global_pr_oil_pud + global_pr_ngl_pud + global_pr_gas_pud)/global_pr;


function selector(d) {return d.selected == "yes";}

var current_data = data.filter(selector);

console.log(current_data);


var order = "abc";  //default sort

var dollars = d3.format("$,");

var dollars2 = d3.format("$.2f");


var percent = d3.format("%,1");

var mode = "PROD_UN";

var margin = {top: 25, right: 600, bottom: 575, left: 50},
    width = 535,
    height = 260,
    
    //width = 1300 - margin.left - margin.right,
    //1600  less 660  -need 640
    contract_width = 200; // shrink delta
   // height = 960 - margin.top - margin.bottom;
   //1030 less 600  - need 360

var x = d3.scale.ordinal()
    .domain(current_data.map(function(d){return d.company;}))
    .rangeRoundBands([0, width], .5);
    
var x_prods = d3.scale.ordinal()
    .domain(["oil","ngl","gas"])
    .rangeRoundBands([0, x.rangeBand()]);
    
var x_corp = d3.scale.ordinal()
    .domain(["postHedge","ebitda","cashMargin", "net"])
    .rangeRoundBands([0, x.rangeBand()]);
    
var x_reserves = d3.scale.ordinal()
    .domain(["oil pd","oil pud","ngl pd","ngl pud","gas pd","gas pud"])
    .rangeRoundBands([0, x.rangeBand()]);
    
var x_capex = d3.scale.ordinal()
    .domain(["capex", "cash margin"])
    .rangeRoundBands([0, x.rangeBand()]);
    
var legend_scale = d3.scale.ordinal()
    .rangeRoundBands([0, 550], .5);
    
var y = d3.scale.linear()
    .domain([0, (d3.max(current_data, function(d) { return d3.max(d.values.prods, function(d) {return d.mboed;}) })) * 1.05])
    .range([height, 0]);

var y_right = d3.scale.linear()
    .domain([0, (d3.max(current_data, function(d) { return d3.max(d.values.prods, function(d) {return d.mboed;}) })) * 1.05 * 6])
    .range([height, 0]);
    
    
// colors
var clr_graph_bkgrnd = "rgb(245,245,245)";
var clr_abc = "black";
// product colors
var clr_oil = "rgb(200,0,40)";
var clr_ngl = "rgb(255,240,0)";
var clr_gas = "rgb(0,0,200)";
var clr_liquids = "url(#liquids)";
var clr_total = "url(#total)"; // also used for PUD reserves
var clr_oil_l = "rgb(255,70,150)"; //lighter red, yellow and blue
var clr_ngl_l = "rgb(255,250,110)";
var clr_gas_l = "rgb(100,100,255)";
var clr_pr = "url(#pr)";
var clr_pr_oil = "url(#pr_oil)";
var clr_pr_liquids = "url(#pr_liquids)";
var clr_pr_gas = "url(#pr_gas)";
var clr_pud = "url(#pud)";

//income metric colors
var clr_gross = "rgb(230,97,1)";
var clr_ebitda = "rgb(253,184,99)";
var clr_cashMargin = "rgb(178,171,210)";
var clr_net = "rgb(94,60,153)";

//cost analysis colors
var clr_ebtidaCosts = "rgb(166,97,26)";
var clr_interest = "rgb(223,194,125)";
var clr_DDA = "rgb(128,205,193)";
var clr_netIncome = "rgb(1,133,113)";

var clr_ev = "url(#ev)";


var colors_prods = d3.scale.ordinal()
    .domain(["oil","ngl","gas"])
    .range([clr_oil, clr_ngl, clr_gas]);
    
var colors_prods_s = d3.scale.ordinal()
    .domain(["oil","ngl","gas"])
    .range([clr_oil_l,clr_ngl_l,clr_gas_l]);

    
var colors_income = d3.scale.ordinal()
    .domain(["rev_total","ebitda","cashMargin", "net"])
    .range([clr_gross, clr_ebitda, clr_cashMargin, clr_net]);
    
var colors_income_s = d3.scale.ordinal()  // for costs
    .domain(["rev_total","ebitda","cashMargin", "net"])
    .range([clr_ebtidaCosts, clr_interest, clr_DDA, clr_netIncome]);
    
var colors_reserves = d3.scale.ordinal()
    .domain(["oil pd","ngl pd","gas pd","oil pud","ngl pud","gas pud"])
    .range([clr_oil, clr_ngl, clr_gas, clr_oil_l,clr_ngl_l,clr_gas_l]);
    
var colors_capex = d3.scale.ordinal()
    .domain(["capex","cash margin"])
    .range(["darkgreen", "lightgreen"]);
    
var colors_ev = d3.scale.ordinal()
    .domain(["market cap","debt"])
    .range(["darkgreen", "lightgreen"]);


// axis objects

var xAxis = d3.svg.axis()
    .scale(x)
    .orient("bottom");

var yAxis = d3.svg.axis()
    .scale(y)
    .orient("left")
    .tickFormat(null)
    .ticks(10);
    
var yAxis_right = d3.svg.axis()
    .scale(y_right)
    .orient("right")
    .tickFormat(null)
    .ticks(10);
  
// svg setup and opening graph

var contracted = "no";  // main graph opens uncontracted -toggled by clicking on main_background rect

var svg = d3.select("body").append("svg")
    //.attr("width", width + margin.left + margin.right)
    //.attr("height", height + margin.top + margin.bottom)
        .attr("width", 640)
    .attr("height", 360)
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
    
    
var guide = svg.append("rect")
    .attr("width", 640)
    .attr("height", 360)
    .style("fill", "none")
    .attr("x", -margin.left)
      .attr("y", -margin.top)
      .style("stroke", "black")
      .style("stroke-width", "1px");
    
var main_background = svg.append("rect")
    .attr("width", width)
    .attr("height", height)
    .style("fill", clr_graph_bkgrnd);
    
var axis_x = svg.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(0," + height + ")")
      .call(xAxis); axis_x.call(xAxis);

var axis_y = svg.append("g")
      .attr("class", "y axis")
      .call(yAxis);
      
var axis_label = axis_y.append("text")
      .attr("x", -20)
      .attr("y", -5)
      .classed("label", true)
      .style("text-anchor", "start")
      .text("boe/day (1000's)");
      
var axis_y_right = svg.append("g")
      .attr("class", "y axis")
      .attr("transform", "translate(" + width + ", 0)")
      .call(yAxis_right);
      
var axis_label_right = axis_y_right.append("text")
      .classed("label", true)
      .attr("x", 20)
      .attr("y", -5)
      .style("text-anchor", "end")
      .text("mcfe/day (1000's)");
      

   //  data display (rects
var group = svg.append("g")
.style("cursor", "pointer");





//RESTORE COMPANY LOAD HERE!!!
      
//  END OF GENERAL SETUP BLOCK



     
// RULE BLOCK


      
var zero_rule = svg.append("line")
      .attr("x1", 0 )
      .attr("x2", width)
      .attr("y1", height)
      .attr("y2", height)
      .style("stroke", "black")
      .style("shape-rendering", "crispEdges")
      .style("stroke-width", "1");
      


var rule_group = svg.append("g")
    .style("visibility", "hidden");
  
var rule = rule_group.append("rect")
      .attr("x", 0 )
      .attr("width", width)
      .attr("y", 150)
      .attr("height", 1 );
      
var text_left = rule_group.append("text")
      .attr("x", 10 )
      .attr("y", 150)
      .text("")
      .classed("label", true)
      .style("font-size", "11px");

var text_center = rule_group.append("text")
      .attr("x", 10 )
      .attr("y", 150)
      .text("")
      .classed("label", true)
      .style("font-size", "11px");

var text_right = rule_group.append("text")
      .attr("x", 10 )
      .attr("y", 150)
      .text("")
      .classed("label", true)
      .style("font-size", "11px");

function show_rule(d) {

              
// test to prove that data is passed automatically, even though function (ie show_rule) is not called with an argument. The data is automtaically passed as a parameter and s.datum here is unncessary.  It should work more simply by just denfing show_rule(ob)
              
              var s = d3.select(this);
              var ob = s.datum();
              var equiv_price  = s[0][0].parentNode.__data__.boe_price;
              var equiv_price_hedged  = s[0][0].parentNode.__data__.boe_price_hedged;
              var tot_prod  = s[0][0].parentNode.__data__.prod_total;
              var tot_rev = s[0][0].parentNode.__data__.rev_total;
              var tot_rev_alt = s[0][0].parentNode.__data__.rev_total_alt;
              var tot_pr = s[0][0].parentNode.__data__.pr_total;
              var hedge = s[0][0].parentNode.__data__.hedge;

              // to place center text using offset of current g
              var str = d3.select(s[0][0].parentNode).attr("transform" );
              str = str.slice( (str.indexOf( "(" ) +1)  , str.indexOf( "," ) );
              if (str.indexOf( ")") != -1)  //for IE jscript, which generates a different string format
              {str = str.slice( 0  , str.indexOf( ")" ) );}
              
              var rule_y;  //to address negative values
              
              //capture negative income metrics (percent), single values (eg. hedge), and cash margin in capex (value)
              if (ob.percent < 0 || ob < 0 || ob.value < 0) {rule_y = (+s.attr("height")) + (+s.attr("y"));}
              else { rule_y = s.attr("y");}
              
              rule_group.style("visibility", "visible");
                          
              rule.attr("width", width);
              rule.attr("y", rule_y );
              rule.style("fill", s.style("fill"));

              text_left.attr("y", rule_y - 4);
              text_center.style("font-size", "11px")
              text_right.attr("y", rule_y - 4);


  switch(mode) {
    case "PROD_S":
        text_left.text(d3.round(y.invert(rule_y),1));
        text_left.attr("x",1);
        text_left.attr("text-anchor", "start");
        
        text_center.attr("x",  (+s.attr("x") + (+str) + (x.rangeBand()/2) )  );
        text_center.text(percent( y.invert(height - s.attr("height")) / tot_prod));
        text_center.attr("text-anchor", "middle");
        text_center.attr("y", +s.attr("y") + (+s.attr("height")/2) );
        
        text_right.text(d3.round((y.invert(rule_y)*6),1));
        text_right.attr("x", width);
        text_right.attr("text-anchor", "end");
        break;
    case "PROD_UN":
        text_left.text(ob.mboed);
        text_left.attr("x", 1);
        text_left.attr("text-anchor", "start");

        text_center.attr("x",  (+s.attr("x") + (+str) + (x_prods.rangeBand()/2)  )  );
        text_center.text(percent(ob.mboed/tot_prod));
        text_center.attr("text-anchor", "middle");
        text_center.attr("y", rule.attr("y") - 4);
        
        text_right.text(d3.round((ob.mboed * 6),1));
        text_right.attr("x", width);
        text_right.attr("text-anchor", "end");
        break;
    case "REV_S":
        text_left.text(dollars(d3.round(y.invert(rule_y),0)));
        text_left.attr("x",0);
        text_left.attr("text-anchor", "start");
        
        text_center.attr("x",  (+s.attr("x") + (+str) + (x.rangeBand()/2) )  );
        //text_center.text(percent( y.invert(rule_y)  / tot_rev));  //cumed percent
        text_center.text(percent( y.invert(height - s.attr("height")) / tot_rev)); //individual percent
        text_center.attr("text-anchor", "middle");
        text_center.attr("y", +s.attr("y") + (+s.attr("height")/2) );
        
        text_right.text(dollars(d3.round(y.invert(rule_y) *4 ,0)));
        text_right.attr("x", width);
        text_right.attr("text-anchor", "end");
        break;
    case "REV_UN":
        text_left.text(dollars(d3.round(ob.mboed * (ob.price/1000) * q2),0));
        text_left.attr("x", 0);
        text_left.attr("text-anchor", "start");
        
        text_center.attr("x",  (+s.attr("x") + (+str) + (x_prods.rangeBand()/2) )  );
        text_center.text(percent(  (ob.mboed * (ob.price/1000) * q2)  / tot_rev));
        text_center.attr("text-anchor", "middle");
        text_center.attr("y", rule.attr("y") - 4);
        
        text_right.text(dollars(d3.round(ob.mboed * (ob.price/1000 * 4) * q2),0));
        text_right.attr("x", width);
        text_right.attr("text-anchor", "end");
        break;
    case "PRICE_S":
        text_left.text(dollars(d3.round(y.invert(rule_y),2)  ));
        text_left.attr("x",1);
        text_left.attr("text-anchor", "start");
        
        text_center.attr("x",  (+s.attr("x") + (+str) + (x.rangeBand()/2) )  );
        text_center.text(percent( y.invert(height - s.attr("height")) / equiv_price)     );
        text_center.attr("text-anchor", "middle");
        text_center.attr("y", +s.attr("y") + (+s.attr("height")/2) );
        
        text_right.text(dollars(d3.round((y.invert(rule_y)/6),2)));
        text_right.attr("x", width);
        text_right.attr("text-anchor", "end");
        break;
    case "PRICE_UN":
        text_left.text(dollars(ob.price));
        text_left.attr("x", 1);
        text_left.attr("text-anchor", "start");
        
        text_center.text("");
        text_center.attr("y", rule.attr("y") - 4);
        
        text_right.text(dollars(d3.round((ob.price / 6),2)));
        text_right.attr("x", width);
        text_right.attr("text-anchor", "end");
        break;
    case "INC_QU_S":
        text_left.text(dollars(d3.round(y.invert(rule_y),0)  ));
        text_left.attr("x", 1);
        text_left.attr("text-anchor", "start");
        
        text_center.attr("x",  (+s.attr("x") + (+str) + (x.rangeBand()/2) )  );
        text_center.text(dollars(d3.round(ob.dif_dollars)));
        text_center.attr("text-anchor", "middle");
        text_center.attr("y", +s.attr("y") + (+s.attr("height")/2) );
        
        text_right.text(dollars(d3.round((y.invert(rule_y)*4),0)));
        text_right.attr("x", width);
        text_right.attr("text-anchor", "end");
        break;
    case "INC_QU_UN":
      
        text_left.text(dollars(d3.round((ob.dollars),0)));
        text_left.attr("x", 1);
        text_left.attr("text-anchor", "start");
        
        text_center.attr("x",  (+s.attr("x") + (+str) + (x_corp.rangeBand()/2) + 3 )  );
        text_center.text(percent(ob.percent));
        text_center.attr("text-anchor", "middle");
        text_center.attr("y", rule.attr("y") - 4);
        
        text_right.text(dollars(d3.round((ob.dollars *4),0)));
        text_right.attr("x", width);
        text_right.attr("text-anchor", "end");
        break;

    case "INC_BOE_UN":
        text_left.text(dollars(d3.round((ob.percent * equiv_price_hedged),2)));
        text_left.attr("x", 1);
        text_left.attr("text-anchor", "start");
        
        text_center.attr("x",  (+s.attr("x") + (+str) + (x_corp.rangeBand()/2) + 3 )  );
        text_center.text(percent(ob.percent));
        text_center.attr("text-anchor", "middle");
        text_center.attr("y", rule.attr("y") - 4);
        
        text_right.text(dollars(d3.round((ob.percent * equiv_price_hedged / 6),2)));
        text_right.attr("x", width);
        text_right.attr("text-anchor", "end");
        break;
    case "INC_BOE_S":
        text_left.text(dollars(d3.round(y.invert(rule_y),2)  ));
        text_left.attr("x", 1);
        text_left.attr("text-anchor", "start");
        
        text_center.attr("x",  (+s.attr("x") + (+str) + (x.rangeBand()/2) )  );
        text_center.text(dollars(d3.round(ob.difference * equiv_price_hedged  ,2)));
        text_center.attr("text-anchor", "middle");
        text_center.attr("y", +s.attr("y") + (+s.attr("height")/2) );

        
        text_right.text(dollars(d3.round((y.invert(rule_y)/6),2)));
        text_right.attr("x", width);
        text_right.attr("text-anchor", "end");
        break;
    case "INC_PERC_UN":
        text_left.text(percent(ob.percent));
        text_left.attr("x", 1);
        text_left.attr("text-anchor", "start");
        
        text_center.attr("x",  (+s.attr("x") + (+str) + (x_corp.rangeBand()/2) + 3 )  );
        text_center.text("");
        text_center.attr("text-anchor", "middle");
        text_center.attr("y", rule.attr("y") - 4);
        
        text_right.text(percent(ob.percent));
        text_right.attr("x", width);
        text_right.attr("text-anchor", "end");
        break;
    case "INC_PERC_S":
        text_left.text(percent(y.invert(s.attr("y") ) ));
        text_left.attr("x", 1);
        text_left.attr("text-anchor", "start");
        
        text_center.attr("x",  (+s.attr("x") + (+str) + (x.rangeBand()/2) )  );
        text_center.text(percent(ob.difference));
        text_center.attr("text-anchor", "middle");
        text_center.attr("y", +s.attr("y") + (+s.attr("height")/2) );

        
        text_right.text("");
        text_right.attr("x", width);
        text_right.attr("text-anchor", "end");
        break;
    case "RESERVES_UN":
        text_left.text(ob.mmboe);
        text_left.attr("x", 1);
        text_left.attr("text-anchor", "start");

        text_center.attr("x",  (+s.attr("x") + (+str) + (x_reserves.rangeBand()/2) )  );
        text_center.text(percent(ob.mmboe/tot_pr));
        text_center.attr("text-anchor", "middle");
        text_center.attr("y", rule.attr("y") - 4);
        
        text_right.text(d3.round((ob.mmboe * 6),1));
        text_right.attr("x", width);
        text_right.attr("text-anchor", "end");
        break;
    case "RESERVES_S":
        text_left.text(d3.round(y.invert(s.attr("y") )),0);
        text_left.attr("x", 1);
        text_left.attr("text-anchor", "start");
        
        
        text_center.attr("x",  (+s.attr("x") + (+str) + (x.rangeBand()/2) )  );
        text_center.text(d3.round((ob.mmboe),1)   );
        text_center.attr("text-anchor", "middle");
        text_center.attr("y", +s.attr("y") + (+s.attr("height")/2) );
        
        
        text_right.text(d3.round(y.invert(s.attr("y") )*6),0);
        text_right.attr("x", width);
        text_right.attr("text-anchor", "end");
        break;
    case "CAPEX":
        text_left.text(dollars(d3.round(y.invert(rule_y)),0));
        text_left.attr("x", 1);
        text_left.attr("text-anchor", "start");
        
        
        text_center.attr("x",  (+s.attr("x") + (+str) + (x.rangeBand()/2) )  );
        text_center.text("");
        text_center.attr("text-anchor", "middle");
        text_center.attr("y", +s.attr("y") + (+s.attr("height")/2) );
        
        
        text_right.text(dollars(d3.round(y.invert(rule_y)),0));
        text_right.attr("x", width);
        text_right.attr("text-anchor", "end");
        break;
    case "HEDGE":
        text_left.text(percent(y.invert(rule_y))  );
        text_left.attr("x", 1);
        text_left.attr("text-anchor", "start");
        
        
        text_center.attr("x",  (+s.attr("x") + (+str) + (x.rangeBand()/2) )  );
        text_center.text("$"+ hedge +  "MM");
        text_center.attr("text-anchor", "middle");
        text_center.attr("y", +s.attr("y") + (+s.attr("height")/2) );
        
        
        text_right.text(percent(y.invert(rule_y))  );
        text_right.attr("x", width);
        text_right.attr("text-anchor", "end");
        break;
        
    case "HEDGE_BOE":
        text_left.text(dollars(d3.round(y.invert(rule_y),2)  ));
        text_left.attr("x", 1);
        text_left.attr("text-anchor", "start");
        
        
        text_center.attr("x",  (+s.attr("x") + (+str) + (x.rangeBand()/2) )  );
        text_center.text("");
        text_center.attr("text-anchor", "middle");
        text_center.attr("y", +s.attr("y") + (+s.attr("height")/2) );
        
        
        text_right.text(dollars(d3.round((y.invert(rule_y)/6),2)));
        text_right.attr("x", width);
        text_right.attr("text-anchor", "end");
        break;
    
    case "DEBT_EBITDA":
        text_left.text(d3.round(y.invert(rule_y),1)  );
        text_left.attr("x", 1);
        text_left.attr("text-anchor", "start");
        
        
        text_center.attr("x",  (+s.attr("x") + (+str) + (x.rangeBand()/2) )  );
        text_center.text("");
        text_center.attr("text-anchor", "middle");
        text_center.attr("y", +s.attr("y") + (+s.attr("height")/2) );
        
        
        text_right.text(d3.round(y.invert(rule_y),1)  );
        text_right.attr("x", width);
        text_right.attr("text-anchor", "end");
        break;
        
    case "EV":
        text_left.text(dollars(d3.round(y.invert(s.attr("y") )),0));
        text_left.attr("x", 1);
        text_left.attr("text-anchor", "start");
        
        
        text_center.attr("x",  (+s.attr("x") + (+str) + (x.rangeBand()/2) )  );
        text_center.text(dollars(d3.round((ob.value),0))   );
        text_center.attr("text-anchor", "middle");
        text_center.attr("y", +s.attr("y") + (+s.attr("height")/2) );
        
        
        text_right.text(dollars(d3.round(y.invert(s.attr("y") )),0));
        text_right.attr("x", width);
        text_right.attr("text-anchor", "end");
        break;
        
    case "EV_EBITDA":
        text_left.text(d3.round(y.invert(rule_y),1)  );
        text_left.attr("x", 1);
        text_left.attr("text-anchor", "start");
        
        
        text_center.attr("x",  (+s.attr("x") + (+str) + (x.rangeBand()/2) )  );
        text_center.text("");
        text_center.attr("text-anchor", "middle");
        text_center.attr("y", +s.attr("y") + (+s.attr("height")/2) );
        
        
        text_right.text(d3.round(y.invert(rule_y),1)  );
        text_right.attr("x", width);
        text_right.attr("text-anchor", "end");
        break;

    case "PR_DASHARE":
        text_left.text(d3.round(y.invert(rule_y),1));
        text_left.attr("x", 1);
        text_left.attr("text-anchor", "start");
        
        
        text_center.attr("x",  (+s.attr("x") + (+str) + (x.rangeBand()/2) )  );
        text_center.text("");
        text_center.attr("text-anchor", "middle");
        text_center.attr("y", +s.attr("y") + (+s.attr("height")/2) );
        
        
        text_right.text(d3.round(y.invert(rule_y) *6,1));
        text_right.attr("x", width);
        text_right.attr("text-anchor", "end");
        break;
        
    case "PROD_DASHARE":
        text_left.text(d3.round(y.invert(rule_y),2));
        text_left.attr("x", 1);
        text_left.attr("text-anchor", "start");
        
        
        text_center.attr("x",  (+s.attr("x") + (+str) + (x.rangeBand()/2) )  );
        text_center.text("");
        text_center.attr("text-anchor", "middle");
        text_center.attr("y", +s.attr("y") + (+s.attr("height")/2) );
        
        
        text_right.text(d3.round(y.invert(rule_y) *6,2));
        text_right.attr("x", width);
        text_right.attr("text-anchor", "end");
        break;
                
  }//end of switch
              
  
}//end of show_rule()



// END OF SHOW RULE FUNCTION BLOCK



// LEGEND BLOCK
var top_legend = svg.append("g")
    .attr("transform", "translate(50, -10)")
    .classed("label", true);


var leg_text_mode = top_legend.append("text")
  .attr("x", width/2 - 40)
  .attr("y", 5)
  .style("text-anchor", "middle")
  .style("visibility", "visible")
  .style("font-size", "13px")
  .text("Average Daily Production in Q2 2015 by product");
  
// END OF LEGEND BLOCK

// MAIN GRAPH BAR SORT CONTROLS

 
 var bar_sort_control_height = height + 30;  // 100 px below graph
    
var legend_data;
    
function set_legend_data() {

  switch(mode) {

    case "PROD_UN":

  legend_data =

[
  [{ "name":"abc","sortable":"yes","color": clr_abc}],
  [{ "name":"oil","sortable":"yes","color": clr_oil}],
  [{ "name":"ngl","sortable":"yes","color": clr_ngl}],
  [{ "name":"gas","sortable":"yes","color": clr_gas}]
];
break;

  case "PROD_S":
  legend_data =

[
[{ "name":"abc","sortable":"yes","color": clr_abc}],
[{ "name":"oil","sortable":"yes","color": clr_oil}],
[{ "name":"liquids","sortable":"yes","color": clr_liquids}],
[{ "name":"total","sortable":"yes","color": clr_total}]
];
break;

  case "REV_UN":
  legend_data =
[
  [{ "name":"abc","sortable":"yes","color": clr_abc}],
  [{ "name":"oil","sortable":"yes","color": clr_oil}],
  [{ "name":"ngl","sortable":"yes","color": clr_ngl}],
  [{ "name":"gas","sortable":"yes","color": clr_gas}]
];
break;

  case "REV_S":
  legend_data =
[
[{ "name":"abc","sortable":"yes","color": clr_abc}],
[{ "name":"oil","sortable":"yes","color": clr_oil}],
[{ "name":"liquids","sortable":"yes","color": clr_liquids}],
[{ "name":"total","sortable":"yes","color": clr_total}]
];
break;

  case "PRICE_UN":
  legend_data =
[
  [{ "name":"abc","sortable":"yes","color": clr_abc}],
  [{ "name":"oil","sortable":"yes","color": clr_oil}],
  [{ "name":"ngl","sortable":"yes","color": clr_ngl}],
  [{ "name":"gas","sortable":"yes","color": clr_gas}]
];
break;


  case "PRICE_S":
  legend_data =
[
[{ "name":"abc","sortable":"yes","color": clr_abc}],
[{ "name":"BOE price","sortable":"yes","color": clr_total}]
];
break;


  case "INC_QU_UN":
  legend_data =

[
[{ "name":"abc","sortable":"yes","color": clr_abc}],
[{ "name":"post-hedge","sortable":"yes","color": clr_gross}],
[{ "name":"ebitda","sortable":"yes","color": clr_ebitda}],
[{ "name":"cash margin","sortable":"yes","color": clr_cashMargin}],
[{ "name":"pre-tax net","sortable":"yes","color": clr_net}]
];
break;

  case "INC_QU_S":
    legend_data =
[
[{ "name":"abc","sortable":"yes","color": clr_abc}],
[{ "name":"ebitda costs","sortable":"yes","color": clr_ebtidaCosts}],
[{ "name":"interest","sortable":"yes","color": clr_interest}],
[{ "name":"DD&A","sortable":"yes","color": clr_DDA}],
[{ "name":"pre-tax net","sortable":"yes","color": clr_netIncome}]
];
break;

  case "INC_BOE_UN":
  legend_data =

[
[{ "name":"abc","sortable":"yes","color": clr_abc}],
[{ "name":"post-hedge","sortable":"yes","color": clr_gross}],
[{ "name":"ebitda","sortable":"yes","color": clr_ebitda}],
[{ "name":"cash margin","sortable":"yes","color": clr_cashMargin}],
[{ "name":"pre-tax net","sortable":"yes","color": clr_net}]
];
break;

  case "INC_BOE_S":
        legend_data =
[
[{ "name":"abc","sortable":"yes","color": clr_abc}],
[{ "name":"ebitda costs","sortable":"yes","color": clr_ebtidaCosts}],
[{ "name":"interest","sortable":"yes","color": clr_interest}],
[{ "name":"DD&A","sortable":"yes","color": clr_DDA}],
[{ "name":"pre-tax net","sortable":"yes","color": clr_netIncome}]
];
break;


  case "INC_PERC_UN":
  legend_data =
[
[{ "name":"abc","sortable":"yes","color": clr_abc}],
[{ "name":"post-hedge","sortable":"yes","color": clr_gross}],
[{ "name":"ebitda","sortable":"yes","color": clr_ebitda}],
[{ "name":"cash margin","sortable":"yes","color": clr_cashMargin}],
[{ "name":"pre-tax net","sortable":"yes","color": clr_net}]
];
break;

  case "INC_PERC_S":
    legend_data =
[
[{ "name":"abc","sortable":"yes","color": clr_abc}],
[{ "name":"ebitda costs","sortable":"yes","color": clr_ebtidaCosts}],
[{ "name":"interest","sortable":"yes","color": clr_interest}],
[{ "name":"DD&A","sortable":"yes","color": clr_DDA}],
[{ "name":"pre-tax net","sortable":"yes","color": clr_netIncome}]
];
break;

  case "RESERVES_UN":
    legend_data =
[
[{ "name":"abc","sortable":"yes","color": clr_abc}],
[{ "name":"oil PD","sortable":"yes","color": clr_oil}],
[{ "name":"oil PUD","sortable":"yes","color": clr_oil_l}],
[{ "name":"ngl PD","sortable":"yes","color": clr_ngl}],
[{ "name":"ngl PUD","sortable":"yes","color": clr_ngl_l}],
[{ "name":"gas PD","sortable":"yes","color": clr_gas}],
[{ "name":"gas PUD","sortable":"yes","color": clr_gas_l}]
];
break;

case "RESERVES_S":
    legend_data =
[
[{ "name":"abc","sortable":"yes","color": clr_abc}],
[{ "name":"PR total","sortable":"yes","color": clr_pr}],
[{ "name":"PR oil","sortable":"yes","color": clr_pr_oil}],
[{ "name":"PR liquids","sortable":"yes","color": clr_pr_liquids}],
[{ "name":"PR gas","sortable":"yes","color": clr_pr_gas}],
[{ "name":"PD total","sortable":"yes","color": clr_total}],
[{ "name":"PUD total","sortable":"yes","color": clr_pud}]
];
break;

case "CAPEX":
    legend_data =
[
[{ "name":"abc","sortable":"yes","color": clr_abc}],
[{ "name":"capex","sortable":"yes","color": "darkgreen"}],
[{ "name":"cash margin","sortable":"yes","color": "lightgreen"}]
];
break;

case "HEDGE":
    legend_data =
[
[{ "name":"abc","sortable":"yes","color": clr_abc}],
[{ "name":"hedge impact","sortable":"yes","color": "lightgreen"}]
];
break;

case "HEDGE_BOE":
    legend_data =
[
[{ "name":"abc","sortable":"yes","color": clr_abc}],
[{ "name":"hedge impact","sortable":"yes","color": "lightgreen"}]
];
break;

case "DEBT_EBITDA":
    legend_data =
[
[{ "name":"abc","sortable":"yes","color": clr_abc}],
[{ "name":"debt/ebitda","sortable":"yes","color": "green"}]
];
break;

case "EV":
    legend_data =
[
[{ "name":"abc","sortable":"yes","color": clr_abc}],
[{ "name":"mrkt cap (equity)","sortable":"yes","color": "darkgreen"}],
[{ "name":"net debt","sortable":"yes","color": "lightgreen"}],
[{ "name":"ev","sortable":"yes","color": clr_ev}],
];
break;

case "EV_EBITDA":
    legend_data =
[
[{ "name":"abc","sortable":"yes","color": clr_abc}],
[{ "name":"ev/ebita","sortable":"yes","color": "lightgreen"}]
];
break;


case "PR_DASHARE":
    legend_data =
[
[{ "name":"abc","sortable":"yes","color": clr_abc}],
[{ "name":"reserves/share","sortable":"yes","color": "green"}]
];
break;

case "PROD_DASHARE":
    legend_data =
[
[{ "name":"abc","sortable":"yes","color": clr_abc}],
[{ "name":"production/share","sortable":"yes","color": "green"}]
];
break;

 } //end of switch

}//end of set_legend_data()


    

  set_legend_data();
  legend_scale.domain(legend_data.map(function(d){return d[0].name;}));

    
var legend_below_root  = svg.append("g")
    .attr("transform", "translate( 10," + bar_sort_control_height + ")")
    .style("cursor", "pointer")
    .classed("label", true);
    
legend_below_root.append("text")
    .attr("x", -47)
    .classed("label", true)
    .style("font-size", "13px")
    .style("font-weight", "700")
    .text("SORT BY:");
    

var legend_below_elements = legend_below_root.selectAll(".elements")
      .data(legend_data)
      .enter().append("g")
      .attr("transform", function(d) { return "translate(" + legend_scale(d[0].name) + ",0)"; });
      
var legend_texts =  legend_below_elements.selectAll("text")
      .data(function (d) {return d;})
      .enter().append("text")
       .style("text-anchor", "end")
       .style("font-size", "12px")
       .style("opacity", function(d) {
          if (d.name == order) {return 1.0;}
          else {return .6;}
        })
        .style("font-weight", function(d) {
          if (d.name == order) {return "700";}
          else {return "400";}
        })
        .style("font-style", function(d) {
          if (d.name == order) {return "italic";}
          else {return "normal";}
        })
      .on("click", changeSort)
      .text(function (d) {return d.name;});
      
var legend_rects =  legend_below_elements.selectAll("rect")
      .data(function (d) {return d;})
      .enter().append("rect")
      .on("click", changeSort)
      .attr("x", 0)
      .attr("y", 5)
      .attr("width", function(d) {
          if (d.name == order) {return 22;}
          else {return 16;}
        })
      .attr("height", function(d) {
          if (d.name == order) {return 22;}
          else {return 16;}
        })
      .style("fill", function (d) {return d.color;})
      .style("stroke", "orange")
      .style("stroke-width", "20")
      .style("stroke-opacity", "0.0");
      
function reset_legends() {
  
    set_legend_data();
    legend_scale.domain(legend_data.map(function(d){return d[0].name;}));
    
    var t = legend_below_root.selectAll("g")
      .data(legend_data);
      
      t.enter().append("g");
      t.exit().remove();
      t.attr("transform", function(d) { return "translate(" + legend_scale(d[0].name) + ",0)"; });
      
    var e = legend_below_root.selectAll("g").selectAll("text")
      .data(function (d) {return d;});
      
      e.enter().append("text");
      
      e.on("click", changeSort)
       .style("text-anchor", "end")
       .text(function (d) {return d.name;});
       
    var r = legend_below_root.selectAll("g").selectAll("rect")
      .data(function (d) {return d;});
      
      r.enter().append("rect");
      
      r.on("click", changeSort)
       .attr("x", 0)
       .attr("y", 5)
       .style("fill", function (d) {return d.color;});

    sort();
      
}



function changeSort(d) {
      if (d.sortable == "yes") {
        order = d.name;
        sort();
        
      }
      else {}  //right now all are sortable, so this shoudnt happen, so make to to also get rid of the sortable data field

}



function sort() {
  
        legend_below_root.selectAll("g").selectAll("text")
        .style("opacity", function(d) {
          if (d.name == order) {return 1.0;}
          else {return .6;}
        })
        .style("font-weight", function(d) {
          if (d.name == order) {return "700";}
          else {return "400";}
        })
        .style("font-style", function(d) {
          if (d.name == order) {return "italic";}
          else {return "normal";}
        })
        .style("font-size", function(d) {
          if (d.name == order) {return "16px";}
          else {return "14px";}
        });
        
        legend_below_root.selectAll("g").selectAll("rect")
        .attr("width", function(d) {
          if (d.name == order) {return 22;}
          else {return 16;}
        })
          .attr("height", function(d) {
          if (d.name == order) {return 22;}
          else {return 16;}
        });

 if (order == "abc"){ current_data = current_data.sort(function(a, b) { return d3.ascending(a.company, b.company); }); }

 else // some kind of value sort
 {
  switch(mode) {

    case "PROD_S":
        switch(order) {
          case "oil":
            current_data = current_data.sort(function(a, b) { return b.values.prods[0].mboed - a.values.prods[0].mboed; }); break;
          case "liquids":
            current_data = current_data.sort(function(a, b) { return (b.values.prods[0].mboed + b.values.prods[1].mboed) - (a.values.prods[0].mboed + a.values.prods[1].mboed); }); break;
          case "total":
            current_data = current_data.sort(function(a, b) { return b.prod_total - a.prod_total; }); break;
        }
        break;
    case "PROD_UN":
        switch(order) {
          case "oil":
            current_data = current_data.sort(function(a, b) { return b.values.prods[0].mboed - a.values.prods[0].mboed; }); break;
          case "ngl":
            current_data = current_data.sort(function(a, b) { return b.values.prods[1].mboed - a.values.prods[1].mboed; }); break;
          case "gas":
            current_data = current_data.sort(function(a, b) { return b.values.prods[2].mboed - a.values.prods[2].mboed; }); break;
        }
        break;
    case "REV_S":
        switch(order) {
          case "oil":
            current_data = current_data.sort(function(a, b) { return (b.values.prods[0].mboed * b.values.prods[0].price) - (a.values.prods[0].mboed * a.values.prods[0].price); }); break;
          case "liquids":
            current_data = current_data.sort(function(a, b) { return ((b.values.prods[0].mboed * b.values.prods[0].price) + (b.values.prods[1].mboed * b.values.prods[1].price)) - ((a.values.prods[0].mboed * a.values.prods[0].price) + (a.values.prods[1].mboed * a.values.prods[1].price)); }); break;
          case "total":
            current_data = current_data.sort(function(a, b) { return b.rev_total - a.rev_total; }); break;
        }
        break;
    case "REV_UN":
        switch(order) {
          case "oil":
              current_data = current_data.sort(function(a, b) { return (b.values.prods[0].mboed * b.values.prods[0].price) - (a.values.prods[0].mboed * a.values.prods[0].price); }); break;
          case "ngl":
            current_data = current_data.sort(function(a, b) { return (b.values.prods[1].mboed * b.values.prods[1].price) - (a.values.prods[1].mboed * a.values.prods[1].price); }); break;
          case "gas":
            current_data.sort(function(a, b) { return (b.values.prods[2].mboed * b.values.prods[2].price) - (a.values.prods[2].mboed * a.values.prods[2].price); }); break;
        }
        break;
    case "PRICE_S":
        current_data = current_data.sort(function(a, b) { return b.boe_price - a.boe_price; });
        break;
    case "PRICE_UN":
        switch(order) {
          case "oil":
              current_data = current_data.sort(function(a, b) { return b.values.prods[0].price - a.values.prods[0].price; }); break;
          case "ngl":
            current_data = current_data = current_data.sort(function(a, b) { return b.values.prods[1].price - a.values.prods[1].price; }); break;
          case "gas":
            current_data = current_data.sort(function(a, b) { return b.values.prods[2].price - a.values.prods[2].price; }); break;
        }
        break;
    case "INC_QU_S":
      
        switch(order) {
          case "ebitda costs":
            current_data = current_data.sort(function(a, b) { return (b.values.corp[3].difference * b.rev_total) - (a.values.corp[3].difference * a.rev_total); }); break;
          case "interest":
            current_data = current_data.sort(function(a, b) { return (b.values.corp[2].difference * b.rev_total) - (a.values.corp[2].difference * a.rev_total); }); break;
          case "DD&A":
            current_data = current_data.sort(function(a, b) { return (b.values.corp[1].difference * b.rev_total) - (a.values.corp[1].difference * a.rev_total); }); break;
          case "pre-tax net":
            current_data = current_data.sort(function(a, b) { return (b.values.corp[0].difference * b.rev_total) - (a.values.corp[0].difference * a.rev_total); }); break;
        }
        break;
    case "INC_QU_UN":
        switch(order) {
          case "post-hedge":
            current_data = current_data.sort(function(a, b) { return b.values.corp[3].dollars - a.values.corp[3].dollars; }); break;
          case "ebitda":
            current_data = current_data.sort(function(a, b) { return b.values.corp[2].dollars - a.values.corp[2].dollars; }); break;
          case "cash margin":
            current_data = current_data.sort(function(a, b) { return b.values.corp[1].dollars - a.values.corp[1].dollars; }); break;
          case "pre-tax net":
            current_data = current_data.sort(function(a, b) { return b.values.corp[0].dollars - a.values.corp[0].dollars; }); break;
        }
        break;
    case "INC_BOE_S":
        switch(order) {
          case "ebitda costs":
            current_data = current_data.sort(function(a, b) { return (b.values.corp[3].difference * b.boe_price) - (a.values.corp[3].difference * a.boe_price); }); break;
          case "interest":
            current_data = current_data.sort(function(a, b) { return (b.values.corp[2].difference * b.boe_price) - (a.values.corp[2].difference * a.boe_price); }); break;
          case "DD&A":
            current_data = current_data.sort(function(a, b) { return (b.values.corp[1].difference * b.boe_price) - (a.values.corp[1].difference * a.boe_price); }); break;
          case "pre-tax net":
            current_data = current_data.sort(function(a, b) { return (b.values.corp[0].difference * b.boe_price) - (a.values.corp[0].difference * a.boe_price); }); break;
        }
        break;
    case "INC_BOE_UN":
        switch(order) {
          case "post-hedge":
            current_data = current_data.sort(function(a, b) { return (b.values.corp[3].percent * b.boe_price) - (a.values.corp[3].percent * a.boe_price); }); break;
          case "ebitda":
            current_data = current_data.sort(function(a, b) { return (b.values.corp[2].percent * b.boe_price) - (a.values.corp[2].percent * a.boe_price); }); break;
          case "cash margin":
            current_data = current_data.sort(function(a, b) { return (b.values.corp[1].percent * b.boe_price) - (a.values.corp[1].percent * a.boe_price); }); break;
          case "pre-tax net":
            current_data = current_data.sort(function(a, b) { return (b.values.corp[0].percent * b.boe_price) - (a.values.corp[0].percent * a.boe_price); }); break;
        }
        break;
    case "INC_PERC_S":
        switch(order) {
          case "ebitda costs":
            current_data = current_data.sort(function(a, b) { return (b.values.corp[3].difference) - (a.values.corp[3].difference); }); break;
          case "interest":
            current_data = current_data.sort(function(a, b) { return (b.values.corp[2].difference) - (a.values.corp[2].difference); }); break;
          case "DD&A":
            current_data = current_data.sort(function(a, b) { return (b.values.corp[1].difference) - (a.values.corp[1].difference); }); break;
          case "pre-tax net":
            current_data = current_data.sort(function(a, b) { return (b.values.corp[0].difference) - (a.values.corp[0].difference); }); break;
        }
        break;
    case "INC_PERC_UN":
        switch(order) {
          case "post-hedge":
            current_data = current_data.sort(function(a, b) { return b.values.corp[3].percent - a.values.corp[3].percent; }); break;
          case "ebitda":
            current_data = current_data.sort(function(a, b) { return b.values.corp[2].percent - a.values.corp[2].percent; }); break;
          case "cash margin":
            current_data = current_data.sort(function(a, b) { return b.values.corp[1].percent - a.values.corp[1].percent; }); break;
          case "pre-tax net":
            current_data = current_data.sort(function(a, b) { return b.values.corp[0].percent - a.values.corp[0].percent; }); break;
        }
        break;
   case "RESERVES_UN":
        switch(order) {
          case "oil PD":
            current_data = current_data.sort(function(a, b) { return b.values.reserves[0].mmboe - a.values.reserves[0].mmboe; }); break;
          case "ngl PD":
            current_data = current_data.sort(function(a, b) { return b.values.reserves[1].mmboe - a.values.reserves[1].mmboe; }); break;
          case "gas PD":
            current_data = current_data.sort(function(a, b) { return b.values.reserves[2].mmboe - a.values.reserves[2].mmboe; }); break;
          case "oil PUD":
            current_data = current_data.sort(function(a, b) { return b.values.reserves[3].mmboe - a.values.reserves[3].mmboe; }); break;
          case "ngl PUD":
            current_data = current_data.sort(function(a, b) { return b.values.reserves[4].mmboe - a.values.reserves[4].mmboe; }); break;
          case "gas PUD":
            current_data = current_data.sort(function(a, b) { return b.values.reserves[5].mmboe - a.values.reserves[5].mmboe; }); break;
        }
        break;
   case "RESERVES_S":
        switch(order) {
            
          case "PR total":
            current_data = current_data.sort(function(a, b) { return b.pr_total - a.pr_total; });
            break;
          case "PR oil":
            current_data = current_data.sort(function(a, b) { return b.pr_oil - a.pr_oil; });
            break;
          case "PR liquids":
            current_data = current_data.sort(function(a, b) { return b.pr_liquids - a.pr_liquids; });
            break;
          case "PR gas":
            current_data = current_data.sort(function(a, b) { return (b.pr_total - b.pr_liquids) - (a.pr_total - a.pr_liquids); });
            break;
          case "PD total":
            current_data = current_data.sort(function(a, b) { return (b.pr_total * (1- b.pr_pud_percent)) - (a.pr_total * (1- a.pr_pud_percent)); });
            break;
          case "PUD total":
            current_data = current_data.sort(function(a, b) { return (b.pr_total * b.pr_pud_percent) - (a.pr_total * a.pr_pud_percent); });
            break;
        }
        break;
    case "CAPEX":
        switch(order) {
          case "capex":
            current_data = current_data.sort(function(a, b) { return b.capex[0].value - a.capex[0].value; }); break;
          case "cash margin":
            current_data = current_data.sort(function(a, b) { return b.capex[1].value - a.capex[1].value; }); break;
        }
        break;
    case "HEDGE":
        current_data = current_data.sort(function(a, b) { return (b.hedge/b.rev_total) - (a.hedge/a.rev_total); });
        break;
    case "HEDGE_BOE":
        current_data = current_data.sort(function(a, b) { return (b.boe_price_hedged - b.boe_price) - (a.boe_price_hedged - a.boe_price); });
        break;
    case "DEBT_EBITDA":
        current_data = current_data.sort(function(a, b) { return (b.debt/(b.values.corp[2].dollars * 4)) - (a.debt/(a.values.corp[2].dollars * 4)); });
        break;
    case "EV":
        switch(order) {
          case "mrkt cap (equity)":
            current_data = current_data.sort(function(a, b) { return b.ev[0].value - a.ev[0].value; }); break;
          case "net debt":
            current_data = current_data.sort(function(a, b) { return b.ev[1].value - a.ev[1].value; }); break;
          case "ev":
            current_data = current_data.sort(function(a, b) { return (b.ev[0].value + b.ev[1].value) - (a.ev[0].value + a.ev[1].value); }); break;
        }
        break;
    case "EV_EBITDA":
        current_data = current_data.sort(function(a, b) { return ( (b.ev[0].value + b.ev[1].value)/(b.values.corp[2].dollars * 4)) - ((a.ev[0].value + a.ev[1].value)/(a.values.corp[2].dollars * 4)); });
        break;
    case "PR_DASHARE":
        current_data = current_data.sort(function(a, b) { return (b.pr_total/b.da_shares) - (a.pr_total/a.da_shares);});
        break;
    case "PROD_DASHARE":
        current_data = current_data.sort(function(a, b) { return (b.prod_total/b.da_shares) - (a.prod_total/a.da_shares);});
        break
    } //end of switch(mode)
    


  }// end of else -- all value (non-ABC) sorts of current_data

// use sorted companies to set x domain and the number of them to compute rangeBands for widths.
  x.domain(current_data.map(function(d){return d.company;}));
  x_prods.rangeRoundBands([0, x.rangeBand()]);
  x_corp.rangeRoundBands([0, x.rangeBand()]);
  x_reserves.rangeRoundBands([0, x.rangeBand()]);
  x_capex.rangeRoundBands([0, x.rangeBand()]);

  
    g_level();  //This is apparently the only place needed as sort() is always called when redrawing rects


}// end of sort function after effecting the sort

// END OF MAIN GRAPH BAR SORT CONTROLS


        

    
    
//TOOLS ROOT FOR MOBILE


var tools_toggle_state = "modes";


var tools_root = svg.append("g")
    .attr("transform", "translate(350, 0)")
    .style("visibility", "hidden")
    .classed("label", true);
    
    
tools_root.append("rect")
    .attr("x", -10)
    .attr("y", -margin.top)
    .attr("width", 250)
    .attr("height", 360)
    .style("fill", "white")
    .style("stroke", "black")
    


    //  COMPANY LABEL  SELECTiON
    
//full list
    
var selections_scale = d3.scale.ordinal()
    .rangePoints([0,(data.length * 28)],0)
    .domain(data.map(function(d){return d.company;}));

 
var selections_root = tools_root.append("g")
    .attr("transform", "translate(0, 0)")
    .style("visibility", "hidden");
    
var drag_list = d3.behavior.drag()
    .origin(Object)
    .on("drag", dragmove_list);
    
selections_root.append("rect")
    .attr("width", 15)
    .attr("height", 255)
    .style("fill", clr_graph_bkgrnd)
    .attr("x", 220)
      .attr("y", 30)
      .style("cursor", "pointer")
      .style("stroke", "black")
      .style("stroke-width", "1px");
    
var dragger = selections_root.append("rect")
    .attr("width", 15)
    .attr("height", 15)
    .style("fill", "black")
    .attr("x", 220)
      .attr("y", 30)
      .style("cursor", "pointer")
      .style("stroke", "orange")
      .style("stroke-width", "40")
      .style("stroke-opacity", "0.0")
      .call(drag_list);
      
      


var dragger_position = 0;
var labels_position = 0;

function dragmove_list() {
  dragger_position += d3.event.dy;
  labels_position =  -3.4 * dragger_position; //list length factor for adjustment
  if (dragger_position < 0) {dragger_position = 0;}
  if (dragger_position > 240) {dragger_position = 240;}
  dragger.attr("y", dragger_position + 30);
  company_labels.attr("transform", "translate(0," + labels_position + ")");
}

var company_labels = selections_root.append("g");

var selections = company_labels.selectAll("label")
      .data(data)
      .enter().append("text")
      .attr("x", 0)
      .attr("y", function(d) { return selections_scale(d.company) - 3 ;})
      .style("opacity", function(d) {
          if (d.selected == "yes") {return 1;}
          else {return .6;}
      })
      .style("font-weight", function(d) {
          if (d.selected == "yes") {return "700";}
          else {return "400";}
        })
      .style("font-style", function(d) {
          if (d.selected == "yes") {return "italic";}
          else {return "normal";}
        })
      .style("cursor", "pointer")
      .classed("label", true)
      .style("font-size", "14px")
      .text(function (d) {return d.company + " - " + d.name;})
      .on("click", function(d) {toggle_selection(d.company, d3.select(this));}  );




    //SELECTION FUNCTIONS
      
function toggle_selection(t,th) {

      //if selected, deselect and dim label
      
  if (th.style("opacity") == 1) {
    data.forEach(function(d) {if (d.company == t){d.selected = "no";}});
    th.style("opacity", .6);
    }
      
      //if unselected, select and darken label
      
  else  {
    data.forEach(function(d) {if (d.company == t){d.selected = "yes";}});
    th.style("opacity", 1);
  }
      
  post_selection();
}
      



function post_selection() {
// refilter to update for only currently selected companies
  current_data  = data.filter(selector);

// sort companies (which calls g_level) and then call mode function to draw rects
  loadSelected();
  
    selections.style("opacity", function(d) {
      if (d.selected == "yes") {return 1;}
      else {return .6;}
        })
      .style("font-weight", function(d) {
          if (d.selected == "yes") {return "700";}
          else {return "400";}
        })
      .style("font-style", function(d) {
          if (d.selected == "yes") {return "italic";}
          else {return "normal";}
        });

}

function loadSelected() {
  
  sort();

  switch(mode) {
    case "PROD_S":
        prod_s();
        break;
    case "PROD_UN":
        prod_un();
        break;
    case "REV_S":
        rev_s();
        break;
    case "REV_UN":
        rev_un();
        break;
    case "PRICE_S":
        price_s();
        break;
    case "PRICE_UN":
        price_un();
        break;
    case "INC_QU_S":
        inc_qu_s();
        break;
    case "INC_QU_UN":
        inc_qu_un();
        break;
    case "INC_BOE_S":
        inc_boe_s();
        break;
    case "INC_BOE_UN":
        inc_boe_un();
        break;
    case "INC_PERC_S":
        inc_perc_s();
        break;
    case "INC_PERC_UN":
        inc_perc_un();
        break;
    case "RESERVES_UN":
        reserves_un();
        break;
    case "RESERVES_S":
        reserves_s();
        break;
    case "CAPEX":
        capex();
        break;
    case "HEDGE":
        hedge();
        break;
    case "HEDGE_BOE":
        hedge_boe();
        break;
    case "DEBT_EBITDA":
        debt_ebitda();
        break;
    case "EV":
        ev();
        break;
    case "EV_EBITDA":
        ev_ebitda();
        break;
    case "PR_DASHARE":
        pr_dashare();
        break;
    case "PROD_DASHARE":
        prod_dashare();
        break;
}

}


// END OF SELECTION BLOCK
          
      
 //  END COMPANY LABEL SELECTION BLOCK
      
//   COMPANY LABEL SORTING BLOCK


    



//  END COMPANY LABEL SORTING BLOCK



// MODE SWITCHING BLOCK

var modes_array = [
        {"text":"Production by Product", "mode": "PROD_UN"},
        {"text":"Production Totaled", "mode": "PROD_S"},
        {"text":"Revenue by Product", "mode":"REV_UN"},
        {"text":"Revenue Totaled","mode": "REV_S"},
        {"text":"Price by Product", "mode":"PRICE_UN"},
        {"text":"Boe/Mcfe Price", "mode": "PRICE_S"},
        {"text":"Income Metrics", "mode": "INC_QU_UN"},
        {"text":"Cost Metrics", "mode": "INC_QU_S"},
        {"text":"Unit Income Metrics", "mode": "INC_BOE_UN"},
        {"text":"Unit Cost Metrics", "mode": "INC_BOE_S"},
        {"text":"Percentage Income Metrics", "mode": "INC_PERC_UN"},
        {"text":"Percentage Cost Metrics", "mode": "INC_PERC_S"},
        {"text":"Proved Reserves Analyzed", "mode": "RESERVES_UN"},
        {"text":"Proved Reserves Totaled", "mode": "RESERVES_S"},
        {"text":"E&P Capital Expenditures", "mode": "CAPEX"},
        {"text":"Hedge Percentage Impact", "mode": "HEDGE"},
        {"text":"Hedge Unit Impact", "mode": "HEDGE_BOE"},
        {"text":"Net Debt/EBITDA Ratio", "mode": "DEBT_EBITDA"},
        {"text":"Enterprise Value (EV)", "mode": "EV"},
        {"text":"EV/EBITDA Ratio", "mode": "EV_EBITDA"},
        {"text":"Reserves per D/A Share", "mode": "PR_DASHARE"},
        {"text":"Production per D/A Share", "mode": "PROD_DASHARE"}
        ];

var modes_scale = d3.scale.ordinal()
    .rangePoints([0,335],0)
    .domain(modes_array.map(function(d){return d.text;}));
    

var modes = tools_root.append("g")
    .attr("transform", "translate(0, -10)")
    .style("visibility", "hidden")
    .classed("label", true);
    
    
var mode_labels = modes.append("g")
      .attr("transform", "translate(0, 0)")
      .selectAll("label")
      .data(modes_array)
      .enter().append("text")
      .attr("x", 20)
      .attr("y", function(d) { return modes_scale(d.text) ;})
      .style("font-size", "13px")
      .style("opacity", function(d) {
        if (d.text == "Production by Product") {return 1.0;}
        else {return .6;}
      })
      .style("font-weight", function(d) {
          if (d.text == "Production by Product") {return "700";}
          else {return "400";}
        })
      .style("font-style", function(d) {
          if (d.text == "Production by Product") {return "italic";}
          else {return "normal";}
        })
      .style("cursor", "pointer")
      .text(function (d) {return d.text;})
      .on("click", function() {
            modeSwitch(d3.select(this).text());
            
      }  );
            
var mode_index = 0;
var mode_select_state = "main";

function modeSwitch(text) {
   order = "abc";// change order before calling mode functions
   
  if (mode_select_state == "main")
  {
  
  mode_labels.style("opacity", function(d) {
    if (d.text == text) {return 1.0;}
    else {return .6;}
    })
    .style("font-weight", function(d) {
        if (d.text == text) {return "700";}
        else {return "400";}
      })
      .style("font-style", function(d) {
          if (d.text == text) {return "italic";}
          else {return "normal";}
        });

    switch(text) {
    case "Production by Product":
        mode_index = 0;
        prod_un();
        break;
    case "Production Totaled":
        mode_index = 1;
        prod_s();
        break;
    case "Revenue by Product":
        mode_index = 2;
        rev_un();
        break;
    case "Revenue Totaled":
        mode_index = 3;
        rev_s();
        break;
    case "Price by Product":
        mode_index = 4;
        price_un();
        break;
    case "Boe/Mcfe Price":
        mode_index = 5;
        price_s();
        break;
    case "Income Metrics":
        mode_index = 6;
        inc_qu_un();
        break;
    case "Cost Metrics":
        mode_index = 7;
        inc_qu_s();
        break;
    case "Unit Income Metrics":
        mode_index = 8;
        inc_boe_un();
        break;
    case "Unit Cost Metrics":
        mode_index = 9;
        inc_boe_s();
        break;
    case "Percentage Income Metrics":
        mode_index = 10;
        inc_perc_un();
        break;
    case "Percentage Cost Metrics":
        mode_index = 11;
        inc_perc_s();
        break;
    case "Proved Reserves Analyzed":
        mode_index = 12;
        reserves_un();
        break;
    case "Proved Reserves Totaled":
        mode_index = 13;
        reserves_s();
        break;
    case "E&P Capital Expenditures":
        mode_index = 14;
        capex();
        break;
    case "Hedge Percentage Impact":
        mode_index = 15;
        hedge();
        break;
    case "Hedge Unit Impact":
        mode_index = 16;
        hedge_boe();
        break;
    case "Net Debt/EBITDA Ratio":
        mode_index = 17;
        debt_ebitda();
        break;
    case "Enterprise Value (EV)":
        mode_index = 18;
        ev();
        break;
    case "EV/EBITDA Ratio":
        mode_index = 19;
        ev_ebitda();
        break;
    case "Reserves per D/A Share":
        mode_index = 20;
        pr_dashare();
        break;
    case "Production per D/A Share":
        mode_index = 21;
        prod_dashare();
        break
    }

  reset_legends();
  
  }// end of if main
  
  else  // if side
  {
    modeSwitch_side(text);
  } // end of if side
}

// TOOLS TOGGLE BUTTON -- must overlay both tool lists


    

    
var tools_toggle_root = tools_root.append("g")
      .attr("transform", "translate(205, 0)")
      .on("click", function() {
        if (tools_toggle_state == "modes") {
          modes.style("visibility", "hidden");
          selections_root.style("visibility", "visible");
          tools_toggle_state = "select";
          state_toggle.text("<");
        }
        else
        {
          modes.style("visibility", "visible");
          selections_root.style("visibility", "hidden");
          tools_toggle_state = "modes";
          state_toggle.text(">");
        }
      });
 

      
tools_toggle_root.append("rect")
    .attr("x", -2)
    .attr("y", -22 )
    .attr("width", 35)
    .attr("height", 35)
    .style("fill", "rgb(170,170,170)");
    
tools_toggle_root.append("rect")
    .attr("x", 0)
    .attr("y", -20 )
    .attr("width", 30 )
    .attr("height", 30 )
    .style("fill", "black");
    
var state_toggle = tools_toggle_root.append("text")
      .attr("x", 15)
      .style("fill", "white")
      .style("font-weight", "900")
      .style("font-size", "20px")
      .attr("text-anchor", "middle")
      .text(">")
      .style("cursor", "pointer");

// info show button underneath mode list

var info_button = svg.append("g")
    .attr("transform", "translate( -45, 320)")
    .style("cursor", "pointer")
    .on("click", function() {
      info_slide_root.style("visibility", "visible");
      info_slide_root_main.style("visibility", "visible");
      info_slide_root_alt.style("visibility", "hidden");
    });

info_button.append("rect")
    .attr("x", -2)
    .attr("y", -22 )
    .attr("width", 54 )
    .attr("height", 34 )
    .style("fill", clr_oil);
    
info_button.append("rect")
    .attr("x", 0)
    .attr("y", -20 )
    .attr("width", 50 )
    .attr("height", 30 )
    .style("fill", "white");
    
info_button.append("text")
      .attr("x", 25)
      .attr("y", 2 )
      .style("fill", "black")
      .style("font-weight", "900")
      .attr("text-anchor", "middle")
      .style("font-family", "Quattrocento Sans")
      .text("INFO");



function prod_un() {

  mode = "PROD_UN";

    y.domain([0, (d3.max(current_data, function(d) { return d3.max(d.values.prods, function(d) {return d.mboed;}) })) * 1.05]);
    y_right.domain([0,(d3.max(current_data, function(d) { return d3.max(d.values.prods, function(d) {return d.mboed;}) })) * 1.05 * 6]);
    
    zero_rule.transition().duration(3000).attr("y1", y(0)).attr("y2", y(0));

    var products = group.selectAll(".company").selectAll("rect")
      .data(function(d) { return d.values.prods; });
      
      
    products.enter().append("rect")
      .attr("y",height)
      .attr("height", 0)
      .style("opacity", 0)
      .on("mouseover", show_rule);
              
    products.exit().transition().duration(3000)
    .attr("y",height)
    .attr("height", 0)
    .remove();
   
    products.transition().duration(3000)
      .attr("width", x_prods.rangeBand())
      .attr("x", function(d) { return x_prods(d.product); })
      .attr("y", function(d) { return y(d.mboed); })
      .attr("height", function(d) { return height - y(d.mboed); })
      .style("opacity", 1)
      .style("fill", function(d) { return colors_prods(d.product); });
  

      yAxis.tickFormat(null);
      yAxis_right.tickFormat(null);
      axis_y.transition().duration(3000)
        .call(yAxis);
      axis_y_right.transition().duration(3000)
        .attr("transform", "translate(" + width + ", 0)")
        .call(yAxis_right);
      axis_label.text("boe/day (1000's)");
      axis_label_right.text("mcfe/day (1000's)");
      
    leg_text_mode.text("Average Daily Production in Q2 2015 by product");
}
  
function prod_s() {


mode = "PROD_S";

       y.domain([0,d3.max(current_data, function(d) { return d.prod_total; }) * 1.05]);
       y_right.domain([0,d3.max(current_data, function(d) { return d.prod_total; })  * 1.05 * 6]);
       
       zero_rule.transition().duration(3000).attr("y1", y(0)).attr("y2", y(0));

    
    var products = group.selectAll(".company").selectAll("rect")
      .data(function(d) { return d.values.prods; });
      
      
    products.enter().append("rect")
      .attr("y",height)
      .attr("height", 0)
      .style("opacity", 0)
      .on("mouseover", show_rule);
              
    products.exit().transition().duration(3000)
    .attr("y",height)
    .attr("height", 0)
    .style("opacity", 0)
    .remove();

      var base = 0;
      
      products.transition().duration(3000)
      .attr("width", x.rangeBand())
      .attr("x", 0)
      .attr("y", function(d) {
        var b = base;
        base += d.mboed;
        if(d.product == "gas") {base = 0;}
       return y(b + d.mboed); })
      .attr("height", function(d) { return height - y( d.mboed); })
      .style("opacity", 1)
      .style("fill", function(d) { return colors_prods(d.product); });

      yAxis.tickFormat(null);
      yAxis_right.tickFormat(null);
      axis_y.transition().duration(3000)
        .call(yAxis);
      axis_y_right.transition().duration(3000)
        .attr("transform", "translate(" + width + ", 0)")
        .call(yAxis_right);
      axis_label.text("boe/day (1000's)");
      axis_label_right.text("mcfe/day (1000's)");
    
    leg_text_mode.text("Average Daily Production in Q2 2015 - totaled");
}

function rev_un() {



  mode = "REV_UN";


       y.domain([0,(d3.max(current_data, function(d) { return d3.max(d.values.prods, function(d) {return (d.mboed * (d.price/1000) * q2);}) })) * 1.05]);
       y_right.domain([0,(d3.max(current_data, function(d) { return d3.max(d.values.prods, function(d) {return (d.mboed * (d.price/1000) * q2);}) })) * 1.05 * 4 ]);
       
       zero_rule.transition().duration(3000).attr("y1", y(0)).attr("y2", y(0));
       

    var products = group.selectAll(".company").selectAll("rect")
      .data(function(d) { return d.values.prods; });
      
      
    products.enter().append("rect")
      .attr("y",height)
      .attr("height", 0)
      .style("opacity", 0)
      .on("mouseover", show_rule);
              
    products.exit().transition().duration(3000)
    .attr("y",height)
    .attr("height", 0)
    .style("opacity", 0)
    .remove();
      
    products.transition().duration(3000)
      .attr("width", x_prods.rangeBand())
      .attr("x", function(d) { return x_prods(d.product); })
      .attr("y", function(d) { return y(d.mboed * (d.price/1000) * q2); })
      .attr("height", function(d) { return height - y(d.mboed * (d.price/1000) * q2); })
      .style("opacity", 1)
      .style("fill", function(d) { return colors_prods(d.product); });


      yAxis.tickFormat(dollars);
      yAxis_right.tickFormat(dollars);
      axis_y.transition().duration(3000)
        .call(yAxis);
      axis_y_right.transition().duration(3000)
        .attr("transform", "translate(" + width + ", 0)")
        .call(yAxis_right);
      axis_label.text("$ (millions)    per quarter");
      axis_label_right.text("$ (millions)    annualized");

    leg_text_mode.text("Q2 2015 Production Revenue by product");
  
}

function rev_s() {
  
  mode = "REV_S";
    
       y.domain([0,d3.max(current_data, function(d) { return d.rev_total; }) * 1.05]);
       y_right.domain([0,d3.max(current_data, function(d) { return d.rev_total; }) * 1.05* 4]);
       
       zero_rule.transition().duration(3000).attr("y1", y(0)).attr("y2", y(0));
       
    var products = group.selectAll(".company").selectAll("rect")
      .data(function(d) { return d.values.prods; });
      
      
    products.enter().append("rect")
    .attr("y",height)
    .attr("height", 0)
    .style("opacity", 0)
    .on("mouseover", show_rule);
              
    products.exit().transition().duration(3000)
    .attr("y",height)
    .attr("height", 0)
    .style("opacity", 0)
    .remove();
      
       var base = 0;
      products.transition().duration(3000)
       .attr("width", x.rangeBand())
       .attr("x", 0)
       .attr("y", function(d) {
          var b = base;
          base += d.mboed * (d.price/1000) * q2;
          if(d.product == "gas") {base = 0;}
          return y(b + (d.mboed * (d.price/1000) * q2 )); })
        .attr("height", function(d) { return height - y(d.mboed * (d.price/1000) * q2); })
        .style("opacity", 1)
        .style("fill", function(d) { return colors_prods(d.product); });

      yAxis.tickFormat(dollars);
      yAxis_right.tickFormat(dollars);
      axis_y.transition().duration(3000)
        .call(yAxis);
      axis_y_right.transition().duration(3000)
        .attr("transform", "translate(" + width + ", 0)")
        .call(yAxis_right);
      axis_label.text("$ (millions)    per quarter");
      axis_label_right.text("$ (millions)    annualized");
      
      leg_text_mode.text("Q2 2015 Production Revenue - totaled");
  
}

function price_un(){

  mode = "PRICE_UN";

       y.domain([0,(d3.max(current_data, function(d) { return d3.max(d.values.prods, function(d) {return d.price;}) })) * 1.05]);
       y_right.domain([0,(d3.max(current_data, function(d) { return d3.max(d.values.prods, function(d) {return d.price;}) })) * 1.05 / 6]);
       
       zero_rule.transition().duration(3000).attr("y1", y(0)).attr("y2", y(0));
       

    var products = group.selectAll(".company").selectAll("rect")
      .data(function(d) { return d.values.prods; });
      
      
    products.enter().append("rect")
    .attr("y",height)
    .attr("height", 0)
    .style("opacity", 0)
    .on("mouseover", show_rule);
              
    products.exit().transition().duration(3000)
    .attr("y",height)
    .attr("height", 0)
    .style("opacity", 0)
    .remove();
      
    products.transition().duration(3000)
      .attr("width", x_prods.rangeBand())
      .attr("x", function(d) { return x_prods(d.product); })
      .attr("y", function(d) { return y(d.price); })
      .attr("height", function(d) { return height - y(d.price); })
      .style("opacity", 1)
      .style("fill", function(d) { return colors_prods(d.product); });


      yAxis.tickFormat(dollars);
      yAxis_right.tickFormat(dollars);
      axis_y.transition().duration(3000)
        .call(yAxis);
      axis_y_right.transition().duration(3000)
        .attr("transform", "translate(" + width + ", 0)")
        .call(yAxis_right);
      axis_label.text("$ per boe");
      axis_label_right.text("$ per mcfe");

    leg_text_mode.text("Q2 2015 Price per Boe/Mcfe, by product");
  
  
}

function price_s(){
  
    mode = "PRICE_S";
       
       y.domain([0,d3.max(current_data, function(d) { return d.boe_price; }) * 1.05]);
       y_right.domain([0,d3.max(current_data, function(d) { return d.boe_price; })  * 1.05 / 6]);
       
       zero_rule.transition().duration(3000).attr("y1", y(0)).attr("y2", y(0));
       

    var products = group.selectAll(".company").selectAll("rect")
      .data(function(d) { return d.values.prods; });
      
      
    products.enter().append("rect")
    .attr("y",height)
    .attr("height", 0)
    .style("opacity", 0)
      .on("mouseover", show_rule);
              
    products.exit().transition().duration(3000)
    .attr("y",height)
    .attr("height", 0)
    .style("opacity", 0)
    .remove();
      
       var base = 0;
      products.transition().duration(3000)

      .attr("width", x.rangeBand())
      .attr("x", 0)
      .attr("y", function(d)
      {
        var b = base;
        base += (d.mboed * d.price) / this.parentNode.__data__.prod_total;
  
        if(d.product == "gas") {base = 0;};
        return y(b + (d.mboed * d.price) / this.parentNode.__data__.prod_total);
      })
      .attr("height", function(d) { return height - y((d.mboed * d.price) / this.parentNode.__data__.prod_total); })
      .style("opacity", 1)
      .style("fill", function(d) { return colors_prods(d.product); });

      yAxis.tickFormat(dollars);
      yAxis_right.tickFormat(dollars);
      axis_y.transition().duration(3000)
        .call(yAxis);
      axis_y_right.transition().duration(3000)
        .attr("transform", "translate(" + width + ", 0)")
        .call(yAxis_right);
      axis_label.text("$ per boe");
      axis_label_right.text("$ per mcfe");

    leg_text_mode.text("Q2 2015 Boe/Mcfe Unit Price - composite");
}


function inc_qu_un(){
  
   mode = "INC_QU_UN";


    var zero = d3.min(current_data, function(d) { return d.values.corp[0].dollars; });
    if (zero >= 0) {zero = 0;}
    else {zero = zero * 1.1;}

      
     y.domain([zero,
                d3.max(current_data, function(d) { return d.values.corp[3].dollars; }) * 1.05]);
     y_right.domain([zero *4,
                d3.max(current_data, function(d) { return d.values.corp[3].dollars; }) * 1.05 *4]);
                
    zero_rule.transition().duration(3000).attr("y1", y(0)).attr("y2", y(0));

    var metrics = group.selectAll(".company").selectAll("rect")
      .data(function(d) { return d.values.corp; });
      
      
    metrics.enter().append("rect")
    .attr("y", height)
    .attr("height", 0)
    .style("opacity", 0)
    .on("mouseover", show_rule);
    
              
    metrics.exit().transition().duration(3000)
    .style("opacity", 0)
    .attr("y", height)
    .attr("height", 0)
    .remove();

     metrics.transition().duration(3000)
      .attr("width", x_corp.rangeBand())
      .attr("x", function(d) { return x_corp(d.metric); })
      .attr("y", function(d) { if (d.dollars<0) return y(0);
        else {return y(d.dollars);}
        })
        .attr("height", function(d) { if (d.dollars < 0) return (y(d.dollars) - y(0));
        else { return y(0) - y(d.dollars); }
        })
      .style("opacity", 1)
      .style("fill", function(d) { return colors_income(d.metric); });

      yAxis.tickFormat(dollars);
      yAxis_right.tickFormat(dollars);
      axis_y.transition().duration(3000)
        .call(yAxis);
      axis_y_right.transition().duration(3000)
        .attr("transform", "translate(" + width + ", 0)")
        .call(yAxis_right);
      axis_label.text("$ (millions)    per quarter");
      axis_label_right.text("$ (millions)    annualized");
      
      leg_text_mode.text("Q2 2015 Production Income Metrics");
 
}

function inc_qu_s(){
  
  mode = "INC_QU_S";
      
    var zero = d3.min(current_data, function(d) { return d.values.corp[0].dollars; });
    if (zero >= 0) {zero = 0;}
    else {zero = zero * 1.1;}

      
     y.domain([zero,
                d3.max(current_data, function(d) { return d.values.corp[3].dollars; }) * 1.05]);
     y_right.domain([zero * 4,
                d3.max(current_data, function(d) { return d.values.corp[3].dollars; }) * 1.05 *4]);
       
     
     zero_rule.transition().duration(3000).attr("y1", y(0)).attr("y2", y(0));

    var base = 0;
    var metrics = group.selectAll(".company").selectAll("rect")
      .data(function(d) { return d.values.corp; });
      
      
    metrics.enter().append("rect")
    .attr("y", height)
    .attr("height", 0)
    .style("opacity", 0)
    .on("mouseover", show_rule);
              
    metrics.exit().transition().duration(3000)
    .style("opacity", 0)
    .attr("y", height)
    .attr("height", 0)
    .remove();
      

     metrics.transition().duration(3000)
      .attr("width", x.rangeBand())
      .attr("x", 0)
      .attr("y", function(d) {
        var b = base;
          base += d.dif_dollars;
          if(d.metric == "postHedge") {base = 0;}
        return y(b + d.dif_dollars);
      })
      .attr("height", function(d) { if (d.dif_dollars < 0) {return 0;}
         else { return y(0) - y(d.dif_dollars); }
      })
      .style("opacity", 1)
      .style("fill", function(d) { return colors_income_s(d.metric); });


      yAxis.tickFormat(dollars);
      yAxis_right.tickFormat(dollars);
      axis_y.transition().duration(3000)
        .call(yAxis);
      axis_y_right.transition().duration(3000)
        .attr("transform", "translate(" + width + ", 0)")
        .call(yAxis_right);
      axis_label.text("$ (millions)    per quarter");
      axis_label_right.text("$ (millions)    annualized");
      
      leg_text_mode.text("Q2 2015 Production Cost Analysis");
 

}

function inc_boe_un(){
  
   mode = "INC_BOE_UN";
   
    var zero = d3.min(current_data, function(d) { return (d.values.corp[0].percent * d.boe_price_hedged); });
    if (zero >= 0) {zero = 0;}
    else {zero = zero * 1.1;}
      

    y.domain([zero,d3.max(current_data, function(d) { return d.boe_price_hedged; }) * 1.05]);
    y_right.domain([zero/6 ,d3.max(current_data, function(d) { return d.boe_price_hedged; }) * 1.05 / 6]);
    
    zero_rule.transition().duration(3000).attr("y1", y(0)).attr("y2", y(0));
     

    var metrics = group.selectAll(".company").selectAll("rect")
      .data(function(d) { return d.values.corp; });
      
      
    metrics.enter().append("rect")
    .attr("y", height)
    .attr("height", 0)
    .style("opacity", 0)
    .on("mouseover", show_rule);
    
              
    metrics.exit().transition().duration(3000)
    .style("opacity", 0)
    .attr("y", height)
    .attr("height", 0)
    .remove();
      
    metrics.transition().duration(3000)
      .attr("width", x_corp.rangeBand())
      .attr("x", function(d) { return x_corp(d.metric); })
      .attr("y", function(d) { if (d.percent * this.parentNode.__data__.boe_price_hedged<0) return y(0);
        else {return y(d.percent * this.parentNode.__data__.boe_price_hedged);}
        })
      .attr("height", function(d) { if (d.percent * this.parentNode.__data__.boe_price_hedged < 0) return (y(d.percent * this.parentNode.__data__.boe_price_hedged) - y(0));
        else { return y(0) - y(d.percent * this.parentNode.__data__.boe_price_hedged); }
        })
      .style("opacity", 1)
      .style("fill", function(d) { return colors_income(d.metric); });
  


      yAxis.tickFormat(dollars);
      yAxis_right.tickFormat(dollars);
      axis_y.transition().duration(3000)
        .call(yAxis);
      axis_y_right.transition().duration(3000)
        .attr("transform", "translate(" + width + ", 0)")
        .call(yAxis_right);
      axis_label.text("$ per boe");
      axis_label_right.text("$ per mcfe");
      
      leg_text_mode.text("Q2 2015 Production Income Metrics - per Barrel Equivalent");
 
}

function inc_boe_s(){
  
  mode = "INC_BOE_S";
  
     var zero = d3.min(current_data, function(d) { return d.values.corp[0].difference * d.boe_price_hedged; });
    if (zero >= 0) {zero = 0;}
    else {zero = zero * 1.1;}

      
     y.domain([zero,
                d3.max(current_data, function(d) { return d.boe_price_hedged; }) * 1.05]);
     y_right.domain([zero/6,
                d3.max(current_data, function(d) { return d.boe_price_hedged; }) * 1.05/6]);
     
     zero_rule.transition().duration(3000).attr("y1", y(0)).attr("y2", y(0));
       

    var base = 0;
    var metrics = group.selectAll(".company").selectAll("rect")
      .data(function(d) { return d.values.corp; });
      
      
    metrics.enter().append("rect")
    .attr("y", height)
    .attr("height", 0)
    .style("opacity", 0)
    .on("mouseover", show_rule);
              
    metrics.exit().transition().duration(3000)
    .style("opacity", 0)
    .attr("y", height)
    .attr("height", 0)
    .remove();
      
    metrics.transition().duration(3000)
      .attr("width", x.rangeBand())
      .attr("x", 0)
      .attr("y", function(d) {
        var b = base;
          base += this.parentNode.__data__.boe_price_hedged * d.difference;
          if(d.metric == "postHedge") {base = 0;}
        return y(b + (this.parentNode.__data__.boe_price_hedged * d.difference));
        
      })
      .attr("height", function(d) { if (this.parentNode.__data__.boe_price_hedged * d.difference < 0) {return 0;} // eliminate negative height rects
            else { return y(0) - y(this.parentNode.__data__.boe_price_hedged * d.difference); }
      })
      .style("opacity", 1)
      .style("fill", function(d) { return colors_income_s(d.metric); });

      yAxis.tickFormat(dollars);
      yAxis_right.tickFormat(dollars);
      axis_y.transition().duration(3000)
        .call(yAxis);
      axis_y_right.transition().duration(3000)
        .attr("transform", "translate(" + width + ", 0)")
        .call(yAxis_right);
      axis_label.text("$ per boe");
      axis_label_right.text("$ per mcfe");
      
      leg_text_mode.text("Q2 2015 Production Cost Analysis - per Barrel Equivalent");
}

function inc_perc_un(){
  
   mode = "INC_PERC_UN";
   
    var zero = d3.min(current_data, function(d) { return (d.values.corp[0].percent); });
    if (zero >= 0) {zero = 0;}
    else {zero = zero * 1.1;}
    
    y.domain([zero, 1.05]);
    y_right.domain([zero, 1.05]);
    
    zero_rule.transition().duration(3000).attr("y1", y(0)).attr("y2", y(0));

    var metrics = group.selectAll(".company").selectAll("rect")
      .data(function(d) { return d.values.corp; });
      
    metrics.enter().append("rect")
    .attr("y", height)
    .attr("height", 0)
    .style("opacity", 0)
    .on("mouseover", show_rule);
    
    metrics.exit().transition().duration(3000)
    .style("opacity", 0)
    .attr("y", height)
    .attr("height", 0)
    .remove();
      
    metrics.transition().duration(3000)
      .attr("width", x_corp.rangeBand())
      .attr("x", function(d) { return x_corp(d.metric); })
      .attr("y", function(d) { if (d.percent<0) return y(0);
        else {return y(d.percent);}
        })
      .attr("height", function(d) { if (d.percent < 0) return (y(d.percent) - y(0));
        else { return y(0) - y(d.percent); }
        })
      .style("opacity", 1)
      .style("fill", function(d) { return colors_income(d.metric); });
  
      yAxis.tickFormat(percent);
      yAxis_right.tickFormat(percent);
      axis_y.transition().duration(3000)
        .call(yAxis);
      axis_y_right.transition().duration(3000)
        .attr("transform", "translate(" + width + ", 0)")
        .call(yAxis_right);
      axis_label.text("percent");
      axis_label_right.text("percent");
      
      leg_text_mode.text("Q2 2015 Production Income Metrics - percent of post-hedge revenue");
 
}


function inc_perc_s(){
  
  mode = "INC_PERC_S";
  
    var zero = d3.min(current_data, function(d) { return d.values.corp[0].difference; });
    if (zero >= 0) {zero = 0;}
    else {zero = zero * 1.1;}
    
    y.domain([zero, 1.05]);
    y_right.domain([zero, 1.05]);
    
    zero_rule.transition().duration(3000).attr("y1", y(0)).attr("y2", y(0));
    
    var base = 0;
    var metrics = group.selectAll(".company").selectAll("rect")
      .data(function(d) { return d.values.corp; });
      
    metrics.enter().append("rect")
    .attr("y", height)
    .attr("height", 0)
    .style("opacity", 0)
    .on("mouseover", show_rule);
              
    metrics.exit().transition().duration(3000)
    .style("opacity", 0)
    .attr("y", height)
    .attr("height", 0)
    .remove();
      
    metrics.transition().duration(3000)
      .attr("width", x.rangeBand())
      .attr("x", 0)
      .attr("y", function(d) {
        var b = base;
          base += d.difference;
          if(d.metric == "postHedge") {base = 0;}
        return y(b + (d.difference));
      })
      .attr("height", function(d) { if (d.difference < 0) {return 0;} // eliminate negative height rects
            else { return y(0) - y(d.difference); }
      })
      .style("opacity", 1)
      .style("fill", function(d) { return colors_income_s(d.metric); });

      yAxis.tickFormat(percent);
      yAxis_right.tickFormat(percent);
      axis_y.transition().duration(3000)
        .call(yAxis);
      axis_y_right.transition().duration(3000)
        .attr("transform", "translate(" + width + ", 0)")
        .call(yAxis_right);
      axis_label.text("percent");
      axis_label_right.text("percent");
      leg_text_mode.text("Q2 2015 Production Cost Analysis - percent of post-hedge revenue");
}

function reserves_un() {

  mode = "RESERVES_UN";
  
    y.domain([0, (d3.max(current_data, function(d) { return d3.max(d.values.reserves, function(d) {return d.mmboe;}) })) * 1.05]);
    y_right.domain([0,(d3.max(current_data, function(d) { return d3.max(d.values.reserves, function(d) {return d.mmboe;}) })) * 1.05 * 6]);

    zero_rule.transition().duration(3000).attr("y1", y(0)).attr("y2", y(0));
    
    var products = group.selectAll(".company").selectAll("rect")
      .data(function(d) { return d.values.reserves; });
      
      
    products.enter().append("rect")
      .attr("y",height)
      .attr("height", 0)
      .style("opacity", 0)
      .on("mouseover", show_rule);
    
     products.exit().transition().duration(3000).remove();
     //presently has no meaning because, begin the largest group, loading never involves an exit selection
   
    products.transition().duration(3000)
      .attr("width", x_reserves.rangeBand())
      .attr("x", function(d) { return x_reserves(d.div); })
      .attr("y", function(d) { return y(d.mmboe); })
      .attr("height", function(d) { return height - y(d.mmboe); })
      .style("opacity", 1)
      .style("fill", function(d) { return colors_reserves(d.div); });
  
      yAxis.tickFormat(null);
      yAxis_right.tickFormat(null);
      axis_y.transition().duration(3000)
        .call(yAxis);
      axis_y_right.transition().duration(3000)
        .attr("transform", "translate(" + width + ", 0)")
        .call(yAxis_right);
      axis_label.text("boe (millions)");
      axis_label_right.text("mcfe (millions)");

    leg_text_mode.text("Proved Reserves (12/31/14) - Analyzed");
  
}

function reserves_s() {


  mode = "RESERVES_S";

      y.domain([0,d3.max(current_data, function(d) { return d.pr_total; }) * 1.05]);
      y_right.domain([0,d3.max(current_data, function(d) { return d.pr_total; }) * 1.05 * 6]);
      
      zero_rule.transition().duration(3000).attr("y1", y(0)).attr("y2", y(0));
       
      var products = group.selectAll(".company").selectAll("rect")
      .data(function(d) { return d.values.reserves; });

    products.enter().append("rect")
      .attr("y",height)
      .attr("height", 0)
      .style("opacity", 0)
      .on("mouseover", show_rule);
              
     products.exit().transition().duration(3000).remove();
     //presently has no meaning because, begin the largest group, loading never involves an exit selection

    var base = 0;
    
     products.transition().duration(3000)

      .attr("width", x.rangeBand())
      .attr("x", 0)
      .attr("y", function(d) {
        var b = base;
        base += d.mmboe;
        if(d.div == "gas pud") {base = 0;}
       return y(b + d.mmboe); })
      .attr("height", function(d) { return height - y( d.mmboe); })
      .style("opacity", 1)
      .style("fill", function(d) { return colors_reserves(d.div); });

      yAxis.tickFormat(null);
      yAxis_right.tickFormat(null);
      axis_y.transition().duration(3000)
        .call(yAxis);
      axis_y_right.transition().duration(3000)
        .attr("transform", "translate(" + width + ", 0)")
        .call(yAxis_right);
      axis_label.text("boe (millions)");
      axis_label_right.text("mcfe (millions)");

    leg_text_mode.text("Proved Reserves (12/31/14) - Totaled");
  
}

function capex(){
  
  mode = "CAPEX";
  
      var zero = d3.min(current_data, function(d) { return (d.capex[1].value); }); //look for negative cash margin
    if (zero >= 0) {zero = 0;}
    else {zero = zero * 1.1;}

      y.domain([zero,d3.max(current_data, function(d) { return d.capex[0].value; }) * 1.05]);
      y_right.domain(y.domain());
      
      zero_rule.transition().duration(3000).attr("y1", y(0)).attr("y2", y(0));

    
    var products = group.selectAll(".company").selectAll("rect")
      .data(function(d) { return d.capex; });
      
      
    products.enter().append("rect")
      .attr("y",height)
      .attr("height", 0)
      .style("opacity", 0)
      .on("mouseover", show_rule);
    
     products.exit().transition().duration(3000).style("opacity", 0).remove();

    products.transition().duration(3000)
      .attr("width", x_capex.rangeBand())
      .attr("x", function(d) { return x_capex(d.name); })
      .attr("y", function(d) { if (d.value<0) return y(0);
        else {return y(d.value);}
        })
      .attr("height", function(d) { if (d.value < 0) return (y(d.value) - y(0));
        else { return y(0) - y(d.value); }
        })
      .style("opacity", 1)
      .style("fill", function(d) { return colors_capex(d.name); });
      
      yAxis.tickFormat(dollars);
      yAxis_right.tickFormat(dollars);
      axis_y.transition().duration(3000)
        .call(yAxis);
      axis_y_right.transition().duration(3000)
        .attr("transform", "translate(" + width + ", 0)")
        .call(yAxis_right);
      axis_label.text("$ (millions)");
      axis_label_right.text("$ (millions)");
      
      leg_text_mode.text("Q2 2015 E&P Capital Expenditures (vs. E&P Cash Margin)");
}
  
function hedge(){
  
  mode = "HEDGE";

      
    var zero = d3.min(current_data, function(d) { return (d.hedge/d.rev_total); });
    if (zero >= 0) {zero = 0;}
    else {zero = zero * 1.1;}

      y.domain([zero,
                d3.max(current_data, function(d) {
                    if (d.hedge/d.rev_total < 0) return 0;
                    else {return (d.hedge/d.rev_total) * 1.05;} })
                    ]);
      y_right.domain(y.domain());

    zero_rule.transition().duration(3000).attr("y1", y(0)).attr("y2", y(0));
 
    var products = group.selectAll(".company").selectAll("rect")
      .data(function(d) { return [d.hedge/d.rev_total]; });
      
    products.enter().append("rect")
      .attr("y",height)
      .attr("height", 0)
      .style("opacity", 0)
      .on("mouseover", show_rule);
              
    
     products.exit().transition().duration(3000).style("opacity", 0).remove();

   
    products.transition().duration(3000)
      .attr("width", x.rangeBand())
      .attr("x", 0)
      .attr("y", function(d) { if (d<0) return y(0);
        else {return y(d);}
        })
      .attr("height", function(d) { if (d<0) return y(d) - y(0);
        else { return y(0) - y(d); }
        })
      .style("opacity", 1)
      .style("fill", function(d) { if (d<0) return "lightgreen";
        else { return "lightgreen"; }
        });
      

      yAxis.tickFormat(percent);
      yAxis_right.tickFormat(percent);
      axis_y.transition().duration(3000)
        .call(yAxis);
      axis_y_right.transition().duration(3000)
        .attr("transform", "translate(" + width + ", 0)")
        .call(yAxis_right);
      axis_label.text("percent");
      axis_label_right.text("percent");
      
      leg_text_mode.text("Q2 2015 Hedge Impact - % of unhedged revenue");
}

function hedge_boe(){
  
  mode = "HEDGE_BOE";
  
    var zero = d3.min(current_data, function(d) { return (d.boe_price_hedged - d.boe_price); });
    if (zero >= 0) {zero = 0;}
    else {zero = zero * 1.1;}

      y.domain([zero,
                d3.max(current_data, function(d) {
                    if (d.boe_price_hedged - d.boe_price < 0) return 0;
                    else {return (d.boe_price_hedged - d.boe_price) * 1.05;} })
                    ]);
      y_right.domain([d3.round(zero/6,2),
                d3.max(current_data, function(d) {
                    if (d.boe_price_hedged - d.boe_price < 0) return 0;
                    else {return (d.boe_price_hedged - d.boe_price) * 1.05/6;} })
                    ]);

    zero_rule.transition().duration(3000).attr("y1", y(0)).attr("y2", y(0));
    
    var products = group.selectAll(".company").selectAll("rect")
      .data(function(d) { return [d.boe_price_hedged - d.boe_price]; });
      
    products.enter().append("rect")
      .attr("y",height)
      .attr("height", 0)
      .style("opacity", 0)
      .on("mouseover", show_rule);
    
     products.exit().transition().duration(3000).style("opacity", 0).remove();

    products.transition().duration(3000)
      .attr("width", x.rangeBand())
      .attr("x", 0)
      .attr("y", function(d) { if (d<0) return y(0);
        else {return y(d);}
        })
      .attr("height", function(d) { if (d<0) return y(d) - y(0);
        else { return y(0) - y(d); }
        })
      .style("opacity", 1)
      .style("fill", function(d) { if (d<0) return "lightgreen";
        else { return "lightgreen"; }
        });
      
      yAxis.tickFormat(dollars);
      yAxis_right.tickFormat(dollars2);//hack to assure rounded values, but loses $ format
      axis_y.transition().duration(3000)
        .call(yAxis);
      axis_y_right.transition().duration(3000)
        .attr("transform", "translate(" + width + ", 0)")
        .call(yAxis_right);
      axis_label.text("$ per boe");
      axis_label_right.text("$ per mcfe");
      
      leg_text_mode.text("Q2 2015 Hedge Impact in $/boe");
}

function debt_ebitda(){
  
  mode = "DEBT_EBITDA";

       
      y.domain([0,d3.max(current_data, function(d) { return d.debt/(d.values.corp[2].dollars * 4); }) * 1.05]);
      y_right.domain(y.domain() );
      
      zero_rule.transition().duration(3000).attr("y1", y(0)).attr("y2", y(0));
    
    var products = group.selectAll(".company").selectAll("rect")
      .data(function(d) { return [d.debt/(d.values.corp[2].dollars * 4)]; });
      
      
    products.enter().append("rect")
      .attr("y",height)
      .attr("height", 0)
      .style("opacity", 0)
      .on("mouseover", show_rule);
              
    
     products.exit().transition().duration(3000).style("opacity", 0).remove();

   
    products.transition().duration(3000)
      .attr("width", x.rangeBand())
      .attr("x", 0)
      .attr("y", function(d) { return y(d); })
      .attr("height", function(d) { return height - y(d); })
      .style("opacity", 1)
      .style("fill", "green");
      
      yAxis.tickFormat(null);
      yAxis_right.tickFormat(null);
      axis_y.transition().duration(3000)
        .call(yAxis);
      axis_y_right.transition().duration(3000)
        .attr("transform", "translate(" + width + ", 0)")
        .call(yAxis_right);
      axis_label.text("multiple");
      axis_label_right.text("multiple");
      
      leg_text_mode.text("Q2 2015 Net Debt/EBITDA Ratio (LQA EBITDA)");

}

function ev(){
  
mode = "EV";

       y.domain([0,d3.max(current_data, function(d) { return d.ev[0].value + d.ev[1].value;} ) * 1.05]);
       y_right.domain(y.domain());
       
       zero_rule.transition().duration(3000).attr("y1", y(0)).attr("y2", y(0));

    
    var products = group.selectAll(".company").selectAll("rect")
      .data(function(d) { return d.ev; });
      
      
    products.enter().append("rect")
      .attr("y",height)
      .attr("height", 0)
      .style("opacity", 0)
      .on("mouseover", show_rule);
              
    products.exit().transition().duration(3000)
    .attr("y",height)
    .attr("height", 0)
    .style("opacity", 0)
    .remove();

      var base = 0;
      
      products.transition().duration(3000)
      .attr("width", x.rangeBand())
      .attr("x", 0)
      .attr("y", function(d) {
        var b = base;
        base += d.value;
        if(d.name == "debt") {base = 0;}
       return y(b + d.value); })
      .attr("height", function(d) { return height - y( d.value); })
      .style("opacity", 1)
      .style("fill", function(d) { return colors_ev(d.name); });

      yAxis.tickFormat(dollars);
      yAxis_right.tickFormat(dollars);
      axis_y.transition().duration(3000)
        .call(yAxis);
      axis_y_right.transition().duration(3000)
        .attr("transform", "translate(" + width + ", 0)")
        .call(yAxis_right);
      axis_label.text("$ (millions)");
      axis_label_right.text("$ (millions)");
    
    leg_text_mode.text("Enterpirse Value (EV) - (stock at weekly close + Q2 debt)");
}

function ev_ebitda(){
  
  mode = "EV_EBITDA";

       
      y.domain([0,d3.max(current_data, function(d) { return ( (d.ev[0].value + d.ev[1].value)/(d.values.corp[2].dollars * 4)); }) * 1.05]);
      y_right.domain(y.domain() );
      zero_rule.transition().duration(3000).attr("y1", y(0)).attr("y2", y(0));

    var products = group.selectAll(".company").selectAll("rect")
      .data(function(d) { return [ (d.ev[0].value + d.ev[1].value)/(d.values.corp[2].dollars * 4)]; });
      
      
    products.enter().append("rect")
      .attr("y",height)
      .attr("height", 0)
      .style("opacity", 0)
      .on("mouseover", show_rule);
              
    
     products.exit().transition().duration(3000).style("opacity", 0).remove();

   
    products.transition().duration(3000)
      .attr("width", x.rangeBand())
      .attr("x", 0)
      .attr("y", function(d) { return y(d); })
      .attr("height", function(d) { return height - y(d); })
      .style("opacity", 1)
      .style("fill", "lightgreen");
      
      yAxis.tickFormat(null);
      yAxis_right.tickFormat(null);
      axis_y.transition().duration(3000)
        .call(yAxis);
      axis_y_right.transition().duration(3000)
        .attr("transform", "translate(" + width + ", 0)")
        .call(yAxis_right);
      axis_label.text("multiple");
      axis_label_right.text("multiple");
      
      leg_text_mode.text("EV/EBITDA Ratio (LQA EBITDA)");

}

function pr_dashare(){
  
  mode = "PR_DASHARE";

       
      y.domain([0,d3.max(current_data, function(d) { return d.pr_total/d.da_shares; }) * 1.05]);
      y_right.domain([0,d3.max(current_data, function(d) { return d.pr_total/d.da_shares; })*6 * 1.05]);
      zero_rule.transition().duration(3000).attr("y1", y(0)).attr("y2", y(0));

    
    var products = group.selectAll(".company").selectAll("rect")
      .data(function(d) { return [d.pr_total/d.da_shares]; });
      
      

    products.enter().append("rect")
      .attr("y",height)
      .attr("height", 0)
      .style("opacity", 0)
      .on("mouseover", show_rule);
              
    
     products.exit().transition().duration(3000).style("opacity", 0).remove();

   
    products.transition().duration(3000)
      .attr("width", x.rangeBand())
      .attr("x", 0)
      .attr("y", function(d) { return y(d); })
      .attr("height", function(d) { return height - y(d); })
      .style("opacity", 1)
      .style("fill", "green");
      
      yAxis.tickFormat(null);
      yAxis_right.tickFormat(null);
      axis_y.transition().duration(3000)
        .call(yAxis);
      axis_y_right.transition().duration(3000)
        .attr("transform", "translate(" + width + ", 0)")
        .call(yAxis_right);
      axis_label.text("boe/share");
      axis_label_right.text("mcfe/share");
      
      leg_text_mode.text("Proved Reserves per Debt-Adjusted Share");

}



function prod_dashare(){
  
  mode = "PROD_DASHARE";

       
      y.domain([0,d3.max(current_data, function(d) { return (d.prod_total * 365/1000)/d.da_shares; }) * 1.05]);
      y_right.domain([0,d3.max(current_data, function(d) { return (d.prod_total * 365/100)/d.da_shares; })*6 * 1.05]);
      zero_rule.transition().duration(3000).attr("y1", y(0)).attr("y2", y(0));

    
    var products = group.selectAll(".company").selectAll("rect")
      .data(function(d) { return [(d.prod_total * 365/1000)/d.da_shares]; });
      
      

    products.enter().append("rect")
      .attr("y",height)
      .attr("height", 0)
      .style("opacity", 0)
      .on("mouseover", show_rule);
              
    
     products.exit().transition().duration(3000).style("opacity", 0).remove();

   
    products.transition().duration(3000)
      .attr("width", x.rangeBand())
      .attr("x", 0)
      .attr("y", function(d) { return y(d); })
      .attr("height", function(d) { return height - y(d); })
      .style("opacity", 1)
      .style("fill", "green");
      
      yAxis.tickFormat(null);
      yAxis_right.tickFormat(null);
      axis_y.transition().duration(3000)
        .call(yAxis);
      axis_y_right.transition().duration(3000)
        .attr("transform", "translate(" + width + ", 0)")
        .call(yAxis_right);
      axis_label.text("boe/share");
      axis_label_right.text("mcfe/share");
      
      leg_text_mode.text("Annual Production (LQA) per Debt-Adjusted Share");

}


function g_level() {

      //clear rule on any refresh
      rule_group.style("visibility", "hidden");

    var t = group.selectAll(".company")
      .data(current_data, function(d){return d.company;});

      t.enter().append("g")
      .attr("class", "company")
      .style("opacity", 0)
      .attr("transform", function(d) { return " scale(0,0), translate( 0, 0)"; });

      
     t.exit()
      .transition().duration(3000)
      .attr("transform", function(d) { return " scale(1,0), translate( 0, 0)"; })
      .style("opacity", 0)
      .remove();
      
      t.transition().duration(3000)
      .attr("class", "company")
      .style("opacity", 1)
      .attr("transform", function(d) { return "scale(1,1), translate(" + x(d.company) + ",0)"; });

      axis_x.transition().duration(3000).call(xAxis);

}


// END MODE SWITCHING BLOCK


var contract_root = svg.append("g")
      .attr("transform", "translate(555, 320)")
.on("click", function() {

        if (contracted == "no") {
          
          contracted = "yes";
          width = width - contract_width;
          svg.attr("width", width);
          main_background.transition().duration(3000).attr("width", width);
          x.rangeRoundBands([0, width], .5);
          loadSelected();
          zero_rule.transition().duration(3000).attr("x2", width); //after loadSelected
          
          tools_root.style("visibility", "visible");
          modes.style("visibility", "visible");
          selections_root.style("visibility", "hidden");
          contract_toggle.text("< >");
          
          

          axis_label_right.transition().duration(1000).style("opacity", 0);
          
          axis_x.attr("class", "x axis small");
          leg_text_mode.style("font-size", "12px");
          leg_text_mode.transition().duration(3000).attr("x", (width/2) + 20);
        }
        else {
        
          contracted = "no";
          svg.attr("width", width);
          width = width + contract_width;
          main_background.transition().duration(3000).attr("width", width);
          
          x.rangeRoundBands([0, width], .5);
          loadSelected();
          zero_rule.transition().duration(3000).attr("x2", width);
          
          tools_root.style("visibility", "hidden");
          modes.style("visibility", "hidden");
          selections_root.style("visibility", "hidden");
          tools_toggle_state = "modes";
          state_toggle.text(">");
          contract_toggle.text("> <");

 

          axis_label_right.transition().duration(3000).style("opacity", 1);
          axis_x.attr("class", "x axis");
          leg_text_mode.style("font-size", "13px");
          leg_text_mode.transition().duration(3000).attr("x", width/2 -40);

        }
      
    });

 

      
contract_root.append("rect")
    .attr("x", -2)
    .attr("y", -22 )
    .attr("width", 35)
    .attr("height", 35)
    .style("fill", "rgb(170,170,170)");
    
contract_root.append("rect")
    .attr("x", 0)
    .attr("y", -20 )
    .attr("width", 30 )
    .attr("height", 30 )
    .style("fill", clr_oil);
    
var contract_toggle = contract_root.append("text")
      .attr("x", 15)
      .style("fill", "white")
      .style("font-weight", "900")
      .style("font-size", "20px")
      .attr("text-anchor", "middle")
      .style("font-family", "Quattrocento Sans")
      .text("> <")
      .style("cursor", "pointer");






// Opening slide sequence -- comment out to disable

// shift root back to body origin
var overlay_root = svg.append("g")
  .attr("transform", "translate(" + -margin.left + "," + -margin.top + ")");

var click_shield_rect = overlay_root.append("rect")
      .attr("width", 640)
      .attr("height", 360)
      //.style("fill", "rgb(239,239,239)")
      .style("fill", clr_oil)
      .style("opacity", 1);

var slides_root = overlay_root.append("g")
    .classed("label", true);

    
//INFO PANEL

    function OpenInNewTab(url) {
  var win = window.open(url, '_blank');
  win.focus();
}



var info_slide_root = slides_root.append("g")
  .attr("transform", "translate( 0,0 )")
  .style("visibility", "hidden");
  
 
info_slide_root.append("rect")
      .attr("width", 640)
      .attr("height", 360)
      .style("fill", "white")
      .style("stroke", "rgb(140,140,140)")
      .style("stroke-width", "10px")
      .transition().delay(3000).duration(1000).style("stroke", clr_oil);


var info_slide_root_main = info_slide_root.append("g")
      .style("visibility", "hidden");
    
var info_slide_root_alt = info_slide_root.append("g")
      .style("visibility", "hidden");


//CLOSE info panel button with functionality


var close_button = info_slide_root_main.append("g")
      .attr("transform", "translate(570, 30)")
      .style("cursor", "pointer")
      .on("click", function() {
        info_slide_root.style("visibility", "hidden");
        info_slide_root_main.style("visibility", "hidden");
        info_slide_root_alt.style("visibility", "hidden");
      });
      
    
close_button.append("rect")
    .attr("x", 0)
    .attr("y", -20 )
    .attr("width", 60 )
    .attr("height", 30 )
    .style("stroke", clr_oil)
    .style("stroke-width", "2px")
    .style("fill", "white");
    
close_button.append("text")
      .attr("x", 29)
      .attr("y", 1 )
      .style("fill", "black")
      .style("font-size", "16px")
      .style("font-weight", "900")
      .attr("text-anchor", "middle")
      .text("CLOSE");
      
      
// Definitions panel button
      
      
var defs_button = info_slide_root_main.append("g")
      .attr("transform", "translate(490, 343)")
      .style("cursor", "pointer")
      .on("click", function() {
        info_slide_root_main.style("visibility", "hidden");
        info_slide_root_alt.style("visibility", "visible");
      });
      
    
defs_button.append("rect")
    .attr("x", 0)
    .attr("y", -20 )
    .attr("width", 140 )
    .attr("height", 30 )
    .style("stroke", clr_oil)
    .style("stroke-width", "2px")
    .style("fill", "white");
    
defs_button.append("text")
      .attr("x", 69)
      .attr("y", 1 )
      .style("fill", "black")
      .style("font-size", "16px")
      .style("font-weight", "900")
      .attr("text-anchor", "middle")
      .text("DEFINITIONS");
      
      

// CONTRACT >< in button
var contract_root_i_in = info_slide_root_main.append("g")
      .attr("transform", "translate(50, 30)")

      
contract_root_i_in.append("rect")
    .attr("x", -2)
    .attr("y", -22 )
    .attr("width", 35)
    .attr("height", 35)
    .style("fill", "rgb(170,170,170)");
    
contract_root_i_in.append("rect")
    .attr("x", 0)
    .attr("y", -20 )
    .attr("width", 30 )
    .attr("height", 30 )
    .style("fill", clr_oil);
    
contract_root_i_in.append("text")
      .attr("x", 15)
      .style("fill", "white")
      .style("font-weight", "900")
      .style("font-size", "20px")
      .attr("text-anchor", "middle")
      .style("font-family", "Quattrocento Sans")
      .text("> <")
      .style("cursor", "pointer");
      
contract_root_i_in.append("text")
      .attr("x", 50)
      .attr("y", 0 )
      .style("fill", "black")
      .style("font-size", "16px")
      .style("font-weight", "500")
      .text("CONTRACT GRAPH - REVEAL TOOLS");
      

// CONTRACT < > out button
var contract_root_i_out = info_slide_root_main.append("g")
      .attr("transform", "translate(50, 70)")

      
contract_root_i_out.append("rect")
    .attr("x", -2)
    .attr("y", -22)
    .attr("width", 35)
    .attr("height", 35)
    .style("fill", "rgb(170,170,170)");
    
contract_root_i_out.append("rect")
    .attr("x", 0)
    .attr("y", -20)
    .attr("width", 30)
    .attr("height", 30)
    .style("fill", clr_oil);
    
contract_root_i_out.append("text")
      .attr("x", 15)
      .style("fill", "white")
      .style("font-weight", "900")
      .style("font-size", "20px")
      .attr("text-anchor", "middle")
      .style("font-family", "Quattrocento Sans")
      .text("< >")
      .style("cursor", "pointer");
      
contract_root_i_out.append("text")
      .attr("x", 50)
      .attr("y", 0 )
      .style("fill", "black")
      .style("font-size", "16px")
      .style("font-weight", "500")
      .text("EXPAND GRAPH - HIDE TOOLS");



//RIGHT > Button image

var tools_toggle_root_i_right = info_slide_root_main.append("g")
      .attr("transform", "translate(50, 110)");
      
tools_toggle_root_i_right.append("rect")
    .attr("x", -2)
    .attr("y", -22 )
    .attr("width", 35 )
    .attr("height", 35 )
    .style("fill", "rgb(170,170,170)");
    
tools_toggle_root_i_right.append("rect")
    .attr("x", 0)
    .attr("y", -20)
    .attr("width", 30)
    .attr("height", 30)
    .style("fill", "black");
    
tools_toggle_root_i_right.append("text")
      .attr("x", 15)
      .style("fill", "white")
      .style("font-weight", "900")
      .style("font-size", "20px")
      .attr("text-anchor", "middle")
      .text(">")
      .style("cursor", "pointer");
      
tools_toggle_root_i_right.append("text")
      .attr("x", 50)
      .attr("y", 0 )
      .style("fill", "black")
      .style("font-size", "16px")
      .style("font-weight", "500")
      .text("SWITCH to COMPANY SELECTION TOOLS");


//LEFT < button image
var tools_toggle_root_i_left = info_slide_root_main.append("g")
      .attr("transform", "translate(50, 150)");
      
tools_toggle_root_i_left.append("rect")
    .attr("x", -2)
    .attr("y", -22)
    .attr("width", 35)
    .attr("height", 35)
    .style("fill", "rgb(170,170,170)");
    
tools_toggle_root_i_left.append("rect")
    .attr("x", 0)
    .attr("y", -20 )
    .attr("width", 30)
    .attr("height", 30)
    .style("fill", "black");
    
tools_toggle_root_i_left.append("text")
      .attr("x", 15)
      .style("fill", "white")
      .style("font-weight", "900")
      .style("font-size", "20px")
      .attr("text-anchor", "middle")
      .text("<")
      .style("cursor", "pointer");
      
tools_toggle_root_i_left.append("text")
      .attr("x", 50)
      .attr("y", 0 )
      .style("fill", "black")
      .style("font-size", "16px")
      .style("font-weight", "500")
      .text("SWITCH to DATA MODE SELECTION TOOLS");
      
//center block of info text lines

center_root = info_slide_root_main.append("g")
    .attr("transform", "translate( 30, 180)");
      
center_root.append("text")
      .attr("x", 0)
      .attr("y", 0 )
      .style("fill", "black")
      .style("font-size", "16px")
      .style("font-weight", "500")
      .text("-Touch Colored Squares in Legend to Sort Company Data");
      
center_root.append("text")
      .attr("x", 0)
      .attr("y", 20 )
      .style("fill", "black")
      .style("font-size", "16px")
      .style("font-weight", "500")
      .text("-Touch Colored Bars in Graph to Display Guide-Rules and Values");
      
center_root.append("text")
      .attr("x", 0)
      .attr("y", 40 )
      .style("fill", "black")
      .style("font-size", "16px")
      .style("font-weight", "500")
      .text("-Load on laptop in tablet browser for complete toolset");
      

      
      
// LInks
links_root = info_slide_root_main.append("g")
    .attr("transform", "translate( 30, 230)");
    
links_root.append("rect")
      .attr("width", 600)
      .attr("height", 90)
      .attr("x", -20)
      .attr("y", 0)
      .style("fill", clr_graph_bkgrnd)
      .style("stroke", "black")
      .style("stroke-width", "1px");
    
links_root.append("text")
       .classed("label", true)
       .style("font-size", "14px")
       .style("font-weight","400")
       .attr("y", 20)
       .text("Click to open in new tab:");
    
links_root.append("text")
       .classed("label", true)
       .style("font-size", "16px")
       .style("font-weight","500")
       .attr("x", 80)
       .attr("y", 40)
       //.attr("text-anchor", "middle")
       .style("font-family", "Quattrocento Sans")
       .style("cursor", "pointer")
       .on("mouseover", function () {d3.select(this).style("fill", "gray");})
       .on("mouseout", function () {d3.select(this).style("fill", "black");})
       .on("click", function() { OpenInNewTab("docs_links.html");}  )
       .text("Understanding Shale Equities Explorer");
       
links_root.append("text")
       .classed("label", true)
       .style("font-size", "16px")
       .style("font-weight","500")
       .attr("x", 80)
       .attr("y", 60)
       .style("font-family", "Quattrocento Sans")
       .style("cursor", "pointer")
        .on("mouseover", function () {d3.select(this).style("fill", "gray");})
       .on("mouseout", function () {d3.select(this).style("fill", "black");})
       .on("click", function() { OpenInNewTab("data_policy.pdf");}  )
       .text("Disclaimer and Data Policy with Company-Specific Notes");
       
links_root.append("text")
       .classed("label", true)
       .style("font-size", "16px")
       .style("font-weight","500")
       .attr("x", 80)
       .attr("y", 80)
       .style("font-family", "Quattrocento Sans")
       .style("cursor", "pointer")
        .on("mouseover", function () {d3.select(this).style("fill", "gray");})
       .on("mouseout", function () {d3.select(this).style("fill", "black");})
       .on("click", function() { OpenInNewTab("2015_Q1/2015_Q1_lite.html");}  )
       .text("Q1 2015 Data");
       
links_root.append("text")
       .classed("label", true)
       .style("font-size", "16px")
       .style("font-weight","500")
       .attr("x", 250)
       .attr("y", 80)
       .style("font-family", "Quattrocento Sans")
       .style("cursor", "pointer")
        .on("mouseover", function () {d3.select(this).style("fill", "gray");})
       .on("mouseout", function () {d3.select(this).style("fill", "black");})
       .on("click", function() { OpenInNewTab("2014_Q4/2014_Q4_lite.html");}  )
       .text("Q4 2014 Data");
      
//Contact email

info_slide_root_main.append("text")
      .attr("x", 20)
      .attr("y", 345)
      .style("fill", "black")
      .style("font-size", "18px")
      .style("font-weight", "500")
      .text("Contact: rob@shaleequitiesexplorer.com");


//end of INFO PANEL

//Definitions panel (from Info panel)


var back_button = info_slide_root_alt.append("g")
      .attr("transform", "translate(570, 30)")
      .style("cursor", "pointer")
            .on("click", function() {
        info_slide_root_alt.style("visibility", "hidden");
        info_slide_root_main.style("visibility", "visible");
      });
      
    
back_button.append("rect")
    .attr("x", 0)
    .attr("y", -20 )
    .attr("width", 60 )
    .attr("height", 30 )
    .style("stroke", clr_oil)
    .style("stroke-width", "2px")
    .style("fill", "white");
    
back_button.append("text")
      .attr("x", 29)
      .attr("y", 1 )
      .style("fill", "black")
      .style("font-size", "16px")
      .style("font-weight", "900")
      .attr("text-anchor", "middle")
      .text("BACK");
      
info_slide_root_alt.append("text")
      .attr("x", 30)
      .attr("y", 40 )
      .style("fill", "black")
      .style("font-size", "20px")
      .style("font-weight", "900")
      //.attr("text-anchor", "middle")
      .text("QUICK DEFINITIONS -- see docs for more");

      
var defs_array = [
    "* (asterisk) = two-stream reporting (ngl production included in gas)",
    "+ (plus sign) = meaningful international production included",
    "BO = barrel of oil (crude oil, condensate or bitumen)",
    "MCF = 1000 cubic feet of natural gas",
    "BOE = barrel of oil equivalent (6 x mcfe)",
    "MCFE = mcf equivalent (1/6 of boe)",
    "GAS = natural gas, NGL = natural gas liquids, LIQUIDS = oil plus ngl",
    "PR = proved reserves -- composed of:",
    " -- PD (proved developed reserves) & PUD (proved undeveloped reserves)",
    "M = thousands, MM = millions, B = billions"
];
      
var defs_array_scale = d3.scale.ordinal()
    .rangePoints([0,defs_array.length * 25],0)
    .domain(defs_array);

var defs_list_root = info_slide_root_alt.append("g")
    .classed("label", true)
    .attr("transform", "translate( 0, 0 )");
    
    
var defs_list_labels = defs_list_root.append("g")
      .attr("transform", "translate(25, 80)")
      .selectAll("label")
      .data(defs_array)
      .enter().append("text")
      .attr("x", 0)
      .attr("y", function(d) { return defs_array_scale(d) ;})
      .style("font-family", "EB Garamond")
      .style("font-size", "20px")
      .text(function (d) {return d;});

      


      
//blue - top - first slide


var blue_slide_root = slides_root.append("g")
  .attr("transform", "translate( 20,20 )")    .on("click", function() {
        d3.select("body").style("background-color", "white");
        d3.select("#links").style("display", "block");
        d3.select(this).style("visibility", "hidden");
        click_shield_rect.style("visibility", "hidden");
        load_main_graph();
      }  ) ;

  
blue_slide_root.append("rect")
.attr("transform", "translate( -12,-12 )")
      .attr("width", 625)
      .attr("height", 345)
      .style("fill", "rgb(165,165,165)")
      .transition().delay(3000).duration(1000).style("fill", clr_ngl);

      
blue_slide_root.append("rect")
      .attr("width", 600)
      .attr("height", 320)
      .style("fill", "rgb(190,190,190)")
      .style("stroke", "rgb(140,140,140)")
      .style("stroke-width", "10px")
      .transition().delay(3000).duration(1000).style("stroke", clr_gas);

      
      



var bbop_text_root = blue_slide_root.append("g")
    .attr("transform", "translate (300, 180)");
    

    bbop_text_root.transition().delay(3500).duration(1000)
      .style("opacity", 0);

    
var blue_bbop_text1 = bbop_text_root.append("text")
    .attr("x", -175)
    .attr("y", 0)
    .attr("text-anchor", "start")
    .style("font-size", "32px")
    .style("font-weight", "normal")
    .style("font-variant", "normal")
    .style("font-family", "Quattrocento Sans")
    .text("b(B")
    .style("fill", "white");
    
var blue_bbop_text2 = bbop_text_root.append("text")
    .attr("x", -96)
    .attr("y", 0)
    .attr("text-anchor", "start")
    .style("font-size", "32px")
    .style("font-weight", "normal")
    .style("font-variant", "normal")
    .style("font-family", "Quattrocento Sans")
    .text("P).data_interactive")
    .style("fill", "white");
    
bbop_text_root.append("circle")
    .attr("r", 11)
    .attr("cx", -112)
    .attr("cy", -10)
    .style("stroke", clr_oil)
    .style("stroke-width", "3")
    .style("fill", clr_gas)
    .transition().delay(2500).duration(1000).ease("elastic")
      .attr("r", 200)
      .transition().delay(3500).duration(0)
      .attr("r",11);
      
bbop_text_root.append("circle")
    .attr("r",11)
    .attr("cx", -112)
    .attr("cy", -10)
    .style("stroke", clr_oil)
    .style("stroke-width", "3")
    .style("fill", clr_ngl)
    .transition().delay(2000).duration(1000).ease("elastic")
      //.style("opacity", ".5")
      .attr("r", 100)
      .transition().delay(3500).duration(0)
      .attr("r",11);
      
      
      
bbop_text_root.append("circle")
    .attr("r", 11)
    .attr("cx", -112)
    .attr("cy", -10)//-13
    .style("stroke", clr_oil)
    .style("stroke-width", "3")
    .style("fill", "white")
    .transition().delay(1500).duration(1000).ease("elastic")
      .attr("r", 50)
      .transition().delay(3500).duration(0)
      .attr("r", 11);



var SEE_text_root = blue_slide_root.append("g")
    .style("opacity", 0);
    
    SEE_text_root.transition().delay(4000).duration(2000)
        .style("opacity", 1);
    
var blue_shale_text = SEE_text_root.append("text")
    .attr("x", 70)
    .attr("y", 80)
    .style("font-family", "EB Garamond")
    .style("font-size", "35px")
    .style("font-weight","400")
    .text("SHALE")
    .style("fill", "white");
    //.style("stroke", "black");
    
var blue_equities_text = SEE_text_root.append("text")
    .attr("x", 195)
    .attr("y", 80)
    .style("font-family", "EB Garamond")
    .style("font-size", "35px")
    .style("font-weight","400")
    .text("EQUITIES")
    .style("fill", "white");

    
var blue_explorer_text = SEE_text_root.append("text")
    .attr("x", 365)
    .attr("y", 80)
    .style("font-family", "EB Garamond")
    .style("font-size", "35px")
    .style("font-weight","400")
    .text("EXPLORER")
    .style("fill", "white");
    
var blue_lite_text = SEE_text_root.append("text")
    .attr("x", 300)
    .attr("y", 110)
    .attr("text-anchor", "middle")
    .style("font-family", "Quattrocento Sans")
    .style("font-size", "23px")
    .style("font-weight","400")
    .style("font-variant","normal")
    .text("Lite Version - Scaled for Smartphones")
    .style("fill", clr_ngl);
    

    
var blue_firstline_text = SEE_text_root.append("text")
    .attr("x", 300)
    .attr("y", 160)
    .attr("text-anchor", "middle")
    .style("font-family", "EB Garamond")
    .style("font-size", "25px")
    .style("font-weight","400")
    .style("font-variant","normal")
    .text("Interactive Visual Database")
    .style("fill", "black");
    
var blue_secondline_text = SEE_text_root.append("text")
    .attr("x", 300)
    .attr("y", 185)
    .attr("text-anchor", "middle")
    .style("font-family", "EB Garamond")
    .style("font-size", "25px")
    .style("font-weight","400")
    .style("font-variant","normal")
    .text("of 40 Public Companies Operating in U.S. Shales")
    .style("fill", "black");
    
    
var bottom_text_root = blue_slide_root.append("g")
    .attr("transform", "translate (300, 220)")
    .style("opacity", 0);
    
    bottom_text_root.transition().delay(4000).duration(2000).style("opacity", 1);
    
bottom_text_root.append("text")
      .attr("x",0)
    .attr("y", 5)
    .attr("text-anchor", "middle")
    .style("font-family", "Quattrocento Sans")
    .style("font-size", "22px")
    .style("font-weight","400")
    .style("font-variant","normal")
    .text("Q2 2015 Data")
    .style("fill", "black");
    
bottom_text_root.append("text")
      .attr("x",0)
    .attr("y", 25)
    .attr("text-anchor", "middle")
    .style("font-family", "Quattrocento Sans")
    .style("font-size", "15px")
    .style("font-weight","400")
    .style("font-variant","normal")
    .text("Data curated pursuant to defined policy for optimal clarity and comparability")
    .style("fill", "black");
    
bottom_text_root.append("text")
      .attr("x",0)
    .attr("y", 60)
    .attr("text-anchor", "middle")
    .style("font-family", "EB Garamond")
    .style("font-size", "16px")
    .style("font-weight","400")
    .style("font-variant","normal")
    .text("Use subject to disclaimer - all rights reserved 2015")
    .style("fill", "black");
    
bottom_text_root.append("text")
    .attr("x", 0)
    .attr("y", 85)
    .attr("text-anchor", "middle")
    .style("font-family", "Quattrocento Sans")
    .style("cursor", "pointer")
    .style("font-size", "20px")
    .style("font-weight","600")
    .text("CLICK to acknowledge")
    .style("fill", "black");
    
    

    




      
      
function load_main_graph()   {
  
  var company = group.selectAll("h")
      .data(current_data, function(d){return d.company;})
    .enter().append("g")
      .attr("class", "company")
      .attr("transform", function(d) { return " scale(0,0), translate( 0, 0)"; });

  
      company.transition().duration(3000)
      .delay(function(d, i) { return i * 300; })
      .attr("transform", function(d) { return "scale(1,1), translate(" + x(d.company) + ",0)"; });

      
      company.selectAll("rect")
      .data(function(d) { return d.values.prods; })
      .enter().append("rect")
      .attr("width", x_prods.rangeBand())
      .attr("x", function(d) { return x_prods(d.product); })
      .attr("y", function(d) { return y(d.mboed); })
      .attr("height", function(d) { return height - y(d.mboed); })
      .style("fill", function(d) { return colors_prods(d.product); })
      .on("mouseover", show_rule);
      
}


</script>


</body>
</html>


  
