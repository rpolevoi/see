
<!DOCTYPE html>
<html>
<head>
<title>Shale Equities Explorer -- A Data-viz Encyclopedia of Public Companies Operating in U.S. Shale Plays</title>
<meta charset="utf-8">
<meta name="description" content="Data-viz Encyclopedia of Public Oil and Gas Companies Operating in U.S. Shale Plays">
<meta name="keywords" content="shale, oil, gas, production, proved reserves">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=EB Garamond|Quattrocento Sans">
<style>

body  { text-rendering: optimizeLegibility; }

.label {
    font: 13px Quattrocento Sans;
    font-weight: 500;
    //font-variant: small-caps;
    
    
 
}

.axis {
  font: 9px Quattrocento Sans;
}

.axis path,
.axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

.x.axis path {

}

.x.axis.small
{
  font: 8px Quattrocento Sans;
}



</style>
</head>
<body style="background-color:#EEEEEE">

<svg width="0" height="0" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <linearGradient id="total" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:rgb(0,0,220);stop-opacity:1" />
      <stop offset="33%" style="stop-color:rgb(0,0,220);stop-opacity:1" />
      <stop offset="34%" style="stop-color:rgb(255,255,0);stop-opacity:1" />
      <stop offset="66%" style="stop-color:rgb(255,255,0);stop-opacity:1" />
      <stop offset="67%" style="stop-color:rgb(220,0,0);stop-opacity:1" />
      <stop offset="100%" style="stop-color:rgb(220,0,0);stop-opacity:1" />
    </linearGradient>
    
    <radialGradient id="total_r" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:rgb(0,0,220);stop-opacity:1" />
      <stop offset="33%" style="stop-color:rgb(0,0,220);stop-opacity:1" />
      <stop offset="34%" style="stop-color:rgb(255,255,0);stop-opacity:1" />
      <stop offset="66%" style="stop-color:rgb(255,255,0);stop-opacity:1" />
      <stop offset="67%" style="stop-color:rgb(220,0,0);stop-opacity:1" />
      <stop offset="100%" style="stop-color:rgb(220,0,0);stop-opacity:1" />
    </radialGradient>
  
    <linearGradient id="liquids" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:rgb(225,225,0);stop-opacity:1" />
      <stop offset="49%" style="stop-color:rgb(255,255,0);stop-opacity:1" />
      <stop offset="50%" style="stop-color:rgb(220,0,0);stop-opacity:1" />
      <stop offset="100%" style="stop-color:rgb(220,0,0);stop-opacity:1" />
    </linearGradient>
    

    <linearGradient id="pud" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:rgb(100,100,255);stop-opacity:1" />
      <stop offset="33%" style="stop-color:rgb(100,100,255);stop-opacity:1" />
      <stop offset="34%" style="stop-color:rgb(255,250,110);stop-opacity:1" />
      <stop offset="66%" style="stop-color:rgb(255,250,110);stop-opacity:1" />
      <stop offset="67%" style="stop-color:rgb(255,70,150);stop-opacity:1" />
      <stop offset="100%" style="stop-color:rgb(255,70,150);stop-opacity:1" />
    </linearGradient>
    
    <linearGradient id="pr" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:rgb(100,100,255);stop-opacity:1" />
      <stop offset="16%" style="stop-color:rgb(100,100,255);stop-opacity:1" />
      <stop offset="17%" style="stop-color:rgb(255,250,110);stop-opacity:1" />
      <stop offset="33%" style="stop-color:rgb(255,250,110);stop-opacity:1" />
      <stop offset="34%" style="stop-color:rgb(255,70,150);stop-opacity:1" />
      <stop offset="49%" style="stop-color:rgb(255,70,150);stop-opacity:1" />
      <stop offset="50%" style="stop-color:rgb(0,0,220);stop-opacity:1" />
      <stop offset="66%" style="stop-color:rgb(0,0,220);stop-opacity:1" />
      <stop offset="67%" style="stop-color:rgb(255,255,0);stop-opacity:1" />
      <stop offset="83%" style="stop-color:rgb(255,255,0);stop-opacity:1" />
      <stop offset="84%" style="stop-color:rgb(220,0,0);stop-opacity:1" />
      <stop offset="100%" style="stop-color:rgb(220,0,0);stop-opacity:1" />
    </linearGradient>
    
    
    <linearGradient id="pr_oil" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:rgb(255,70,150);stop-opacity:1" />
      <stop offset="49%" style="stop-color:rgb(255,70,150);stop-opacity:1" />
      <stop offset="50%" style="stop-color:rgb(220,0,0);stop-opacity:1" />
      <stop offset="100%" style="stop-color:rgb(220,0,0);stop-opacity:1" />
    </linearGradient>
    
    <linearGradient id="pr_liquids" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:rgb(255,250,110);stop-opacity:1" />
      <stop offset="24%" style="stop-color:rgb(255,250,110);stop-opacity:1" />
      <stop offset="25%" style="stop-color:rgb(255,70,150);stop-opacity:1" />
      <stop offset="49%" style="stop-color:rgb(255,70,150);stop-opacity:1" />
      <stop offset="50%" style="stop-color:rgb(255,255,0);stop-opacity:1" />
      <stop offset="74%" style="stop-color:rgb(255,255,0);stop-opacity:1" />
      <stop offset="75%" style="stop-color:rgb(220,0,0);stop-opacity:1" />
      <stop offset="100%" style="stop-color:rgb(220,0,0);stop-opacity:1" />
    </linearGradient>
    
    <linearGradient id="pr_gas" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:rgb(100,100,255);stop-opacity:1" />
      <stop offset="49%" style="stop-color:rgb(100,100,255);stop-opacity:1" />
      <stop offset="50%" style="stop-color:rgb(0,0,220);stop-opacity:1" />
      <stop offset="100%" style="stop-color:rgb(0,0,220);stop-opacity:1" />
    </linearGradient>
    
     <linearGradient id="ev" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:rgb(144,238,144);stop-opacity:1" /> //light green
      <stop offset="49%" style="stop-color:rgb(144,238,144);stop-opacity:1" />
      <stop offset="50%" style="stop-color:rgb(0,100,0);stop-opacity:1" /> //dark green
      <stop offset="100%" style="stop-color:rgb(0,100,0);stop-opacity:1" />
    </linearGradient>
    
    
  </defs>
  
  
</svg>

<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js" charset="utf-8"></script>


<script>

//  GENERAL SETUP BLOCK
//Q2 2015

  var data = [
            {
              "company" : "APA+", //q2
              "name" : "Apache Corp.",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed" : 302.3, "price": 58.50},
                             {"product":"ngl","mboed": 62.8, "price": 10.15},
                             {"product":"gas","mboed": 198.6, "price": 16.33}
                             
                             ],

                            "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .652},
                             {"metric":"cashMargin","percent": .620},
                             {"metric":"net","percent": .150}
                            ],
                            
                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 784},
                            {"div":"ngl pd", "mmboe" : 205},
                            {"div":"gas pd", "mmboe" : 661.9},
                            {"div":"oil pud", "mmboe" : 290},
                            {"div":"ngl pud", "mmboe" : 77},
                            {"div":"gas pud", "mmboe" : 378}
                            ]
                          },
              "hedge" : 0,
              "capex"  : 1059,
              "debt" : 6726,
              "stock" : [
                {"key":"price", "value" : 44.83},
                {"key":"shares", "value" : 378}
                ],
              "groups" : [
                "Canada Shales",
                "Eagle Ford (East)",
                "Gulf of Mexico",
                "International",
                "Mid-Continent",
                "Permian (Delaware)",
                "Permian (Midland)",
                "Permian (Other)"
                ],
              "selected":"no"
            },
            {
              "company" : "APC+",//q2
              "name" : "Anadarko Petroleum Corp",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed": 318, "price": 55.78},
                             {"product":"ngl", "mboed": 136, "price": 18.50},
                             {"product":"gas","mboed": 392.3, "price": 13.68}
                             
                             ],

                           "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .605},
                             {"metric":"cashMargin","percent": .522},
                             {"metric":"net","percent": .018}
                            ],
                            
                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 542},
                            {"div":"ngl pd", "mmboe" : 317},
                            {"div":"gas pd", "mmboe" : 1110.3},
                            {"div":"oil pud", "mmboe" : 387},
                            {"div":"ngl pud", "mmboe" : 162},
                            {"div":"gas pud", "mmboe" : 339.5}
                            ]
                          },
              "hedge" : 81.0,
              "capex"  : 1410,
              "debt" :  13885,
              "stock" : [
                {"key":"price", "value" : 70.90},
                {"key":"shares", "value" : 508}
                ],
              "groups" : [
                "DJ/Powder River",
                "Eagle Ford",
                "Eagle Ford (East)",
                "Gulf of Mexico",
                "East Texas/Haynesville",
                "International(+)",
                "Marcellus/Utica",
                "Mid-Continent",
                "Permian (Delaware)",
                "Western Rockies"
                ],
              "selected":"yes"
            },
            {
              "company" : "AR", //q2
              "name" : "Antero Resources",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed": 5.7, "price": 44.06},
                             {"product":"ngl", "mboed": 40.2, "price": 16.29},
                             {"product":"gas","mboed": 201.5, "price": 13.20}
                             
                             ],

                            "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .517},
                             {"metric":"cashMargin","percent": .402},
                             {"metric":"net","percent": .060}
                            ],
                            
                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 6.0},
                            {"div":"ngl pd", "mmboe" : 80.0},
                            {"div":"gas pd", "mmboe" : 547.5},
                            {"div":"oil pud", "mmboe" : 22.0},
                            {"div":"ngl pud", "mmboe" : 250.0},
                            {"div":"gas pud", "mmboe" : 1208.3}
                            ]
                          },
              "hedge" : 195.9,
              "capex"  : 499,
              "debt" :  4357,
              "stock" : [
                {"key":"price", "value" : 25.19},
                {"key":"shares", "value" : 277}
                ],
              "groups" : [
                "Marcellus/Utica"
                ],
              "selected":"no"
            },
            {
              "company" : "BBG",  //q2
              "name" : "Bill Barrett Corp",
              "values" : {
 
                           "prods" : [
                             {"product":"oil", "mboed": 12.3, "price": 48.68},
                             {"product":"ngl", "mboed": 2.3, "price": 12.76},
                             {"product":"gas","mboed": 3.3, "price": 13.98}
                             
                             ],

                           "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .711},
                             {"metric":"cashMargin","percent": .535},
                             {"metric":"net","percent": -.003}
                            ],

                            "reserves" : [
                            {"div":"oil pd", "mmboe" :  29.3},
                            {"div":"ngl pd", "mmboe" : 3.8},
                            {"div":"gas pd", "mmboe" : 8.4},
                            {"div":"oil pud", "mmboe" : 54.5 },
                            {"div":"ngl pud", "mmboe" : 9.0},
                            {"div":"gas pud", "mmboe" : 17.2}
                            ]
                          },
              "hedge" : 36.5,
              "capex" : 65.1,
              "debt" :  769,
              "stock" : [
                {"key":"price", "value" : 5.05},
                {"key":"shares", "value" : 50}
                ],
              "groups" : [
                  "DJ/Powder River",
                  "Western Rockies"
                ],
              "selected":"yes"
            },
            {
              "company" : "BCEI",//q2
              "name" : "Bonanza Creek Energy",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed": 16.9, "price": 49.90},
                             {"product":"ngl", "mboed": 4.7, "price": 16.28	},
                             {"product":"gas","mboed": 6.5, "price": 11.72}
                             
                             ],

                            "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .600},
                             {"metric":"cashMargin","percent": .463},
                             {"metric":"net","percent": -.199}
                            ],
                            
                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 28.3},
                            {"div":"ngl pd", "mmboe" : 2.2},
                            {"div":"gas pd", "mmboe" : 15.8},
                            {"div":"oil pud", "mmboe" : 26.4},
                            {"div":"ngl pud", "mmboe" : 1.2},
                            {"div":"gas pud", "mmboe" : 15.7}
                            ]
                          },
              "hedge" : 15.2,
              "capex" : 164,
              "debt" :  835,
              "stock" : [
                {"key":"price", "value" : 6.70},
                {"key":"shares", "value" : 49.7}
                ],
              "groups" : [
                "DJ/Powder River",
                "East Texas/Haynesville"
                ],
              "selected":"no"
            },            {
              "company" : "CHK",
              "name" : "Chesapeake Energy",  //q2
              "values" : {
 
                           "prods" : [
                             {"product":"oil", "mboed": 118.7, "price": 51.21},
                             {"product":"ngl", "mboed": 79.1, "price": 1.90},
                             {"product":"gas","mboed": 504.4, "price": 4.50}
                             
                             ],

                           "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .650},
                             {"metric":"cashMargin","percent": .581},
                             {"metric":"net","percent": -.005}
                            ],

                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 229},
                            {"div":"ngl pd", "mmboe" : 198},
                            {"div":"gas pd", "mmboe" : 1437},
                            {"div":"oil pud", "mmboe" : 192},
                            {"div":"ngl pud", "mmboe" :  68},
                            {"div":"gas pud", "mmboe" : 345}
                            ]
                          },
              "hedge" : 253,
              "capex" : 957,
              "debt" :  8604,
              "stock" : [
                {"key":"price", "value" : 7.36},
                {"key":"shares", "value" : 665.4}
                ],
              "groups" : [
                  "Eagle Ford",
                  "East Texas/Haynesville",
                  "Marcellus/Utica",
                  "Mid-Continent",
                  "DJ/Powder River"
                ],
              "selected":"no"
            },
            {
              "company" : "CLR*",//q2
              "name" : "Continental Resources",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed": 149.9, "price": 50.50},
                             {"product":"ngl", "mboed": 0.0, "price": 0.0},
                             {"product":"gas","mboed": 76.65, "price": 14.50}
                             
                             ],

                           "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .774},
                             {"metric":"cashMargin","percent": .677},
                             {"metric":"net","percent": .113}
                            ],
                            
                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 342.1},
                            {"div":"ngl pd", "mmboe" : 0.0},
                            {"div":"gas pd", "mmboe" : 160.3},
                            {"div":"oil pud", "mmboe" : 524.2},
                            {"div":"ngl pud", "mmboe" : 0.0},
                            {"div":"gas pud", "mmboe" : 324.4}
                            ]
                          },
              "hedge" : 13.2,
              "capex" : 592,
              "debt" : 6965,
              "stock" : [
                {"key":"price", "value" : 30.88},
                {"key":"shares", "value" : 373.1}
                ],
              "groups" : [
                "Bakken/Three Forks",
                "Mid-Continent"
                ],
              "selected":"no"
            },
            {
              "company" : "COG",  //Q2
              "name" : "Cabot Oil and Gas",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed": 17.7, "price": 50.39 },
                             {"product":"ngl", "mboed": 0 , "price": 0},
                             {"product":"gas","mboed": 235.2, "price": 10.50}
                             
                             ],

                           "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .558},
                             {"metric":"cashMargin","percent": .490},
                             {"metric":"net","percent": .062}
                            ],
                            
                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 27.2},
                            {"div":"ngl pd", "mmboe" : 0},
                            {"div":"gas pd", "mmboe" : 723.2},
                            {"div":"oil pud", "mmboe" : 25.9},
                            {"div":"ngl pud", "mmboe" : 0},
                            {"div":"gas pud", "mmboe" : 457.2}
                            ]
                          },
              "hedge" : 51,
              "capex" : 228.2,
              "debt" :  1995,
              "stock" : [
                {"key":"price", "value" : 23.30},
                {"key":"shares", "value" : 413.8}
                ],
              "groups" : [
                "Eagle Ford",
                "Marcellus/Utica"
                ],
              "selected":"yes"
            },
            {
              "company" : "CRK",//q2
              "name" : "Comstock Resources",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed": 10.2, "price": 55.34},
                             {"product":"ngl", "mboed": 0.0, "price": 0.0},
                             {"product":"gas","mboed": 20.3, "price": 14.22}
                             
                             ],

                           "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .615},
                             {"metric":"cashMargin","percent": .180},
                             {"metric":"net","percent": -.987}
                            ],

                            "reserves" : [
                            {"div":"oil pd", "mmboe" :  16.2},
                            {"div":"ngl pd", "mmboe" : 0.0},
                            {"div":"gas pd", "mmboe" : 54.1},
                            {"div":"oil pud", "mmboe" : 4.6},
                            {"div":"ngl pud", "mmboe" :  0.0},
                            {"div":"gas pud", "mmboe" : 28.5}
                            ]
                          },
              "hedge" : 0,
              "capex" : 53.5,
              "debt" :  1249,
              "stock" : [
                {"key":"price", "value" : 3.06},
                {"key":"shares", "value" : 47.7}
                ],
              "groups" : [
                "Eagle Ford",
                "Eagle Ford (East)",
                "East Texas/Haynesville",
                "Tuscaloosa"
                ],
              "selected":"yes"
            },
            {
              "company" : "CRZO", //q2
              "name" : "Carrizo Oil and Gas",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed": 22.3, "price": 54.86},
                             {"product":"ngl", "mboed": 3.5, "price": 11.95},
                             {"product":"gas","mboed": 10.3, "price": 8.94}
                             
                             ],

                            "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .756},
                             {"metric":"cashMargin","percent": .656},
                             {"metric":"net","percent": .186}
                            ],
                            
                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 35.2},
                            {"div":"ngl pd", "mmboe" : 5.3},
                            {"div":"gas pd", "mmboe" : 25.0},
                            {"div":"oil pud", "mmboe" : 65.5},
                            {"div":"ngl pud", "mmboe" : 8.2},
                            {"div":"gas pud", "mmboe" : 11.9}
                            ]
                          },
              "hedge" : 45.1,
              "capex" : 136,
              "debt" :  1371,
              "stock" : [
                {"key":"price", "value" : 35.38},
                {"key":"shares", "value" : 52}
                ],
              "groups" : [
                "DJ/Powder River",
                "Eagle Ford",
                "Marcellus/Utica"
                ],
              "selected":"no"
            },
            {
              "company" : "CXO*",  //q2
              "name" : "Concho Resources",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed": 99.2, "price": 52.14},
                             {"product":"ngl", "mboed": 0.0, "price": 0.0},
                             {"product":"gas","mboed": 48.1, "price": 15.18}
                             
                             ],

                            "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .711},
                             {"metric":"cashMargin","percent": .629},
                             {"metric":"net","percent": .160}
                            ],
                            
                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 211.4},
                            {"div":"ngl pd", "mmboe" : 0.0},
                            {"div":"gas pd", "mmboe" : 165.4},
                            {"div":"oil pud", "mmboe" : 158.9},
                            {"div":"ngl pud", "mmboe" : 0.0},
                            {"div":"gas pud", "mmboe" : 101.4}
                            ]
                          },
              "hedge" : 112.3,
              "capex" : 584.7,
              "debt" :  3382,
              "stock" : [
                {"key":"price", "value" : 105.83},
                {"key":"shares", "value" : 120.3}
                ],
              "groups" : [
                "Permian (Delaware)",
                "Permian (Midland)",
                "Permian (Other)"
                ],
              "selected":"no"
            },
          {
              "company" : "DVN", //q2
              "name" : "Devon Energy Corp",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed": 270, "price": 46.69},
                             {"product":"ngl", "mboed": 134, "price": 10.31},
                             {"product":"gas","mboed": 271.2, "price": 12.78}
                             
                             ],

                           "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .589},
                             {"metric":"cashMargin","percent": .529},
                             {"metric":"net","percent": .182}
                            ],

                            "reserves" : [
                            {"div":"oil pd", "mmboe" :  415},
                            {"div":"ngl pd", "mmboe" : 486},
                            {"div":"gas pd", "mmboe" : 1164},
                            {"div":"oil pud", "mmboe" : 480},
                            {"div":"ngl pud", "mmboe" :  92},
                            {"div":"gas pud", "mmboe" : 117.2}
                            ]
                          },
              "hedge" : 480,
              "capex" : 998,
              "debt" :  7565,
              "stock" : [
                {"key":"price", "value" : 42.22},
                {"key":"shares", "value" : 411}
                ],
              "groups" : [
                "Barnett Shale",
                "Canada Bitumen",
                "Eagle Ford",
                "Mid-Continent",
                "Permian (Delaware)",
                "Permian (Midland)",
                ],
              "selected":"no"
            },
            {
              "company" : "ECA",//q2
              "name" : "Encana Corp",
              "values" : {
 
                           "prods" : [
                             {"product":"oil", "mboed": 127.3, "price": 43.83},
                             {"product":"ngl", "mboed": 0, "price": 0},
                             {"product":"gas","mboed": 261.3, "price": 14.22}
                             
                             ],

                           "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .387},
                             {"metric":"cashMargin","percent": .112},
                             {"metric":"net","percent": -.278}
                            ],

                            "reserves" : [
                            {"div":"oil pd", "mmboe" :  120.5},
                            {"div":"ngl pd", "mmboe" : 85},
                            {"div":"gas pd", "mmboe" : 647.8},
                            {"div":"oil pud", "mmboe" : 84.5},
                            {"div":"ngl pud", "mmboe" :  71.7},
                            {"div":"gas pud", "mmboe" : 267.8}
                            ]
                          },
              "hedge" : 163.7,
              "capex" : 742,
              "debt" :  5616,
              "stock" : [
                {"key":"price", "value" : 7.08},
                {"key":"shares", "value" : 842.5}
                ],
              "groups" : [
                  "Canada Shales",
                  "Eagle Ford",
                  "San Juan/Raton Basins",
                ],
              "selected":"yes"
            },
            {
              "company" : "ECR",//q2
              "name" : "Eclipse Resources",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed": 6.6, "price": 45.48 },
                             {"product":"ngl", "mboed": 7.5, "price": 14.01},
                             {"product":"gas","mboed": 19.0, "price": 16.26}
                             
                             ],

                            "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .448},
                             {"metric":"cashMargin","percent": .252},
                             {"metric":"net","percent": -.573}
                            ],
                            
                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 3.9},
                            {"div":"ngl pd", "mmboe" : 6.8},
                            {"div":"gas pd", "mmboe" : 22.2},
                            {"div":"oil pud", "mmboe" : 4.1},
                            {"div":"ngl pud", "mmboe" : 1.8},
                            {"div":"gas pud", "mmboe" : 20.6}
                            ]
                          },
              "hedge" : 8.5,
              "capex" : 113.8,
              "debt" :  172,
              "stock" : [
                {"key":"price", "value" : 3.74},
                {"key":"shares", "value" : 222.7}
                ],
              "groups" : [
                "Marcellus/Utica"
                ],
              "selected":"no"
            },
            {
              "company" : "EGN", //q2
              "name" : "Energen Corp",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed" : 39.5, "price": 52.48},
                             {"product":"ngl","mboed": 11.7, "price": 13.86},
                             {"product":"gas","mboed": 13.1, "price": 13.38}
                            
                             ],

                            "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .652},
                             {"metric":"cashMargin","percent": .612},
                             {"metric":"net","percent": .087}
                            ],
                            
                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 118.7},
                            {"div":"ngl pd", "mmboe" : 47.6},
                            {"div":"gas pd", "mmboe" : 98.2},
                            {"div":"oil pud", "mmboe" : 62.5},
                            {"div":"ngl pud", "mmboe" : 25.8},
                            {"div":"gas pud", "mmboe" : 19.8}
                            ]
                          },
              "hedge" : 65.9,
              "capex"  : 285,
              "debt" :  685,
              "stock" : [
                {"key":"price", "value" : 50.37},
                {"key":"shares", "value" : 78.8}
                ],
              "groups" : [
                "Permian (Delaware)",
                "Permian (Midland)",
                "Permian (Other)"
                ],
              "selected":"no"
            },
            {
              "company" : "EOG",  //q2
              "name" : "EOG Resources",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed" : 277.5, "price": 57.45},
                             {"product":"ngl","mboed": 73.4, "price": 15.54},
                             {"product":"gas","mboed": 209.5, "price": 14.40}
                             
                             ],

                            "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .644},
                             {"metric":"cashMargin","percent": .614},
                             {"metric":"net","percent": .165}
                            ],
                            
                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 495.1},
                            {"div":"ngl pd", "mmboe" : 264.7},
                            {"div":"gas pd", "mmboe" : 588.1},
                            {"div":"oil pud", "mmboe" : 644.6},
                            {"div":"ngl pud", "mmboe" : 202.3},
                            {"div":"gas pud", "mmboe" : 302.4}
                            ]
                          },
              "hedge" : 193.4,
              "capex" : 1269,
              "debt" :  5033,
              "stock" : [
                {"key":"price", "value" :77.31},
                {"key":"shares", "value" : 549.2}
                ],
              "groups" : [
                "Bakken/Three Forks",
                "DJ/Powder River",
                "Eagle Ford",
                "Permian (Delaware)"
                ],
              "selected":"no"
            },
            {
              "company" : "EPE", //q2
              "name" : "EP Energy",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed" : 63.4, "price": 53.17},
                             {"product":"ngl","mboed": 14.5, "price": 11.91},
                             {"product":"gas","mboed": 31.2, "price": 16.20}
                            
                             ],

                            "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .750},
                             {"metric":"cashMargin","percent": .602},
                             {"metric":"net","percent": .138}
                            ],
                            
                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 128.4},
                            {"div":"ngl pd", "mmboe" : 32.4},
                            {"div":"gas pd", "mmboe" : 77.3},
                            {"div":"oil pud", "mmboe" : 192.4},
                            {"div":"ngl pud", "mmboe" : 61.8},
                            {"div":"gas pud", "mmboe" : 129.9}
                            ]
                          },
              "hedge" : 177,
              "capex"  : 341,
              "debt" :  4893,
              "stock" : [
                {"key":"price", "value" : 6.22},
                {"key":"shares", "value" : 248.8}
                ],
              "groups" : [
                "Eagle Ford",
                "East Texas/Haynesville",
                "Permian (Midland)",
                "Western Rockies"
                ],
              "selected":"no"
            },
            {
              "company" : "FANG",//q2
              "name" : "Diamondback Energy",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed": 22.1, "price": 53.49},
                             {"product":"ngl", "mboed": 4.6, "price": 16.93},
                             {"product":"gas","mboed": 3.3, "price": 14.70}
                             
                             ],

                            "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .781},
                             {"metric":"cashMargin","percent": .709},
                             {"metric":"net","percent": .313}
                            ],
                            
                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 43.9},
                            {"div":"ngl pd", "mmboe" : 11.2},
                            {"div":"gas pd", "mmboe" : 11.4},
                            {"div":"oil pud", "mmboe" : 31.8},
                            {"div":"ngl pud", "mmboe" : 7.3},
                            {"div":"gas pud", "mmboe" : 7.2}
                            ]
                          },
              "hedge" : 25.3,
              "capex" : 88.5,
              "debt" :  673.3,
              "stock" : [
                {"key":"price", "value" : 66.56},
                {"key":"shares", "value" : 66.2}
                ],
              "groups" : [
                "Permian (Midland)"
                ],
              "selected":"no"
            },
            {
              "company" : "GPOR", //q2
              "name" : "Gulfport Energy",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed": 8.0, "price": 50.15},
                             {"product":"ngl", "mboed": 10.3, "price": 12.60},
                             {"product":"gas","mboed": 60.66, "price": 13.38}
                             
                             ],

                            "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .588},
                             {"metric":"cashMargin","percent": .507},
                             {"metric":"net","percent": -.017}
                            ],
                            
                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 5.7},
                            {"div":"ngl pd", "mmboe" : 12.4},
                            {"div":"gas pd", "mmboe" : 57.5},
                            {"div":"oil pud", "mmboe" : 3.8},
                            {"div":"ngl pud", "mmboe" : 13.9},
                            {"div":"gas pud", "mmboe" : 62.3}
                            ]
                          },
              "hedge" : 24.6,
              "capex" : 203,
              "debt" :  411,
              "stock" : [
                {"key":"price", "value" : 35.04},
                {"key":"shares", "value" : 108.2}
                ],
              "groups" : [
                "Marcellus/Utica"
                ],
              "selected":"no"
            },
                      {
              "company" : "HK",//q2
              "name" : "Halcon Resources",
              "values" : {
 
                          "prods" : [
                             {"product":"oil", "mboed": 33.1, "price": 52.58},
                             {"product":"ngl", "mboed": 3.7, "price": 11.68},
                             {"product":"gas","mboed": 4.6, "price": 13.32}
                             ],

                           "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .731},
                             {"metric":"cashMargin","percent": .493},
                             {"metric":"net","percent": .097}
                            ],

                            "reserves" : [
                            {"div":"oil pd", "mmboe" :  62.8},
                            {"div":"ngl pd", "mmboe" : 6.7},
                            {"div":"gas pd", "mmboe" : 8.0},
                            {"div":"oil pud", "mmboe" : 92.8 },
                            {"div":"ngl pud", "mmboe" : 9.6},
                            {"div":"gas pud", "mmboe" : 9.3}
                            ]
                          },
              "hedge" : 88.2,
              "capex" : 112.8,
              "debt" :  3651,
              "stock" : [
                {"key":"price", "value" : 1.05},
                {"key":"shares", "value" : 590.2}
                ],
              "groups" : [
                  "Bakken/Three Forks",
                  "Eagle Ford (East)",
                ],
              "selected":"no"
            },
            {
              "company" : "LPI",//q2
              "name" : "Laredo Petroleum",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed" : 21.3, "price": 50.77},
                             {"product":"ngl","mboed": 12.0, "price": 12.85},
                             {"product":"gas","mboed": 12.4, "price": 10.92}
                             
                             ],

                            "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .675},
                             {"metric":"cashMargin","percent": .535},
                             {"metric":"net","percent": .113}
                            ],
                            
                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 57.0},
                            {"div":"ngl pd", "mmboe" : 0},
                            {"div":"gas pd", "mmboe" : 48.6},
                            {"div":"oil pud", "mmboe" : 83.2},
                            {"div":"ngl pud", "mmboe" : 0},
                            {"div":"gas pud", "mmboe" : 58.6}
                            ]
                          },
              "hedge" : 46.6,
              "capex" : 114,
              "debt" :  1367,
              "stock" : [
                {"key":"price", "value" : 9.92},
                {"key":"shares", "value" : 213.9}
                ],
              "groups" : [
                "Permian (Midland)"
                ],
              "selected":"no"
            },
           {
              "company" : "NBL+", //Q2
              "name" : "Noble Energy",
              "values" : {
 
                          "prods" : [
                             {"product":"oil", "mboed": 97, "price": 54.91},
                             {"product":"ngl", "mboed": 27, "price": 9.64},
                             {"product":"gas","mboed": 171.7, "price": 13.80}
                             ],

                           "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .671},
                             {"metric":"cashMargin","percent": .611},
                             {"metric":"net","percent": .116}
                            ],

                            "reserves" : [
                            {"div":"oil pd", "mmboe" :  174},
                            {"div":"ngl pd", "mmboe" : 72},
                            {"div":"gas pd", "mmboe" : 634.8},
                            {"div":"oil pud", "mmboe" : 130 },
                            {"div":"ngl pud", "mmboe" : 56},
                            {"div":"gas pud", "mmboe" : 337.3}
                            ]
                          },
              "hedge" : 187,
              "capex" : 807,
              "debt" :  4834,
              "stock" : [
                {"key":"price", "value" : 34.53},
                {"key":"shares", "value" : 390}
                ],
              "groups" : [
                  "DJ/Powder River",
                  "Gulf of Mexico",
                  "International(+)",
                  "Marcellus/Utica"
                ],
              "selected":"yes"
            },
            {
              "company" : "NFX",  //q2
              "name" : "Newfield Exploration",
              "values" : {
 
                           "prods" : [
                             {"product":"oil", "mboed": 79.1, "price": 50.49},
                             {"product":"ngl", "mboed": 22.0, "price": 19.17},
                             {"product":"gas","mboed": 54.6, "price": 14.16}
                             
                             ],

                           "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .692},
                             {"metric":"cashMargin","percent": .629},
                             {"metric":"net","percent": .212}
                            ],

                            "reserves" : [
                            {"div":"oil pd", "mmboe" :  144},
                            {"div":"ngl pd", "mmboe" : 38},
                            {"div":"gas pd", "mmboe" : 156.3},
                            {"div":"oil pud", "mmboe" : 157 },
                            {"div":"ngl pud", "mmboe" :  38},
                            {"div":"gas pud", "mmboe" : 111.5}
                            ]
                          },
              "hedge" : 123,
              "capex" : 401,
              "debt" :  2408,
              "stock" : [
                {"key":"price", "value" : 31.60},
                {"key":"shares", "value" : 163}
                ],
              "groups" : [
                  "Bakken/Three Forks",
                  "Eagle Ford",
                  "Mid-Continent",
                  "Western Rockies"
                ],
              "selected":"yes"
            },
          {
              "company" : "OAS*",  //q2
              "name" : "Oasis Petroleum",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed": 44.0, "price": 52.04},
                             {"product":"ngl", "mboed": 0, "price": 0},
                             {"product":"gas","mboed": 6.2, "price": 9.78}
                             
                             ],

                           "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .745},
                             {"metric":"cashMargin","percent": .628},
                             {"metric":"net","percent": .254}
                            ],
                            
                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 127.3},
                            {"div":"ngl pd", "mmboe" : 0},
                            {"div":"gas pd", "mmboe" : 19},
                            {"div":"oil pud", "mmboe" : 108.1},
                            {"div":"ngl pud", "mmboe" : 0},
                            {"div":"gas pud", "mmboe" : 17.7}
                            ]
                          },
              "hedge" : 104.7,
              "capex" : 106.2,
              "debt" :  2341,
              "stock" : [
                {"key":"price", "value" : 10.00},
                {"key":"shares", "value" : 139.2}
                ],
              "groups" : [
                "Bakken/ThreeForks"
                ],
              "selected":"yes"
            },
            {
              "company" : "PDCE",//q2
              "name" : "PDC Energy",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed": 17.4, "price": 48.31},
                             {"product":"ngl", "mboed": 6.2, "price": 10.01},
                             {"product":"gas","mboed": 13.4, "price": 12.18}
                             
                             ],

                            "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .747},
                             {"metric":"cashMargin","percent": .673},
                             {"metric":"net","percent": .172}
                            ],
                            
                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 26.8},
                            {"div":"ngl pd", "mmboe" : 17.0},
                            {"div":"gas pd", "mmboe" : 31.1},
                            {"div":"oil pud", "mmboe" : 73.7},
                            {"div":"ngl pud", "mmboe" : 43.1},
                            {"div":"gas pud", "mmboe" : 58.4}
                            ]
                          },
              "hedge" : 44.1,
              "capex" : 176,
              "debt" :  554,
              "stock" : [
                {"key":"price", "value" : 54.94},
                {"key":"shares", "value" : 40.1}
                ],
              "groups" : [
                "DJ/Powder River",
                "Marcellus/Utica"
                ],
              "selected":"no"
            },
            {
              "company" : "PE",//q2
              "name" : "Parsley Energy",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed": 13.0, "price": 53.61},
                             {"product":"ngl", "mboed": 4.3, "price": 19.76},
                             {"product":"gas","mboed": 4.9, "price": 14.88}
                             
                             ],

                            "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .579},
                             {"metric":"cashMargin","percent": .454},
                             {"metric":"net","percent": -.063}
                            ],
                            
                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 23.5},
                            {"div":"ngl pd", "mmboe" : 11.5},
                            {"div":"gas pd", "mmboe" : 10.9},
                            {"div":"oil pud", "mmboe" : 24.1},
                            {"div":"ngl pud", "mmboe" : 11.2},
                            {"div":"gas pud", "mmboe" : 9.7}
                            ]
                          },
              "hedge" : 8.1,
              "capex" : 74.9,
              "debt" :  580,
              "stock" : [
                {"key":"price", "value" : 16.54},
                {"key":"shares", "value" : 108.8}
                ],
              "groups" : [
                "Permian (Midland)"
                ],
              "selected":"no"
            },
            {
              "company" : "PVA", //q2
              "name" : "Penn Virginia Corp.",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed" : 14.1, "price": 55.22},
                             {"product":"ngl","mboed": 4.2, "price": 13.53},
                             {"product":"gas","mboed": 5.2, "price": 15.24}
                             
                             ],

                            "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .723},
                             {"metric":"cashMargin","percent": .528},
                             {"metric":"net","percent": -.197}
                            ],
                            
                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 22.1},
                            {"div":"ngl pd", "mmboe" : 8.1},
                            {"div":"gas pd", "mmboe" : 15.8},
                            {"div":"oil pud", "mmboe" : 47.0},
                            {"div":"ngl pud", "mmboe" : 11.2},
                            {"div":"gas pud", "mmboe" : 10.8}
                            ]
                          },
              "hedge" : 34.8,
              "capex" : 94,
              "debt" :  1260,
              "stock" : [
                {"key":"price", "value" : 1.09},
                {"key":"shares", "value" : 71.7}
                ],
              "groups" : [
                "Eagle Ford"
                ],
              "selected":"no"
            },
            {
              "company" : "PXD",  //q2
              "name" : "Pioneer Natural Resources",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed": 100.6, "price": 51.64},
                             {"product":"ngl", "mboed": 36.7, "price": 14.03},
                             {"product":"gas","mboed": 59.4, "price": 14.22}
                             
                             ],

                           "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .662},
                             {"metric":"cashMargin","percent": .601},
                             {"metric":"net","percent": .160}
                            ],
                            
                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 267.2},
                            {"div":"ngl pd", "mmboe" : 130.2},
                            {"div":"gas pd", "mmboe" : 247.7},
                            {"div":"oil pud", "mmboe" : 84.9},
                            {"div":"ngl pud", "mmboe" : 39.0},
                            {"div":"gas pud", "mmboe" : 30.5}
                            ]
                          },
              "hedge" : 150,
              "capex" : 360,
              "debt" :  2453,
              "stock" : [
                {"key":"price", "value" : 121.33},
                {"key":"shares", "value" : 149.3}
                ],
              "groups" : [
                "Eagle Ford",
                "Mid-Continent",
                "Permian (Midland)",
                "San Juan/Raton Basins",
                ],
              "selected":"yes"
            },
            {
              "company" : "QEP",  //q2
              "name" : "QEP Resources",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed": 53.6, "price": 51.34},
                             {"product":"ngl", "mboed": 13.2, "price": 21.68},
                             {"product":"gas","mboed": 81.5, "price":  15.12}
                             
                             ],

                           "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .565},
                             {"metric":"cashMargin","percent": .463},
                             {"metric":"net","percent": .020}
                            ],
                            
                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 99.3},
                            {"div":"ngl pd", "mmboe" : 52.2},
                            {"div":"gas pd", "mmboe" : 214.7},
                            {"div":"oil pud", "mmboe" : 73.2},
                            {"div":"ngl pud", "mmboe" : 44.4},
                            {"div":"gas pud", "mmboe" : 171.5}
                            ]
                          },
              "hedge" : 92,
              "capex" : 274,
              "debt" :  1773,
              "stock" : [
                {"key":"price", "value" : 13.70},
                {"key":"shares", "value" : 176.7}
                ],
              "groups" : [
                "Bakken/ThreeForks",
                "DJ/Powder River",
                "East Texas/Haynesville",
                "Permian (Midland)",
                "Western Rockies"
                ],
              "selected":"yes"
            },
            {
              "company" : "RICE", //q2
              "name" : "Rice Energy",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed": 0, "price": 0},
                             {"product":"ngl", "mboed": 0, "price": 0},
                             {"product":"gas","mboed": 88.1, "price": 12.54}
                             
                             ],

                           "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .573},
                             {"metric":"cashMargin","percent": .409},
                             {"metric":"net","percent": -.103}
                            ],

                            "reserves" : [
                            {"div":"oil pd", "mmboe" :  0},
                            {"div":"ngl pd", "mmboe" : 0},
                            {"div":"gas pd", "mmboe" : 107.3},
                            {"div":"oil pud", "mmboe" : 0},
                            {"div":"ngl pud", "mmboe" :  0},
                            {"div":"gas pud", "mmboe" : 110.4}
                            ]
                          },
              "hedge" : 42.3,
              "capex" : 212,
              "debt" :  1161,
              "stock" : [
                {"key":"price", "value" : 18.78},
                {"key":"shares", "value" : 136.4}
                ],
              "groups" : [
                "Marcellus/Utica"
                ],
              "selected":"yes"
            },
            {
              "company" : "RRC",//q2
              "name" : "Range Resources",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed" : 12.0, "price": 41.71},
                             {"product":"ngl","mboed": 56.1 , "price": 8.02},
                             {"product":"gas","mboed": 160.7, "price": 11.76}
                             
                             ],

                            "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .542},
                             {"metric":"cashMargin","percent": .428},
                             {"metric":"net","percent": .031}
                            ],
                            
                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 24.2},
                            {"div":"ngl pd", "mmboe" : 270.3},
                            {"div":"gas pd", "mmboe" : 597.2},
                            {"div":"oil pud", "mmboe" : 24.5},
                            {"div":"ngl pud", "mmboe" : 245.6},
                            {"div":"gas pud", "mmboe" : 555.6}
                            ]
                          },
              "hedge" : 125.2,
              "capex" : 285,
              "debt" :  3464,
              "stock" : [
                {"key":"price", "value" : 38.33},
                {"key":"shares", "value" : 169.4}
                ],
              "groups" : [
                "Marcellus/Utica"
                ],
              "selected":"no"
            },
            {
              "company" : "RSPP", //q2
              "name" : "RSP Permian",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed": 15.1, "price": 53.68},
                             {"product":"ngl", "mboed": 2.9, "price": 9.69},
                             {"product":"gas","mboed": 1.9, "price": 11.82}
                             
                             ],

                            "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .746},
                             {"metric":"cashMargin","percent": .649},
                             {"metric":"net","percent": .241}
                            ],
                            
                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 27.7},
                            {"div":"ngl pd", "mmboe" : 8.2},
                            {"div":"gas pd", "mmboe" : 6.0},
                            {"div":"oil pud", "mmboe" : 41.6},
                            {"div":"ngl pud", "mmboe" : 13.5},
                            {"div":"gas pud", "mmboe" : 9.4}
                            ]
                          },
              "hedge" : 18.6,
              "capex" : 147,
              "debt" :  456,
              "stock" : [
                {"key":"price", "value" : 22.80},
                {"key":"shares", "value" : 84}
                ],
              "groups" : [
                "Permian (Midland)"
                ],
              "selected":"no"
            },
            {
              "company" : "SM",//q2
              "name" : "SM Energy",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed": 55.9, "price": 51.45},
                             {"product":"ngl", "mboed": 44.2, "price": 16.85},
                             {"product":"gas","mboed": 81.0, "price": 15.18}
                             
                             ],

                            "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .635},
                             {"metric":"cashMargin","percent": .581},
                             {"metric":"net","percent": .198}
                            ],
                            
                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 89.3},
                            {"div":"ngl pd", "mmboe" : 66.7},
                            {"div":"gas pd", "mmboe" : 130.8},
                            {"div":"oil pud", "mmboe" : 80.4},
                            {"div":"ngl pud", "mmboe" : 66.8},
                            {"div":"gas pud", "mmboe" : 113.7}
                            ]
                          },
              "hedge" : 131.5,
              "capex" : 339,
              "debt" :  2390,
              "stock" : [
                {"key":"price", "value" : 34.73},
                {"key":"shares", "value" : 67.6}
                ],
              "groups" : [
                "Bakken/Three Forks",
                "Eagle Ford"
                ],
              "selected":"no"
            },
            {
              "company" : "SN",  //q2
              "name" : "Sanchez Energy",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed": 21.1, "price": 51.90},
                             {"product":"ngl", "mboed": 16.1, "price": 12.06},
                             {"product":"gas","mboed": 16.7, "price": 15.72}
                             
                             ],

                           "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .656},
                             {"metric":"cashMargin","percent": .470},
                             {"metric":"net","percent": -.149}
                            ],

                            "reserves" : [
                            {"div":"oil pd", "mmboe" :  27.4},
                            {"div":"ngl pd", "mmboe" : 18.6},
                            {"div":"gas pd", "mmboe" : 18.4},
                            {"div":"oil pud", "mmboe" : 37.1},
                            {"div":"ngl pud", "mmboe" : 16.7},
                            {"div":"gas pud", "mmboe" : 16.5}
                            ]
                          },
              "hedge" : 28.1,
              "capex" : 133,
              "debt" :  1476,
              "stock" : [
                {"key":"price", "value" : 5.94},
                {"key":"shares", "value" : 61.9}
                ],
              "groups" : [
                "Eagle Ford",
                "Tuscaloosa"
                ],
              "selected":"yes"
            },
            {
              "company" : "SWN", //Q2
              "name" : "Southwestern Energy",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed": 6.5, "price": 40.88},
                             {"product":"ngl", "mboed": 28.3, "price": 5.77},
                             {"product":"gas","mboed": 413.9, "price": 10.56}
                             
                             ],

                           "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .444},
                             {"metric":"cashMargin","percent": .442},
                             {"metric":"net","percent": -.094}
                            ],
                            
                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 7.4},
                            {"div":"ngl pd", "mmboe" : 38.6},
                            {"div":"gas pd", "mmboe" : 945.8},
                            {"div":"oil pud", "mmboe" : 30.2},
                            {"div":"ngl pud", "mmboe" : 80.1},
                            {"div":"gas pud", "mmboe" : 689}
                            ]
                          },
              "hedge" : 106,
              "capex" : 389,
              "debt" :  4502,
              "stock" : [
                {"key":"price", "value" : 16.00},
                {"key":"shares", "value" : 384.5}
                ],
              "groups" : [
                "Fayetteville",
                "Marcellus/Utica"
                ],
              "selected":"yes"
            },
            {
              "company" : "UPL", //q2
              "name" : "Ultra Petroleum",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed": 9.9, "price": 48.64},
                             {"product":"ngl", "mboed": 0, "price": 0},
                             {"product":"gas","mboed": 119.3, "price":  15.12}
                             
                             ],

                            "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .671},
                             {"metric":"cashMargin","percent": .524},
                             {"metric":"net","percent": .206}
                            ],
                            
                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 28.5},
                            {"div":"ngl pd", "mmboe" : 9.1},
                            {"div":"gas pd", "mmboe" : 374.2},
                            {"div":"oil pud", "mmboe" : 39.3},
                            {"div":"ngl pud", "mmboe" : 12.9},
                            {"div":"gas pud", "mmboe" : 431.0}
                            ]
                          },
              "hedge" : 81.9,
              "capex" : 135.4,
              "debt" :  3363,
              "stock" : [
                {"key":"price", "value" : 8.36},
                {"key":"shares", "value" : 153.2}
                ],
              "groups" : [
                "DJ/Powder River",
                "Western Rockies"
                ],
              "selected":"no"
            },
            {
              "company" : "WLL",  //q2
              "name" : "Whiting Petroleum",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed": 136.5, "price": 48.95},
                             {"product":"ngl", "mboed": 14.3, "price": 16.86},
                             {"product":"gas","mboed": 19.4, "price": 11.52}
                             
                             ],

                           "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .630},
                             {"metric":"cashMargin","percent": .497},
                             {"metric":"net","percent": .018}
                            ],
                            
                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 198.2},
                            {"div":"ngl pd", "mmboe" : 23.7},
                            {"div":"gas pd", "mmboe" : 30.5},
                            {"div":"oil pud", "mmboe" : 149.2},
                            {"div":"ngl pud", "mmboe" : 21.1},
                            {"div":"gas pud", "mmboe" : 15.7}
                            ]
                          },
              "hedge" : 22.9,
              "capex" : 751.3,
              "debt" :  5185,
              "stock" : [
                {"key":"price", "value" : 17.60},
                {"key":"shares", "value" : 204.1}
                ],
              "groups" : [
                "Bakken/Three Forks",
                "DJ/Powder River"
                ],
              "selected":"yes"
            },
            {
              "company" : "WPX",  //q2
              "name" : "WPX Energy",
              "values" : {
 
                           "prods" : [
                             
                             
                             {"product":"oil", "mboed": 32.7, "price": 48.73},
                             {"product":"ngl", "mboed": 19.7, "price": 13.95},
                             {"product":"gas","mboed": 112.5, "price": 12.41}
                             
                             ],

                           "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .524},
                             {"metric":"cashMargin","percent": .450},
                             {"metric":"net","percent": -.079}
                            ],
                            
                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 60.0},
                            {"div":"ngl pd", "mmboe" : 44.0},
                            {"div":"gas pd", "mmboe" : 348.3},
                            {"div":"oil pud", "mmboe" : 70.8},
                            {"div":"ngl pud", "mmboe" : 26.9},
                            {"div":"gas pud", "mmboe" : 176.6}
                            ]
                          },
              "hedge" : 132,
              "capex" : 138,
              "debt" :  1683,
              "stock" : [
                {"key":"price", "value" : 7.06},
                {"key":"shares", "value" : 235.2}
                ],
              "groups" : [
                "Bakken/ThreeForks",
                "Western Rockies",
                "San Juan/Raton Basins",
                ],
              "selected":"yes"
            },
            {
              "company" : "XCO", //q2
              "name" : "EXCO Resources",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed" : 6.5, "price": 53.11},
                             {"product":"ngl","mboed": 0, "price": 0},
                             {"product":"gas","mboed": 53.7, "price": 12.72}
                            
                             ],

                            "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .515},
                             {"metric":"cashMargin","percent": .307},
                             {"metric":"net","percent": -.195}
                            ],
                            
                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 14.4},
                            {"div":"ngl pd", "mmboe" : 0},
                            {"div":"gas pd", "mmboe" : 84.1},
                            {"div":"oil pud", "mmboe" : 3.3},
                            {"div":"ngl pud", "mmboe" : 0},
                            {"div":"gas pud", "mmboe" : 108.8}
                            ]
                          },
              "hedge" : 29.4,
              "capex"  : 75,
              "debt" :  1475,
              "stock" : [
                {"key":"price", "value" : 0.77},
                {"key":"shares", "value" : 277.2}
                ],
              "groups" : [
                "Eagle Ford",
                "East Texas/Haynesville",
                "Marcellus/Utica"
                ],
              "selected":"no"
            },            {
              "company" : "XEC", //q2
              "name" : "Cimarex Energy",
              "values" : {
 
                           "prods" : [
                             
                             {"product":"oil", "mboed": 56.3, "price": 50.66},
                             {"product":"ngl", "mboed": 37.1, "price": 14.67},
                             {"product":"gas","mboed": 77.7, "price": 15.06}
                             
                             ],

                           "corp" : [
                             {"metric":"postHedge", "percent" : 1.0},
                             {"metric":"ebitda","percent": .623},
                             {"metric":"cashMargin","percent": .593},
                             {"metric":"net","percent": .070}
                            ],
                            
                            "reserves" : [
                            {"div":"oil pd", "mmboe" : 100.1},
                            {"div":"ngl pd", "mmboe" : 89.6},
                            {"div":"gas pd", "mmboe" : 210.7},
                            {"div":"oil pud", "mmboe" : 19.1},
                            {"div":"ngl pud", "mmboe" : 35.6},
                            {"div":"gas pud", "mmboe" : 67.1}
                            ]
                          },
              "hedge" : 0,
              "capex" : 190,
              "debt" :  643,
              "stock" : [
                {"key":"price", "value" : 107.75},
                {"key":"shares", "value" : 94.5}
                ],
              "groups" : [
                "Mid-Continent",
                "Permian (Delaware)"
                ],
              "selected":"yes"
            }
            ];
var q2 = 91;

var global_prod = 0;
var global_prod_oil = 0;
var global_prod_ngl = 0;
var global_prod_gas = 0;

var global_rev = 0;
var global_rev_oil = 0;
var global_rev_ngl = 0;
var global_rev_gas = 0;

var global_pr = 0;
var global_pr_oil_pd = 0;
var global_pr_oil_pud = 0;
var global_pr_ngl_pd = 0;
var global_pr_ngl_pud = 0;
var global_pr_gas_pd = 0;
var global_pr_gas_pud = 0;

var global_average_ebitda = 0;
var global_average_cashMargin = 0;
var global_average_net = 0;

var global_average_pretax_net = 0;
var global_average_DDA = 0;
var global_average_interest = 0;
var global_average_ebitdaCst = 0;

var alt_oil_price = 50;
var alt_ngl_price = 30;
var alt_gas_price = 18;

var rand = [0,1,2,3,4,5,6,7];

rand.forEach(function (d,i) { rand[i] = Math.floor (Math.random() * data.length);} );

data.forEach(function (d,i) {
  if (i == rand[0] || i == rand[1] || i == rand[2] || i == rand[3] || i == rand[4] || i == rand[5] || i == rand[6] || i == rand[7])
  {data[i].selected = "yes";}
  else {data[i].selected = "no";}
})


function addData (d) {
  d.prod_total = 0;
  d.rev_total = 0;
  d.rev_total_alt = 0;
  d.pr_total = 0;
  d.pr_oil = 0;
  d.pr_liquids = 0;

  
  d.values.prods.forEach(function(e) {
    if (e.product == "oil") {e.price_alt = alt_oil_price;}
    else {e.price_alt = e.price;}
    d.prod_total += e.mboed;
    d.rev_total += (e.mboed * e.price * q2 / 1000);
    d.rev_total_alt += (e.mboed * e.price_alt * q2 / 1000);

    });
    
  d.boe_price = (d.rev_total/ q2 * 1000)/d.prod_total;
  d.boe_price_hedged = d.boe_price + ((d.hedge/ q2 * 1000)/d.prod_total);
  
  d.ev = [
    {"name": "market cap", "value": d.stock[0].value * d.stock[1].value},
    {"name": "debt", "value": d.debt}
  ];
  
  d.da_shares = (d.ev[1].value/d.stock[0].value) + d.stock[1].value;
 
 //compute these global averages before reversing array
 global_average_ebitda += d.values.corp[1].percent/data.length;
 global_average_cashMargin += d.values.corp[2].percent/data.length;
 global_average_net += d.values.corp[3].percent/data.length;
 
  d.values.corp.reverse();
      var base = 0;
  d.values.corp.forEach(function(e) {
    e.dollars = (d.rev_total + d.hedge) * e.percent;
    e.difference = e.percent - base;
    e.dif_dollars = (d.rev_total + d.hedge) * e.difference;
    base = e.percent;
    e.dollars_alt = d.rev_total_alt - ((d.rev_total + d.hedge) * (1- e.percent));
  });
  
    d.capex = [
    {"name":"capex", "value" : d.capex},
    {"name":"cash margin","value": d.values.corp[1].dollars}
    ];
  
   //compute these global averages after reversing array and computing difference
 global_average_pretax_net += d.values.corp[0].difference/data.length;
 global_average_DDA += d.values.corp[1].difference/data.length;
 global_average_interest += d.values.corp[2].difference/data.length;
 global_average_ebitdaCst += d.values.corp[3].difference/data.length;
  
  d.values.reserves.forEach(function(e) {
    
    d.pr_total += e.mmboe;
  });
  
  var pud_temp_total = 0;
  d.values.reserves.filter(function (d) {return d.div == "oil pud" || d.div == "ngl pud" || d.div == "gas pud";}).forEach(function(e) {
    pud_temp_total += e.mmboe;
    d.pr_pud_percent = pud_temp_total/d.pr_total;
  });
  
  d.values.reserves.filter(function (d) {return d.div == "oil pd" || d.div == "ngl pd" || d.div ==  "oil pud" || d.div == "ngl pud" ;}).forEach(function(e) {
    d.pr_liquids += e.mmboe;
  });
  
    d.values.reserves.filter(function (d) {return d.div == "oil pd" || d.div ==  "oil pud" ;}).forEach(function(e) {d.pr_oil += e.mmboe;});
 
 global_prod += d.prod_total;
 global_prod_oil += d.values.prods[0].mboed;
 global_prod_ngl += d.values.prods[1].mboed;
 global_prod_gas += d.values.prods[2].mboed;
 
 global_rev += d.rev_total;
 global_rev_oil += d.values.prods[0].mboed * d.values.prods[0].price * q2 / 1000;
 global_rev_ngl += d.values.prods[1].mboed * d.values.prods[1].price * q2 / 1000;
 global_rev_gas += d.values.prods[2].mboed * d.values.prods[2].price * q2 / 1000;
 
 global_pr += d.pr_total;
 global_pr_oil_pd += d.values.reserves[0].mmboe;
 global_pr_oil_pud += d.values.reserves[3].mmboe;
 global_pr_ngl_pd += d.values.reserves[1].mmboe;
 global_pr_ngl_pud += d.values.reserves[4].mmboe;
 global_pr_gas_pd += d.values.reserves[2].mmboe;
 global_pr_gas_pud += d.values.reserves[5].mmboe;

}
                       


data.forEach(addData);

var global_pud_percent = (global_pr_oil_pud + global_pr_ngl_pud + global_pr_gas_pud)/global_pr;


function selector(d) {return d.selected == "yes";}

var current_data = data.filter(selector);


console.log(current_data);

var side_data = current_data[0];  // first company selected for side graph as default


var order = "abc";  //default sort

var dollars = d3.format("$,");
var dollars2 = d3.format("$.2f");


var percent = d3.format("%,1");

var mode = "PROD_UN";

var margin = {top: 25, right: 600, bottom: 575, left: 60},
    width = 1600 - margin.left - margin.right,
    contract_width = 200, // shrink delta
    height = 1030 - margin.top - margin.bottom;

var x = d3.scale.ordinal()
    .domain(current_data.map(function(d){return d.company;}))
    .rangeRoundBands([0, width], .5);
    
var x_prods = d3.scale.ordinal()
    .domain(["oil","ngl","gas"])
    .rangeRoundBands([0, x.rangeBand()]);
    
var x_corp = d3.scale.ordinal()
    .domain(["postHedge","ebitda","cashMargin", "net"])
    .rangeRoundBands([0, x.rangeBand()]);
    
var x_reserves = d3.scale.ordinal()
    .domain(["oil pd","oil pud","ngl pd","ngl pud","gas pd","gas pud"])
    .rangeRoundBands([0, x.rangeBand()]);
    
var x_capex = d3.scale.ordinal()
    .domain(["capex","cash margin"])
    .rangeRoundBands([0, x.rangeBand()]);
    
var legend_scale = d3.scale.ordinal()
    .rangeRoundBands([0, 650], .5);
    
var y = d3.scale.linear()
    .domain([0, (d3.max(current_data, function(d) { return d3.max(d.values.prods, function(d) {return d.mboed;}) })) * 1.05])
    .range([height, 0]);

var y_right = d3.scale.linear()
    .domain([0, (d3.max(current_data, function(d) { return d3.max(d.values.prods, function(d) {return d.mboed;}) })) * 1.05 * 6])
    .range([height, 0]);
    
    
// colors
var clr_graph_bkgrnd = "rgb(245,245,245)";
var clr_abc = "black";
// product colors
var clr_oil = "rgb(200,0,40)";
var clr_ngl = "rgb(255,240,0)";
var clr_gas = "rgb(0,0,200)";
var clr_liquids = "url(#liquids)";
var clr_total = "url(#total)"; // also used for PUD reserves
var clr_oil_l = "rgb(255,70,150)"; //lighter red, yellow and blue
var clr_ngl_l = "rgb(255,250,110)";
var clr_gas_l = "rgb(100,100,255)";
var clr_pr = "url(#pr)";
var clr_pr_oil = "url(#pr_oil)";
var clr_pr_liquids = "url(#pr_liquids)";
var clr_pr_gas = "url(#pr_gas)";
var clr_pud = "url(#pud)";

//income metric colors
var clr_gross = "rgb(230,97,1)";
var clr_ebitda = "rgb(253,184,99)";
var clr_cashMargin = "rgb(178,171,210)";
var clr_net = "rgb(94,60,153)";

//cost analysis colors
var clr_ebtidaCosts = "rgb(166,97,26)";
var clr_interest = "rgb(223,194,125)";
var clr_DDA = "rgb(128,205,193)";
var clr_netIncome = "rgb(1,133,113)";

var clr_ev = "url(#ev)";



var colors_prods = d3.scale.ordinal()
    .domain(["oil","ngl","gas"])
    .range([clr_oil, clr_ngl, clr_gas]);
    
var colors_prods_s = d3.scale.ordinal()
    .domain(["oil","ngl","gas"])
    .range([clr_oil_l,clr_ngl_l,clr_gas_l]);

    
var colors_income = d3.scale.ordinal()
    .domain(["rev_total","ebitda","cashMargin", "net"])
    .range([clr_gross, clr_ebitda, clr_cashMargin, clr_net]);
    
var colors_income_s = d3.scale.ordinal()  // for costs
    .domain(["rev_total","ebitda","cashMargin", "net"])
    .range([clr_ebtidaCosts, clr_interest, clr_DDA, clr_netIncome]);
    
var colors_reserves = d3.scale.ordinal()
    .domain(["oil pd","ngl pd","gas pd","oil pud","ngl pud","gas pud"])
    .range([clr_oil, clr_ngl, clr_gas, clr_oil_l,clr_ngl_l,clr_gas_l]);
    
var colors_capex = d3.scale.ordinal()
    .domain(["capex","cash margin"])
    .range(["darkgreen", "lightgreen"]);
    
var colors_ev = d3.scale.ordinal()
    .domain(["market cap","debt"])
    .range(["darkgreen", "lightgreen"]);
    
//for nested income pie charts -- MAX only

var colors_pie_rev_total = d3.scale.ordinal()
    .domain(["rev_total","excess"])
    .range([clr_gross, clr_gross]);
    
var colors_pie_ebitda = d3.scale.ordinal()
    .domain(["ebitda","excess"])
    .range([clr_ebitda, "white"]);
    
var colors_pie_cashMargin = d3.scale.ordinal()
    .domain(["cashMargin","excess"])
    .range([clr_cashMargin, "white"]);
    
var colors_pie_net = d3.scale.ordinal()
    .domain(["net","excess"])
    .range([clr_net, "white"]);
    


// axis objects

var xAxis = d3.svg.axis()
    .scale(x)
    .orient("bottom");

var yAxis = d3.svg.axis()
    .scale(y)
    .orient("left")
    .tickFormat(null)
    .ticks(10);
    
var yAxis_right = d3.svg.axis()
    .scale(y_right)
    .orient("right")
    .tickFormat(null)
    .ticks(10);
  
// svg setup and opening graph

var contracted = "no";  // main graph opens uncontracted -toggled by clicking on main_background rect

var svg = d3.select("body").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
    
var main_background = svg.append("rect")
    .attr("width", width)
    .attr("height", height)
    .style("fill", clr_graph_bkgrnd)
    .style("cursor", "crosshair")
    .on("click", function() {

        if (contracted == "no") {
          
          contracted = "yes";
          width = width - contract_width;
          svg.attr("width", width);
          main_background.transition().duration(3000).attr("width", width);
          x.rangeRoundBands([0, width], .5);
          loadSelected();
          zero_rule.transition().duration(3000).attr("x2", width); //after loadSelected
          
          side_panel.transition().duration(3000).attr("transform", "translate(1150, 0)");
          
          main_controls.style("visibility", "hidden").style("opacity", 0);  //pure hack to fix apparent bug or delay issue
          group_select_labels.style("visibility", "visible");
          group_select.style("visibility", "visible");
          company_sort_group.style("visibility", "visible");
          main_controls.style("visibility", "visible");
          company_labels_info.style("visibility", "visible");
          main_controls.transition().duration(4000).style("opacity", 1);
          modes.transition().duration(3000).attr("transform", "translate(620, 500)");
          
          axis_x.attr("class", "x axis small");
          leg_text_mode.transition().duration(3000).attr("x", (width/2) - 50);
        }
        else {
        
          contracted = "no";
          svg.attr("width", width);
          width = width + contract_width;
          main_background.transition().duration(3000).attr("width", width);
          x.rangeRoundBands([0, width], .5);
          loadSelected();
          zero_rule.transition().duration(3000).attr("x2", width); //after loadSelected
          
          side_panel.transition().duration(3000).attr("transform", "translate(1050, 0)");
          group_select_labels.style("visibility", "hidden");
          group_select.style("visibility", "hidden");
          company_sort_group.style("visibility", "hidden");
          main_controls.style("visibility", "hidden");
          company_labels_info.style("visibility", "hidden");
          modes.transition().duration(3000).attr("transform", "translate(720, 500)");
          
          axis_x.attr("class", "x axis");
          leg_text_mode.transition().duration(3000).attr("x", width/2 -20);

        }
      
    });

var axis_x = svg.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(0," + height + ")")
      .call(xAxis); axis_x.call(xAxis);

var axis_y = svg.append("g")
      .attr("class", "y axis")
      .call(yAxis);
      
var axis_label = axis_y.append("text")
      .attr("x", 0)
      .attr("y", -10)
      .classed("label", true)
      .style("text-anchor", "start")
      .text("boe/day (thousands)");
      
var axis_y_right = svg.append("g")
      .attr("class", "y axis")
      .attr("transform", "translate(" + width + ", 0)")
      .call(yAxis_right);
      
var axis_label_right = axis_y_right.append("text")
      .classed("label", true)
      .attr("x", 0)
      .attr("y", -10)
      .style("text-anchor", "end")
      .text("mcfe/day (thousands)");
      

   //  data display (rects
var group = svg.append("g")
.style("cursor", "pointer");





//RESTORE COMPANY LOAD HERE!!!
      
//  END OF GENERAL SETUP BLOCK



     
// SHOW RULE BLOCK

var zero_rule = svg.append("line")
      .attr("x1", 0 )
      .attr("x2", width)
      .attr("y1", height)
      .attr("y2", height)
      .style("stroke", "black")
      .style("shape-rendering", "crispEdges")
      .style("stroke-width", "1");

var rule_group = svg.append("g")
    .style("visibility", "hidden");
  
var rule = rule_group.append("rect")
      .attr("x", 0 )
      .attr("width", width)
      .attr("y", 150)
      .attr("height", 1 );
      
var text_left = rule_group.append("text")
      .attr("x", 10 )
      .attr("y", 150)
      .text("")
      .classed("label", true)
      .style("font-size", "11px");

var text_center = rule_group.append("text")
      .attr("x", 10 )
      .attr("y", 150)
      .text("")
      .classed("label", true)
      .style("font-size", "11px");

var text_right = rule_group.append("text")
      .attr("x", 10 )
      .attr("y", 150)
      .text("")
      .classed("label", true)
      .style("font-size", "11px");

function show_rule(d) {

              
// test to prove that data is passed automatically, even though function (ie show_rule) is not called with an argument. The data is automtaically passed as a parameter and s.datum here is unncessary.  It should work more simply by just denfing show_rule(ob)
              
              var s = d3.select(this);
              var ob = s.datum();
              var equiv_price  = s[0][0].parentNode.__data__.boe_price;
              var equiv_price_hedged  = s[0][0].parentNode.__data__.boe_price_hedged;
              var tot_prod  = s[0][0].parentNode.__data__.prod_total;
              var tot_rev = s[0][0].parentNode.__data__.rev_total;
              var tot_rev_alt = s[0][0].parentNode.__data__.rev_total_alt;
              var tot_pr = s[0][0].parentNode.__data__.pr_total;
              var hedge = s[0][0].parentNode.__data__.hedge;
              
              // to place center text using offset of current g
              var str = d3.select(s[0][0].parentNode).attr("transform" );
              str = str.slice( (str.indexOf( "(" ) +1)  , str.indexOf( "," ) );
              if (str.indexOf( ")") != -1)  //for IE jscript, which generates a different string format
              {str = str.slice( 0  , str.indexOf( ")" ) );}
              
              var rule_y;  //to address negative values
              
              //capture negative income metrics (percent), single values (eg. hedge), and cash margin in capex (value)
              if (ob.percent < 0 || ob < 0 || ob.value < 0) {rule_y = (+s.attr("height")) + (+s.attr("y"));}
              else { rule_y = s.attr("y");}
              
              rule_group.style("visibility", "visible");
                          
              rule.attr("width", width);
              rule.attr("y", rule_y);
              rule.style("fill", s.style("fill"));

              text_left.attr("y", rule_y - 4);
              text_center.style("font-size", "11px")
              text_right.attr("y", rule_y - 4);


  switch(mode) {
    case "PROD_S":
        text_left.text(d3.round(y.invert(rule_y),1));
        text_left.attr("x",1);
        text_left.attr("text-anchor", "start");
        
        text_center.attr("x",  (+s.attr("x") + (+str) + (x.rangeBand()/2) )  );
        text_center.text(percent( y.invert(height - s.attr("height")) / tot_prod));
        text_center.attr("text-anchor", "middle");
        text_center.attr("y", +s.attr("y") + (+s.attr("height")/2) );
        
        text_right.text(d3.round((y.invert(rule_y)*6),1));
        text_right.attr("x", width);
        text_right.attr("text-anchor", "end");
        break;
    case "PROD_UN":
        text_left.text(ob.mboed);
        text_left.attr("x", 1);
        text_left.attr("text-anchor", "start");

        text_center.attr("x",  (+s.attr("x") + (+str) + (x_prods.rangeBand()/2)  )  );
        text_center.text(percent(ob.mboed/tot_prod));
        text_center.attr("text-anchor", "middle");
        text_center.attr("y", rule.attr("y") - 4);
        
        text_right.text(d3.round((ob.mboed * 6),1));
        text_right.attr("x", width);
        text_right.attr("text-anchor", "end");
        break;
    case "REV_S":
        text_left.text(dollars(d3.round(y.invert(rule_y),0)));
        text_left.attr("x",0);
        text_left.attr("text-anchor", "start");
        
        text_center.attr("x",  (+s.attr("x") + (+str) + (x.rangeBand()/2) )  );
        //text_center.text(percent( y.invert(rule_y)  / tot_rev));  //cumed percent
        text_center.text(percent( y.invert(height - s.attr("height")) / tot_rev)); //individual percent
        text_center.attr("text-anchor", "middle");
        text_center.attr("y", +s.attr("y") + (+s.attr("height")/2) );
        
        text_right.text(dollars(d3.round(y.invert(rule_y) *4 ,0)));
        text_right.attr("x", width);
        text_right.attr("text-anchor", "end");
        break;
    case "REV_UN":
        text_left.text(dollars(d3.round(ob.mboed * (ob.price/1000) * q2),0));
        text_left.attr("x", 0);
        text_left.attr("text-anchor", "start");
        
        text_center.attr("x",  (+s.attr("x") + (+str) + (x_prods.rangeBand()/2) )  );
        text_center.text(percent(  (ob.mboed * (ob.price/1000) * q2)  / tot_rev));
        text_center.attr("text-anchor", "middle");
        text_center.attr("y", rule.attr("y") - 4);
        
        text_right.text(dollars(d3.round(ob.mboed * (ob.price/1000 * 4) * q2),0));
        text_right.attr("x", width);
        text_right.attr("text-anchor", "end");
        break;
    case "PRICE_S":
        text_left.text(dollars(d3.round(y.invert(rule_y),2)  ));
        text_left.attr("x",1);
        text_left.attr("text-anchor", "start");
        
        text_center.attr("x",  (+s.attr("x") + (+str) + (x.rangeBand()/2) )  );
        text_center.text(percent( y.invert(height - s.attr("height")) / equiv_price)     );
        text_center.attr("text-anchor", "middle");
        text_center.attr("y", +s.attr("y") + (+s.attr("height")/2) );
        
        text_right.text(dollars(d3.round((y.invert(rule_y)/6),2)));
        text_right.attr("x", width);
        text_right.attr("text-anchor", "end");
        break;
    case "PRICE_UN":
        text_left.text(dollars(ob.price));
        text_left.attr("x", 1);
        text_left.attr("text-anchor", "start");
        
        text_center.text("");
        text_center.attr("y", rule.attr("y") - 4);
        
        text_right.text(dollars(d3.round((ob.price / 6),2)));
        text_right.attr("x", width);
        text_right.attr("text-anchor", "end");
        break;
    case "INC_QU_S":
        text_left.text(dollars(d3.round(y.invert(rule_y),0)  ));
        text_left.attr("x", 1);
        text_left.attr("text-anchor", "start");
        
        text_center.attr("x",  (+s.attr("x") + (+str) + (x.rangeBand()/2) )  );
        text_center.text(dollars(d3.round(ob.dif_dollars)));
        text_center.attr("text-anchor", "middle");
        text_center.attr("y", +s.attr("y") + (+s.attr("height")/2) );
        
        text_right.text(dollars(d3.round((y.invert(rule_y)*4),0)));
        text_right.attr("x", width);
        text_right.attr("text-anchor", "end");
        break;
    case "INC_QU_UN":
      
     if(override == "yes") {
        text_left.text(dollars(d3.round(y.invert(rule_y),0)));
        text_left.attr("x", 1);
        text_left.attr("text-anchor", "start");
        
        text_center.attr("x",  (+s.attr("x") + (+str) + (x_corp.rangeBand()/2) + 3 )  );
        text_center.text(percent(y.invert(rule_y)/tot_rev_alt));
        text_center.attr("text-anchor", "middle");
        text_center.attr("y", rule.attr("y") - 4);
        
        text_right.text(dollars(d3.round((y.invert(rule_y)*4),0)));
        text_right.attr("x", width);
        text_right.attr("text-anchor", "end");
        break;
      
      
    }
      else {
        text_left.text(dollars(d3.round((ob.dollars),0)));
        text_left.attr("x", 1);
        text_left.attr("text-anchor", "start");
        
        text_center.attr("x",  (+s.attr("x") + (+str) + (x_corp.rangeBand()/2) + 3 )  );
        text_center.text(percent(ob.percent));
        text_center.attr("text-anchor", "middle");
        text_center.attr("y", rule.attr("y") - 4);
        
        text_right.text(dollars(d3.round((ob.dollars *4),0)));
        text_right.attr("x", width);
        text_right.attr("text-anchor", "end");
        break;
      }
    case "INC_BOE_UN":
        text_left.text(dollars(d3.round((ob.percent * equiv_price_hedged),2)));
        text_left.attr("x", 1);
        text_left.attr("text-anchor", "start");
        
        text_center.attr("x",  (+s.attr("x") + (+str) + (x_corp.rangeBand()/2) + 3 )  );
        text_center.text(percent(ob.percent));
        text_center.attr("text-anchor", "middle");
        text_center.attr("y", rule.attr("y") - 4);
        
        text_right.text(dollars(d3.round((ob.percent * equiv_price_hedged / 6),2)));
        text_right.attr("x", width);
        text_right.attr("text-anchor", "end");
        break;
    case "INC_BOE_S":
        text_left.text(dollars(d3.round(y.invert(rule_y),2)  ));
        text_left.attr("x", 1);
        text_left.attr("text-anchor", "start");
        
        text_center.attr("x",  (+s.attr("x") + (+str) + (x.rangeBand()/2) )  );
        text_center.text(dollars(d3.round(ob.difference * equiv_price_hedged  ,2)));
        text_center.attr("text-anchor", "middle");
        text_center.attr("y", +s.attr("y") + (+s.attr("height")/2) );

        
        text_right.text(dollars(d3.round((y.invert(rule_y)/6),2)));
        text_right.attr("x", width);
        text_right.attr("text-anchor", "end");
        break;
    case "INC_PERC_UN":
        text_left.text(percent(ob.percent));
        text_left.attr("x", 1);
        text_left.attr("text-anchor", "start");
        
        text_center.attr("x",  (+s.attr("x") + (+str) + (x_corp.rangeBand()/2) + 3 )  );
        text_center.text("");
        text_center.attr("text-anchor", "middle");
        text_center.attr("y", rule.attr("y") - 4);
        
        text_right.text(percent(ob.percent));
        text_right.attr("x", width);
        text_right.attr("text-anchor", "end");
        break;
    case "INC_PERC_S":
        text_left.text(percent(y.invert(s.attr("y") ) ));
        text_left.attr("x", 1);
        text_left.attr("text-anchor", "start");
        
        text_center.attr("x",  (+s.attr("x") + (+str) + (x.rangeBand()/2) )  );
        text_center.text(percent(ob.difference));
        text_center.attr("text-anchor", "middle");
        text_center.attr("y", +s.attr("y") + (+s.attr("height")/2) );

        
        text_right.text("");
        text_right.attr("x", width);
        text_right.attr("text-anchor", "end");
        break;
    case "RESERVES_UN":
        text_left.text(ob.mmboe);
        text_left.attr("x", 1);
        text_left.attr("text-anchor", "start");

        text_center.attr("x",  (+s.attr("x") + (+str) + (x_reserves.rangeBand()/2) )  );
        text_center.text(percent(ob.mmboe/tot_pr));
        text_center.attr("text-anchor", "middle");
        text_center.attr("y", rule.attr("y") - 4);
        
        text_right.text(d3.round((ob.mmboe * 6),1));
        text_right.attr("x", width);
        text_right.attr("text-anchor", "end");
        break;
    case "RESERVES_S":
        text_left.text(d3.round(y.invert(s.attr("y") )),0);
        text_left.attr("x", 1);
        text_left.attr("text-anchor", "start");
        
        
        text_center.attr("x",  (+s.attr("x") + (+str) + (x.rangeBand()/2) )  );
        text_center.text(d3.round((ob.mmboe),1)   );
        text_center.attr("text-anchor", "middle");
        text_center.attr("y", +s.attr("y") + (+s.attr("height")/2) );
        
        
        text_right.text(d3.round(y.invert(s.attr("y") )*6),0);
        text_right.attr("x", width);
        text_right.attr("text-anchor", "end");
        break;
    case "CAPEX":
        text_left.text(dollars(d3.round(y.invert(rule_y)),0));
        text_left.attr("x", 1);
        text_left.attr("text-anchor", "start");
        
        
        text_center.attr("x",  (+s.attr("x") + (+str) + (x.rangeBand()/2) )  );
        text_center.text("");
        text_center.attr("text-anchor", "middle");
        text_center.attr("y", +s.attr("y") + (+s.attr("height")/2) );
        
        
        text_right.text(dollars(d3.round(y.invert(rule_y)),0));
        text_right.attr("x", width);
        text_right.attr("text-anchor", "end");
        break;
    case "HEDGE":
        text_left.text(percent(y.invert(rule_y))  );
        text_left.attr("x", 1);
        text_left.attr("text-anchor", "start");
        
        
        text_center.attr("x",  (+s.attr("x") + (+str) + (x.rangeBand()/2) )  );
        text_center.text("$"+ hedge +  "MM");
        text_center.attr("text-anchor", "middle");
        text_center.attr("y", +s.attr("y") + (+s.attr("height")/2) );
        
        
        text_right.text(percent(y.invert(rule_y))  );
        text_right.attr("x", width);
        text_right.attr("text-anchor", "end");
        break;
        
    case "HEDGE_BOE":
        text_left.text(dollars(d3.round(y.invert(rule_y),2)  ));
        text_left.attr("x", 1);
        text_left.attr("text-anchor", "start");
        
        
        text_center.attr("x",  (+s.attr("x") + (+str) + (x.rangeBand()/2) )  );
        text_center.text("");
        text_center.attr("text-anchor", "middle");
        text_center.attr("y", +s.attr("y") + (+s.attr("height")/2) );
        
        
        text_right.text(dollars(d3.round((y.invert(rule_y)/6),2)));
        text_right.attr("x", width);
        text_right.attr("text-anchor", "end");
        break;
        
    case "DEBT_EBITDA":
        text_left.text(d3.round(y.invert(rule_y),1)  );
        text_left.attr("x", 1);
        text_left.attr("text-anchor", "start");
        
        
        text_center.attr("x",  (+s.attr("x") + (+str) + (x.rangeBand()/2) )  );
        text_center.text("");
        text_center.attr("text-anchor", "middle");
        text_center.attr("y", +s.attr("y") + (+s.attr("height")/2) );
        
        
        text_right.text(d3.round(y.invert(rule_y),1)  );
        text_right.attr("x", width);
        text_right.attr("text-anchor", "end");
        break;
        
    case "EV":
      
        text_left.text(dollars(d3.round(y.invert(s.attr("y") )),0));
        text_left.attr("x", 1);
        text_left.attr("text-anchor", "start");
        
        
        text_center.attr("x",  (+s.attr("x") + (+str) + (x.rangeBand()/2) )  );
        text_center.text(dollars(d3.round((ob.value),0))   );
        text_center.attr("text-anchor", "middle");
        text_center.attr("y", +s.attr("y") + (+s.attr("height")/2) );
        
        
        text_right.text(dollars(d3.round(y.invert(s.attr("y") )),0));
        text_right.attr("x", width);
        text_right.attr("text-anchor", "end");
        break;
        
    case "EV_EBITDA":
        text_left.text(d3.round(y.invert(rule_y),1)  );
        text_left.attr("x", 1);
        text_left.attr("text-anchor", "start");
        
        
        text_center.attr("x",  (+s.attr("x") + (+str) + (x.rangeBand()/2) )  );
        text_center.text("");
        text_center.attr("text-anchor", "middle");
        text_center.attr("y", +s.attr("y") + (+s.attr("height")/2) );
        
        
        text_right.text(d3.round(y.invert(rule_y),1)  );
        text_right.attr("x", width);
        text_right.attr("text-anchor", "end");
        break;

    case "PR_DASHARE":
        text_left.text(d3.round(y.invert(rule_y),1));
        text_left.attr("x", 1);
        text_left.attr("text-anchor", "start");
        
        
        text_center.attr("x",  (+s.attr("x") + (+str) + (x.rangeBand()/2) )  );
        text_center.text("");
        text_center.attr("text-anchor", "middle");
        text_center.attr("y", +s.attr("y") + (+s.attr("height")/2) );
        
        
        text_right.text(d3.round(y.invert(rule_y) *6,1));
        text_right.attr("x", width);
        text_right.attr("text-anchor", "end");
        break;
        
    case "PROD_DASHARE":
        text_left.text(d3.round(y.invert(rule_y),2));
        text_left.attr("x", 1);
        text_left.attr("text-anchor", "start");
        
        
        text_center.attr("x",  (+s.attr("x") + (+str) + (x.rangeBand()/2) )  );
        text_center.text("");
        text_center.attr("text-anchor", "middle");
        text_center.attr("y", +s.attr("y") + (+s.attr("height")/2) );
        
        
        text_right.text(d3.round(y.invert(rule_y) *6,2));
        text_right.attr("x", width);
        text_right.attr("text-anchor", "end");
        break;
  }//end of switch
              
  
}//end of show_rule()



// END OF SHOW RULE FUNCTION BLOCK



// LEGEND BLOCK
var top_legend = svg.append("g")
    .attr("transform", "translate(50, -10)")
    .classed("label", true);


var leg_text_mode = top_legend.append("text")
  .attr("x", width/2 - 20)
  .attr("y", 5)
  .style("text-anchor", "middle")
  .style("visibility", "visible")
  .style("font-size", "16px")
  .text("Average Daily Production in Q2 2015 by product");
  
// END OF LEGEND BLOCK

// MAIN GRAPH BAR SORT CONTROLS

 
 var bar_sort_control_height = height + 50;  // 100 px below graph
    
var legend_data;
    
function set_legend_data() {

  switch(mode) {

    case "PROD_UN":

  legend_data =

[
  [{ "name":"abc","sortable":"yes","color": clr_abc}],
  [{ "name":"oil","sortable":"yes","color": clr_oil}],
  [{ "name":"ngl","sortable":"yes","color": clr_ngl}],
  [{ "name":"gas","sortable":"yes","color": clr_gas}]
];
break;

  case "PROD_S":
  legend_data =

[
[{ "name":"abc","sortable":"yes","color": clr_abc}],
[{ "name":"oil","sortable":"yes","color": clr_oil}],
[{ "name":"liquids","sortable":"yes","color": clr_liquids}],
[{ "name":"total","sortable":"yes","color": clr_total}]
];
break;

  case "REV_UN":
  legend_data =
[
  [{ "name":"abc","sortable":"yes","color": clr_abc}],
  [{ "name":"oil","sortable":"yes","color": clr_oil}],
  [{ "name":"ngl","sortable":"yes","color": clr_ngl}],
  [{ "name":"gas","sortable":"yes","color": clr_gas}]
];
break;

  case "REV_S":
  legend_data =
[
[{ "name":"abc","sortable":"yes","color": clr_abc}],
[{ "name":"oil","sortable":"yes","color": clr_oil}],
[{ "name":"liquids","sortable":"yes","color": clr_liquids}],
[{ "name":"total","sortable":"yes","color": clr_total}]
];
break;

  case "PRICE_UN":
  legend_data =
[
  [{ "name":"abc","sortable":"yes","color": clr_abc}],
  [{ "name":"oil","sortable":"yes","color": clr_oil}],
  [{ "name":"ngl","sortable":"yes","color": clr_ngl}],
  [{ "name":"gas","sortable":"yes","color": clr_gas}]
];
break;


  case "PRICE_S":
  legend_data =
[
[{ "name":"abc","sortable":"yes","color": clr_abc}],
[{ "name":"BOE price","sortable":"yes","color": clr_total}]
];
break;


  case "INC_QU_UN":
    
if (override == "no") {
  legend_data =

[
[{ "name":"abc","sortable":"yes","color": clr_abc}],
[{ "name":"post-hedge revs","sortable":"yes","color": clr_gross}],
[{ "name":"ebitda","sortable":"yes","color": clr_ebitda}],
[{ "name":"cash margin","sortable":"yes","color": clr_cashMargin}],
[{ "name":"pre-tax net","sortable":"yes","color": clr_net}]
];}

else

if (override == "yes") {
  legend_data =

[
[{ "name":"abc","sortable":"yes","color": clr_abc}],
[{ "name":"override revs","sortable":"yes","color": clr_gross}],
[{ "name":"ebitda","sortable":"yes","color": clr_ebitda}],
[{ "name":"cash margin","sortable":"yes","color": clr_cashMargin}],
[{ "name":"pre-tax net","sortable":"yes","color": clr_net}]
];}

break;

  case "INC_QU_S":
    legend_data =
[
[{ "name":"abc","sortable":"yes","color": clr_abc}],
[{ "name":"ebitda costs","sortable":"yes","color": clr_ebtidaCosts}],
[{ "name":"interest","sortable":"yes","color": clr_interest}],
[{ "name":"DD&A","sortable":"yes","color": clr_DDA}],
[{ "name":"pre-tax net","sortable":"yes","color": clr_netIncome}]
];
break;

  case "INC_BOE_UN":
  legend_data =

[
[{ "name":"abc","sortable":"yes","color": clr_abc}],
[{ "name":"post-hedge","sortable":"yes","color": clr_gross}],
[{ "name":"ebitda","sortable":"yes","color": clr_ebitda}],
[{ "name":"cash margin","sortable":"yes","color": clr_cashMargin}],
[{ "name":"pre-tax net","sortable":"yes","color": clr_net}]
];
break;

  case "INC_BOE_S":
        legend_data =
[
[{ "name":"abc","sortable":"yes","color": clr_abc}],
[{ "name":"ebitda costs","sortable":"yes","color": clr_ebtidaCosts}],
[{ "name":"interest","sortable":"yes","color": clr_interest}],
[{ "name":"DD&A","sortable":"yes","color": clr_DDA}],
[{ "name":"pre-tax net","sortable":"yes","color": clr_netIncome}]
];
break;


  case "INC_PERC_UN":
    
    
  legend_data =
[
[{ "name":"abc","sortable":"yes","color": clr_abc}],
[{ "name":"post-hedge","sortable":"yes","color": clr_gross}],
[{ "name":"ebitda","sortable":"yes","color": clr_ebitda}],
[{ "name":"cash margin","sortable":"yes","color": clr_cashMargin}],
[{ "name":"pre-tax net","sortable":"yes","color": clr_net}]
];
break;

  case "INC_PERC_S":
    legend_data =
[
[{ "name":"abc","sortable":"yes","color": clr_abc}],
[{ "name":"ebitda costs","sortable":"yes","color": clr_ebtidaCosts}],
[{ "name":"interest","sortable":"yes","color": clr_interest}],
[{ "name":"DD&A","sortable":"yes","color": clr_DDA}],
[{ "name":"pre-tax net","sortable":"yes","color": clr_netIncome}]
];
break;

  case "RESERVES_UN":
    legend_data =
[
[{ "name":"abc","sortable":"yes","color": clr_abc}],
[{ "name":"oil PD","sortable":"yes","color": clr_oil}],
[{ "name":"oil PUD","sortable":"yes","color": clr_oil_l}],
[{ "name":"ngl PD","sortable":"yes","color": clr_ngl}],
[{ "name":"ngl PUD","sortable":"yes","color": clr_ngl_l}],
[{ "name":"gas PD","sortable":"yes","color": clr_gas}],
[{ "name":"gas PUD","sortable":"yes","color": clr_gas_l}]
];
break;

case "RESERVES_S":
    legend_data =
[
[{ "name":"abc","sortable":"yes","color": clr_abc}],
[{ "name":"PR total","sortable":"yes","color": clr_pr}],
[{ "name":"PR oil","sortable":"yes","color": clr_pr_oil}],
[{ "name":"PR liquids","sortable":"yes","color": clr_pr_liquids}],
[{ "name":"PR gas","sortable":"yes","color": clr_pr_gas}],
[{ "name":"PD total","sortable":"yes","color": clr_total}],
[{ "name":"PUD total","sortable":"yes","color": clr_pud}]
];
break;

case "CAPEX":
    legend_data =
[
[{ "name":"abc","sortable":"yes","color": clr_abc}],
[{ "name":"capex","sortable":"yes","color": "darkgreen"}],
[{ "name":"cash margin","sortable":"yes","color": "lightgreen"}]
];
break;

case "HEDGE":
    legend_data =
[
[{ "name":"abc","sortable":"yes","color": clr_abc}],
[{ "name":"hedge impact","sortable":"yes","color": "lightgreen"}]
];
break;

case "HEDGE_BOE":
    legend_data =
[
[{ "name":"abc","sortable":"yes","color": clr_abc}],
[{ "name":"hedge impact","sortable":"yes","color": "lightgreen"}]
];
break;

case "DEBT_EBITDA":
    legend_data =
[
[{ "name":"abc","sortable":"yes","color": clr_abc}],
[{ "name":"debt/ebitda","sortable":"yes","color": "green"}]
];
break;

case "EV":
    legend_data =
[
[{ "name":"abc","sortable":"yes","color": clr_abc}],
[{ "name":"mrkt cap (equity)","sortable":"yes","color": "darkgreen"}],
[{ "name":"net debt","sortable":"yes","color": "lightgreen"}],
[{ "name":"ev","sortable":"yes","color": clr_ev}],
];
break;

case "EV_EBITDA":
    legend_data =
[
[{ "name":"abc","sortable":"yes","color": clr_abc}],
[{ "name":"ev/ebita","sortable":"yes","color": "lightgreen"}]
];
break;

case "PR_DASHARE":
    legend_data =
[
[{ "name":"abc","sortable":"yes","color": clr_abc}],
[{ "name":"reserves/share","sortable":"yes","color": "green"}]
];
break;

case "PROD_DASHARE":
    legend_data =
[
[{ "name":"abc","sortable":"yes","color": clr_abc}],
[{ "name":"production/share","sortable":"yes","color": "green"}]
];
break;
 } //end of switch




}//end of set_legend_data()


    

  set_legend_data();
  legend_scale.domain(legend_data.map(function(d){return d[0].name;}));

    
var legend_below_root  = svg.append("g")
    .attr("transform", "translate( 30," + bar_sort_control_height + ")")
    .style("cursor", "pointer")
    .classed("label", true);
    
legend_below_root.append("text")
    .attr("x", -50)
    .classed("label", true)
    .style("font-size", "20px")
    .text("sort by:");
    

var legend_below_elements = legend_below_root.selectAll(".elements")
      .data(legend_data)
      .enter().append("g")
      .attr("transform", function(d) { return "translate(" + legend_scale(d[0].name) + ",0)"; });
      
var legend_texts =  legend_below_elements.selectAll("text")
      .data(function (d) {return d;})
      .enter().append("text")
       .style("text-anchor", "end")
       .style("opacity", function(d) {
          if (d.name == order) {return 1.0;}
          else {return .6;}
        })
        .style("font-weight", function(d) {
          if (d.name == order) {return "700";}
          else {return "400";}
        })
        .style("font-style", function(d) {
          if (d.name == order) {return "italic";}
          else {return "normal";}
        })
      .on("click", changeSort)
      .text(function (d) {return d.name;});
      
var legend_rects =  legend_below_elements.selectAll("rect")
      .data(function (d) {return d;})
      .enter().append("rect")
      .on("click", changeSort)
      .attr("x", -15)
      .attr("y", 5)
      .attr("width", function(d) {
          if (d.name == order) {return 22;}
          else {return 16;}
        })
      .attr("height", function(d) {
          if (d.name == order) {return 22;}
          else {return 16;}
        })
      .style("fill", function (d) {return d.color;});
      
function reset_legends() {
  
    set_legend_data();
    legend_scale.domain(legend_data.map(function(d){return d[0].name;}));
    
    var t = legend_below_root.selectAll("g")
      .data(legend_data);
      
      t.enter().append("g");
      t.exit().remove();
      t.attr("transform", function(d) { return "translate(" + legend_scale(d[0].name) + ",0)"; });
      
    var e = legend_below_root.selectAll("g").selectAll("text")
      .data(function (d) {return d;});
      
      e.enter().append("text");
      
      e.on("click", changeSort)
       .style("text-anchor", "end")
       .text(function (d) {return d.name;});
       
    var r = legend_below_root.selectAll("g").selectAll("rect")
      .data(function (d) {return d;});
      
      r.enter().append("rect");
      
      r.on("click", changeSort)
       .attr("x", -15)
       .attr("y", 5)
       .style("fill", function (d) {return d.color;});

    sort();
      
}



function changeSort(d) {
      if (d.sortable == "yes") {
        order = d.name;
        sort();
        
      }
      else {}  //right now all are sortable, so this shoudnt happen, so make to to also get rid of the sortable data field

}



function sort() {
  
        legend_below_root.selectAll("g").selectAll("text")
        .style("opacity", function(d) {
          if (d.name == order) {return 1.0;}
          else {return .6;}
        })
        .style("font-weight", function(d) {
          if (d.name == order) {return "700";}
          else {return "400";}
        })
        .style("font-style", function(d) {
          if (d.name == order) {return "italic";}
          else {return "normal";}
        })
        .style("font-size", function(d) {
          if (d.name == order) {return "16px";}
          else {return "14px";}
        });
        
        legend_below_root.selectAll("g").selectAll("rect")
        .attr("width", function(d) {
          if (d.name == order) {return 22;}
          else {return 16;}
        })
          .attr("height", function(d) {
          if (d.name == order) {return 22;}
          else {return 16;}
        });

 if (order == "abc"){ current_data = current_data.sort(function(a, b) { return d3.ascending(a.company, b.company); }); }

 else // some kind of value sort
 {
  switch(mode) {

    case "PROD_S":
        switch(order) {
          case "oil":
            current_data = current_data.sort(function(a, b) { return b.values.prods[0].mboed - a.values.prods[0].mboed; }); break;
          case "liquids":
            current_data = current_data.sort(function(a, b) { return (b.values.prods[0].mboed + b.values.prods[1].mboed) - (a.values.prods[0].mboed + a.values.prods[1].mboed); }); break;
          case "total":
            current_data = current_data.sort(function(a, b) { return b.prod_total - a.prod_total; }); break;
        }
        break;
    case "PROD_UN":
        switch(order) {
          case "oil":
            current_data = current_data.sort(function(a, b) { return b.values.prods[0].mboed - a.values.prods[0].mboed; }); break;
          case "ngl":
            current_data = current_data.sort(function(a, b) { return b.values.prods[1].mboed - a.values.prods[1].mboed; }); break;
          case "gas":
            current_data = current_data.sort(function(a, b) { return b.values.prods[2].mboed - a.values.prods[2].mboed; }); break;
        }
        break;
    case "REV_S":
        switch(order) {
          case "oil":
            current_data = current_data.sort(function(a, b) { return (b.values.prods[0].mboed * b.values.prods[0].price) - (a.values.prods[0].mboed * a.values.prods[0].price); }); break;
          case "liquids":
            current_data = current_data.sort(function(a, b) { return ((b.values.prods[0].mboed * b.values.prods[0].price) + (b.values.prods[1].mboed * b.values.prods[1].price)) - ((a.values.prods[0].mboed * a.values.prods[0].price) + (a.values.prods[1].mboed * a.values.prods[1].price)); }); break;
          case "total":
            current_data = current_data.sort(function(a, b) { return b.rev_total - a.rev_total; }); break;
        }
        break;
    case "REV_UN":
        switch(order) {
          case "oil":
              current_data = current_data.sort(function(a, b) { return (b.values.prods[0].mboed * b.values.prods[0].price) - (a.values.prods[0].mboed * a.values.prods[0].price); }); break;
          case "ngl":
            current_data = current_data.sort(function(a, b) { return (b.values.prods[1].mboed * b.values.prods[1].price) - (a.values.prods[1].mboed * a.values.prods[1].price); }); break;
          case "gas":
            current_data.sort(function(a, b) { return (b.values.prods[2].mboed * b.values.prods[2].price) - (a.values.prods[2].mboed * a.values.prods[2].price); }); break;
        }
        break;
    case "PRICE_S":
        current_data = current_data.sort(function(a, b) { return b.boe_price - a.boe_price; });
        break;
    case "PRICE_UN":
        switch(order) {
          case "oil":
              current_data = current_data.sort(function(a, b) { return b.values.prods[0].price - a.values.prods[0].price; }); break;
          case "ngl":
            current_data = current_data = current_data.sort(function(a, b) { return b.values.prods[1].price - a.values.prods[1].price; }); break;
          case "gas":
            current_data = current_data.sort(function(a, b) { return b.values.prods[2].price - a.values.prods[2].price; }); break;
        }
        break;
    case "INC_QU_S":
      
        switch(order) {
          case "ebitda costs":
            current_data = current_data.sort(function(a, b) { return (b.values.corp[3].difference * b.rev_total) - (a.values.corp[3].difference * a.rev_total); }); break;
          case "interest":
            current_data = current_data.sort(function(a, b) { return (b.values.corp[2].difference * b.rev_total) - (a.values.corp[2].difference * a.rev_total); }); break;
          case "DD&A":
            current_data = current_data.sort(function(a, b) { return (b.values.corp[1].difference * b.rev_total) - (a.values.corp[1].difference * a.rev_total); }); break;
          case "pre-tax net":
            current_data = current_data.sort(function(a, b) { return (b.values.corp[0].difference * b.rev_total) - (a.values.corp[0].difference * a.rev_total); }); break;
        }
        break;
    case "INC_QU_UN":
        switch(order) {
          case "post-hedge revs":
            current_data = current_data.sort(function(a, b) { return b.values.corp[3].dollars - a.values.corp[3].dollars; }); break;
          case "override revs":
            current_data = current_data.sort(function(a, b) { return b.values.corp[3].dollars - a.values.corp[3].dollars; }); break;
          case "ebitda":
            current_data = current_data.sort(function(a, b) { return b.values.corp[2].dollars - a.values.corp[2].dollars; }); break;
          case "cash margin":
            current_data = current_data.sort(function(a, b) { return b.values.corp[1].dollars - a.values.corp[1].dollars; }); break;
          case "pre-tax net":
            current_data = current_data.sort(function(a, b) { return b.values.corp[0].dollars - a.values.corp[0].dollars; }); break;
        }
        break;
    case "INC_BOE_S":
        switch(order) {
          case "ebitda costs":
            current_data = current_data.sort(function(a, b) { return (b.values.corp[3].difference * b.boe_price) - (a.values.corp[3].difference * a.boe_price); }); break;
          case "interest":
            current_data = current_data.sort(function(a, b) { return (b.values.corp[2].difference * b.boe_price) - (a.values.corp[2].difference * a.boe_price); }); break;
          case "DD&A":
            current_data = current_data.sort(function(a, b) { return (b.values.corp[1].difference * b.boe_price) - (a.values.corp[1].difference * a.boe_price); }); break;
          case "pre-tax net":
            current_data = current_data.sort(function(a, b) { return (b.values.corp[0].difference * b.boe_price) - (a.values.corp[0].difference * a.boe_price); }); break;
        }
        break;
    case "INC_BOE_UN":
        switch(order) {
          case "post-hedge":
            current_data = current_data.sort(function(a, b) { return (b.values.corp[3].percent * b.boe_price) - (a.values.corp[3].percent * a.boe_price); }); break;
          case "ebitda":
            current_data = current_data.sort(function(a, b) { return (b.values.corp[2].percent * b.boe_price) - (a.values.corp[2].percent * a.boe_price); }); break;
          case "cash margin":
            current_data = current_data.sort(function(a, b) { return (b.values.corp[1].percent * b.boe_price) - (a.values.corp[1].percent * a.boe_price); }); break;
          case "pre-tax net":
            current_data = current_data.sort(function(a, b) { return (b.values.corp[0].percent * b.boe_price) - (a.values.corp[0].percent * a.boe_price); }); break;
        }
        break;
    case "INC_PERC_S":
        switch(order) {
          case "ebitda costs":
            current_data = current_data.sort(function(a, b) { return (b.values.corp[3].difference) - (a.values.corp[3].difference); }); break;
          case "interest":
            current_data = current_data.sort(function(a, b) { return (b.values.corp[2].difference) - (a.values.corp[2].difference); }); break;
          case "DD&A":
            current_data = current_data.sort(function(a, b) { return (b.values.corp[1].difference) - (a.values.corp[1].difference); }); break;
          case "pre-tax net":
            current_data = current_data.sort(function(a, b) { return (b.values.corp[0].difference) - (a.values.corp[0].difference); }); break;
        }
        break;
    case "INC_PERC_UN":
        switch(order) {
          case "post-hedge":
            current_data = current_data.sort(function(a, b) { return b.values.corp[3].percent - a.values.corp[3].percent; }); break;
          case "ebitda":
            current_data = current_data.sort(function(a, b) { return b.values.corp[2].percent - a.values.corp[2].percent; }); break;
          case "cash margin":
            current_data = current_data.sort(function(a, b) { return b.values.corp[1].percent - a.values.corp[1].percent; }); break;
          case "pre-tax net":
            current_data = current_data.sort(function(a, b) { return b.values.corp[0].percent - a.values.corp[0].percent; }); break;
        }
        break;
   case "RESERVES_UN":
        switch(order) {
          case "oil PD":
            current_data = current_data.sort(function(a, b) { return b.values.reserves[0].mmboe - a.values.reserves[0].mmboe; }); break;
          case "ngl PD":
            current_data = current_data.sort(function(a, b) { return b.values.reserves[1].mmboe - a.values.reserves[1].mmboe; }); break;
          case "gas PD":
            current_data = current_data.sort(function(a, b) { return b.values.reserves[2].mmboe - a.values.reserves[2].mmboe; }); break;
          case "oil PUD":
            current_data = current_data.sort(function(a, b) { return b.values.reserves[3].mmboe - a.values.reserves[3].mmboe; }); break;
          case "ngl PUD":
            current_data = current_data.sort(function(a, b) { return b.values.reserves[4].mmboe - a.values.reserves[4].mmboe; }); break;
          case "gas PUD":
            current_data = current_data.sort(function(a, b) { return b.values.reserves[5].mmboe - a.values.reserves[5].mmboe; }); break;
        }
        break;
   case "RESERVES_S":
        switch(order) {
            
          case "PR total":
            current_data = current_data.sort(function(a, b) { return b.pr_total - a.pr_total; });
            break;
          case "PR oil":
            current_data = current_data.sort(function(a, b) { return b.pr_oil - a.pr_oil; });
            break;
          case "PR liquids":
            current_data = current_data.sort(function(a, b) { return b.pr_liquids - a.pr_liquids; });
            break;
          case "PR gas":
            current_data = current_data.sort(function(a, b) { return (b.pr_total - b.pr_liquids) - (a.pr_total - a.pr_liquids); });
            break;
          case "PD total":
            current_data = current_data.sort(function(a, b) { return (b.pr_total * (1- b.pr_pud_percent)) - (a.pr_total * (1- a.pr_pud_percent)); });
            break;
          case "PUD total":
            current_data = current_data.sort(function(a, b) { return (b.pr_total * b.pr_pud_percent) - (a.pr_total * a.pr_pud_percent); });
            break;
        }
        break;
    case "CAPEX":
        switch(order) {
          case "capex":
            current_data = current_data.sort(function(a, b) { return b.capex[0].value - a.capex[0].value; }); break;
          case "cash margin":
            current_data = current_data.sort(function(a, b) { return b.capex[1].value - a.capex[1].value; }); break;
        }
        break;
   case "HEDGE":
        current_data = current_data.sort(function(a, b) { return (b.hedge/b.rev_total) - (a.hedge/a.rev_total); });
        break;
   case "HEDGE_BOE":
        current_data = current_data.sort(function(a, b) { return (b.boe_price_hedged - b.boe_price) - (a.boe_price_hedged - a.boe_price); });
        break;
    case "DEBT_EBITDA":
        current_data = current_data.sort(function(a, b) { return (b.debt/(b.values.corp[2].dollars * 4)) - (a.debt/(a.values.corp[2].dollars * 4)); });
        break;
    case "EV":
        switch(order) {
          case "mrkt cap (equity)":
            current_data = current_data.sort(function(a, b) { return b.ev[0].value - a.ev[0].value; }); break;
          case "net debt":
            current_data = current_data.sort(function(a, b) { return b.ev[1].value - a.ev[1].value; }); break;
          case "ev":
            current_data = current_data.sort(function(a, b) { return (b.ev[0].value + b.ev[1].value) - (a.ev[0].value + a.ev[1].value); }); break;
        }
        break;
    case "EV_EBITDA":
        current_data = current_data.sort(function(a, b) { return ( (b.ev[0].value + b.ev[1].value)/(b.values.corp[2].dollars * 4)) - ((a.ev[0].value + a.ev[1].value)/(a.values.corp[2].dollars * 4)); });
        break;
    case "PR_DASHARE":
        current_data = current_data.sort(function(a, b) { return (b.pr_total/b.da_shares) - (a.pr_total/a.da_shares);});
        break;
    case "PROD_DASHARE":
        current_data = current_data.sort(function(a, b) { return (b.prod_total/b.da_shares) - (a.prod_total/a.da_shares);});
        break
    } //end of switch(mode)
    


  }// end of else -- all value (non-ABC) sorts of current_data

// use sorted companies to set x domain and the number of them to compute rangeBands for widths.
  x.domain(current_data.map(function(d){return d.company;}));
  x_prods.rangeRoundBands([0, x.rangeBand()]);
  x_corp.rangeRoundBands([0, x.rangeBand()]);
  x_reserves.rangeRoundBands([0, x.rangeBand()]);
  x_capex.rangeRoundBands([0, x.rangeBand()]);

  
    g_level();  //This is apparently the only place needed as sort() is always called when redrawing rects


}// end of sort function after effecting the sort

// END OF MAIN GRAPH BAR SORT CONTROLS

//pie chart unit below legends

var global_prod_data = [

  {"product":"oil", "mboed" : global_prod_oil},
  {"product":"ngl","mboed": global_prod_ngl},
  {"product":"gas","mboed": global_prod_gas}
  
  ]
    
    
var global_rev_data = [

  {"product":"oil", "rev" : global_rev_oil},
  {"product":"ngl","rev": global_rev_ngl},
  {"product":"gas","rev": global_rev_gas}
  
  ]
  
var global_pr_data = [

  {"div":"oil pd", "mmboe" : global_pr_oil_pd},
  {"div":"oil pud", "mmboe" : global_pr_oil_pud},
  {"div":"ngl pd", "mmboe" : global_pr_ngl_pd},
  {"div":"ngl pud", "mmboe" : global_pr_ngl_pud},
  {"div":"gas pd", "mmboe" : global_pr_gas_pd},
  {"div":"gas pud", "mmboe" : global_pr_gas_pud}
  
  ]


var global_inc_data = [

  [{"metric":"rev_total", "percent" : 1.0}, {"metric":"excess", "percent" : 0}],
  [{"metric":"ebitda", "percent" : global_average_ebitda}, {"metric":"excess", "percent" : 1.0 - global_average_ebitda}],
  [{"metric":"cashMargin", "percent" : global_average_cashMargin}, {"metric":"excess", "percent" : 1.0 - global_average_cashMargin}],
  [{"metric":"net", "percent" : global_average_net}, {"metric":"excess", "percent" : 1.0 - global_average_net}]
  ]
  
var global_cost_data = [

  {"metric":"rev_total", "percent" : global_average_ebitdaCst},
  {"metric":"ebitda", "percent" : global_average_interest},
  {"metric":"cashMargin", "percent" : global_average_DDA},
  {"metric":"net", "percent" : global_average_pretax_net}
  ]
  
  

 
var radius = 65;

var arc = d3.svg.arc()
    .outerRadius(radius)
    .innerRadius(radius - 15);
    
  //define outside of load function so they are globally available

var pie_charts_root_pr;
var pie_charts_root_rev;
var pie_charts_root_prod;
var pie_charts_root_inc;
var pie_charts_root_cost;
var links_root;
    
// production pie chart
    
function load_pie_graphs(){
  
    
var pie_charts_root  = svg.insert("g", ":first-child")
    .attr("transform", "translate( 30," + (bar_sort_control_height + 120) + ")");
    


// production pie chart

var pie_prod = d3.layout.pie()
    .sort(null)
    .value(function(d) { return d.mboed; });
    
pie_charts_root_prod  = pie_charts_root.append("g")
    .style("opacity", 0)
    .attr("transform", "translate(30,0)");
    
    pie_charts_root_prod.transition().delay(0).duration(2000).style("opacity", 1);

var global_prod_chart = pie_charts_root_prod.selectAll("gpc")
      .data(pie_prod(global_prod_data))
    .enter().append("g")
      .attr("class", "arc");

  global_prod_chart.append("path")
      .attr("d", arc)
      .style("fill", function(d) { return colors_prods(d.data.product); });
      
  pie_charts_root_prod.append("text")
       .classed("label", true)
               .style("opacity","hidden")
       .style("font-size", "13px")
       .style("font-weight","600")
       .attr("text-anchor", "middle")
       .attr("y", -2)
       .text(d3.round(global_prod/1000,2) + " MMboe/d");
       
  pie_charts_root_prod.append("text")
       .classed("label", true)
       .style("font-size", "11px")
       .style("font-weight","500")
       .attr("text-anchor", "middle")
       .attr("y", 13)
       .text(d3.round((global_prod *6)/1000,2) + " Bcfe/d");
       
  pie_charts_root_prod.append("text")
       .classed("label", true)
       .style("font-size", "18px")
       .style("font-weight","500")
       .attr("text-anchor", "middle")
       .attr("y", 90)
       .text("Daily Production");
       
  pie_charts_root_prod.append("text")
       .classed("label", true)
       .style("font-size", "14px")
       .style("font-weight","500")
       .attr("text-anchor", "middle")
       .attr("y", 105)
       .text("all data");

       
// rev pie chart

var pie_rev = d3.layout.pie()
    .sort(null)
    .value(function(d) { return d.rev; });
    
pie_charts_root_rev  = pie_charts_root.append("g")
    .style("opacity", 0)
    .attr("transform", "translate(250,0)");
    
    pie_charts_root_rev.transition().delay(1000).duration(2000).style("opacity", 1);

var global_rev_chart = pie_charts_root_rev.selectAll("grc")
    .data(pie_rev(global_rev_data))
    .enter().append("g")
    .attr("class", "arc");


  global_rev_chart.append("path")
      .attr("d", arc)
      .style("fill", function(d) { return colors_prods(d.data.product); });
      
  pie_charts_root_rev.append("text")
       .classed("label", true)
       .style("font-size", "13px")
       .style("font-weight","600")
       .attr("text-anchor", "middle")
       .attr("y", 4)
       .text(dollars(d3.round(global_rev/1000,2)) + " billion");
       
  pie_charts_root_rev.append("text")
       .classed("label", true)
       .style("font-size", "18px")
       .style("font-weight","500")
       .attr("text-anchor", "middle")
       .attr("y", 90)
       .text("Quarterly Revenue");
       
  pie_charts_root_rev.append("text")
       .classed("label", true)
       .style("font-size", "14px")
       .style("font-weight","500")
       .attr("text-anchor", "middle")
       .attr("y", 105)
       .text("all data");
       
//proved reserves pie chart

var pie_pr = d3.layout.pie()
    .sort(null)
    .value(function(d) { return d.mmboe; });
    
pie_charts_root_pr  = pie_charts_root.append("g")
    .style("opacity", 0)
    .attr("transform", "translate(470,0)");
    
    pie_charts_root_pr.transition().delay(2000).duration(2000).style("opacity", 1);

var global_pr_chart = pie_charts_root_pr.selectAll("grc")
    .data(pie_pr(global_pr_data))
    .enter().append("g")
    .attr("class", "arc");


  global_pr_chart.append("path")
      .attr("d", arc)
      .style("fill", function(d) { return colors_reserves(d.data.div); });
      
  pie_charts_root_pr.append("text")
       .classed("label", true)
       .style("font-size", "13px")
       .style("font-weight","600")
       .attr("text-anchor", "middle")
       .attr("y", -1)
       .text(d3.round(global_pr/1000,2) + " Bboe");
       
  pie_charts_root_pr.append("text")
       .classed("label", true)
       .style("font-size", "12px")
       .style("font-weight","400")
       .attr("text-anchor", "middle")
       .attr("y", 13)
       .text("(" + percent(global_pud_percent) + " PUD)");
       
  pie_charts_root_pr.append("text")
       .classed("label", true)
       .style("font-size", "18px")
       .style("font-weight","500")
       .attr("text-anchor", "middle")
       .attr("y", 90)
       .text("Proved Reserves");
       
  pie_charts_root_pr.append("text")
       .classed("label", true)
       .style("font-size", "14px")
       .style("font-weight","500")
       .attr("text-anchor", "middle")
       .attr("y", 105)
       .text("all data");
       
//income metrics charts (income and cost)  -- reamin hidden until revealed.

// cost percentages

var pie_cost = d3.layout.pie()
    .sort(null)
    .value(function(d) { return d.percent; });
    
    //defined as global var above so it can be reached.
    pie_charts_root_cost = pie_charts_root.append("g")
    .style("visibility", "hidden")
    .attr("transform", "translate(450,0)");
    

var global_cost_chart = pie_charts_root_cost.selectAll("c")
    .data(pie_cost(global_cost_data))
    .enter().append("g")
    .attr("class", "arc")
    .on("mouseover", function () {pie_charts_cost_text.text(percent(d3.select(this).datum().value));})
    .on("mouseout", function () {pie_charts_cost_text.text("");} );


  global_cost_chart.append("path")
      .attr("d", arc)
      .style("fill", function(d) { return colors_income_s(d.data.metric); });
      
var  pie_charts_cost_text = pie_charts_root_cost.append("text")
    .attr("x", 0)
    .attr("y", 3)
    .classed("label", true)
    .attr("text-anchor", "middle")
    .style("font-size", "12px")
    .text("");
       
  pie_charts_root_cost.append("text")
       .classed("label", true)
       .style("font-size", "18px")
       .style("font-weight","500")
       .attr("text-anchor", "middle")
       .attr("y", 90)
       .text("Cost Analysis");
       
  pie_charts_root_cost.append("text")
       .classed("label", true)
       .style("font-size", "14px")
       .style("font-weight","500")
       .attr("text-anchor", "middle")
       .attr("y", 105)
       .text("all data");
       
// four nest income pies, on top of each other

var arc_filled = d3.svg.arc()
    .outerRadius(radius)
    .innerRadius(0);
    
var pie_inc = d3.layout.pie()
    .sort(null)
    .value(function(d) { return d.percent; });
    
pie_charts_root_inc  = pie_charts_root.append("g")
    .style("visibility", "hidden")
    .attr("transform", "translate(200,0)");


var global_inc1_chart = pie_charts_root_inc.selectAll("inc1")
      .data(pie_inc(global_inc_data[0]))
    .enter().append("g")
      .attr("class", "arc")
      .on("mouseover", function () {pie_charts_inc_text.text(percent(global_inc_data[0][0].percent));})
      .on("mouseout", function () {pie_charts_inc_text.text("");} );

  global_inc1_chart.append("path")
      .attr("d", arc_filled)
      .style("fill", function(d) { return colors_pie_rev_total(d.data.metric); });
      
var global_inc2_chart = pie_charts_root_inc.selectAll("inc2")
      .data(pie_inc(global_inc_data[1]))
    .enter().append("g")
    .attr("transform", "scale(.8,.8)")
      .attr("class", "arc")
      .on("mouseover", function () {pie_charts_inc_text.text(percent(global_inc_data[1][0].percent));})
      .on("mouseout", function () {pie_charts_inc_text.text("");} );

  global_inc2_chart.append("path")
      .attr("d", arc_filled)
      .style("fill", function(d) { return colors_pie_ebitda(d.data.metric); });
      
var global_inc3_chart = pie_charts_root_inc.selectAll("inc3")
      .data(pie_inc(global_inc_data[2]))
    .enter().append("g")
    .attr("transform", "scale(.6,.6)")
    .attr("class", "arc")
    .on("mouseover", function () {pie_charts_inc_text.text(percent(global_inc_data[2][0].percent));})
    .on("mouseout", function () {pie_charts_inc_text.text("");} );

  global_inc3_chart.append("path")
      .attr("d", arc_filled)
      .style("fill", function(d) { return colors_pie_cashMargin(d.data.metric); });
      
var global_inc4_chart = pie_charts_root_inc.selectAll("inc4")
      .data(pie_inc(global_inc_data[3]))
    .enter().append("g")
    .attr("transform", "scale(.4,.4)")
    .attr("class", "arc")
    .on("mouseover", function () {pie_charts_inc_text.text(percent(global_inc_data[3][0].percent));})
    .on("mouseout", function () {pie_charts_inc_text.text("");} );;

  global_inc4_chart.append("path")
      .attr("d", arc_filled)
      .style("fill", function(d) { return colors_pie_net(d.data.metric); });
      
  pie_charts_root_inc.append("circle")
    .attr("r", radius*.2)
    .style("fill", "white");

    
 var  pie_charts_inc_text = pie_charts_root_inc.append("text")
    .attr("x", -20)
    .attr("y", 10)
    .classed("label", true)
    .style("font-size", "12px")
    .text("");
    
  pie_charts_root_inc.append("text")
       .classed("label", true)
       .style("font-size", "18px")
       .style("font-weight","500")
       .attr("text-anchor", "middle")
       .attr("y", 90)
       .text("Income Analysis");
       
  pie_charts_root_inc.append("text")
       .classed("label", true)
       .style("font-size", "14px")
       .style("font-weight","500")
       .attr("text-anchor", "middle")
       .attr("y", 105)
       .text("all data");
       
links_root = pie_charts_root.append("g")
    .attr("transform", "translate( 0, 140)");
    
links_root.append("rect")
      .attr("width", 600)
      .attr("height", 150)
      .attr("x", -20)
      .attr("y", 0)
      .style("fill", clr_graph_bkgrnd)
      .style("stroke", "black")
      .style("stroke-width", "1px");
    
links_root.append("text")
       .classed("label", true)
       .style("font-size", "14px")
       .style("font-weight","400")
       .attr("y", 30)
       .text("Click to open in new tab:");
    
links_root.append("text")
       .classed("label", true)
       .style("font-size", "20px")
       .style("font-weight","700")
       .attr("x", 80)
       .attr("y", 60)
       //.attr("text-anchor", "middle")
       .style("font-family", "Quattrocento Sans")
       .style("cursor", "pointer")
       .on("mouseover", function () {d3.select(this).style("fill", "gray");})
       .on("mouseout", function () {d3.select(this).style("fill", "black");})
       .on("click", function() { OpenInNewTab("docs_links.html");}  )
       .text("Understanding Shale Equities Explorer");
       
links_root.append("text")
       .classed("label", true)
       .style("font-size", "20px")
       .style("font-weight","700")
       .attr("x", 80)
       .attr("y", 90)
       .style("font-family", "Quattrocento Sans")
       .style("cursor", "pointer")
        .on("mouseover", function () {d3.select(this).style("fill", "gray");})
       .on("mouseout", function () {d3.select(this).style("fill", "black");})
       .on("click", function() { OpenInNewTab("data_policy.pdf");}  )
       .text("Data Policy with Company-Specific Notes");
       
links_root.append("text")
       .classed("label", true)
       .style("font-size", "20px")
       .style("font-weight","700")
       .attr("y", 120)
       .attr("x", 80)
       .style("font-family", "Quattrocento Sans")
       .style("cursor", "pointer")
       .on("mouseover", function () {d3.select(this).style("fill", "gray");})
       .on("mouseout", function () {d3.select(this).style("fill", "black");})
       .on("click", function() { OpenInNewTab("http://youtu.be/WxEnakWeR6I");}  )
       .text("Quick-Start Video (3 minutes)");

       
}//end of load pie graphs


// oil price slider
var override = "no";

var price_axis_root_oil  = svg.append("g")
    .style("visibility", "hidden")
    .attr("transform", "translate( 30," + (bar_sort_control_height + 90) + ")");


var price_scale_oil = d3.scale.linear()
    .range([0, 550])
    .domain([50,120]);
    
    
var price_axis_maker_oil = d3.svg.axis()
    .scale(price_scale_oil)
    .orient("bottom")
    .tickFormat(dollars)
    .ticks(13);


var price_axis_oil = price_axis_root_oil.append("g")
    .attr("class", "axis")
    .call(price_axis_maker_oil);
    

var drag_price = d3.behavior.drag()
    .origin(Object)
    .on("drag", dragmove_price);

var position_price_oil = 0;

function dragmove_price() {
  position_price_oil += d3.event.dx;
  if (position_price_oil < 0) {position_price_oil = 0;}
  if (position_price_oil > 550) {position_price_oil = 550;}
  d3.select(this).attr("cx", position_price_oil);
  alt_oil_price = d3.round(50 + (position_price_oil * (70/550)), 2);
  price_oil_text.text(dollars(alt_oil_price));
  if (mode == "INC_QU_UN") {
    current_data.forEach(changePrice);
    inc_qu_un_slider(); }
  rule_group.style("visibility", "hidden");
}

var circle_price = price_axis_root_oil.append("circle")
    .attr("r", 10)
    .attr("cx", 0)
    .attr("cy", 0)
    .style("stroke", "black")
    .style("stroke-width", "40")
    .style("stroke-opacity", "0.0")
    .style("fill", "black")
    .style("fill-opacity", "1.0")
    .style("cursor", "pointer")
    .style("visibility", "hidden")
    .call(drag_price);



price_axis_root_oil.append("text")
    .attr("x", -85)
    .attr("y", -20)
    .text("Toggle NO/YES for OVERRIDE (oil = slider price; ngl = 40% oil; gas = actual pre-hedge price, current cost structure.)")
    .classed("label", true);
    
    
var price_oil_text = price_axis_root_oil.append("text")
    .attr("y", 30)
    .attr("x", -50)
    .style("opacity", 0)
    .text(dollars(alt_oil_price));
    
var slider_text = price_axis_root_oil.append("text")
    .attr("x", -85)
    .attr("y", -40)
    .classed("label", true)
    .text("WHAT-IF option to override post-hedge revenue data and explore impact of oil pricing on unhedged income metrics.");
    
// toggle button group
    
var override_toggle_button = price_axis_root_oil.append("g")
      .style("cursor", "pointer")
      .attr("transform", "translate( -45, 5)")
      .on("click", altToggle);

override_toggle_button.append("rect")
    .attr("x", -6)
    .attr("y", -16)
    .attr("width", 37)
    .attr("height", 22)
    .style("fill", "rgb(200,200,200)");
    
override_toggle_button.append("rect")
    .attr("x", -5)
    .attr("y", -15)
    .attr("width", 35)
    .attr("height", 20)
    .style("fill", "black");
    
var alt_flag_label = override_toggle_button.append("text")
    .attr("x", 12)
    .text("NO")
    .style("fill", "white")
    .attr("text-anchor", "middle")
    .classed("label", true);
    
    
function altToggle() {
  
      rule_group.style("visibility", "hidden");

      if (override == "no") {
        alt_flag_label.text("YES");
        override = "yes";
        reset_legends();
        circle_price.style("visibility", "visible");
        price_oil_text.style("opacity", 1.0);
        inc_qu_un_slider_toggle();
        
      }
      else {
        alt_flag_label.text("NO");
        override = "no";
        reset_legends();
        circle_price.style("visibility", "hidden");
        price_oil_text.style("opacity", 0.0);
        inc_qu_un();
      }

    }

// end toggle button block

function changePrice(d) {
  
  d.rev_total_alt = 0;

  d.values.prods.forEach(function(e) {
    if (e.product == "oil") {e.price_alt = alt_oil_price;}
    if (e.product == "ngl") {e.price_alt = alt_oil_price * .4;}
    else {e.price_alt = e.price;} //gas price unchanged

    d.rev_total_alt += (e.mboed * e.price_alt * q2 / 1000);
    });

      var base = 0;
  d.values.corp.forEach(function(e) {
    e.dollars = (d.rev_total + d.hedge) * e.percent;
    e.difference = e.percent - base;
    e.dif_dollars = (d.rev_total + d.hedge) * e.difference;
    base = e.percent;
    e.dollars_alt = d.rev_total_alt - ((d.rev_total + d.hedge) * (1- e.percent));
  });
}

  function inc_qu_un_slider(){     //called only when slider pulled, so no transition possible

  
    var zero = d3.min(current_data, function(d) { return d.values.corp[0].dollars_alt; });
    if (zero >= 0) {zero = 0;}
    else {zero = zero * 1.1;}

      
     y.domain([zero,
                d3.max(current_data, function(d) { return d.values.corp[3].dollars_alt; }) * 1.05]);
     y_right.domain([zero *4,
                d3.max(current_data, function(d) { return d.values.corp[3].dollars_alt; }) * 1.05 *4]);
                
    zero_rule.attr("y1", y(0)).attr("y2", y(0));


    var metrics = group.selectAll(".company").selectAll("rect")
      .data(function(d) { return d.values.corp; });
    
      
    metrics.attr("width", x_corp.rangeBand())
      .attr("x", function(d) { return x_corp(d.metric); })
      .attr("y", function(d) { if (d.dollars_alt<0) return y(0);
        else {return y(d.dollars_alt);}
        })
      .attr("height", function(d) { if (d.dollars_alt < 0) return (y(d.dollars_alt) - y(0));
        else { return y(0) - y(d.dollars_alt); }
        })
      .style("opacity", 1)
      .style("fill", function(d) { return colors_income(d.metric); });

      yAxis.tickFormat(dollars);
      yAxis_right.tickFormat(dollars);
      axis_y.call(yAxis);
      axis_y_right
        .attr("transform", "translate(" + width + ", 0)")
        .call(yAxis_right);

 
}

  function inc_qu_un_slider_toggle(){ //called only on toggle from override = "no", to implement transition

  
    var zero = d3.min(current_data, function(d) { return d.values.corp[0].dollars_alt; });
    if (zero >= 0) {zero = 0;}
    else {zero = zero * 1.1;}

      
     y.domain([zero,
                d3.max(current_data, function(d) { return d.values.corp[3].dollars_alt; }) * 1.05]);
     y_right.domain([zero *4,
                d3.max(current_data, function(d) { return d.values.corp[3].dollars_alt; }) * 1.05 *4]);
                
    zero_rule.transition().duration(3000).attr("y1", y(0)).attr("y2", y(0));


    var metrics = group.selectAll(".company").selectAll("rect")
      .data(function(d) { return d.values.corp; });
    
      
      metrics.transition().duration(3000)
      .attr("width", x_corp.rangeBand())
      .attr("x", function(d) { return x_corp(d.metric); })
      .attr("y", function(d) { if (d.dollars_alt<0) return y(0);
        else {return y(d.dollars_alt);}
        })
      .attr("height", function(d) { if (d.dollars_alt < 0) return (y(d.dollars_alt) - y(0));
        else { return y(0) - y(d.dollars_alt); }
        })
      .style("opacity", 1)
      .style("fill", function(d) { return colors_income(d.metric); });

      yAxis.tickFormat(dollars);
      yAxis_right.tickFormat(dollars);
      axis_y.transition().duration(3000).call(yAxis);
      axis_y_right.transition().duration(3000)
        .attr("transform", "translate(" + width + ", 0)")
        .call(yAxis_right);

 
}

    
// END OF LEFt SIDE DISPLAY -- MAIN GRAPH and Legends (above) and Bar Sort Controls and Pie Charts (below)



//  START OF MAIN_CONTROLS BLOCK -- Between Left side (main graph, legends and sort controls)  and Right side (side graph and toggled side graphs mode list -- text panel)


        
var main_controls = svg.append("g")
    .attr("transform", "translate(800, 0)")
    .style("visibility", "hidden");

    


    //  COMPANY LABEL  SELECTiON
    
//full list
    
var selections_scale = d3.scale.ordinal()
    .rangePoints([0,(data.length * 16)],0)
    .domain(data.map(function(d){return d.company;}));
    
main_controls.append("text")
      //.style("font-style","italic")
      .classed("label", true)
      .attr("transform", "translate(25, 0)")
      .text("SELECT");
 
var company_labels = main_controls.append("g")
    .attr("transform", "translate(40, 20)")
    .classed("main_controls", true);

var selections = company_labels.selectAll("label")
      .data(data)
      .enter().append("text")
      .attr("x", 0)
      .attr("y", function(d) { return selections_scale(d.company) - 3 ;})
      .style("opacity", function(d) {
          if (d.selected == "yes") {return 1;}
          else {return .6;}
      })
      .style("font-weight", function(d) {
          if (d.selected == "yes") {return "700";}
          else {return "400";}
        })
      .style("font-style", function(d) {
          if (d.selected == "yes") {return "italic";}
          else {return "normal";}
        })
      .style("cursor", "pointer")
      .classed("label", true)
      .style("font-size", "13px")
      .text(function (d) {return d.company;})
      .on("mouseover", function() {
            showCompanyName(d3.select(this));}  )
      .on("mouseout", function() {
            hideCompanyName(d3.select(this));}  )
      .on("click", function() {
            toggle_selection(d3.select(this));}  );

var company_tooltip = company_labels.append("text")
      .style("visibility", "hidden")
      .classed("label", true);
            
function showCompanyName(d)
  {
    company_tooltip.text(d.datum().name);
    company_tooltip.attr("y", d.attr("y"));
    company_tooltip.attr("dx", 40);
    company_tooltip.style("visibility", "visible");
    group_select.style("visibility", "hidden");
    group_select_labels.style("visibility", "hidden");
    company_sort_group.style("visibility", "hidden");
    company_labels_info.style("visibility", "hidden");
  }
    
function hideCompanyName(d)
  {

    company_tooltip.style("visibility", "hidden");
    group_select.style("visibility", "visible");
    group_select_labels.style("visibility", "visible");
    company_sort_group.style("visibility", "visible");
    company_labels_info.style("visibility", "visible");
  }
  
var company_labels_info = main_controls.append("g")
    .attr("transform", "translate(120, 20)")
    .classed("label", true);
    
var selections_info_head = company_labels_info.append("text")
    .attr("y",-20)
    .style("font-size", "13px")
    .attr("text-anchor", "end")
    .text("");
    
var selections_info = company_labels_info.selectAll("label")
      .data(data)
      .enter().append("text")
      .attr("x", 0)
      .attr("y", function(d) { return selections_scale(d.company) - 4 ;})
      .style("opacity", function(d) {
          if (d.selected == "yes") {return 1;}
          else {return .6;}
      })
      .style("font-weight", function(d) {
          if (d.selected == "yes") {return "700";}
          else {return "400";}
        })
      .style("font-style", function(d) {
          if (d.selected == "yes") {return "italic";}
          else {return "normal";}
        })
      .style("cursor", "pointer")
      .style("font-size", "13px")
      .attr("text-anchor", "end")
      .text("");
      
      
// lines display is now hidden
var selections_info_lines_root = main_controls.append("g")
    .attr("transform", "translate(0, 20)")
    .style("visibility", "hidden");


var info_lines_scale = d3.scale.linear()
    .range([0, 110]);


var selections_info_lines = selections_info_lines_root.selectAll("l")
      .data(data)
      .enter().append("line")
      .attr("y1", function(d) { return selections_scale(d.company) ;})
      .attr("y2", function(d) { return selections_scale(d.company) ;})
      .attr("x1", 0)
      .attr("x2", 0)
      .style("stroke", clr_oil)
      .style("shape-rendering", "crispEdges")
      .style("stroke-width", "2");

  

//group selections


var group_select_array = [

  "CLEAR ALL",
  "SELECT ALL",
  "Bakken/Three Forks",
  "Barnett Shale",
  "Canada Bitumen",
  "Canada Shales",
  "DJ/Powder River",
  "Eagle Ford",
  "Eagle Ford (East)",
  "East Texas/Haynesville",
  "Fayetteville",
  "Gulf of Mexico",
  "International(+)",
  "Marcellus/Utica",
  "Mid-Continent",
  "Permian (Delaware)",
  "Permian (Midland)",
  "Permian (Other)",
  "San Juan/Raton Basins",
  "Tuscaloosa",
  "Western Rockies"
];


var selected_group = ""; //name of currently selected group

var group_select_scale = d3.scale.ordinal()
    .rangePoints([0,group_select_array.length * 16],0)
    .domain(group_select_array);

var group_select = main_controls.append("g")
    .classed("label", true)
    .attr("transform", "translate( 150, 280 )");
    
    group_select.append("text")
      .style("font-style","italic")
     .text("GROUP SELECTIONS:");
    
var group_select_labels = group_select.append("g")
      .attr("transform", "translate(0, 20)")
      .selectAll("label")
      .data(group_select_array)
      .enter().append("text")
      .attr("x", 0)
      .attr("y", function(d) { return group_select_scale(d) ;})
      .style("cursor", "pointer")
      .classed("label", true)
      .style("font-size", "15px")
      .text(function (d) {return d;})
      .on("click", group_selection);
      
      
    //SELECTION FUNCTIONS
      
function toggle_selection(th) {
  
  var t = th.text();

      //if selected, deselect and dim label
      
  if (th.style("opacity") == 1) {
    data.forEach(function(d) {if (d.company == t){d.selected = "no";}});
    th.style("opacity", .6);
    }
      
      //if unselected, select and darken label
      
  else  {
    data.forEach(function(d) {if (d.company == t){d.selected = "yes";}});
    th.style("opacity", 1);
  }
      
  post_selection();
}
      


function group_selection(t) {
  
      if (t == "CLEAR ALL") {
        data.forEach(function(d) {d.selected = "no";});
        }
        
      else if (t == "SELECT ALL") {
        data.forEach(function(d) {d.selected = "yes";});
        }
          
      else {
        
        data.forEach(function(d) {
          if (d.groups.indexOf(t) == -1) {d.selected = "no";}
          else {d.selected = "yes";}
        });
      }

  post_selection();
  

}
       
function post_selection() {
// refilter to update for only currently selected companies
  current_data  = data.filter(selector);

// sort companies (which calls g_level) and then call mode function to draw rects
  loadSelected();
  
    selections.style("opacity", function(d) {
      if (d.selected == "yes") {return 1;}
      else {return .6;}
        })
      .style("font-weight", function(d) {
          if (d.selected == "yes") {return "700";}
          else {return "400";}
        })
      .style("font-style", function(d) {
          if (d.selected == "yes") {return "italic";}
          else {return "normal";}
        });

  
     selections_info.style("opacity", function(d) {
          if (d.selected == "yes") {return 1;}
          else {return .6;}
        })
     .style("font-weight", function(d) {
          if (d.selected == "yes") {return "700";}
          else {return "400";}
        })
      .style("font-style", function(d) {
          if (d.selected == "yes") {return "italic";}
          else {return "normal";}
        });

}

function loadSelected() {
  
  sort();

  switch(mode) {
    case "PROD_S":
        prod_s();
        break;
    case "PROD_UN":
        prod_un();
        break;
    case "REV_S":
        rev_s();
        break;
    case "REV_UN":
        rev_un();
        break;
    case "PRICE_S":
        price_s();
        break;
    case "PRICE_UN":
        price_un();
        break;
    case "INC_QU_S":
        inc_qu_s();
        break;
    case "INC_QU_UN":
        if (override == "yes") {
          current_data.forEach(changePrice);
          inc_qu_un();
          inc_qu_un_slider_toggle();}
        else {inc_qu_un();}
        break;
    case "INC_BOE_S":
        inc_boe_s();
        break;
    case "INC_BOE_UN":
        inc_boe_un();
        break;
    case "INC_PERC_S":
        inc_perc_s();
        break;
    case "INC_PERC_UN":
        inc_perc_un();
        break;
    case "RESERVES_UN":
        reserves_un();
        break;
    case "RESERVES_S":
        reserves_s();
        break;
    case "CAPEX":
        capex();
        break;
    case "HEDGE":
        hedge();
        break;
    case "HEDGE_BOE":
        hedge_boe();
        break;
    case "DEBT_EBITDA":
        debt_ebitda();
        break;
    case "EV":
        ev();
        break;
    case "EV_EBITDA":
        ev_ebitda();
        break
    case "PR_DASHARE":
        pr_dashare();
        break;
    case "PROD_DASHARE":
        prod_dashare();
        break;
}

}


// END OF SELECTION BLOCK
          
      
 //  END COMPANY LABEL SELECTION BLOCK
      
//   COMPANY LABEL SORTING BLOCK


    
var company_sort_order = "ABC";

var company_sort_array = [

  "ABC",
  "TOTAL PRODUCTION",
  "OIL PRODUCTION",
  "NGL PRODUCTION",
  "LIQUIDS PRODUCTION",
  "GAS PRODUCTION",
  "TOTAL REVENUE",
  "OIL REVENUE",
  "NGL REVENUE",
  "LIQUIDS REVENUE",
  "GAS REVENUE",
  "PROVED RESERVES",
  "E&P CAPEX",
  "ENTERPRISE VALUE (EV)"

];

var company_sort_scale = d3.scale.ordinal()
    .rangePoints([0,company_sort_array.length * 15],0)
    .domain(company_sort_array);
    

var company_sort_group = main_controls.append("g")
    .classed("label", true)
    .attr("transform", "translate( 150, 0 )");
    
     company_sort_group.append("text")
      .style("font-style","italic")
      .text("SORT FIRMS by:");
    
var company_sort_labels = company_sort_group.append("g")
      .attr("transform", "translate(0, 20)")
      .selectAll("label")
      .data(company_sort_array)
      .enter().append("text")
      .attr("x", 0)
      .attr("y", function(d) { return company_sort_scale(d) ;})
      .classed("label", true)
      .style("font-size", "13px")
      .style("opacity", function(d) {
        if (d == company_sort_order) {return 1.0;}
        else {return .6;}
      })
      .style("font-weight", function(d) {
          if (d == company_sort_order) {return "700";}
          else {return "400";}
        })
      .style("font-style", function(d) {
          if (d == company_sort_order) {return "italic";}
          else {return "normal";}
        })
      .style("cursor", "pointer")
      .text(function (d) {return d;})
      .on("click", sort_select);
      
     

function sort_select(tt) {
  
  var data_temp;
  company_labels_info.style("visibility", "visible");

   switch(tt) {
     
    case "ABC":
      data_temp = data.sort(function(a, b) { return d3.ascending(a.company, b.company); });
      company_sort_order = "ABC";
      break;
    case "TOTAL PRODUCTION":
      data_temp = data.sort(function(a, b) { return b.prod_total - a.prod_total; });
      company_sort_order = "TOTAL PRODUCTION";
      break;
    case "OIL PRODUCTION":
      data_temp = data.sort(function(a, b) { return b.values.prods[0].mboed - a.values.prods[0].mboed; });
      company_sort_order = "OIL PRODUCTION";
      break;
    case "NGL PRODUCTION":
      data_temp = data.sort(function(a, b) { return b.values.prods[1].mboed - a.values.prods[1].mboed; });
      company_sort_order = "NGL PRODUCTION";
      break;
    case "LIQUIDS PRODUCTION":
      data_temp = data.sort(function(a, b) { return (b.values.prods[1].mboed + b.values.prods[0].mboed) - ( a.values.prods[1].mboed  + a.values.prods[0].mboed); });
      company_sort_order = "LIQUIDS PRODUCTION";
      break;
    case "GAS PRODUCTION":
      data_temp = data.sort(function(a, b) { return b.values.prods[2].mboed - a.values.prods[2].mboed; });
      company_sort_order = "GAS PRODUCTION";
      break;
    case "TOTAL REVENUE":
      data_temp = data.sort(function(a, b) { return b.rev_total - a.rev_total; });
      company_sort_order = "TOTAL REVENUE";
      break;
    case "OIL REVENUE":
      data_temp = data.sort(function(a, b) { return (b.values.prods[0].mboed * b.values.prods[0].price) - ( a.values.prods[0].mboed  * a.values.prods[0].price); });
      company_sort_order = "OIL REVENUE";
      break;
    case "NGL REVENUE":
      data_temp = data.sort(function(a, b) { return (b.values.prods[1].mboed * b.values.prods[1].price) - ( a.values.prods[1].mboed  * a.values.prods[1].price); });
      company_sort_order = "NGL REVENUE";
      break;
    case "LIQUIDS REVENUE":
      data_temp = data.sort(function(a, b) { return ((b.values.prods[1].mboed * b.values.prods[1].price) + (b.values.prods[0].mboed * b.values.prods[0].price   )) - ( (a.values.prods[1].mboed  * a.values.prods[1].price) + (a.values.prods[0].mboed  * a.values.prods[0].price)) ; });
      company_sort_order = "LIQUIDS REVENUE";
      break;
    case "GAS REVENUE":
      data_temp = data.sort(function(a, b) { return (b.values.prods[2].mboed * b.values.prods[2].price) - ( a.values.prods[2].mboed  * a.values.prods[2].price); });
      company_sort_order = "GAS REVENUE";
      break;
    case "PROVED RESERVES":
      data_temp = data.sort(function(a, b) { return b.pr_total - a.pr_total; });
      company_sort_order = "PROVED RESERVES";
      break;
    case "E&P CAPEX":
      data_temp = data.sort(function(a, b) { return b.capex[0].value - a.capex[0].value; });
      company_sort_order = "E&P CAPEX";
      break;
    case "ENTERPRISE VALUE (EV)":
      data_temp = data.sort(function(a, b) { return ((b.ev[0].value + b.ev[1].value) - (a.ev[0].value + a.ev[1].value)) });
      company_sort_order = "EV";
      console.log(data_temp);
      break;
  } // end of switch

   selections_scale.domain(data_temp.map(function(d) { return d.company; }));
   selections.transition().duration(1500).attr("y", function(d) { return selections_scale(d.company) -3 ;});
   selections_info.transition().duration(1500).attr("y", function(d) { return selections_scale(d.company) - 4;});
   selections_info_lines.attr("y1", function(d) { return selections_scale(d.company) ;});
   selections_info_lines.attr("y2", function(d) { return selections_scale(d.company) ;});
  
    company_sort_labels.style("opacity", function(d) {
        if (d == company_sort_order) {return 1.0;}
        else {return .6;}
        })
        .style("font-weight", function(d) {
          if (d == company_sort_order) {return "700";}
          else {return "400";}
        })
      .style("font-style", function(d) {
          if (d == company_sort_order) {return "italic";}
          else {return "normal";}
        });
    
  switch(company_sort_order) {
    case "ABC":
        selections_info.text("");
        selections_info_head.text("");
        info_lines_scale.domain([0,0]);
        selections_info_lines.attr("x2",0);
        selections_info_lines.style("stroke", "black");
        break;
    case "TOTAL PRODUCTION":
        selections_info.text( function(d) {return d3.round(d.prod_total,1);} );
        selections_info_head.text("mboe/d");
        info_lines_scale.domain([0,d3.max(data, function(d) { return d.prod_total; })]);
        selections_info_lines.attr("x2", function(d) { return info_lines_scale(d.prod_total) ;} )
        selections_info_lines.style("stroke", "black");
        break;
    case "OIL PRODUCTION":
        selections_info.text( function(d) {return d3.round(d.values.prods[0].mboed,1);} );
        selections_info_head.text("mbo/d");
        info_lines_scale.domain([0,d3.max(data, function(d) { return d.values.prods[0].mboed; })]);
        selections_info_lines.attr("x2", function(d) { return info_lines_scale(d.values.prods[0].mboed) ;} )
        selections_info_lines.style("stroke", clr_oil);
        break;
    case "NGL PRODUCTION":
        selections_info.text( function(d) {return d3.round(d.values.prods[1].mboed,1);} );
        selections_info_head.text("mbngl/d");
        info_lines_scale.domain([0,d3.max(data, function(d) { return d.values.prods[1].mboed; })]);
        selections_info_lines.attr("x2", function(d) { return info_lines_scale(d.values.prods[1].mboed) ;} )
        selections_info_lines.style("stroke", clr_ngl);
        break;
    case "LIQUIDS PRODUCTION":
        selections_info.text( function(d) {return d3.round(d.values.prods[0].mboed + d.values.prods[1].mboed,1);} );
        selections_info_head.text("mboe/d");
        info_lines_scale.domain([0,d3.max(data, function(d) { return d.values.prods[0].mboed + d.values.prods[1].mboed; })]);
        selections_info_lines.attr("x2", function(d) { return info_lines_scale(d.values.prods[0].mboed + d.values.prods[1].mboed) ;} )
        selections_info_lines.style("stroke", "orange");
        break;
    case "GAS PRODUCTION":
        selections_info.text( function(d) {return d3.round(d.values.prods[2].mboed * 6, 1);} );
        selections_info_head.text("mmcf/d");
        info_lines_scale.domain([0,d3.max(data, function(d) { return d.values.prods[2].mboed; })]);
        selections_info_lines.attr("x2", function(d) { return info_lines_scale(d.values.prods[2].mboed) ;} )
        selections_info_lines.style("stroke", clr_gas);
        break;
    case "TOTAL REVENUE":
        selections_info.text( function(d) {return dollars(d3.round(d.rev_total));} );
        selections_info_head.text("millions");
        info_lines_scale.domain([0,d3.max(data, function(d) { return d.rev_total; })]);
        selections_info_lines.attr("x2", function(d) { return info_lines_scale(d.rev_total) ;} )
        selections_info_lines.style("stroke", "black");
        break;
    case "OIL REVENUE":
        selections_info.text( function(d) {return dollars(d3.round(d.values.prods[0].mboed * d.values.prods[0].price / 1000 * 92));} );
        selections_info_head.text("millions");
        info_lines_scale.domain([0,d3.max(data, function(d) { return d.values.prods[0].mboed * d.values.prods[0].price; })]);
        selections_info_lines.attr("x2", function(d) { return info_lines_scale(d.values.prods[0].mboed * d.values.prods[0].price) ;} )
        selections_info_lines.style("stroke", clr_oil);
        break;
    case "NGL REVENUE":
        selections_info.text( function(d) {return dollars(d3.round(d.values.prods[1].mboed * d.values.prods[1].price / 1000 * 92));} );
        selections_info_head.text("millions");
        info_lines_scale.domain([0,d3.max(data, function(d) { return d.values.prods[1].mboed * d.values.prods[1].price; })]);
        selections_info_lines.attr("x2", function(d) { return info_lines_scale(d.values.prods[1].mboed * d.values.prods[1].price) ;} )
        selections_info_lines.style("stroke", clr_ngl);
        break;
    case "LIQUIDS REVENUE":
        selections_info.text( function(d) {return dollars(d3.round( ((d.values.prods[0].mboed  * d.values.prods[0].price) + (d.values.prods[1].mboed  * d.values.prods[1].price)) / 1000 * 92));} );
        selections_info_head.text("millions");
        info_lines_scale.domain([0,d3.max(data, function(d) { return (d.values.prods[0].mboed  * d.values.prods[0].price) + (d.values.prods[1].mboed  * d.values.prods[1].price); })]);
        selections_info_lines.attr("x2", function(d) { return info_lines_scale((d.values.prods[0].mboed  * d.values.prods[0].price) + (d.values.prods[1].mboed  * d.values.prods[1].price)) ;} )
        selections_info_lines.style("stroke", "orange");
        break;
    case "GAS REVENUE":
        selections_info.text( function(d) {return dollars(d3.round(d.values.prods[2].mboed * d.values.prods[2].price / 1000 *92));} );
        selections_info_head.text("millions");
        info_lines_scale.domain([0,d3.max(data, function(d) { return d.values.prods[2].mboed * d.values.prods[2].price; })]);
        selections_info_lines.attr("x2", function(d) { return info_lines_scale(d.values.prods[2].mboed * d.values.prods[2].price) ;} )
        selections_info_lines.style("stroke", clr_gas);
        break;
    case "PROVED RESERVES":
        selections_info.text( function(d) {return d3.round(d.pr_total);} );
        selections_info_head.text("mmboe");
        info_lines_scale.domain([0,d3.max(data, function(d) { return d.pr_total; })]);
        selections_info_lines.attr("x2", function(d) { return info_lines_scale(d.pr_total) ;} )
        selections_info_lines.style("stroke", "brown");
        break;
      case "E&P CAPEX":
        selections_info.text( function(d) {return dollars(d3.round(d.capex[0].value));}    );
        selections_info_head.text("millions");
        info_lines_scale.domain([0,d3.max(data, function(d) { return d.capex[0].value; })]);
        selections_info_lines.attr("x2", function(d) { return info_lines_scale(d.capex[0].value) ;} )
        selections_info_lines.style("stroke", "brown");
        break;
     case "EV":
        selections_info.text( function(d) {return dollars(d3.round(d.ev[0].value + d.ev[1].value));} );
        selections_info_head.text("millions");
        info_lines_scale.domain([0,d3.max(data, function(d) {return d.ev[0].value + d.ev[1].value;})]);
        selections_info_lines.attr("x2", function(d) { return info_lines_scale(d.ev[0].value + d.ev[1].value) ;} )
        selections_info_lines.style("stroke", "brown");
        break;
    };





  //IS the following needed here?  Think it out and get rid of it is not needed
  // definitely need in postSelection(), to refelct select/deselect of companies, because the info opacity must reflect company selection status
  // But here companies are only being sorted (not selected/deselcted) and the info changed to reflect the sort.
  
  
      selections_info.style("opacity", function(d) {
          if (d.selected == "yes") {return 1;}
          else {return .6;}
      })
        
  
}

//  END COMPANY LABEL SORTING BLOCK

   
    
    

// MODE SWITCHING BLOCK

var modes_array = [
        {"text":"Production by Product", "mode": "PROD_UN"},
        {"text":"Production Totaled", "mode": "PROD_S"},
        {"text":"Revenue by Product", "mode":"REV_UN"},
        {"text":"Revenue Totaled","mode": "REV_S"},
        {"text":"Price by Product", "mode":"PRICE_UN"},
        {"text":"Boe/Mcfe Price", "mode": "PRICE_S"},
        {"text":"Income Metrics", "mode": "INC_QU_UN"},
        {"text":"Cost Metrics", "mode": "INC_QU_S"},
        {"text":"Unit Income Metrics", "mode": "INC_BOE_UN"},
        {"text":"Unit Cost Metrics", "mode": "INC_BOE_S"},
        {"text":"Percentage Income Metrics", "mode": "INC_PERC_UN"},
        {"text":"Percentage Cost Metrics", "mode": "INC_PERC_S"},
        {"text":"Proved Reserves Analyzed", "mode": "RESERVES_UN"},
        {"text":"Proved Reserves Totaled", "mode": "RESERVES_S"},
        {"text":"E&P Capital Expenditures", "mode": "CAPEX"},
        {"text":"Hedge Percentage Impact", "mode": "HEDGE"},
        {"text":"Hedge Unit Impact", "mode": "HEDGE_BOE"},
        {"text":"Net Debt/EBITDA Ratio", "mode": "DEBT_EBITDA"},
        {"text":"Enterprise Value (EV)", "mode": "EV"},
        {"text":"EV/EBITDA Ratio", "mode": "EV_EBITDA"},
        {"text":"Reserves per D/A Share", "mode": "PR_DASHARE"},
        {"text":"Production per D/A Share", "mode": "PROD_DASHARE"}
        ];

var modes_scale = d3.scale.ordinal()
    .rangePoints([0,310],0)
    .domain(modes_array.map(function(d){return d.text;}));
    

var modes = svg.append("g")
    .attr("transform", "translate(720, 500)")
    .classed("label", true);
    
var mode_switch_label = modes.append("g")
      .on("click", function() {
        
        //if main select state -- swith to side select state
        if (mode_select_state == "main") {
          modes_toggle.text("SIDE GRAPH MODES");
          mode_select_state = "side";

      mode_labels.style("opacity", function(d) {

        if (d.text == mode_labels[0][mode_index_side].textContent) {return 1.0;}
        else {return .6;}
        })
        .style("font-weight", function(d) {
        if (d.text == mode_labels[0][mode_index_side].textContent) {return "700";}
        else {return "400";}
        })
        .style("font-style", function(d) {
          if (d.text == mode_labels[0][mode_index_side].textContent) {return "italic";}
          else {return "normal";}
        });

        } // end of if
        //if side select state, switch to main select state
        else {
          modes_toggle.text("MAIN GRAPH MODES");
          mode_select_state = "main";
          
        mode_labels.style("opacity", function(d) {
        if (d.text == mode_labels[0][mode_index].textContent) {return 1.0;}
        else {return .6;}
        })
        .style("font-weight", function(d) {
        if (d.text == mode_labels[0][mode_index].textContent) {return "700";}
        else {return "400";}
        })
        .style("font-style", function(d) {
          if (d.text == mode_labels[0][mode_index].textContent) {return "italic";}
          else {return "normal";}
        });
 
          
        }// end of else
        
      });//end of mode toggle button root with its click handler
    
mode_switch_label.append("rect")
    .attr("x", -2)
    .attr("y", -22 )
    .attr("width", 165)
    .attr("height", 35)
    .style("fill", "rgb(170,170,170)");
    
mode_switch_label.append("rect")
    .attr("x", 0)
    .attr("y", -20 )
    .attr("width", 160 )
    .attr("height", 30 )
    .style("fill", "black");
    
var modes_toggle = mode_switch_label.append("text")
      .attr("x", 80)
      .style("fill", "white")
      .style("font-weight", "900")
      .attr("text-anchor", "middle")
      .text("MAIN GRAPH MODES")
      .style("cursor", "pointer");

    
var mode_labels = modes.append("g")
      .attr("transform", "translate(0, 35)")
      .selectAll("label")
      .data(modes_array)
      .enter().append("text")
      .attr("x", 0)
      .attr("y", function(d) { return modes_scale(d.text) ;})
      .style("font-size", "15px")
      .style("opacity", function(d) {
        if (d.text == "Production by Product") {return 1.0;}
        else {return .6;}
      })
      .style("font-weight", function(d) {
          if (d.text == "Production by Product") {return "700";}
          else {return "400";}
        })
      .style("font-style", function(d) {
          if (d.text == "Production by Product") {return "italic";}
          else {return "normal";}
        })
      .style("cursor", "pointer")
      .text(function (d) {return d.text;})
      .on("click", function() {
            modeSwitch(d3.select(this).text());}  );
            
var mode_index = 0;
var mode_select_state = "main";

function modeSwitch(text) {
   order = "abc";// change order before calling mode functions
   
  if (mode_select_state == "main")
  {
  
  mode_labels.style("opacity", function(d) {
    if (d.text == text) {return 1.0;}
    else {return .6;}
    })
    .style("font-weight", function(d) {
        if (d.text == text) {return "700";}
        else {return "400";}
      })
      .style("font-style", function(d) {
          if (d.text == text) {return "italic";}
          else {return "normal";}
        });
  //hide slider unless income metrics mode
  price_axis_root_oil.style("visibility", "hidden");
    switch(text) {
    case "Production by Product":
        mode_index = 0;
        prod_un();
        swapPieCharts("yes");
        break;
    case "Production Totaled":
        mode_index = 1;
        prod_s();
        swapPieCharts("yes");
        break;
    case "Revenue by Product":
        mode_index = 2;
        rev_un();
        swapPieCharts("yes");
        break;
    case "Revenue Totaled":
        mode_index = 3;
        rev_s();
        swapPieCharts("yes");
        break;
    case "Price by Product":
        mode_index = 4;
        price_un();
        swapPieCharts("yes");
        break;
    case "Boe/Mcfe Price":
        mode_index = 5;
        price_s();
        swapPieCharts("yes");
        break;
    case "Income Metrics":
        mode_index = 6;
        if (override == "yes") {inc_qu_un(); inc_qu_un_slider_toggle();}
        else {inc_qu_un();}
        swapPieCharts("no");
        price_axis_root_oil.style("visibility", "visible");
        break;
    case "Cost Metrics":
        mode_index = 7;
        inc_qu_s();
        swapPieCharts("no");
        break;
    case "Unit Income Metrics":
        mode_index = 8;
        inc_boe_un();
        swapPieCharts("no");
        break;
    case "Unit Cost Metrics":
        mode_index = 9;
        inc_boe_s();
        swapPieCharts("no");
        break;
    case "Percentage Income Metrics":
        mode_index = 10;
        inc_perc_un();
        swapPieCharts("no");
        break;
    case "Percentage Cost Metrics":
        mode_index = 11;
        inc_perc_s();
        swapPieCharts("no");
        break;
    case "Proved Reserves Analyzed":
        mode_index = 12;
        reserves_un();
        swapPieCharts("yes");
        break;
    case "Proved Reserves Totaled":
        mode_index = 13;
        reserves_s();
        swapPieCharts("yes");
        break;
    case "E&P Capital Expenditures":
        mode_index = 14;
        swapPieCharts("yes");
        capex();
        break;
    case "Hedge Percentage Impact":
        mode_index = 15;
        hedge();
        break;
    case "Hedge Unit Impact":
        mode_index = 16;
        hedge_boe();
        break;
    case "Net Debt/EBITDA Ratio":
        mode_index = 17;
        debt_ebitda();
        break;
    case "Enterprise Value (EV)":
        mode_index = 18;
        ev();
        break;
    case "EV/EBITDA Ratio":
        mode_index = 19;
        ev_ebitda();
        break;
    case "Reserves per D/A Share":
        mode_index = 20;
        pr_dashare();
        break;
    case "Production per D/A Share":
        mode_index = 21;
        prod_dashare();
        break;
    }

  reset_legends();
  
  }// end of if main
  
  else  // if side
  {
    modeSwitch_side(text);
  } // end of if side
}


// info show button underneath mode list

var info_button = modes.append("g")
    .attr("transform", "translate( 2, 375)")
    .style("visibility", "hidden")
    .on("click", function() {
      red_slide_root.style("visibility", "visible");
      info_button.style("visibility", "hidden");
    });

info_button.append("rect")
    .attr("x", -2)
    .attr("y", -22 )
    .attr("width", 164 )
    .attr("height", 34 )
    .style("fill", clr_oil);
    
info_button.append("rect")
    .attr("x", 0)
    .attr("y", -20 )
    .attr("width", 160 )
    .attr("height", 30 )
    .style("fill", "white");
    
info_button.append("text")
      .attr("x", 80)
      .style("fill", "black")
      .style("font-weight", "900")
      .attr("text-anchor", "middle")
      .text("SHOW INFO PANEL")
      .style("cursor", "pointer");

function swapPieCharts(first) {
  
  if (first == "yes") {
    
        pie_charts_root_cost.style("visibility", "hidden");
        pie_charts_root_inc.style("visibility", "hidden");
        pie_charts_root_prod.style("visibility", "visible");
        pie_charts_root_rev.style("visibility", "visible");
        pie_charts_root_pr.style("visibility", "visible");
        links_root.attr("transform", "translate(0, 140)");
    
  }
  else {
    
        pie_charts_root_cost.style("visibility", "visible");
        pie_charts_root_inc.style("visibility", "visible");
        pie_charts_root_prod.style("visibility", "hidden");
        pie_charts_root_rev.style("visibility", "hidden");
        pie_charts_root_pr.style("visibility", "hidden");
        if(mode_index == 6){
        pie_charts_root_cost.attr("transform", "translate(400,85)");
        pie_charts_root_inc.attr("transform", "translate(150,85)");
        links_root.attr("transform", "translate(0, 235)");
        }
        else {
        pie_charts_root_cost.attr("transform", "translate(450,0)");
        pie_charts_root_inc.attr("transform", "translate(200,0)");
        links_root.attr("transform", "translate(0, 140)");
        }
    
  }
  
  
}
  



function prod_un() {

  mode = "PROD_UN";

    y.domain([0, (d3.max(current_data, function(d) { return d3.max(d.values.prods, function(d) {return d.mboed;}) })) * 1.05]);
    y_right.domain([0,(d3.max(current_data, function(d) { return d3.max(d.values.prods, function(d) {return d.mboed;}) })) * 1.05 * 6]);

    zero_rule.transition().duration(3000).attr("y1", y(0)).attr("y2", y(0));
     
    var products = group.selectAll(".company").selectAll("rect")
      .data(function(d) { return d.values.prods; });
      
      
    products.enter().append("rect")
      .attr("y",height)
      .attr("height", 0)
      .style("opacity", 0)
      .on("mouseover", show_rule);
              
    products.exit().transition().duration(3000)
    .attr("y",height)
    .attr("height", 0)
    .remove();
   
    products.transition().duration(3000)
      .attr("width", x_prods.rangeBand())
      .attr("x", function(d) { return x_prods(d.product); })
      .attr("y", function(d) { return y(d.mboed); })
      .attr("height", function(d) { return height - y(d.mboed); })
      .style("opacity", 1)
      .style("fill", function(d) { return colors_prods(d.product); });
  

      yAxis.tickFormat(null);
      yAxis_right.tickFormat(null);
      axis_y.transition().duration(3000)
        .call(yAxis);
      axis_y_right.transition().duration(3000)
        .attr("transform", "translate(" + width + ", 0)")
        .call(yAxis_right);
      axis_label.text("boe/day (thousands)");
      axis_label_right.text("mcfe/day (thousands)");
      
      

    leg_text_mode.text("Average Daily Production in Q2 2015 by product");
  
}
  
function prod_s() {


mode = "PROD_S";

       y.domain([0,d3.max(current_data, function(d) { return d.prod_total; }) * 1.05]);
       y_right.domain([0,d3.max(current_data, function(d) { return d.prod_total; })  * 1.05 * 6]);

    zero_rule.transition().duration(3000).attr("y1", y(0)).attr("y2", y(0));

    var products = group.selectAll(".company").selectAll("rect")
      .data(function(d) { return d.values.prods; });
      
      
    products.enter().append("rect")
      .attr("y",height)
      .attr("height", 0)
      .style("opacity", 0)
      .on("mouseover", show_rule);
              
    products.exit().transition().duration(3000)
    .attr("y",height)
    .attr("height", 0)
    .style("opacity", 0)
    .remove();

      
      var base = 0;
      
      products.transition().duration(3000)
      .attr("width", x.rangeBand())
      .attr("x", 0)
      .attr("y", function(d) {
        var b = base;
        base += d.mboed;
        if(d.product == "gas") {base = 0;}
       return y(b + d.mboed); })
      .attr("height", function(d) { return height - y( d.mboed); })
      .style("opacity", 1)
      .style("fill", function(d) { return colors_prods(d.product); });

      

      yAxis.tickFormat(null);
      yAxis_right.tickFormat(null);
      axis_y.transition().duration(3000)
        .call(yAxis);
      axis_y_right.transition().duration(3000)
        .attr("transform", "translate(" + width + ", 0)")
        .call(yAxis_right);
      axis_label.text("boe/day (thousands)");
      axis_label_right.text("mcfe/day (thousands)");

    
    leg_text_mode.text("Average Daily Production in Q2 2015 - totaled");
  
  
}

function rev_un() {



  mode = "REV_UN";


       y.domain([0,(d3.max(current_data, function(d) { return d3.max(d.values.prods, function(d) {return (d.mboed * (d.price/1000) * q2);}) })) * 1.05]);
       y_right.domain([0,(d3.max(current_data, function(d) { return d3.max(d.values.prods, function(d) {return (d.mboed * (d.price/1000) * q2);}) })) * 1.05 * 4 ]);
       
    zero_rule.transition().duration(3000).attr("y1", y(0)).attr("y2", y(0));
    
    var products = group.selectAll(".company").selectAll("rect")
      .data(function(d) { return d.values.prods; });
      
      
    products.enter().append("rect")
      .attr("y",height)
      .attr("height", 0)
      .style("opacity", 0)
      .on("mouseover", show_rule);
              
    products.exit().transition().duration(3000)
    .attr("y",height)
    .attr("height", 0)
    .style("opacity", 0)
    .remove();
      
    products.transition().duration(3000)
      .attr("width", x_prods.rangeBand())
      .attr("x", function(d) { return x_prods(d.product); })
      .attr("y", function(d) { return y(d.mboed * (d.price/1000) * q2); })
      .attr("height", function(d) { return height - y(d.mboed * (d.price/1000) * q2); })
      .style("opacity", 1)
      .style("fill", function(d) { return colors_prods(d.product); });


      yAxis.tickFormat(dollars);
      yAxis_right.tickFormat(dollars);
      axis_y.transition().duration(3000)
        .call(yAxis);
      axis_y_right.transition().duration(3000)
        .attr("transform", "translate(" + width + ", 0)")
        .call(yAxis_right);
      axis_label.text("$ (millions)    per quarter");
      axis_label_right.text("$ (millions)    annualized");

    leg_text_mode.text("Q2 2015 Production Revenue by product");
  
}

function rev_s() {
  
  mode = "REV_S";
    
    y.domain([0,d3.max(current_data, function(d) { return d.rev_total; }) * 1.05]);
    y_right.domain([0,d3.max(current_data, function(d) { return d.rev_total; }) * 1.05* 4]);
       
    zero_rule.transition().duration(3000).attr("y1", y(0)).attr("y2", y(0));
       
    var products = group.selectAll(".company").selectAll("rect")
      .data(function(d) { return d.values.prods; });
      
      
    products.enter().append("rect")
    .attr("y",height)
    .attr("height", 0)
    .style("opacity", 0)
    .on("mouseover", show_rule);
              
    products.exit().transition().duration(3000)
    .attr("y",height)
    .attr("height", 0)
    .style("opacity", 0)
    .remove();
      
    var base = 0;
    products.transition().duration(3000)
       .attr("width", x.rangeBand())
       .attr("x", 0)
       .attr("y", function(d) {
          var b = base;
          base += d.mboed * (d.price/1000) * q2;
          if(d.product == "gas") {base = 0;}
          return y(b + (d.mboed * (d.price/1000) * q2 )); })
        .attr("height", function(d) { return height - y(d.mboed * (d.price/1000) * q2); })
        .style("opacity", 1)
        .style("fill", function(d) { return colors_prods(d.product); });
  
      yAxis.tickFormat(dollars);
      yAxis_right.tickFormat(dollars);
      axis_y.transition().duration(3000)
        .call(yAxis);
      axis_y_right.transition().duration(3000)
        .attr("transform", "translate(" + width + ", 0)")
        .call(yAxis_right);
      axis_label.text("$ (millions)    per quarter");
      axis_label_right.text("$ (millions)    annualized");
    
    leg_text_mode.text("Q2 2015 Production Revenue - totaled");
  
}

function price_un(){

  mode = "PRICE_UN";

    y.domain([0,(d3.max(current_data, function(d) { return d3.max(d.values.prods, function(d) {return d.price;}) })) * 1.05]);
    y_right.domain([0,(d3.max(current_data, function(d) { return d3.max(d.values.prods, function(d) {return d.price;}) })) * 1.05 / 6]);
       
    zero_rule.transition().duration(3000).attr("y1", y(0)).attr("y2", y(0));

    var products = group.selectAll(".company").selectAll("rect")
      .data(function(d) { return d.values.prods; });
      
      
    products.enter().append("rect")
    .attr("y",height)
    .attr("height", 0)
    .style("opacity", 0)
    .on("mouseover", show_rule);
              
    products.exit().transition().duration(3000)
    .attr("y",height)
    .attr("height", 0)
    .style("opacity", 0)
    .remove();
      
    products.transition().duration(3000)
      .attr("width", x_prods.rangeBand())
      .attr("x", function(d) { return x_prods(d.product); })
      .attr("y", function(d) { return y(d.price); })
      .attr("height", function(d) { return height - y(d.price); })
      .style("opacity", 1)
      .style("fill", function(d) { return colors_prods(d.product); });


      yAxis.tickFormat(dollars);
      yAxis_right.tickFormat(dollars);
      axis_y.transition().duration(3000)
        .call(yAxis);
      axis_y_right.transition().duration(3000)
        .attr("transform", "translate(" + width + ", 0)")
        .call(yAxis_right);
      axis_label.text("$ per boe");
      axis_label_right.text("$ per mcfe");
    
    leg_text_mode.text("Price per Boe/Mcfe, by product");
  
  
}

function price_s(){
  
    mode = "PRICE_S";
       
    y.domain([0,d3.max(current_data, function(d) { return d.boe_price; }) * 1.05]);
    y_right.domain([0,d3.max(current_data, function(d) { return d.boe_price; })  * 1.05 / 6]);
    
    zero_rule.transition().duration(3000).attr("y1", y(0)).attr("y2", y(0));
       

    var products = group.selectAll(".company").selectAll("rect")
      .data(function(d) { return d.values.prods; });
      
      
    products.enter().append("rect")
    .attr("y",height)
    .attr("height", 0)
    .style("opacity", 0)
      .on("mouseover", show_rule);
              
    products.exit().transition().duration(3000)
    .attr("y",height)
    .attr("height", 0)
    .style("opacity", 0)
    .remove();
      
    var base = 0;
    products.transition().duration(3000)
      .attr("width", x.rangeBand())
      .attr("x", 0)
      .attr("y", function(d)
      {
        var b = base;
        base += (d.mboed * d.price) / this.parentNode.__data__.prod_total;
  
        if(d.product == "gas") {base = 0;};
        return y(b + (d.mboed * d.price) / this.parentNode.__data__.prod_total);
      })
      .attr("height", function(d) { return height - y((d.mboed * d.price) / this.parentNode.__data__.prod_total); })
      .style("opacity", 1)
      .style("fill", function(d) { return colors_prods(d.product); });

      yAxis.tickFormat(dollars);
      yAxis_right.tickFormat(dollars);
      axis_y.transition().duration(3000)
        .call(yAxis);
      axis_y_right.transition().duration(3000)
        .attr("transform", "translate(" + width + ", 0)")
        .call(yAxis_right);
      axis_label.text("$ per boe");
      axis_label_right.text("$ per mcfe");
      
    leg_text_mode.text("Boe/Mcfe Unit Price - composite");
}


function inc_qu_un(){
  
   mode = "INC_QU_UN";

    var zero = d3.min(current_data, function(d) { return d.values.corp[0].dollars; });
    if (zero >= 0) {zero = 0;}
    else {zero = zero * 1.1;}

      
     y.domain([zero,
                d3.max(current_data, function(d) { return d.values.corp[3].dollars; }) * 1.05]);
     y_right.domain([zero * 4,
                d3.max(current_data, function(d) { return d.values.corp[3].dollars; }) * 1.05 *4]);
    
    zero_rule.transition().duration(3000).attr("y1", y(0)).attr("y2", y(0));

    var metrics = group.selectAll(".company").selectAll("rect")
      .data(function(d) { return d.values.corp; });
      
      
    metrics.enter().append("rect")
    .attr("y", height)
    .attr("height", 0)
    .style("opacity", 0)
    .on("mouseover", show_rule);
    
              
    metrics.exit().transition().duration(3000)
    .style("opacity", 0)
    .attr("y", height)
    .attr("height", 0)
    .remove();

     metrics.transition().duration(3000)
      .attr("width", x_corp.rangeBand())
      .attr("x", function(d) { return x_corp(d.metric); })
      .attr("y", function(d) { if (d.dollars<0) return y(0);
        else {return y(d.dollars);}
        })
        .attr("height", function(d) { if (d.dollars < 0) return (y(d.dollars) - y(0));
        else { return y(0) - y(d.dollars); }
        })
      .style("opacity", 1)
      .style("fill", function(d) { return colors_income(d.metric); });

      yAxis.tickFormat(dollars);
      yAxis_right.tickFormat(dollars);
      axis_y.transition().duration(3000)
        .call(yAxis);
      axis_y_right.transition().duration(3000)
        .attr("transform", "translate(" + width + ", 0)")
        .call(yAxis_right);
      axis_label.text("$ (millions)    per quarter");
      axis_label_right.text("$ (millions)    annualized");
      
      leg_text_mode.text("Q2 2015 Production Income Metrics");
 
}

function inc_qu_s(){
  
  mode = "INC_QU_S";
      
    var zero = d3.min(current_data, function(d) { return d.values.corp[0].dollars; });
    if (zero >= 0) {zero = 0;}
    else {zero = zero * 1.1;}

      
     y.domain([zero,
                d3.max(current_data, function(d) { return d.values.corp[3].dollars; }) * 1.05]);
     y_right.domain([zero * 4,
                d3.max(current_data, function(d) { return d.values.corp[3].dollars; }) * 1.05 *4]);
       
     
     zero_rule.transition().duration(3000).attr("y1", y(0)).attr("y2", y(0));

    
     var base = 0;
    var metrics = group.selectAll(".company").selectAll("rect")
      .data(function(d) { return d.values.corp; });
      
      
    metrics.enter().append("rect")
    .attr("y", height)
    .attr("height", 0)
    .style("opacity", 0)
    .on("mouseover", show_rule);
              
    metrics.exit().transition().duration(3000)
    .style("opacity", 0)
    .attr("y", height)
    .attr("height", 0)
    .remove();
      

      metrics.transition().duration(3000)
      .attr("width", x.rangeBand())
      .attr("x", 0)
      .attr("y", function(d) {
        var b = base;
          base += d.dif_dollars;
          if(d.metric == "postHedge") {base = 0;}
        return y(b + d.dif_dollars);
      })
      .attr("height", function(d) { if (d.dif_dollars < 0) {return 0;}
         else { return y(0) - y(d.dif_dollars); }
      })
      .style("opacity", 1)
      .style("fill", function(d) { return colors_income_s(d.metric); });

      yAxis.tickFormat(dollars);
      yAxis_right.tickFormat(dollars);
      axis_y.transition().duration(3000)
        .call(yAxis);
      axis_y_right.transition().duration(3000)
        .attr("transform", "translate(" + width + ", 0)")
        .call(yAxis_right);
      axis_label.text("$ (millions)    per quarter");
      axis_label_right.text("$ (millions)    annualized");
      
      leg_text_mode.text("Q2 2015 Production Cost Analysis");
 

}

function inc_boe_un(){
  
   mode = "INC_BOE_UN";
      
    var zero = d3.min(current_data, function(d) { return (d.values.corp[0].percent * d.boe_price_hedged); });
    if (zero >= 0) {zero = 0;}
    else {zero = zero * 1.1;}
      

    y.domain([zero,d3.max(current_data, function(d) { return d.boe_price_hedged; }) * 1.05]);
    y_right.domain([zero/6,d3.max(current_data, function(d) { return d.boe_price_hedged; }) * 1.05 / 6]);
    
    zero_rule.transition().duration(3000).attr("y1", y(0)).attr("y2", y(0));


    var metrics = group.selectAll(".company").selectAll("rect")
      .data(function(d) { return d.values.corp; });
      
      
    metrics.enter().append("rect")
    .attr("y", height)
    .attr("height", 0)
    .style("opacity", 0)
    .on("mouseover", show_rule);
    
              
    metrics.exit().transition().duration(3000)
    .style("opacity", 0)
    .attr("y", height)
    .attr("height", 0)
    .remove();
      
    metrics.transition().duration(3000)
      .attr("width", x_corp.rangeBand())
      .attr("x", function(d) { return x_corp(d.metric); })
      .attr("y", function(d) { if (d.percent * this.parentNode.__data__.boe_price_hedged<0) return y(0);
        else {return y(d.percent * this.parentNode.__data__.boe_price_hedged);}
        })
      .attr("height", function(d) { if (d.percent * this.parentNode.__data__.boe_price_hedged < 0) return (y(d.percent * this.parentNode.__data__.boe_price_hedged) - y(0));
        else { return y(0) - y(d.percent * this.parentNode.__data__.boe_price_hedged); }
        })
      .style("opacity", 1)
      .style("fill", function(d) { return colors_income(d.metric); });
  


      yAxis.tickFormat(dollars);
      yAxis_right.tickFormat(dollars);
      axis_y.transition().duration(3000)
        .call(yAxis);
      axis_y_right.transition().duration(3000)
        .attr("transform", "translate(" + width + ", 0)")
        .call(yAxis_right);
      axis_label.text("$ per boe");
      axis_label_right.text("$ per mcfe");

      leg_text_mode.text("Production Income Metrics - per Barrel Equivalent");
 
}

function inc_boe_s(){
  
  mode = "INC_BOE_S";
      
     var zero = d3.min(current_data, function(d) { return d.values.corp[0].difference * d.boe_price_hedged; });
    if (zero >= 0) {zero = 0;}
    else {zero = zero * 1.1;}
      
     y.domain([zero,
                d3.max(current_data, function(d) { return d.boe_price_hedged; }) * 1.05]);
     y_right.domain([zero/6,
                d3.max(current_data, function(d) { return d.boe_price_hedged; }) * 1.05/6]);
     
     zero_rule.transition().duration(3000).attr("y1", y(0)).attr("y2", y(0));
       

    var base = 0;
    var metrics = group.selectAll(".company").selectAll("rect")
      .data(function(d) { return d.values.corp; });
      
      
    metrics.enter().append("rect")
    .attr("y", height)
    .attr("height", 0)
    .style("opacity", 0)
    .on("mouseover", show_rule);
              
    metrics.exit().transition().duration(3000)
    .style("opacity", 0)
    .attr("y", height)
    .attr("height", 0)
    .remove();
      
    metrics.transition().duration(3000)
      .attr("width", x.rangeBand())
      .attr("x", 0)
      .attr("y", function(d) {
        var b = base;
          base += this.parentNode.__data__.boe_price_hedged * d.difference;
          if(d.metric == "postHedge") {base = 0;}
        return y(b + (this.parentNode.__data__.boe_price_hedged * d.difference));
        
      })
      .attr("height", function(d) { if (this.parentNode.__data__.boe_price_hedged * d.difference < 0) {return 0;} // eliminate negative height rects
            else { return y(0) - y(this.parentNode.__data__.boe_price_hedged * d.difference); }
      })
      .style("opacity", 1)
      .style("fill", function(d) { return colors_income_s(d.metric); });



      yAxis.tickFormat(dollars);
      yAxis_right.tickFormat(dollars);
      axis_y.transition().duration(3000)
        .call(yAxis);
      axis_y_right.transition().duration(3000)
        .attr("transform", "translate(" + width + ", 0)")
        .call(yAxis_right);
      axis_label.text("$ per boe");
      axis_label_right.text("$ per mcfe");

      leg_text_mode.text("Production Cost Analysis - per Barrel Equivalent");

 

}

function inc_perc_un(){
  
   mode = "INC_PERC_UN";

    var zero = d3.min(current_data, function(d) { return (d.values.corp[0].percent); });
    if (zero >= 0) {zero = 0;}
    else {zero = zero * 1.1;}
    
    y.domain([zero, 1.05]);
    y_right.domain([zero, 1.05]);
    
    zero_rule.transition().duration(3000).attr("y1", y(0)).attr("y2", y(0));

    var metrics = group.selectAll(".company").selectAll("rect")
      .data(function(d) { return d.values.corp; });
      
      
    metrics.enter().append("rect")
    .attr("y", height)
    .attr("height", 0)
    .style("opacity", 0)
    .on("mouseover", show_rule);
    
              
    metrics.exit().transition().duration(3000)
    .style("opacity", 0)
    .attr("y", height)
    .attr("height", 0)
    .remove();
      
    metrics.transition().duration(3000)
      .attr("width", x_corp.rangeBand())
      .attr("x", function(d) { return x_corp(d.metric); })
      .attr("y", function(d) { if (d.percent<0) return y(0);
        else {return y(d.percent);}
        })
      .attr("height", function(d) { if (d.percent < 0) return (y(d.percent) - y(0));
        else { return y(0) - y(d.percent); }
        })
      .style("opacity", 1)
      .style("fill", function(d) { return colors_income(d.metric); });

      yAxis.tickFormat(percent);
      yAxis_right.tickFormat(percent);
      axis_y.transition().duration(3000)
        .call(yAxis);
      axis_y_right.transition().duration(3000)
        .attr("transform", "translate(" + width + ", 0)")
        .call(yAxis_right);
      axis_label.text("percent");
      axis_label_right.text("percent");

      leg_text_mode.text("Production Income Metrics - percent of post-hedge revenue");
}


function inc_perc_s(){
  
  mode = "INC_PERC_S";

    var zero = d3.min(current_data, function(d) { return d.values.corp[0].difference; });
    if (zero >= 0) {zero = 0;}
    else {zero = zero * 1.1;}
    
    y.domain([zero, 1.05]);
    y_right.domain([zero, 1.05]);
    
    zero_rule.transition().duration(3000).attr("y1", y(0)).attr("y2", y(0));
    
     var base = 0;
    var metrics = group.selectAll(".company").selectAll("rect")
      .data(function(d) { return d.values.corp; });
      
      
    metrics.enter().append("rect")
    .attr("y", height)
    .attr("height", 0)
    .style("opacity", 0)
    .on("mouseover", show_rule);
              
    metrics.exit().transition().duration(3000)
    .style("opacity", 0)
    .attr("y", height)
    .attr("height", 0)
    .remove();
      
    metrics.transition().duration(3000)
      .attr("width", x.rangeBand())
      .attr("x", 0)
      .attr("y", function(d) {
        var b = base;
          base += d.difference;
          if(d.metric == "postHedge") {base = 0;}
        return y(b + (d.difference));
      })
      .attr("height", function(d) { if (d.difference < 0) {return 0;} // eliminate negative height rects
            else { return y(0) - y(d.difference); }
      })
      .style("opacity", 1)
      .style("fill", function(d) { return colors_income_s(d.metric); });

      yAxis.tickFormat(percent);
      yAxis_right.tickFormat(percent);
      axis_y.transition().duration(3000)
        .call(yAxis);
      axis_y_right.transition().duration(3000)
        .attr("transform", "translate(" + width + ", 0)")
        .call(yAxis_right);
      axis_label.text("percent");
      axis_label_right.text("percent");

      leg_text_mode.text("Production Cost Analysis - percent of post-hedge revenue");

}

function reserves_un() {

  mode = "RESERVES_UN";
  
    y.domain([0, (d3.max(current_data, function(d) { return d3.max(d.values.reserves, function(d) {return d.mmboe;}) })) * 1.05]);
    y_right.domain([0,(d3.max(current_data, function(d) { return d3.max(d.values.reserves, function(d) {return d.mmboe;}) })) * 1.05 * 6]);
    
    zero_rule.transition().duration(3000).attr("y1", y(0)).attr("y2", y(0));

    var products = group.selectAll(".company").selectAll("rect")
      .data(function(d) { return d.values.reserves; });
      
      
    products.enter().append("rect")
      .attr("y",height)
      .attr("height", 0)
      .style("opacity", 0)
      .on("mouseover", show_rule);
              
    
     products.exit().transition().duration(3000).remove();
     //presently has no meaning because, begin the largest group, loading never involves an exit selection
   
    products.transition().duration(3000)
      .attr("width", x_reserves.rangeBand())
      .attr("x", function(d) { return x_reserves(d.div); })
      .attr("y", function(d) { return y(d.mmboe); })
      .attr("height", function(d) { return height - y(d.mmboe); })
      .style("opacity", 1)
      .style("fill", function(d) { return colors_reserves(d.div); });
  
     
      yAxis.tickFormat(null);
      yAxis_right.tickFormat(null);
      axis_y.transition().duration(3000)
        .call(yAxis);
      axis_y_right.transition().duration(3000)
        .attr("transform", "translate(" + width + ", 0)")
        .call(yAxis_right);
      axis_label.text("boe (millions)");
      axis_label_right.text("mcfe (millions)");
      
      //reset_legends();

    leg_text_mode.text("Proved Reserves (12/31/14) - Analyzed");
  
}

function reserves_s() {


  mode = "RESERVES_S";

  y.domain([0,d3.max(current_data, function(d) { return d.pr_total; }) * 1.05]);
  y_right.domain([0,d3.max(current_data, function(d) { return d.pr_total; }) * 1.05 * 6]);
       
  zero_rule.transition().duration(3000).attr("y1", y(0)).attr("y2", y(0));
       
      var products = group.selectAll(".company").selectAll("rect")
      .data(function(d) { return d.values.reserves; });


    products.enter().append("rect")
      .attr("y",height)
      .attr("height", 0)
      .style("opacity", 0)
      .on("mouseover", show_rule);
              
    
     products.exit().transition().duration(3000).remove();
     //presently has no meaning because, begin the largest group, loading never involves an exit selection

    var base = 0;
    
     products.transition().duration(3000)

      .attr("width", x.rangeBand())
      .attr("x", 0)
      .attr("y", function(d) {
        var b = base;
        base += d.mmboe;
        if(d.div == "gas pud") {base = 0;}
       return y(b + d.mmboe); })
      .attr("height", function(d) { return height - y( d.mmboe); })
      .style("opacity", 1)
      .style("fill", function(d) { return colors_reserves(d.div); });

      yAxis.tickFormat(null);
      yAxis_right.tickFormat(null);
      axis_y.transition().duration(3000)
        .call(yAxis);
      axis_y_right.transition().duration(3000)
        .attr("transform", "translate(" + width + ", 0)")
        .call(yAxis_right);
      axis_label.text("boe (millions)");
      axis_label_right.text("mcfe (millions)");

    leg_text_mode.text("Proved Reserves (12/31/14) - Totaled");
  
}

function capex(){
  
  mode = "CAPEX";
       
      var zero = d3.min(current_data, function(d) { return (d.capex[1].value); }); //look for negative cash margin
    if (zero >= 0) {zero = 0;}
    else {zero = zero * 1.1;}

       
      y.domain([zero,d3.max(current_data, function(d) { return d.capex[0].value; }) * 1.05]);
      y_right.domain(y.domain());
      
      zero_rule.transition().duration(3000).attr("y1", y(0)).attr("y2", y(0));
    
    var products = group.selectAll(".company").selectAll("rect")
      .data(function(d) { return d.capex; });
      
    products.enter().append("rect")
      .attr("y",height)
      .attr("height", 0)
      .style("opacity", 0)
      .on("mouseover", show_rule);
              
     products.exit().transition().duration(3000).style("opacity", 0).remove();

   
    products.transition().duration(3000)
      .attr("width", x_capex.rangeBand())
      .attr("x", function(d) { return x_capex(d.name); })
      .attr("y", function(d) { if (d.value<0) return y(0);
        else {return y(d.value);}
        })
      .attr("height", function(d) { if (d.value < 0) return (y(d.value) - y(0));
        else { return y(0) - y(d.value); }
        })
      .style("opacity", 1)
      .style("fill", function(d) { return colors_capex(d.name); });
      
      yAxis.tickFormat(dollars);
      yAxis_right.tickFormat(dollars);
      axis_y.transition().duration(3000)
        .call(yAxis);
      axis_y_right.transition().duration(3000)
        .attr("transform", "translate(" + width + ", 0)")
        .call(yAxis_right);
      axis_label.text("$ (millions)");
      axis_label_right.text("$ (millions)");
      
      leg_text_mode.text("Q2 2015 E&P Capital Expenditures (vs. E&P Cash Margin)");

}

function hedge(){
  
  mode = "HEDGE";

      
    var zero = d3.min(current_data, function(d) { return (d.hedge/d.rev_total); });
    if (zero >= 0) {zero = 0;}
    else {zero = zero * 1.1;}
      
      
      y.domain([zero,
                d3.max(current_data, function(d) { return (d.hedge/d.rev_total); }) * 1.05]);
      y_right.domain([zero,
                d3.max(current_data, function(d) { return (d.hedge/d.rev_total); }) * 1.05]);

    zero_rule.transition().duration(3000).attr("y1", y(0)).attr("y2", y(0));
 
    var products = group.selectAll(".company").selectAll("rect")
      .data(function(d) { return [d.hedge/d.rev_total]; });
      
    products.enter().append("rect")
      .attr("y",height)
      .attr("height", 0)
      .style("opacity", 0)
      .on("mouseover", show_rule);
              
    products.exit().transition().duration(3000).style("opacity", 0).remove();

    products.transition().duration(3000)
      .attr("width", x.rangeBand())
      .attr("x", 0)
      .attr("y", function(d) { if (d<0) return y(0);
        else {return y(d);}
        })
      .attr("height", function(d) { if (d<0) return y(d) - y(0);
        else { return y(0) - y(d); }
        })
      .style("opacity", 1)
      .style("fill", function(d) { if (d<0) return "lightgreen";
        else { return "lightgreen"; }
        });
      

      yAxis.tickFormat(percent);
      yAxis_right.tickFormat(percent);
      axis_y.transition().duration(3000)
        .call(yAxis);
      axis_y_right.transition().duration(3000)
        .attr("transform", "translate(" + width + ", 0)")
        .call(yAxis_right);
      axis_label.text("percent");
      axis_label_right.text("percent");
      
      leg_text_mode.text("Q2 2015 Hedge Impact - % of unhedged revenue");
}

function hedge_boe(){
  
  mode = "HEDGE_BOE";
  
    var zero = d3.min(current_data, function(d) { return (d.boe_price_hedged - d.boe_price); });
    if (zero >= 0) {zero = 0;}
    else {zero = zero * 1.1;}
    
      y.domain([zero,
                d3.max(current_data, function(d) {
                    if (d.boe_price_hedged - d.boe_price < 0) return 0;
                    else {return (d.boe_price_hedged - d.boe_price) * 1.05;} })
                    ]);
      y_right.domain([d3.round(zero/6,2),
                d3.max(current_data, function(d) {
                    if (d.boe_price_hedged - d.boe_price < 0) return 0;
                    else {return (d.boe_price_hedged - d.boe_price) * 1.05/6;} })
                    ]);
                    

    zero_rule.transition().duration(3000).attr("y1", y(0)).attr("y2", y(0));
    
    var products = group.selectAll(".company").selectAll("rect")
      .data(function(d) { return [d.boe_price_hedged - d.boe_price]; });
      
    products.enter().append("rect")
      .attr("y",height)
      .attr("height", 0)
      .style("opacity", 0)
      .on("mouseover", show_rule);
    
     products.exit().transition().duration(3000).style("opacity", 0).remove();

    products.transition().duration(3000)
      .attr("width", x.rangeBand())
      .attr("x", 0)
      .attr("y", function(d) { if (d<0) return y(0);
        else {return y(d);}
        })
      .attr("height", function(d) { if (d<0) return y(d) - y(0);
        else { return y(0) - y(d); }
        })
      .style("opacity", 1)
      .style("fill", function(d) { if (d<0) return "lightgreen";
        else { return "lightgreen"; }
        });
      
      yAxis.tickFormat(dollars);
      yAxis_right.tickFormat(dollars2);//hack to assure rounded values, but loses $ format
      axis_y.transition().duration(3000)
        .call(yAxis);
      axis_y_right.transition().duration(3000)
        .attr("transform", "translate(" + width + ", 0)")
        .call(yAxis_right);
      axis_label.text("$ per boe");
      axis_label_right.text("$ per mcfe");
      
      leg_text_mode.text("Q2 2015 Hedge Impact in $/boe");
}

function debt_ebitda(){
  
  mode = "DEBT_EBITDA";

       
      y.domain([0,d3.max(current_data, function(d) { return d.debt/(d.values.corp[2].dollars * 4); }) * 1.05]);
      y_right.domain(y.domain() );
      
      zero_rule.transition().duration(3000).attr("y1", y(0)).attr("y2", y(0));

    
    var products = group.selectAll(".company").selectAll("rect")
      .data(function(d) { return [d.debt/(d.values.corp[2].dollars * 4)]; });
      
      
    products.enter().append("rect")
      .attr("y",height)
      .attr("height", 0)
      .style("opacity", 0)
      .on("mouseover", show_rule);
              
    
     products.exit().transition().duration(3000).style("opacity", 0).remove();

   
    products.transition().duration(3000)
      .attr("width", x.rangeBand())
      .attr("x", 0)
      .attr("y", function(d) { return y(d); })
      .attr("height", function(d) { return height - y(d); })
      .style("opacity", 1)
      .style("fill", "green");
      
      yAxis.tickFormat(null);
      yAxis_right.tickFormat(null);
      axis_y.transition().duration(3000)
        .call(yAxis);
      axis_y_right.transition().duration(3000)
        .attr("transform", "translate(" + width + ", 0)")
        .call(yAxis_right);
      axis_label.text("multiple");
      axis_label_right.text("multiple");
      
      leg_text_mode.text("Q2 2015 Debt/EBITDA Ratio (LQA EBITDA)");

}

function ev(){
  
mode = "EV";

       y.domain([0,d3.max(current_data, function(d) { return d.ev[0].value + d.ev[1].value;} ) * 1.05]);
       y_right.domain(y.domain());
       
       zero_rule.transition().duration(3000).attr("y1", y(0)).attr("y2", y(0));

    
    var products = group.selectAll(".company").selectAll("rect")
      .data(function(d) { return d.ev; });
      
      
    products.enter().append("rect")
      .attr("y",height)
      .attr("height", 0)
      .style("opacity", 0)
      .on("mouseover", show_rule);
              
    products.exit().transition().duration(3000)
    .attr("y",height)
    .attr("height", 0)
    .style("opacity", 0)
    .remove();

      var base = 0;
      
      products.transition().duration(3000)
      .attr("width", x.rangeBand())
      .attr("x", 0)
      .attr("y", function(d) {
        var b = base;
        base += d.value;
        if(d.name == "debt") {base = 0;}
       return y(b + d.value); })
      .attr("height", function(d) { return height - y( d.value); })
      .style("opacity", 1)
      .style("fill", function(d) { return colors_ev(d.name); });

      yAxis.tickFormat(dollars);
      yAxis_right.tickFormat(dollars);
      axis_y.transition().duration(3000)
        .call(yAxis);
      axis_y_right.transition().duration(3000)
        .attr("transform", "translate(" + width + ", 0)")
        .call(yAxis_right);
      axis_label.text("$ (millions)");
      axis_label_right.text("$ (millions)");
    
    leg_text_mode.text("Enterpirse Value (EV) - (stock at weekly close + Q2 debt)");
}

function ev_ebitda(){
  
  mode = "EV_EBITDA";

       
      y.domain([0,d3.max(current_data, function(d) { return ( (d.ev[0].value + d.ev[1].value)/(d.values.corp[2].dollars * 4)); }) * 1.05]);
      y_right.domain(y.domain() );
      
      zero_rule.transition().duration(3000).attr("y1", y(0)).attr("y2", y(0));

    
    var products = group.selectAll(".company").selectAll("rect")
      .data(function(d) { return [ (d.ev[0].value + d.ev[1].value)/(d.values.corp[2].dollars * 4)]; });
      
      
    products.enter().append("rect")
      .attr("y",height)
      .attr("height", 0)
      .style("opacity", 0)
      .on("mouseover", show_rule);
              
    
     products.exit().transition().duration(3000).style("opacity", 0).remove();

   
    products.transition().duration(3000)
      .attr("width", x.rangeBand())
      .attr("x", 0)
      .attr("y", function(d) { return y(d); })
      .attr("height", function(d) { return height - y(d); })
      .style("opacity", 1)
      .style("fill", "lightgreen");
      
      yAxis.tickFormat(null);
      yAxis_right.tickFormat(null);
      axis_y.transition().duration(3000)
        .call(yAxis);
      axis_y_right.transition().duration(3000)
        .attr("transform", "translate(" + width + ", 0)")
        .call(yAxis_right);
      axis_label.text("multiple");
      axis_label_right.text("multiple");
      
      leg_text_mode.text("EV/EBITDA Ratio (LQA EBITDA)");

}

function pr_dashare(){
  
  mode = "PR_DASHARE";

       
      y.domain([0,d3.max(current_data, function(d) { return d.pr_total/d.da_shares; }) * 1.05]);
      y_right.domain([0,d3.max(current_data, function(d) { return d.pr_total/d.da_shares; })*6 * 1.05]);
      
      zero_rule.transition().duration(3000).attr("y1", y(0)).attr("y2", y(0));

    
    var products = group.selectAll(".company").selectAll("rect")
      .data(function(d) { return [d.pr_total/d.da_shares]; });
      
      

    products.enter().append("rect")
      .attr("y",height)
      .attr("height", 0)
      .style("opacity", 0)
      .on("mouseover", show_rule);
              
    
     products.exit().transition().duration(3000).style("opacity", 0).remove();

   
    products.transition().duration(3000)
      .attr("width", x.rangeBand())
      .attr("x", 0)
      .attr("y", function(d) { return y(d); })
      .attr("height", function(d) { return height - y(d); })
      .style("opacity", 1)
      .style("fill", "green");
      
      yAxis.tickFormat(null);
      yAxis_right.tickFormat(null);
      axis_y.transition().duration(3000)
        .call(yAxis);
      axis_y_right.transition().duration(3000)
        .attr("transform", "translate(" + width + ", 0)")
        .call(yAxis_right);
      axis_label.text("boe/share");
      axis_label_right.text("mcfe/share");
      
      leg_text_mode.text("Proved Reserves per Debt-Adjusted Share");

}



function prod_dashare(){
  
  mode = "PROD_DASHARE";

       
      y.domain([0,d3.max(current_data, function(d) { return (d.prod_total * 365/1000)/d.da_shares; }) * 1.05]);
      y_right.domain([0,d3.max(current_data, function(d) { return (d.prod_total * 365/100)/d.da_shares; })*6 * 1.05]);
      
      zero_rule.transition().duration(3000).attr("y1", y(0)).attr("y2", y(0));

    
    var products = group.selectAll(".company").selectAll("rect")
      .data(function(d) { return [(d.prod_total * 365/1000)/d.da_shares]; });
      
      

    products.enter().append("rect")
      .attr("y",height)
      .attr("height", 0)
      .style("opacity", 0)
      .on("mouseover", show_rule);
              
    
     products.exit().transition().duration(3000).style("opacity", 0).remove();

   
    products.transition().duration(3000)
      .attr("width", x.rangeBand())
      .attr("x", 0)
      .attr("y", function(d) { return y(d); })
      .attr("height", function(d) { return height - y(d); })
      .style("opacity", 1)
      .style("fill", "green");
      
      yAxis.tickFormat(null);
      yAxis_right.tickFormat(null);
      axis_y.transition().duration(3000)
        .call(yAxis);
      axis_y_right.transition().duration(3000)
        .attr("transform", "translate(" + width + ", 0)")
        .call(yAxis_right);
      axis_label.text("boe/share");
      axis_label_right.text("mcfe/share");
      
      leg_text_mode.text("Annual Production (LQA) per Debt-Adjusted Share");

}


function g_level() {

      //clear rule on any refresh
      rule_group.style("visibility", "hidden");

    var t = group.selectAll(".company")
      .data(current_data, function(d){return d.company;});

      t.enter().append("g")
      .attr("class", "company")
      .style("opacity", 0)
      .attr("transform", function(d) { return " scale(0,0), translate( 0, 0)"; })
      .on("click",function() {
        side_data = d3.select(this).datum();
        side_graph();

      });

      
     t.exit()
      .transition().duration(3000)
      .attr("transform", function(d) { return " scale(1,0), translate( 0, 0)"; })
      //.attr("transform", function(d) { return "translate( 0, 0)"; })
      .style("opacity", 0)
      .remove();
      
      t.transition().duration(3000)
      .attr("class", "company")
      .style("opacity", 1)
      .attr("transform", function(d) { return "scale(1,1), translate(" + x(d.company) + ",0)"; });

      axis_x.transition().duration(3000).call(xAxis);
}


// END MODE SWITCHING BLOCK

  
//SIDE PANEL --  Right side panel -- side graph and toggled side graphs mode list -- text panel)

var side_panel = svg.append("g")
        .style("visibility", "visible")
        .attr("transform", "translate(1050, 0)");  //root of all right side display side_panel_graph, side_panel_rule,side_panel_modes, and                                                    //side_panel_data
 
var side_panel_height = 300;
var side_panel_width  = 170;
var side_panel_width_plus  = 260;
var side_panel_width_plus_plus  = 300;
        
var side_graph_legend = side_panel.append("text")
        .attr("x", side_panel_width/2)
        .classed("label", true)
        .style("font-size", "13px")
        .text("Average Daily Production in Q2 2015 by product")
        .attr("text-anchor", "middle");

var lower_display = "data"  // vs modes


//created for clicking, but now just for color
var side_panel_graph_background = side_panel.append("rect")
    .attr("width", side_panel_width)
    .attr("height", side_panel_height)
    .attr("transform", "translate(0, 30)")
    .style("fill", clr_graph_bkgrnd);




    
var side_panel_graph = side_panel.append("g")  // must be after background rect so graph isn't covered
      .attr("transform", "translate(0, 30)");
      
var drag_data = d3.behavior.drag()
    .origin(Object)
    .on("drag", dragmove_data);

var data_y_position = 375;

function dragmove_data() {
  data_y_position += d3.event.dy;
  if (data_y_position  < 375) {
    side_panel_graph.style("visibility", "hidden");
    side_panel_graph_background.style("visibility", "hidden");
    side_panel_rule.style("visibility", "hidden")
  }
  else {
    side_panel_graph.style("visibility", "visible");
    side_panel_graph_background.style("visibility", "visible");
    side_panel_rule.style("visibility", "visible")
  }
  side_panel_data.attr("transform", "translate(0," + data_y_position + ")")
}
      
 // to toggle with side_panel modes.
var side_panel_data = side_panel.append("g")
      .attr("transform", "translate(0, 375)")
      .style("visibility", "hidden")
      .on("mouseover", function() {})
      .style("cursor", "all-scroll")
      .call(drag_data)
      .attr("class", "label");
      
var side_panel_data_background = side_panel_data.append("rect")
    //.attr("width", (width + margin.left + margin.right) - 1050)
    .attr("width", 300)
    .attr("height", (height + margin.top + margin.bottom) - 375)
    .attr("transform", "translate(0, 0)")
    .style("fill", clr_graph_bkgrnd);

    
    


var y_side = d3.scale.linear()
    .range([side_panel_height, 0]);

var y_side_right = d3.scale.linear()
    .range([side_panel_height, 0]);
    
var x_side_hedge = d3.scale.ordinal()
    .domain(["hedge impact"])
    .rangeRoundBands([0, side_panel_width], 0, 2.0);
    
var x_side_debt_ebitda = d3.scale.ordinal()
    .domain(["debt/ebitda"])
    .rangeRoundBands([0, side_panel_width], 0, 2.0);
    
var x_side_ev_ebitda = d3.scale.ordinal()
    .domain(["ev/ebitda"])
    .rangeRoundBands([0, side_panel_width], 0, 2.0);
    
var x_side_pr_dashare = d3.scale.ordinal()
    .domain(["reserves/share"])
    .rangeRoundBands([0, side_panel_width], 0, 2.0);
    
var x_side_prod_dashare = d3.scale.ordinal()
    .domain(["production/share"])
    .rangeRoundBands([0, side_panel_width], 0, 2.0);

var x_side_prods = d3.scale.ordinal()
    .domain(["oil","ngl","gas"])
    .rangeRoundBands([0, side_panel_width], 0, 2.0);
    
var x_side_corp = d3.scale.ordinal()
    .domain(["postHedge","ebitda","cashMargin", "net"])
    .rangeRoundBands([0, side_panel_width_plus], .5, .65);
    
var x_side_axis_corp_income = d3.scale.ordinal()
    .domain(["hedged","ebitda","cash mgn", "pretax"])
    .rangeRoundBands([0, side_panel_width_plus], .5, .65);
    
var x_side_axis_corp_costs = d3.scale.ordinal()
    .domain(["ebitda costs","int","DDA", "pre-tax net"])
    .rangeRoundBands([0, side_panel_width_plus], .5, .65);
    
var x_side_reserves = d3.scale.ordinal()
    .domain(["oil pd","ngl pd","gas pd","oil pud","ngl pud","gas pud"])
    .rangeRoundBands([0, side_panel_width_plus_plus], .5, .4);
    
var x_side_ev = d3.scale.ordinal()
    .domain(["market cap","debt"])
    .rangeRoundBands([0, side_panel_width], .5, .65);
    
var x_side_capex = d3.scale.ordinal()
    .domain(["capex","cash margin"])
    .rangeRoundBands([0, side_panel_width], .5, .65);
    
var xAxis_side = d3.svg.axis()
    .scale(x_side_prods)
    .orient("bottom");

var yAxis_side = d3.svg.axis()
    .scale(y_side)
    .orient("left")
    .tickFormat(null)
    .ticks(10);
    
var yAxis_side_right = d3.svg.axis()
    .scale(y_side_right)
    .orient("right")
    .tickFormat(null)
    .ticks(10);
    
var axisAdjust = side_panel_graph.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(0," + side_panel_height + ")");

var axis_y_side = side_panel_graph.append("g")
      .attr("class", "y axis");

var axis_label_side = axis_y_side.append("text")
      .attr("x", -20)
      .attr("y", -10)
      .classed("label", true)
      .style("text-anchor", "start")
      .text("mboe/day");

var axis_y_side_right = side_panel_graph.append("g")
      .attr("class", "y axis")
      .attr("transform", "translate(" + side_panel_width + ", 0)");
      
var axis_label_side_right = axis_y_side_right.append("text")
      .attr("x", 20)
      .attr("y", -10)
      .classed("label", true)
      .style("text-anchor", "end")
      .text("mmcfe/day");

var side_graph_mode;

//Problem that this need be here, to define spd_company before it's used in side_graph. Because
// this element in only part of a larger data display that is positioned under the graph.
// Do I need to build the whole data display here?


var data_totals_group = side_panel_data.append("g")
  .attr("transform", "translate(0, 0)");

  
var spd_company = data_totals_group.append("text")
      .attr("y", 0)
      .style("font-weight","600")
      .style("font-size", "18px");

var spd_name = data_totals_group.append("text")
      .attr("x", 60)
      .attr("y", 0)
      .style("font-size", "16px");
      
var spd_prod_total = data_totals_group.append("text")
      .attr("y", 20)
      
var spd_boe_price = data_totals_group.append("text")
      .attr("y", 40);
      
var spd_rev_total = data_totals_group.append("text")
      .attr("y", 60);
      
var spd_pr_total = data_totals_group.append("text")
      .attr("y", 80);
      
var spd_capex = data_totals_group.append("text")
      .attr("y", 100);
      
  
var data_oil_group = side_panel_data.append("g")
  .attr("transform", "translate(10, 120)");
      
var spd_oilLabel = data_oil_group.append("text")
      .attr("y", 0)
      .text("OIL")
      .style("font-weight","600");
      
var spd_prod_oil = data_oil_group.append("text")
      .attr("y", 20);
      
var spd_price_oil = data_oil_group.append("text")
      .attr("y", 20)
      .attr("x", 90);
      
var spd_rev_oil = data_oil_group.append("text")
      .attr("y", 40);
      
var spd_pr_oil = data_oil_group.append("text")
      .attr("y", 60);
      
      
var data_ngl_group = side_panel_data.append("g")
  .attr("transform", "translate(10, 220)");
  
var three_stream = data_ngl_group.append("g");
      
var spd_nglLabel = three_stream.append("text")
      .attr("y", 0)
      .text("NGL")
      .style("font-weight","600");
      
var spd_prod_ngl = three_stream.append("text")
      .attr("y", 20);
      
var spd_price_ngl = three_stream.append("text")
      .attr("y", 20)
      .attr("x", 90);
      
var spd_rev_ngl = three_stream.append("text")
      .attr("y", 40);
      
var spd_pr_ngl = three_stream.append("text")
      .attr("y", 60);
      
var two_stream = data_ngl_group.append("g")
    .style("visibility", "hidden");
    
var two_stream_text = two_stream.append("text")
      .attr("x", -10)
      .text("*Two-Stream Reporting (Oil & Gas Only)")
      .style("font-weight","600");
      

var data_gas_group = side_panel_data.append("g")
  .attr("transform", "translate(10, 280)");
      
var spd_gasLabel = data_gas_group.append("text")
      .attr("y", 0)
      .text("GAS")
      .style("font-weight","600");
      
var spd_prod_gas = data_gas_group.append("text")
      .attr("y", 20);
      
var spd_price_gas = data_gas_group.append("text")
      .attr("y", 20)
      .attr("x", 90);
      
var spd_rev_gas = data_gas_group.append("text")
      .attr("y", 40);
      
var spd_pr_gas = data_gas_group.append("text")
      .attr("y", 60);
      
var data_bottom_group = side_panel_data.append("g");

var data_groups_group = data_bottom_group.append("g")
    .attr("transform", "translate(50, 135)");  //for groups list below metrics

      
data_bottom_group.append("text")
      .attr("y", 0)
      .attr("x", 10)
      .text("PRODUCTION INCOME METRICS")
      .style("font-weight","600");
      
data_bottom_group.append("text")
      .attr("y", 15)
      .attr("x", 15)
      .text("Post-Hedge Revenue")
      .style("font-size", "12px")
      .style("font-weight","600");
      
var spd_inc_rev = data_bottom_group.append("text")
      .attr("y", 15)
      .attr("x", 220)
      .style("text-anchor", "end")
      .text("bb")
      .style("font-size", "12px")
      .style("font-weight","600");
      
var spd_inc_rev_p = data_bottom_group.append("text")
      .attr("y", 15)
      .attr("x", 260)
      .style("text-anchor", "end")
      .text("bb")
      .style("font-weight","600");
      
data_bottom_group.append("text")
      .attr("y", 30)
      .attr("x", 35)
      .text("EBITDA Costs")
      .style("font-weight","400");
      
var spd_costs_EBITDA = data_bottom_group.append("text")
      .attr("y", 30)
      .attr("x", 220)
      .style("text-anchor", "end")
      .style("font-weight","400");
      
var spd_costs_EBITDA_p = data_bottom_group.append("text")
      .attr("y", 30)
      .attr("x", 260)
      .style("text-anchor", "end")
      .style("font-weight","400");
  
data_bottom_group.append("text")
      .attr("y", 45)
      .attr("x", 15)
      .text("EBITDA")
      .style("font-size", "12px")
      .style("font-weight","600");
      
var spd_inc_EBITDA = data_bottom_group.append("text")
      .attr("y", 45)
      .attr("x", 220)
      .style("text-anchor", "end")
      .style("font-size", "12px")
      .style("font-weight","600");
      
var spd_inc_EBITDA_p = data_bottom_group.append("text")
      .attr("y", 45)
      .attr("x", 260)
      .style("text-anchor", "end")
      .style("font-weight","600");
      
data_bottom_group.append("text")
      .attr("y", 60)
      .attr("x", 35)
      .text("Interest")
      .style("font-weight","400");
      
var spd_costs_int = data_bottom_group.append("text")
      .attr("y", 60)
      .attr("x", 220)
      .style("text-anchor", "end")
      .style("font-weight","400");
      
var spd_costs_int_p = data_bottom_group.append("text")
      .attr("y", 60)
      .attr("x", 260)
      .style("text-anchor", "end")
      .style("font-weight","400");
      
data_bottom_group.append("text")
      .attr("y", 75)
      .attr("x", 15)
      .text("Cash Margin")
      .style("font-size", "12px")
      .style("font-weight","600");
      
var spd_inc_cash = data_bottom_group.append("text")
      .attr("y", 75)
      .attr("x", 220)
      .style("font-size", "12px")
      .style("text-anchor", "end")
      .style("font-weight","600");
      
var spd_inc_cash_p = data_bottom_group.append("text")
      .attr("y", 75)
      .attr("x", 260)
      .style("text-anchor", "end")
      .style("font-weight","600");
      
data_bottom_group.append("text")
      .attr("y", 90)
      .attr("x", 35)
      .text("DD&A")
      .style("font-weight","400");
      
var spd_costs_dda = data_bottom_group.append("text")
      .attr("y", 90)
      .attr("x", 220)
      .style("text-anchor", "end")
      .style("font-weight","400");
      
var spd_costs_dda_p = data_bottom_group.append("text")
      .attr("y", 90)
      .attr("x", 260)
      .style("text-anchor", "end")
      .style("font-weight","400");

data_bottom_group.append("text")
      .attr("y", 105)
      .attr("x", 15)
      .text("Pre-Tax Net Income")
      .style("font-weight","600");
      
var spd_inc_net = data_bottom_group.append("text")
      .attr("y", 105)
      .attr("x", 220)
      .style("text-anchor", "end")
      .style("font-weight","600");
      
var spd_inc_net_p = data_bottom_group.append("text")
      .attr("y", 105)
      .attr("x", 260)
      .style("text-anchor", "end")
      .style("font-weight","600");
  
  
function setDataDisplay() {
  
  if (side_data.values.prods[1].price == 0) {
    three_stream.style("visibility", "hidden");
    two_stream.style("visibility", "visible");
    data_gas_group.attr("transform", "translate(10, 200)");
    data_ngl_group.attr("transform", "translate(10, 280)");
    spd_gasLabel.text("GAS (including NGL content)");
    data_bottom_group.attr("transform", "translate(0, 300)");
  }
  else {
    three_stream.style("visibility", "visible");
    two_stream.style("visibility", "hidden");
    data_ngl_group.attr("transform", "translate(10, 200)");
    data_gas_group.attr("transform", "translate(10, 280)");
    spd_gasLabel.text("GAS");
    data_bottom_group.attr("transform", "translate(0, 360)");
  }
  
  
  spd_company.text(side_data.company);
  spd_name.text(side_data.name);
  spd_prod_total.text(d3.round(side_data.prod_total,1) + " mmboe/day (" + d3.round(side_data.prod_total*6,1) + " mmcfe/day)");
  spd_boe_price.text( (dollars(d3.round(side_data.boe_price,2))) + " per boe (" + (dollars(d3.round(side_data.boe_price/6,2))) + " per mcfe)");
  spd_rev_total.text( (dollars(d3.round(side_data.rev_total,1))) + " revenue (millions for quarter)");
  spd_pr_total.text(d3.round(side_data.pr_total,0) + " mmboe proved reserves (" + d3.round(side_data.pr_pud_percent * 100,1) + "% pud)");
  spd_capex.text( (dollars(d3.round(side_data.capex[0].value,1))) + " E&P capex (millions for quarter)");
  spd_prod_oil.text(side_data.values.prods[0].mboed + " mbo/day");
  spd_price_oil.text((dollars(d3.round(side_data.values.prods[0].price,2))) + " per barrel");
  spd_rev_oil.text((dollars(d3.round(side_data.values.prods[0].price * side_data.values.prods[0].mboed * q2/1000 ,1 ))) + " per quarter (millions)");
  spd_pr_oil.text(d3.round(side_data.values.reserves[0].mmboe + side_data.values.reserves[3].mmboe,0) + " mmboe proved reserves (" + d3.round(side_data.values.reserves[3].mmboe / (side_data.values.reserves[0].mmboe + side_data.values.reserves[3].mmboe) * 100,1) + "% pud)");
  spd_prod_ngl.text(side_data.values.prods[1].mboed + " mbo/day");
  spd_price_ngl.text((dollars(d3.round(side_data.values.prods[1].price,2))) + " per barrel");
  spd_rev_ngl.text((dollars(d3.round(side_data.values.prods[1].price * side_data.values.prods[1].mboed * q2/1000 ,1 ))) + " per quarter (millions)");
  spd_pr_ngl.text(d3.round(side_data.values.reserves[1].mmboe + side_data.values.reserves[4].mmboe,0) + " mmboe proved reserves (" + d3.round(side_data.values.reserves[4].mmboe / (side_data.values.reserves[1].mmboe + side_data.values.reserves[4].mmboe) * 100,1) + "% pud)");
  spd_prod_gas.text(d3.round(side_data.values.prods[2].mboed * 6, 0) + " mmcf/day");
  spd_price_gas.text((dollars(d3.round(side_data.values.prods[2].price / 6 ,2))) + " per mcf");
  spd_rev_gas.text((dollars(d3.round(side_data.values.prods[2].price * side_data.values.prods[2].mboed * q2/1000 ,1 ))) + " per quarter (millions)");
  spd_pr_gas.text(d3.round(side_data.values.reserves[2].mmboe + side_data.values.reserves[5].mmboe,0) + " mmboe proved reserves (" + d3.round(side_data.values.reserves[5].mmboe / (side_data.values.reserves[2].mmboe + side_data.values.reserves[5].mmboe) * 100,1) + "% pud)");
  spd_inc_rev.text(dollars(d3.round(side_data.values.corp[3].dollars)) + " MM");
  spd_inc_rev_p.text(percent(side_data.values.corp[3].percent));
  spd_costs_EBITDA.text("(" + dollars(d3.round(side_data.values.corp[3].dif_dollars)) + ")");
  spd_costs_EBITDA_p.text("(" + percent(side_data.values.corp[3].difference) + ")");
  spd_inc_EBITDA.text(dollars(d3.round(side_data.values.corp[2].dollars)) + " MM");
  spd_inc_EBITDA_p.text(percent(side_data.values.corp[2].percent));
  spd_costs_int.text("("+ dollars(d3.round(side_data.values.corp[2].dif_dollars)) + ")");
  spd_costs_int_p.text("("+ percent(side_data.values.corp[2].difference) + ")");
  spd_inc_cash.text(dollars(d3.round(side_data.values.corp[1].dollars)) + " MM");
  spd_inc_cash_p.text(percent(side_data.values.corp[1].percent));
  spd_costs_dda.text("("+dollars(d3.round(side_data.values.corp[1].dif_dollars)) + ")");
  spd_costs_dda_p.text("("+ percent(side_data.values.corp[1].difference) + ")");
  spd_inc_net.text(dollars(d3.round(side_data.values.corp[0].dollars)) + " MM");
  spd_inc_net_p.text(percent(side_data.values.corp[0].percent));

 var rr = data_groups_group.selectAll("text")
   .data(side_data.groups);
    
   rr.enter().append("text");
   
   rr.exit().remove();

   rr.text(function (d) {return d;})
   .style("font-weight","600")
   .attr("y", function (d,i) {return i * 15;} );
   
    
}

function side_graph() {
  
  
  switch(mode) {

    case "PROD_UN":
        modeSwitch_side("Production by Product");
        break;
    case "PROD_S":
        modeSwitch_side("Production Totaled");
        break;
    case "REV_UN":
        modeSwitch_side("Revenue by Product");
        break;
    case "REV_S":
        modeSwitch_side("Revenue Totaled");
        break;
    case "PRICE_UN":
        modeSwitch_side("Price by Product");
        break;
    case "PRICE_S":
        modeSwitch_side("Boe/Mcfe Price");
        break;
    case "INC_QU_UN":
        modeSwitch_side("Income Metrics");
        break;
    case "INC_QU_S":
        modeSwitch_side("Cost Metrics");
        break;
    case "INC_BOE_UN":
        modeSwitch_side("Unit Income Metrics");
        break;
    case "INC_BOE_S":
        modeSwitch_side("Unit Cost Metrics");
        break;
    case "INC_PERC_UN":
        modeSwitch_side("Percentage Income Metrics");
        break;
    case "INC_PERC_S":
        modeSwitch_side("Percentage Cost Metrics");
        break;
    case "RESERVES_UN":
        modeSwitch_side("Proved Reserves Analyzed");
        break;
    case "RESERVES_S":
        modeSwitch_side("Proved Reserves Totaled");
        break;
    case "CAPEX":
        modeSwitch_side("E&P Capital Expenditures");
        break;
    case "HEDGE":
        modeSwitch_side("Hedge Percentage Impact");
        break;
    case "HEDGE_BOE":
        modeSwitch_side("Hedge Unit Impact");
        break;
    case "DEBT_EBITDA":
        modeSwitch_side("Net Debt/EBITDA Ratio");
        break;
    case "EV":
        modeSwitch_side("Enterprise Value (EV)");
        break;
    case "EV_EBITDA":
        modeSwitch_side("EV/EBITDA Ratio");
        break;
    case "PR_DASHARE":
        modeSwitch_side("Reserves per D/A Share");
        break;
    case "PROD_DASHARE":
        modeSwitch_side("Production per D/A Share");
        break;
        
  }
  
  setDataDisplay();
}

function adjustAxes(bars, format, mode) {
  
    yAxis_side.tickFormat(format);
    yAxis_side_right.tickFormat(format);
    
  if (bars == 1) {  //1 bar
  
    if (mode == "hedge") xAxis_side.scale(x_side_hedge); //one of the two hedge modes, with same axis labels
    else if (mode == "debt_ebitda") {xAxis_side.scale(x_side_debt_ebitda);}
    else if (mode == "ev_ebitda") {xAxis_side.scale(x_side_ev_ebitda);}
    else if (mode == "pr_dashare") {xAxis_side.scale(x_side_pr_dashare);}
    else if (mode == "prod_dashare") {xAxis_side.scale(x_side_prod_dashare);}
    else {}
  rule_side.attr("width", side_panel_width);
  axisAdjust.transition().duration(2000).call(xAxis_side);
  axis_y_side.transition().duration(2000).call(yAxis_side);
  axis_y_side_right.transition().duration(2000)
    .attr("transform", "translate(" + side_panel_width + ", 0)")
    .call(yAxis_side_right);
    side_panel_graph_background.transition().duration(2000).attr("width", side_panel_width);
    side_graph_legend.transition().duration(2000).attr("x", side_panel_width/2);
  }
  
 else if (bars == 2) {  //2 bars -- currently only capex
  
 if (mode == "capex") xAxis_side.scale(x_side_capex);
 else if (mode == "ev") {xAxis_side.scale(x_side_ev);}
 else {}

  rule_side.attr("width", side_panel_width);
  axisAdjust.transition().duration(2000).call(xAxis_side);
  axis_y_side.transition().duration(2000).call(yAxis_side);
  axis_y_side_right.transition().duration(2000)
    .attr("transform", "translate(" + side_panel_width + ", 0)")
    .call(yAxis_side_right);
    side_panel_graph_background.transition().duration(2000).attr("width", side_panel_width);
    side_graph_legend.transition().duration(2000).attr("x", side_panel_width/2);
  }
  
  
  else if (bars == 3) {  //sized for three bars
  
  xAxis_side.scale(x_side_prods);
  rule_side.attr("width", side_panel_width);
  axisAdjust.transition().duration(2000).call(xAxis_side);
  axis_y_side.transition().duration(2000).call(yAxis_side);
  axis_y_side_right.transition().duration(2000)
    .attr("transform", "translate(" + side_panel_width + ", 0)")
    .call(yAxis_side_right);
    side_panel_graph_background.transition().duration(2000).attr("width", side_panel_width);
    side_graph_legend.transition().duration(2000).attr("x", side_panel_width/2);
  }
  
  else if (bars == 4) {

  if(mode == "costs") {xAxis_side.scale(x_side_axis_corp_costs);}  // set domain for x axis only, for labels, not for rects
  else {xAxis_side.scale(x_side_axis_corp_income);}
  
  rule_side.attr("width", side_panel_width_plus);
  axisAdjust.transition().duration(2000).call(xAxis_side);
  axis_y_side.transition().duration(2000).call(yAxis_side);
  axis_y_side_right.transition().duration(2000)
    .attr("transform", "translate(" + side_panel_width_plus + ", 0)")
    .call(yAxis_side_right);
  side_panel_graph_background.transition().duration(2000).attr("width", side_panel_width_plus);
  side_graph_legend.transition().duration(2000).attr("x", side_panel_width_plus/2);
  }
  
  else {  // six bars is reserves analysed

  xAxis_side.scale(x_side_reserves);
  rule_side.attr("width", side_panel_width_plus_plus);
  axisAdjust.transition().duration(2000).call(xAxis_side);
  axis_y_side.transition().duration(2000).call(yAxis_side);
  axis_y_side_right.transition().duration(2000)
    .attr("transform", "translate(" + side_panel_width_plus_plus + ", 0)")
    .call(yAxis_side_right);
  side_panel_graph_background.transition().duration(2000).attr("width", side_panel_width_plus_plus);
  side_graph_legend.transition().duration(2000).attr("x", side_panel_width_plus_plus/2);
  }
}
  
  
function prod_un_side() {
  
  side_graph_mode = "PROD_UN";
  y_side.domain([0, (d3.max(side_data.values.prods, function(d) {return d.mboed;}) ) * 1.05]);
  y_side_right.domain([0, (d3.max(side_data.values.prods, function(d) {return d.mboed;}) ) * 1.05 * 6]);
  adjustAxes(3, null);
  zero_rule_side.transition().duration(2000).attr("y1", y_side(0))
    .attr("y2", y_side(0))
    .attr("x2", side_panel_width);

  
  var side_company = side_panel_graph.selectAll("rect")
        .data(side_data.values.prods);
        
      side_company.enter().append("rect")
       .style("opacity", 0)
       .attr("y",side_panel_height)
       .attr("class", ".sidebar")
       .attr("height",0)
       .on("mouseover", show_rule_side);

      
      side_company.exit().remove();
      
      side_company.transition().duration(2000)
      .attr("width", x_side_prods.rangeBand())
      .attr("x", function(d) { return x_side_prods(d.product); })
      .attr("y", function(d) { return y_side(d.mboed); })
      .attr("height", function(d) { return side_panel_height - y_side(d.mboed); })
      .style("opacity", 1)
      .style("fill", function(d) { return colors_prods(d.product); });
      
      axis_label_side.text("mboe/day");
      axis_label_side_right.text("mmcfe/day");
      side_graph_legend.text("Average Daily Production in Q2 2015 by product");

}

function prod_s_side() {
  
  side_graph_mode = "PROD_S";
  y_side.domain([0, side_data.prod_total * 1.05]);
  y_side_right.domain([0, side_data.prod_total * 1.05 * 6]);
  adjustAxes(3, null);
  zero_rule_side.transition().duration(2000).attr("y1", y_side(0))
    .attr("y2", y_side(0))
    .attr("x2", side_panel_width);
  
  var side_company = side_panel_graph.selectAll("rect")
        .data(side_data.values.prods);
        
      side_company.enter().append("rect")
       .style("opacity", 0)
       .attr("y",side_panel_height)
       .attr("class", ".sidebar")
       .attr("height",0)
       .on("mouseover", show_rule_side);

      
      side_company.exit().remove();

      var base = 0;

      side_company.transition().duration(2000)
      .attr("width", x_side_prods.rangeBand())
      .attr("x", function(d) { return x_side_prods(d.product); })
      .attr("y", function(d) {
        var b = base;
        base += d.mboed;
        if(d.product == "gas") {base = 0;}
       return y_side(b + d.mboed); })
      .attr("height", function(d) { return side_panel_height - y_side(d.mboed); })
      .style("opacity", 1)
      .style("fill", function(d) { return colors_prods(d.product); });
      
      axis_label_side.text("mboe/day");
      axis_label_side_right.text("mmcfe/day");
      side_graph_legend.text("Average Daily Production in Q2 2015 - totaled");


}

function rev_un_side() {
  
  
  side_graph_mode = "REV_UN";
  y_side.domain([0, (d3.max(side_data.values.prods, function(d) {return (d.mboed * (d.price/1000) * q2);}) ) * 1.05]);
  y_side_right.domain([0, (d3.max(side_data.values.prods, function(d) {return (d.mboed * (d.price/1000) * q2);}) ) * 1.05 * 4]);
  adjustAxes(3, dollars);
  zero_rule_side.transition().duration(2000).attr("y1", y_side(0))
    .attr("y2", y_side(0))
    .attr("x2", side_panel_width);
  
  var side_company = side_panel_graph.selectAll("rect")
        .data(side_data.values.prods);
        
      side_company.enter().append("rect")
       .style("opacity", 0)
       .attr("y",side_panel_height)
       .attr("class", ".sidebar")
       .attr("height",0)
       .on("mouseover", show_rule_side);

      
      side_company.exit().remove();
      
      side_company.transition().duration(2000)
      .attr("width", x_side_prods.rangeBand())
      .attr("x", function(d) { return x_side_prods(d.product); })
      .attr("y", function(d) { return y_side(d.mboed * (d.price/1000) * q2); })
      .attr("height", function(d) { return side_panel_height - y_side(d.mboed * (d.price/1000) * q2); })
      .style("opacity", 1)
      .style("fill", function(d) { return colors_prods(d.product); });
      
      axis_label_side.text("$MM/quarter");
      axis_label_side_right.text("$MM annualized");
      side_graph_legend.text("Q2 2015 Production Revenue by product");

}

function rev_s_side() {
  
  side_graph_mode = "REV_S";
  y_side.domain([0, side_data.rev_total * 1.05]);
  y_side_right.domain([0, side_data.rev_total * 1.05 * 4]);
  adjustAxes(3, dollars);
  zero_rule_side.transition().duration(2000).attr("y1", y_side(0))
    .attr("y2", y_side(0))
    .attr("x2", side_panel_width);
  
  var side_company = side_panel_graph.selectAll("rect")
        .data(side_data.values.prods);
        
      side_company.enter().append("rect")
       .style("opacity", 0)
       .attr("y",side_panel_height)
       .attr("class", ".sidebar")
       .attr("height",0)
       .on("mouseover", show_rule_side);

      
      side_company.exit().remove();

      var base = 0;

      side_company.transition().duration(2000)
      .attr("width", x_side_prods.rangeBand())
      .attr("x", function(d) { return x_side_prods(d.product); })
      .attr("y", function(d) {
        var b = base;
        base += (d.mboed * (d.price/1000) * q2);
        if(d.product == "gas") {base = 0;}
       return y_side(b + (d.mboed * (d.price/1000) * q2)); })
      .attr("height", function(d) { return side_panel_height - y_side(d.mboed * (d.price/1000) * q2); })
      .style("opacity", 1)
      .style("fill", function(d) { return colors_prods(d.product); });

      axis_label_side.text("$MM/quarter");
      axis_label_side_right.text("$MM annualized");
      side_graph_legend.text("Q2 2015 Production Revenue - totaled");
}


function price_un_side() {
  
  
  side_graph_mode = "PRICE_UN";
  y_side.domain([0, (d3.max(side_data.values.prods, function(d) {return d.price;}) ) * 1.05]);
  y_side_right.domain([0, (d3.max(side_data.values.prods, function(d) {return d.price;}) ) * 1.05 / 6]);
  adjustAxes(3, dollars);
  zero_rule_side.transition().duration(2000).attr("y1", y_side(0))
    .attr("y2", y_side(0))
    .attr("x2", side_panel_width);
  
  var side_company = side_panel_graph.selectAll("rect")
        .data(side_data.values.prods);
        
      side_company.enter().append("rect")
       .style("opacity", 0)
       .attr("y",side_panel_height)
       .attr("class", ".sidebar")
       .attr("height",0)
       .on("mouseover", show_rule_side);

      
      side_company.exit().remove();
      
      side_company.transition().duration(2000)
      .attr("width", x_side_prods.rangeBand())
      .attr("x", function(d) { return x_side_prods(d.product); })
      .attr("y", function(d) { return y_side(d.price); })
      .attr("height", function(d) { return side_panel_height - y_side(d.price); })
      .style("opacity", 1)
      .style("fill", function(d) { return colors_prods(d.product); });
      
      axis_label_side.text("$ per boe");
      axis_label_side_right.text("$ per mcfe");
      side_graph_legend.text("Price per Boe/Mcfe, by product");
}

function price_s_side() {
  
  
  side_graph_mode = "PRICE_S";
  y_side.domain([0, side_data.boe_price * 1.05]);
  y_side_right.domain([0, side_data.boe_price * 1.05 / 6]);
  adjustAxes(3, dollars);
  zero_rule_side.transition().duration(2000).attr("y1", y_side(0))
    .attr("y2", y_side(0))
    .attr("x2", side_panel_width);
  
  var side_company = side_panel_graph.selectAll("rect")
        .data(side_data.values.prods);
        
      side_company.enter().append("rect")
       .style("opacity", 0)
       .attr("y",side_panel_height)
       .attr("class", ".sidebar")
       .attr("height",0)
       .on("mouseover", show_rule_side);

      
      side_company.exit().remove();
      var base = 0;
      side_company.transition().duration(2000)
      .attr("width", x_side_prods.rangeBand())
      .attr("x", function(d) { return x_side_prods(d.product); })
      .attr("y", function(d)
      {
        var b = base;
        base += (d.mboed * d.price) / side_data.prod_total;
  
        if(d.product == "gas") {base = 0;};
        return y_side(b + (d.mboed * d.price) / side_data.prod_total);
      })
      .attr("height", function(d) { return side_panel_height - y_side((d.mboed * d.price) / side_data.prod_total); })
      .style("opacity", 1)
      .style("fill", function(d) { return colors_prods(d.product); });
      
      axis_label_side.text("$ per boe");
      axis_label_side_right.text("$ per mcfe");
      side_graph_legend.text("Boe/Mcfe Unit Price - composite");

}

function inc_qu_un_side() {
  
  
  side_graph_mode = "INC_QU_UN";
  
    var zero = side_data.values.corp[0].dollars;
    if (zero >= 0) {zero = 0;}
    else {zero = zero * 1.1;}

      
     y_side.domain([zero, side_data.values.corp[3].dollars * 1.05]);
     y_side_right.domain([zero * 4, side_data.values.corp[3].dollars * 1.05 *4]);
                
    adjustAxes(4, dollars);
    zero_rule_side.transition().duration(2000).attr("y1", y_side(0))
      .attr("y2", y_side(0))
      .attr("x2", side_panel_width_plus);
    
  var side_company = side_panel_graph.selectAll("rect")
        .data(side_data.values.corp);
        
      side_company.enter().append("rect")
       .style("opacity", 0)
       .attr("y",side_panel_height)
       .attr("class", ".sidebar")
       .attr("height",0)
       .on("mouseover", show_rule_side);

      
      side_company.exit().remove();
      
      side_company.transition().duration(2000)
      .attr("width", x_side_corp.rangeBand())
      .attr("x", function(d) { return x_side_corp(d.metric); })
      .attr("y", function(d) { if (d.dollars<0) return y_side(0);
        else {return y_side(d.dollars);}
        })
        .attr("height", function(d) { if (d.dollars < 0) return (y_side(d.dollars) - y_side(0));
        else { return y_side(0) - y_side(d.dollars); }
        })
      .style("opacity", 1)
      .style("fill", function(d) { return colors_income(d.metric); });
      
      axis_label_side.text("$MM/quarter");
      axis_label_side_right.text("$MM annualized");
      side_graph_legend.text("Q2 2015 Production Income Metrics");

}


function inc_qu_s_side() {
  
  side_graph_mode = "INC_QU_S";
  
    var zero = side_data.values.corp[0].dollars;
    if (zero >= 0) {zero = 0;}
    else {zero = zero * 1.1;}
  
  
     y_side.domain([zero, side_data.values.corp[3].dollars * 1.05]);
     y_side_right.domain([zero * 4, side_data.values.corp[3].dollars * 1.05 *4]);
;
  adjustAxes(4, dollars, "costs");
  
  zero_rule_side.transition().duration(2000).attr("y1", y_side(0))
      .attr("y2", y_side(0))
      .attr("x2", side_panel_width_plus);
  
    var side_company = side_panel_graph.selectAll("rect")
        .data(side_data.values.corp);
        
      side_company.enter().append("rect")
       .style("opacity", 0)
       .attr("y",side_panel_height)
       .attr("class", ".sidebar")
       .attr("height",0)
       .on("mouseover", show_rule_side);

      
      side_company.exit().remove();
      
      var base = 0;
  
    side_company.transition().duration(2000)
      .attr("width", x_side_corp.rangeBand())
      .attr("x", function(d) { return x_side_corp(d.metric); })
      .attr("y", function(d) {
        var b = base;
          base += d.dif_dollars;
          if(d.metric == "postHedge") {base = 0;}
        return y_side(b + d.dif_dollars);
      })
      .attr("height", function(d) { if (d.dif_dollars < 0) {return 0;}
         else { return y_side(0) - y_side(d.dif_dollars); }
      })
      .style("opacity", 1)
      .style("fill", function(d) { return colors_income_s(d.metric); });
  
      axis_label_side.text("$MM/quarter");
      axis_label_side_right.text("$MM annualized");
      side_graph_legend.text("Q2 2015 Production Cost Analysis");
  
}

function inc_boe_un_side() {
  
  side_graph_mode = "INC_BOE_UN";
  
    var zero = side_data.values.corp[0].percent * side_data.boe_price_hedged;
    if (zero >= 0) {zero = 0;}
    else {zero = zero * 1.1;}

  
  y_side.domain([zero, side_data.boe_price_hedged * 1.05]);
  y_side_right.domain([zero/6, side_data.boe_price_hedged * 1.05/6]);
  adjustAxes(4, dollars);
  
  zero_rule_side.transition().duration(2000).attr("y1", y_side(0))
      .attr("y2", y_side(0))
      .attr("x2", side_panel_width_plus);
  
  var side_company = side_panel_graph.selectAll("rect")
        .data(side_data.values.corp);
        
      side_company.enter().append("rect")
       .style("opacity", 0)
       .attr("y",side_panel_height)
       .attr("class", ".sidebar")
       .attr("height",0)
       .on("mouseover", show_rule_side);

      
      side_company.exit().remove();
      
      side_company.transition().duration(2000)
      .attr("width", x_side_corp.rangeBand())
      .attr("x", function(d) { return x_side_corp(d.metric); })
     
      .attr("y", function(d) { if (d.percent * side_data.boe_price_hedged < 0) return y_side(0);
        else {return y_side(d.percent * side_data.boe_price_hedged);}
        })
      .attr("height", function(d) { if (d.percent * side_data.boe_price_hedged < 0) return (y_side(d.percent * side_data.boe_price_hedged) - y_side(0));
        else { return y_side(0) - y_side(d.percent * side_data.boe_price_hedged); }
        })
      .style("opacity", 1)
      .style("fill", function(d) { return colors_income(d.metric); });
  
  
      axis_label_side.text("$ per boe");
      axis_label_side_right.text("$ per mcfe");
      side_graph_legend.text("Production Income Metrics - per Barrel Equivalent");

}


function inc_boe_s_side() {
  
  side_graph_mode = "INC_BOE_S";
  
      var zero = side_data.values.corp[0].percent * side_data.boe_price_hedged;
    if (zero >= 0) {zero = 0;}
    else {zero = zero * 1.1;}
    
  y_side.domain([zero, side_data.boe_price_hedged * 1.05]);
  y_side_right.domain([zero/6, side_data.boe_price_hedged * 1.05/6]);
  adjustAxes(4, dollars, "costs");
  
  zero_rule_side.transition().duration(2000).attr("y1", y_side(0))
      .attr("y2", y_side(0))
      .attr("x2", side_panel_width_plus);
  
     var side_company = side_panel_graph.selectAll("rect")
        .data(side_data.values.corp);
        
      side_company.enter().append("rect")
       .style("opacity", 0)
       .attr("y",side_panel_height)
       .attr("class", ".sidebar")
       .attr("height",0)
       .on("mouseover", show_rule_side);

      side_company.exit().remove();
      
      var base = 0;
  
    side_company.transition().duration(2000)
      .attr("width", x_side_corp.rangeBand())
      .attr("x", function(d) { return x_side_corp(d.metric); })
      .attr("y", function(d) {
        var b = base;
          base += side_data.boe_price_hedged * d.difference;
          if(d.metric == "postHedge") {base = 0;}
        return y_side(b + side_data.boe_price_hedged * d.difference);
      })
      .attr("height", function(d) { if (side_data.boe_price_hedged * d.difference < 0) {return 0;}
         else { return y_side(0) - y_side(side_data.boe_price_hedged * d.difference); }
      })
      .style("opacity", 1)
      .style("fill", function(d) { return colors_income_s(d.metric); });
  
      axis_label_side.text("$ per boe");
      axis_label_side_right.text("$ per mcfe");
      side_graph_legend.text("Production Cost Analysis - per Barrel Equivalent");
}

function inc_perc_un_side() {
  
  side_graph_mode = "INC_PERC_UN";
  
    
    var zero = side_data.values.corp[0].percent;
    if (zero >= 0) {zero = 0;}
    else {zero = zero * 1.1;}
    
  y_side.domain([zero, 1.05]);
  y_side_right.domain([zero, 1.05]);
  adjustAxes(4, percent);
  zero_rule_side.transition().duration(2000).attr("y1", y_side(0))
      .attr("y2", y_side(0))
      .attr("x2", side_panel_width_plus);
  
  var side_company = side_panel_graph.selectAll("rect")
        .data(side_data.values.corp);
        
      side_company.enter().append("rect")
       .style("opacity", 0)
       .attr("y",side_panel_height)
       .attr("class", ".sidebar")
       .attr("height",0)
       .on("mouseover", show_rule_side);

      
      side_company.exit().remove();
      
      side_company.transition().duration(2000)
      .attr("width", x_side_corp.rangeBand())
      .attr("x", function(d) { return x_side_corp(d.metric); })
      .attr("y", function(d) { if (d.percent < 0) return y_side(0);
        else {return y_side(d.percent);}
        })
      .attr("height", function(d) { if (d.percent < 0) return (y_side(d.percent) - y_side(0));
        else { return y_side(0) - y_side(d.percent); }
        })
      .style("opacity", 1)
      .style("fill", function(d) { return colors_income(d.metric); });
  
      axis_label_side.text("percent");
      axis_label_side_right.text("percent");
      side_graph_legend.text("Production Income Metrics - % of post-hedge revenue");

  
}
function inc_perc_s_side() {
  
  side_graph_mode = "INC_PERC_S";
  
    var zero = side_data.values.corp[0].percent;
    if (zero >= 0) {zero = 0;}
    else {zero = zero * 1.1;}
    
  y_side.domain([zero, 1.05]);
  y_side_right.domain([zero, 1.05]);
  adjustAxes(4, percent, "costs");
  zero_rule_side.transition().duration(2000).attr("y1", y_side(0))
      .attr("y2", y_side(0))
      .attr("x2", side_panel_width_plus);
  
    var side_company = side_panel_graph.selectAll("rect")
        .data(side_data.values.corp);
  
        side_company.enter().append("rect")
       .style("opacity", 0)
       .attr("y",side_panel_height)
       .attr("class", ".sidebar")
       .attr("height",0)
       .on("mouseover", show_rule_side);

      
      side_company.exit().remove();
      
      var base = 0;
  
    side_company.transition().duration(2000)
      .attr("width", x_side_corp.rangeBand())
      .attr("x", function(d) { return x_side_corp(d.metric); })
      .attr("y", function(d) {
        var b = base;
          base += d.difference;
          if(d.metric == "postHedge") {base = 0;}
        return y_side(b + d.difference);
      })
      .attr("height", function(d) { if (d.difference < 0) {return 0;}
         else { return y_side(0) - y_side(d.difference); }
      })
      .style("opacity", 1)
      .style("fill", function(d) { return colors_income_s(d.metric); });
  
  
      axis_label_side.text("percent");
      axis_label_side_right.text("percent");
      side_graph_legend.text("Production Cost Analysis - % of post-hedge revenue");
}

function reserves_un_side() {
  
  side_graph_mode = "RESERVES_UN";
  y_side.domain([0, (d3.max(side_data.values.reserves, function(d) {return d.mmboe;}) ) * 1.05]);
  y_side_right.domain([0, (d3.max(side_data.values.reserves, function(d) {return d.mmboe;}) ) * 1.05 * 6]);
  adjustAxes(6, null);
  zero_rule_side.transition().duration(2000).attr("y1", y_side(0))
      .attr("y2", y_side(0))
      .attr("x2", side_panel_width_plus_plus);
  
  var side_company = side_panel_graph.selectAll("rect")
        .data(side_data.values.reserves);
        
      side_company.enter().append("rect")
       .style("opacity", 0)
       .attr("y",side_panel_height)
       .attr("class", ".sidebar")
       .attr("height",0)
       .style("cursor", "pointer")
       .on("mouseover", show_rule_side);

      
      side_company.exit().remove();
      
      side_company.transition().duration(2000)
      .attr("width", x_side_reserves.rangeBand())
      .attr("x", function(d) { return x_side_reserves(d.div); })
      .attr("y", function(d) { return y_side(d.mmboe); })
      .attr("height", function(d) { return side_panel_height - y_side(d.mmboe); })
      .style("opacity", 1)
      .style("fill", function(d) { return colors_reserves(d.div); });
      
      axis_label_side.text("MMboe");
      axis_label_side_right.text("Bcfe");
      side_graph_legend.text("Proved Reserves (12/31/14) - Analyzed");

}

function reserves_s_side() {
  
  side_graph_mode = "RESERVES_S";
  y_side.domain([0, side_data.pr_total * 1.05]);
  y_side_right.domain([0, side_data.pr_total * 1.05 * 6]);
  adjustAxes(6, null);
  zero_rule_side.transition().duration(2000).attr("y1", y_side(0))
      .attr("y2", y_side(0))
      .attr("x2", side_panel_width_plus_plus);
  
  var side_company = side_panel_graph.selectAll("rect")
        .data(side_data.values.reserves);
        
      side_company.enter().append("rect")
       .style("opacity", 0)
       .attr("y",side_panel_height)
       .attr("class", ".sidebar")
       .attr("height",0)
       .style("cursor", "pointer")
       .on("mouseover", show_rule_side);

      
      side_company.exit().remove();
      
    var base = 0;

     side_company.transition().duration(2000)
      .attr("width", x_side_reserves.rangeBand())
      .attr("x", function(d) { return x_side_reserves(d.div); })
      .attr("y", function(d) {
          var b = base;
          base += d.mmboe;
          if(d.div == "gas pud") {base = 0;}
          return y_side(b + (d.mmboe)) ;})
      .attr("height", function(d) { return side_panel_height - y_side(d.mmboe); })
      .style("opacity", 1)
      .style("fill", function(d) { return colors_reserves(d.div); });
      
      axis_label_side.text("MMboe");
      axis_label_side_right.text("Bcfe");
      side_graph_legend.text("Proved Reserves (12/31/14) - Totaled");

}

function capex_side() {
  
  
  side_graph_mode = "CAPEX";
  
    var zero = d3.min(current_data, function(d) { return (d.capex[1].value); }); //look for negative cash margin
    if (zero >= 0) {zero = 0;}
    else {zero = zero * 1.1;}
  
  y_side.domain([zero, side_data.capex[0].value * 1.05]);
  y_side_right.domain(y_side.domain());
  
  adjustAxes(2, dollars, "capex");
   zero_rule_side.transition().duration(2000).attr("y1", y_side(0))
      .attr("y2", y_side(0))
      .attr("x2", side_panel_width);
  
  var side_company = side_panel_graph.selectAll("rect")
        .data(side_data.capex);
        
        
        
      side_company.enter().append("rect")
       .style("opacity", 0)
       .attr("y",side_panel_height)
       .attr("class", ".sidebar")
       .attr("height",0)
       .on("mouseover", show_rule_side);

      side_company.exit().remove();

      side_company.transition().duration(2000)
      .attr("width", x_side_capex.rangeBand())
      .attr("x", function(d) {return x_side_capex(d.name); })
      
      //.attr("y", function(d) { return y_side(d.value); })
      //.attr("height", function(d) { return side_panel_height - y_side(d.value); })
      
     .attr("y", function(d) { if (d.value<0) return y_side(0);
        else {return y_side(d.value);}
        })
      .attr("height", function(d) { if (d.value < 0) return (y_side(d.value) - y_side(0));
        else { return y_side(0) - y_side(d.value); }
        })
      .style("opacity", 1)
      .style("fill", function(d) { return colors_capex(d.name); });
      
      
      axis_label_side.text("$MM/quarter");
      axis_label_side_right.text("$MM/quarter");
      side_graph_legend.text("E&P Capital Expenditures");

}


function hedge_side() {
  
  
  side_graph_mode = "HEDGE";
  

    if (side_data.hedge >= 0) {
        y_side.domain([0, side_data.hedge/side_data.rev_total * 1.05]);
        y_side_right.domain([0,side_data.hedge/side_data.rev_total * 1.05]);
    }
    else {
        y_side.domain([side_data.hedge/side_data.rev_total * 1.05, 0]);
        y_side_right.domain([side_data.hedge/side_data.rev_total * 1.05, 0]);
    }

  adjustAxes(1, percent, "hedge");
   zero_rule_side.transition().duration(2000).attr("y1", y_side(0))
      .attr("y2", y_side(0))
      .attr("x2", side_panel_width);
  
  var side_company = side_panel_graph.selectAll("rect")
        .data([side_data.hedge/side_data.rev_total]);
        
      side_company.enter().append("rect")
       .style("opacity", 0)
       .attr("y",side_panel_height)
       .attr("class", ".sidebar")
       .attr("height",0)
       .on("mouseover", show_rule_side);

      side_company.exit().remove();

      side_company.transition().duration(2000)
      .attr("width", x_side_hedge.rangeBand())
      .attr("x", function(d) { return x_side_hedge("hedge impact"); })
      .attr("y", function(d) { if (d < 0) return y_side(0);
        else {return y_side(d);}
        })
      .attr("height", function(d) { if (d < 0) return (y_side(d) - y_side(0));
        else { return y_side(0) - y_side(d); }
        })
      .style("opacity", 1)
      .style("fill", "lightgreen");
      
      axis_label_side.text("percent");
      axis_label_side_right.text("percent");
      side_graph_legend.text("Hedge Impact - % of unhedged revenue");

}
function hedge_boe_side() {
  
  
  side_graph_mode = "HEDGE_BOE";
  
    if (side_data.hedge >= 0) {
        y_side.domain([0, (side_data.boe_price_hedged - side_data.boe_price) * 1.05]);
        y_side_right.domain([0, (side_data.boe_price_hedged - side_data.boe_price) * 1.05/6]);
    }
    else { console.log("yes");
        y_side.domain([(side_data.boe_price_hedged - side_data.boe_price) * 1.05, 0]);
        y_side_right.domain([d3.round( (side_data.boe_price_hedged - side_data.boe_price) * (1.05/6) ,0), d3.round(0,0)]);
    }

  adjustAxes(1, dollars, "hedge");
   zero_rule_side.transition().duration(2000).attr("y1", y_side(0))
      .attr("y2", y_side(0))
      .attr("x2", side_panel_width);
  
  var side_company = side_panel_graph.selectAll("rect")
        .data([side_data.boe_price_hedged - side_data.boe_price]);
        
      side_company.enter().append("rect")
       .style("opacity", 0)
       .attr("y",side_panel_height)
       .attr("class", ".sidebar")
       .attr("height",0)
       .on("mouseover", show_rule_side);

      side_company.exit().remove();

      side_company.transition().duration(2000)
      .attr("width", x_side_hedge.rangeBand())
      .attr("x", function(d) { return x_side_hedge("hedge impact"); })
      .attr("y", function(d) { if (d < 0) return y_side(0);
        else {return y_side(d);}
        })
      .attr("height", function(d) { if (d < 0) return (y_side(d) - y_side(0));
        else { return y_side(0) - y_side(d); }
        })
      .style("opacity", 1)
      .style("fill", "lightgreen");
      
      axis_label_side.text("$ per BOE");
      axis_label_side_right.text("$ per MCFE");
      side_graph_legend.text("Hedge Impact in $ per BOE (MCFE)");

}

function debt_ebitda_side() {
  
  
  side_graph_mode = "DEBT_EBITDA";
  
        y_side.domain([0, (side_data.debt/(side_data.values.corp[2].dollars * 4)) * 1.05]);
        y_side_right.domain(y_side.domain());

  adjustAxes(1, null, "debt_ebitda");
   zero_rule_side.transition().duration(2000).attr("y1", y_side(0))
      .attr("y2", y_side(0))
      .attr("x2", side_panel_width);
  
  var side_company = side_panel_graph.selectAll("rect")
        .data([side_data.debt/(side_data.values.corp[2].dollars * 4)]);
        
      side_company.enter().append("rect")
       .style("opacity", 0)
       .attr("y",side_panel_height)
       .attr("class", ".sidebar")
       .attr("height",0)
       .on("mouseover", show_rule_side);

      side_company.exit().remove();

      side_company.transition().duration(2000)
      .attr("width", x_side_debt_ebitda.rangeBand())
      .attr("x", function(d) { return x_side_debt_ebitda("debt/ebitda"); })
      .attr("y", function(d) {return y_side(d);})
      .attr("height", function(d) { return y_side(0) - y_side(d); })
      .style("opacity", 1)
      .style("fill", "green");
      
      axis_label_side.text("multiple");
      axis_label_side_right.text("multiple");
      side_graph_legend.text("Net Debt/EBITDA Ratio (LQA EBITDA)");

}



function ev_side() {
  
  
  side_graph_mode = "EV";
  
        y_side.domain([0, (side_data.ev[0].value + side_data.ev[1].value)  * 1.05]);
        y_side_right.domain(y_side.domain());

  adjustAxes(2, dollars, "ev");
   zero_rule_side.transition().duration(2000).attr("y1", y_side(0))
      .attr("y2", y_side(0))
      .attr("x2", side_panel_width);
      
  var base = 0;
  
  var side_company = side_panel_graph.selectAll("rect")
        .data(side_data.ev);
        
      side_company.enter().append("rect")
       .style("opacity", 0)
       .attr("y",side_panel_height)
       .attr("class", ".sidebar")
       .attr("height",0)
       .on("mouseover", show_rule_side);

      side_company.exit().remove();

      side_company.transition().duration(2000)
      .attr("width", x_side_ev.rangeBand())
      .attr("x", function(d) { return x_side_ev(d.name); })
      .attr("y", function(d) {
        var b = base;
        base += d.value;
        if(d.name == "debt") {base = 0;}
       return y_side(b + d.value); })
      .attr("height", function(d) { return y_side(0) - y_side( d.value); })
      .style("opacity", 1)
      .style("fill", function(d) { return colors_ev(d.name); });
      
      axis_label_side.text("$MM");
      axis_label_side_right.text("$MM");
      side_graph_legend.text("Enterpirse Value (EV)");

}

function ev_ebitda_side() {
  
  
  side_graph_mode = "EV_EBITDA";
  
        y_side.domain([0, ((side_data.ev[0].value + side_data.ev[1].value)/(side_data.values.corp[2].dollars * 4)) * 1.05]);
        y_side_right.domain(y_side.domain());

  adjustAxes(1, null, "ev_ebitda");
   zero_rule_side.transition().duration(2000).attr("y1", y_side(0))
      .attr("y2", y_side(0))
      .attr("x2", side_panel_width);
  
  var side_company = side_panel_graph.selectAll("rect")
        .data([(side_data.ev[0].value + side_data.ev[1].value)/(side_data.values.corp[2].dollars * 4)]);
        
      side_company.enter().append("rect")
       .style("opacity", 0)
       .attr("y",side_panel_height)
       .attr("class", ".sidebar")
       .attr("height",0)
       .on("mouseover", show_rule_side);

      side_company.exit().remove();

      side_company.transition().duration(2000)
      .attr("width", x_side_debt_ebitda.rangeBand())
      .attr("x", function(d) { return x_side_ev_ebitda("ev/ebitda"); })
      .attr("y", function(d) {return y_side(d);})
      .attr("height", function(d) { return y_side(0) - y_side(d); })
      .style("opacity", 1)
      .style("fill", "green");
      
      axis_label_side.text("multiple");
      axis_label_side_right.text("multiple");
      side_graph_legend.text("EV/EBITDA Ratio (LQA EBITDA)");

}

function pr_dashare_side() {
  
  
  side_graph_mode = "PR_DASHARE";
  
        y_side.domain([0, (side_data.pr_total/side_data.da_shares) * 1.05]);
        y_side_right.domain([0, (side_data.pr_total/side_data.da_shares) * 6 * 1.05]);

  adjustAxes(1, null, "pr_dashare");
   zero_rule_side.transition().duration(2000).attr("y1", y_side(0))
      .attr("y2", y_side(0))
      .attr("x2", side_panel_width);
  
  var side_company = side_panel_graph.selectAll("rect")
        .data([side_data.pr_total/side_data.da_shares]);
        
      side_company.enter().append("rect")
       .style("opacity", 0)
       .attr("y",side_panel_height)
       .attr("class", ".sidebar")
       .attr("height",0)
       .on("mouseover", show_rule_side);

      side_company.exit().remove();

      side_company.transition().duration(2000)
      .attr("width", x_side_pr_dashare.rangeBand())
      .attr("x", function(d) { return x_side_pr_dashare("reserves/share"); })
      .attr("y", function(d) {return y_side(d);})
      .attr("height", function(d) { return y_side(0) - y_side(d); })
      .style("opacity", 1)
      .style("fill", "green");
      
      axis_label_side.text("boe/share");
      axis_label_side_right.text("mcfe/share");
      side_graph_legend.text("Proved Reserves per Debt-Adjusted Share");

}

function prod_dashare_side() {
  
  
  side_graph_mode = "PROD_DASHARE";
  
        y_side.domain([0, ((side_data.prod_total * 365/1000)/side_data.da_shares) * 1.05]);
        y_side_right.domain([0, ((side_data.prod_total * 365/1000)/side_data.da_shares) * 6 * 1.05]);

  adjustAxes(1, null, "pr_dashare");
   zero_rule_side.transition().duration(2000).attr("y1", y_side(0))
      .attr("y2", y_side(0))
      .attr("x2", side_panel_width);
  
  var side_company = side_panel_graph.selectAll("rect")
        .data([(side_data.prod_total * 365/1000)/side_data.da_shares]);
        
      side_company.enter().append("rect")
       .style("opacity", 0)
       .attr("y",side_panel_height)
       .attr("class", ".sidebar")
       .attr("height",0)
       .on("mouseover", show_rule_side);

      side_company.exit().remove();

      side_company.transition().duration(2000)
      .attr("width", x_side_prod_dashare.rangeBand())
      .attr("x", function(d) { return x_side_prod_dashare("production/share"); })
      .attr("y", function(d) {return y_side(d);})
      .attr("height", function(d) { return y_side(0) - y_side(d); })
      .style("opacity", 1)
      .style("fill", "green");
      
      axis_label_side.text("boe/share");
      axis_label_side_right.text("mcfe/share");
      side_graph_legend.text("Annual Production (LQA) per Debt-Adjusted Share");

}

// end of side graph mode functions

// start side graph rule block
var side_panel_rule = side_panel.append("g")
  .style("visibility", "hidden")
  .attr("transform", "translate(0, 30)");
  
var zero_rule_side = side_panel.append("line")
      .attr("transform", "translate(0, 30)")
      .attr("x1", 0 )
      .attr("x2", side_panel_width)
      .attr("y1", side_panel_height)
      .attr("y2", side_panel_height)
      .style("stroke", "black")
      .style("shape-rendering", "crispEdges")
      .style("stroke-width", 1);

var rule_side = side_panel_rule.append("rect")
      .attr("x", 0 )
      .attr("width", side_panel_width)
      .attr("y", 150)
      .attr("height", 1 );
      
var text_left_side = side_panel_rule.append("text")
      .attr("x", 10 )
      .attr("y", 150)
      .text("")
      .classed("label", true)
      .style("font-size", "11px");
      
var text_center_side = side_panel_rule.append("text")
      .attr("x", 10 )
      .attr("y", 150)
      .text("")
      .classed("label", true)
      .style("font-size", "11px");
      
var text_right_side = side_panel_rule.append("text")
      .attr("x", 10 )
      .attr("y", 150)
      .text("")
      .classed("label", true)
      .style("font-size", "11px");

      
function show_rule_side(ob) {

              var s = d3.select(this);
              side_panel_rule.style("visibility", "visible");
              var rule_y_side;  //to address negative values
              
             if (ob.percent < 0 || ob < 0 || ob.value < 0) {console.log("neg"); rule_y_side = +s.attr("height") + (+s.attr("y"));}
             else { rule_y_side = s.attr("y");}
             
      rule_side.attr("y", rule_y_side);
      rule_side.style("fill", s.style("fill"));
      text_left_side.attr("y", rule_side.attr("y") - 4);
      text_right_side.attr("y", rule_side.attr("y") - 4);

        
  switch(side_graph_mode) {

    case "PROD_UN":
        text_left_side.text(ob.mboed);
        text_left_side.attr("x", 1);
        text_left_side.attr("text-anchor", "start");

        text_center_side.attr("x",  (+s.attr("x") + (x_side_prods.rangeBand()/2) )  );
        text_center_side.text(percent(ob.mboed/side_data.prod_total));
        text_center_side.attr("text-anchor", "middle");
        text_center_side.attr("y", rule_side.attr("y") - 4);
        
        text_right_side.text(d3.round((ob.mboed * 6),0));
        text_right_side.attr("x", side_panel_width);
        text_right_side.attr("text-anchor", "end");
        break;
        
    case "PROD_S":
      console.log(rule_y_side);
        text_left_side.text(d3.round(y_side.invert(rule_y_side),1));
        text_left_side.attr("x",1);
        text_left_side.attr("text-anchor", "start");
        
        text_center_side.attr("x",  (+s.attr("x") + (x_side_prods.rangeBand()*1.1) )  );
        text_center_side.text(percent( y_side.invert(side_panel_height - s.attr("height")) / side_data.prod_total));
        text_center_side.attr("text-anchor", "start");
        text_center_side.attr("y", +s.attr("y") + (+s.attr("height")/2) );
        
        text_right_side.text(d3.round((y_side.invert(rule_y_side)*6),0));
        text_right_side.attr("x", side_panel_width);
        text_right_side.attr("text-anchor", "end");
        break;
        
    case "REV_UN":
        text_left_side.text(dollars(d3.round(ob.mboed * (ob.price/1000) * q2),0));
        text_left_side.attr("x", 0);
        text_left_side.attr("text-anchor", "start");
        
        text_center_side.attr("x",  (+s.attr("x") + (x_side_prods.rangeBand()/2) )  );
        text_center_side.text(percent(  (ob.mboed * (ob.price/1000) * q2)  / side_data.rev_total));
        text_center_side.attr("text-anchor", "middle");
        text_center_side.attr("y", rule_side.attr("y") - 4);
        
        text_right_side.text(dollars(d3.round(ob.mboed * (ob.price/1000 * 4) * q2),0));
        text_right_side.attr("x", side_panel_width);
        text_right_side.attr("text-anchor", "end");
        break;
        
    case "REV_S":
        text_left_side.text(dollars(d3.round(y_side.invert(rule_y_side),0)));
        text_left_side.attr("x",0);
        text_left_side.attr("text-anchor", "start");
        
        text_center_side.attr("x",  (+s.attr("x") + (x_side_prods.rangeBand()*1.1) )  );
        //text_center_side.text(percent( y_side.invert(rule_y_side)  / side_data.rev_total));  //cumed percent
        text_center_side.text(percent( y_side.invert(side_panel_height - s.attr("height")) / side_data.rev_total)); //individual percent
        text_center_side.attr("text-anchor", "start");
        text_center_side.attr("y", +s.attr("y") + (+s.attr("height")/2) );
        
        text_right_side.text(dollars(d3.round(y_side.invert(rule_y_side) *4 ,0)));
        text_right_side.attr("x", side_panel_width);
        text_right_side.attr("text-anchor", "end");
        break;

    case "PRICE_UN":
        text_left_side.text(dollars(ob.price));
        text_left_side.attr("x", 1);
        text_left_side.attr("text-anchor", "start");
        
        text_center_side.text("");
        text_center_side.attr("y", rule_side.attr("y") - 4);
        
        text_right_side.text(dollars(d3.round((ob.price / 6),2)));
        text_right_side.attr("x", side_panel_width);
        text_right_side.attr("text-anchor", "end");
        break;
        
    case "PRICE_S":
        text_left_side.text(dollars(d3.round(y_side.invert(rule_y_side),2)  ));
        text_left_side.attr("x",1);
        text_left_side.attr("text-anchor", "start");
        
        text_center_side.attr("x",  (+s.attr("x") + (x_side_prods.rangeBand()*1.1) )  );
        text_center_side.text(percent( y_side.invert(side_panel_height - s.attr("height")) / side_data.boe_price)     );
        text_center_side.attr("text-anchor", "start");
        text_center_side.attr("y", +s.attr("y") + (+s.attr("height")/2) );
        
        text_right_side.text(dollars(d3.round((y_side.invert(rule_y_side)/6),2)));
        text_right_side.attr("x", side_panel_width);
        text_right_side.attr("text-anchor", "end");
        break;
        
    case "INC_QU_UN":
      console.log("inc_un");
        text_left_side.text(dollars(d3.round((ob.dollars),0)));
        text_left_side.attr("x", 1);
        text_left_side.attr("text-anchor", "start");
        
        text_center_side.attr("x",  (+s.attr("x") + (x_side_corp.rangeBand()/2))  );
        text_center_side.text(percent(ob.percent));
        text_center_side.attr("text-anchor", "middle");
        if (rule_side.attr("y") > y_side(0)) {text_center_side.attr("y", y_side(0) - 4);} //negative bars
        else {text_center_side.attr("y", rule_side.attr("y") - 4);}
        
        text_right_side.text(dollars(d3.round((ob.dollars *4),0)));
        text_right_side.attr("x", side_panel_width_plus);
        text_right_side.attr("text-anchor", "end");
        break;
        
    case "INC_QU_S":
        text_left_side.text(dollars(d3.round(y_side.invert(rule_y_side),0)  ));
        text_left_side.attr("x", 1);
        text_left_side.attr("text-anchor", "start");
        
        text_center_side.attr("x",  (+s.attr("x") + (x_side_corp.rangeBand()*1.1) )  );
        text_center_side.text(dollars(d3.round(ob.dif_dollars)));
        text_center_side.attr("text-anchor", "start");
        text_center_side.attr("y", +s.attr("y") + (+s.attr("height")/2 * 1.6) );
        
        text_right_side.text(dollars(d3.round((y_side.invert(rule_y_side)*4),0)));
        text_right_side.attr("x", side_panel_width_plus);
        text_right_side.attr("text-anchor", "end");
        break;
        
    case "INC_BOE_UN":
        text_left_side.text(dollars(d3.round((ob.percent * side_data.boe_price_hedged),2)));
        text_left_side.attr("x", 1);
        text_left_side.attr("text-anchor", "start");
        
        text_center_side.attr("x",  (+s.attr("x") + (x_side_corp.rangeBand()/2))  );
        text_center_side.text(percent(ob.percent));
        text_center_side.attr("text-anchor", "middle");
        if (rule_side.attr("y") > y_side(0)) {text_center_side.attr("y", y_side(0) - 4);} //negative bars
        else {text_center_side.attr("y", rule_side.attr("y") - 4);}
        
        text_right_side.text(dollars(d3.round((ob.percent * side_data.boe_price_hedged / 6),2)));
        text_right_side.attr("x", side_panel_width_plus);
        text_right_side.attr("text-anchor", "end");
        break;
        
    case "INC_BOE_S":
        text_left_side.text(dollars(d3.round(y_side.invert(rule_y_side),2)  ));
        text_left_side.attr("x", 1);
        text_left_side.attr("text-anchor", "start");
        
        text_center_side.attr("x",  (+s.attr("x") + (x_side_corp.rangeBand()*1.1) )  );
        text_center_side.text(dollars(d3.round(ob.difference * side_data.boe_price_hedged  ,2)));
        text_center_side.attr("text-anchor", "start");
        text_center_side.attr("y", +s.attr("y") + (+s.attr("height")/2 * 1.6) );

        text_right_side.text(dollars(d3.round((y_side.invert(rule_y_side)/6),2)));
        text_right_side.attr("x", side_panel_width_plus);
        text_right_side.attr("text-anchor", "end");
        break;

    case "INC_PERC_UN":
        text_left_side.text(percent(ob.percent));
        text_left_side.attr("x", 1);
        text_left_side.attr("text-anchor", "start");
        
        //no center text
        text_center_side.text("");

        
        text_right_side.text(percent(ob.percent));
        text_right_side.attr("x", side_panel_width_plus);
        text_right_side.attr("text-anchor", "end");
        break;
        
    case "INC_PERC_S":
        text_left_side.text(percent(y_side.invert(s.attr("y") ) ));
        text_left_side.attr("x", 1);
        text_left_side.attr("text-anchor", "start");
        
        text_center_side.attr("x",  (+s.attr("x") + (x_side_corp.rangeBand()*1.1) )  );
        text_center_side.text(percent(ob.difference));
        text_center_side.attr("text-anchor", "start");
        text_center_side.attr("y", +s.attr("y") + (+s.attr("height")/2 * 1.6) );

        text_right_side.text("");
        text_right_side.attr("x", side_panel_width_plus);
        text_right_side.attr("text-anchor", "end");
        break;
        
    case "RESERVES_UN":
        text_left_side.text(ob.mmboe);
        text_left_side.attr("x", 1);
        text_left_side.attr("text-anchor", "start");

        text_center_side.attr("x",  (+s.attr("x") + (x_side_reserves.rangeBand()*1.45) )  );
        text_center_side.text(percent(ob.mmboe/side_data.pr_total));
        text_center_side.attr("text-anchor", "middle");
        //text_center_side.attr("y", rule_side.attr("y") - 2);
        text_center_side.attr("y", +s.attr("y") + (+s.attr("height")/2 * .6) );
        
        text_right_side.text(d3.round((ob.mmboe * 6),1));
        text_right_side.attr("x", side_panel_width_plus_plus);
        text_right_side.attr("text-anchor", "end");
        break;
        
    case "RESERVES_S":
        text_left_side.text(d3.round(y_side.invert(rule_y_side)),0);
        text_left_side.attr("x", 1);
        text_left_side.attr("text-anchor", "start");
        
        text_center_side.attr("x",  (+s.attr("x") + (x_side_reserves.rangeBand()*1.1) )  );
        text_center_side.text(ob.mmboe);
        text_center_side.attr("text-anchor", "start");
        text_center_side.attr("y", +s.attr("y") + (+s.attr("height")/2 * 1.6) );

       text_right_side.text(d3.round(y_side.invert(rule_y_side)*6),0);
        text_right_side.attr("x", side_panel_width_plus_plus);
        text_right_side.attr("text-anchor", "end");
        break;
        
     case "CAPEX":
        text_left_side.text(dollars(d3.round(y_side.invert(rule_y_side)),0));
        text_left_side.attr("x", 1);
        text_left_side.attr("text-anchor", "start");
        
        text_center_side.attr("x",  (+s.attr("x") + (x_side_capex.rangeBand()/2))  );
        text_center_side.text("");
        text_center_side.attr("text-anchor", "start");
        text_center_side.attr("y", +s.attr("y") + (+s.attr("height")/2 * 1.6) );

        text_right_side.text(dollars(d3.round(y_side.invert(rule_y_side)),0));
        text_right_side.attr("x", side_panel_width);
        text_right_side.attr("text-anchor", "end");
        break;
        
     case "HEDGE":
       console.log("hedge");
        text_left_side.text(percent(y_side.invert(rule_y_side)),0);
        text_left_side.attr("x", 1);
        text_left_side.attr("text-anchor", "start");
        
        text_center_side.attr("x",  (+s.attr("x") + (x_side_hedge.rangeBand()/2))  );
        text_center_side.text("$"+ side_data.hedge +  "MM");
        text_center_side.attr("text-anchor", "middle");
        if (rule_side.attr("y") > y_side(0)) {text_center_side.attr("y", rule_side.attr("y") - 4);} //negative bars
        else {text_center_side.attr("y", rule_side.attr("y") - 4);}

        text_right_side.text(percent(y_side.invert(rule_y_side)),0);
        text_right_side.attr("x", side_panel_width);
        text_right_side.attr("text-anchor", "end");
        break;
        
      case "HEDGE_BOE":
        
        text_left_side.text(dollars(d3.round(y_side.invert(rule_y_side),2)  ));
        text_left_side.attr("x", 1);
        text_left_side.attr("text-anchor", "start");
        
        text_center_side.attr("x",  (+s.attr("x") + (x_side_hedge.rangeBand()/2) )  );
        text_center_side.text("");
        text_center_side.attr("text-anchor", "middle");
        if (rule_side.attr("y") > y_side(0)) {text_center_side.attr("y", rule_side.attr("y") - 4);} //negative bars
        else {text_center_side.attr("y", rule_side.attr("y") - 4);}

        text_right_side.text(dollars(d3.round((y_side.invert(rule_y_side)/6),2)));
        text_right_side.attr("x", side_panel_width);
        text_right_side.attr("text-anchor", "end");
        break;
        
      case "DEBT_EBITDA":
        
        text_left_side.text(d3.round(y_side.invert(rule_y_side),1) );
        text_left_side.attr("x", 1);
        text_left_side.attr("text-anchor", "start");
        
        text_center_side.attr("x",  (+s.attr("x") + (x_side_hedge.rangeBand()/2) )  );
        text_center_side.text("");
        text_center_side.attr("text-anchor", "middle");

        text_right_side.text(d3.round(y_side.invert(rule_y_side),1) );
        text_right_side.attr("x", side_panel_width);
        text_right_side.attr("text-anchor", "end");
        break;
        
    case "EV":
        text_left_side.text(dollars(d3.round(y_side.invert(rule_y_side)),0));
        text_left_side.attr("x", 1);
        text_left_side.attr("text-anchor", "start");
        
        text_center_side.attr("x",  (+s.attr("x") + (x_side_reserves.rangeBand()*1.3) )  );
        text_center_side.text(dollars(d3.round((ob.value),0))   );
        text_center_side.attr("text-anchor", "start");
        text_center_side.attr("y", +s.attr("y") + (+s.attr("height")/2 * 1.6) );

        text_right_side.text(dollars(d3.round(y_side.invert(rule_y_side)),0));
        text_right_side.attr("x", side_panel_width);
        text_right_side.attr("text-anchor", "end");
        break;
        
      case "EV_EBITDA":
        
        text_left_side.text(d3.round(y_side.invert(rule_y_side),1) );
        text_left_side.attr("x", 1);
        text_left_side.attr("text-anchor", "start");
        
        text_center_side.attr("x",  (+s.attr("x") + (x_side_hedge.rangeBand()/2) )  );
        text_center_side.text("");
        text_center_side.attr("text-anchor", "middle");

        text_right_side.text(d3.round(y_side.invert(rule_y_side),1) );
        text_right_side.attr("x", side_panel_width);
        text_right_side.attr("text-anchor", "end");
        break;
        
    case "PR_DASHARE":
        text_left_side.text(d3.round(y_side.invert(rule_y_side),2));
        text_left_side.attr("x", 1);
        text_left_side.attr("text-anchor", "start");
        
        
        text_center_side.attr("x",  (+s.attr("x") + (x_side_hedge.rangeBand()/2) )  );
        text_center_side.text("");
        text_center_side.attr("text-anchor", "middle");
        
        
        text_right_side.text(d3.round(y_side.invert(rule_y_side) * 6, 2));
        text_right_side.attr("x", side_panel_width);
        text_right_side.attr("text-anchor", "end");
        break;
        
    case "PROD_DASHARE":
        text_left_side.text(d3.round(y_side.invert(rule_y_side),2));
        text_left_side.attr("x", 1);
        text_left_side.attr("text-anchor", "start");
        
        
        text_center_side.attr("x",  (+s.attr("x") + (x_side_hedge.rangeBand()/2) )  );
        text_center_side.text("");
        text_center_side.attr("text-anchor", "middle");
        
        
        text_right_side.text(d3.round(y_side.invert(rule_y_side) *6,2));
        text_right_side.attr("x", side_panel_width);
        text_right_side.attr("text-anchor", "end");
        break;
                
  }//end of switch
        
        
  
}//end of show_rule_side()








var mode_index_side = 0;
window.focus();
d3.select(window).on("keydown", function() {
    switch (d3.event.keyCode) {
    /* case 75:  //"k"
            if (mode_index_side == mode_labels_side[0].length - 1) {mode_index_side = 0;}
            else {mode_index_side = mode_index_side + 1;}
            modeSwitch_side(mode_labels_side[0][mode_index_side].textContent);
            break;*/
            
     case 73: //"i" for info
     
     red_slide_root.style("visibility", "visible");
            break;
    
    case 77: //"m"
            if (mode_index == mode_labels[0].length - 1) {mode_index = 0;}
            else {mode_index = mode_index + 1;}
            modeSwitch(mode_labels[0][mode_index].textContent);
            break;
            
     case 78: // "n"
            if (mode_index == 0) {mode_index = mode_labels[0].length - 1;}
            else {mode_index = mode_index - 1;}
            modeSwitch(mode_labels[0][mode_index].textContent);
            break;
    }
    
 });
 


function modeSwitch_side(text) {
  
  side_panel_rule.style("visibility", "hidden"); //clears "sticky rule" any change of mode or selection
  
        
    mode_labels.style("opacity", function(d) {
    if (d.text == text) {return 1.0;}
    else {return .6;}
    })
    .style("font-weight", function(d) {
        if (d.text == text) {return "700";}
        else {return "400";}
      })
      .style("font-style", function(d) {
          if (d.text == text) {return "italic";}
          else {return "normal";}
        });
  
    switch(text) {
    case "Production by Product":
        mode_index_side = 0;
        prod_un_side();
        break;
    case "Production Totaled":
        mode_index_side = 1;
        prod_s_side();
        break;
    case "Revenue by Product":
        mode_index_side = 2;
        rev_un_side();
        break;
    case "Revenue Totaled":
        mode_index_side = 3;
        rev_s_side();
        break;
    case "Price by Product":
        mode_index_side = 4;
        price_un_side();
        break;
    case "Boe/Mcfe Price":
        mode_index_side = 5;
        price_s_side();
        break;
    case "Income Metrics":
        mode_index_side = 6;
        inc_qu_un_side();
        break;
    case "Cost Metrics":
        mode_index_side = 7;
        inc_qu_s_side();
        break;
    case "Unit Income Metrics":
        mode_index_side = 8;
        inc_boe_un_side();
        break;
    case "Unit Cost Metrics":
        mode_index_side = 9;
        inc_boe_s_side();
        break;
    case "Percentage Income Metrics":
        mode_index_side = 10;
        inc_perc_un_side();
        break;
    case "Percentage Cost Metrics":
        mode_index_side = 11;
        inc_perc_s_side();
        break;
    case "Proved Reserves Analyzed":
        mode_index_side = 12;
        reserves_un_side();
        break;
    case "Proved Reserves Totaled":
        mode_index_side = 13;
        reserves_s_side();
        break;
    case "E&P Capital Expenditures":
        mode_index_side = 14;
        capex_side();
        break;
    case "Hedge Percentage Impact":
        mode_index_side = 15;
        hedge_side();
        break;
    case "Hedge Unit Impact":
        mode_index_side = 16;
        hedge_boe_side();
        break;
    case "Net Debt/EBITDA Ratio":
        mode_index_side = 17;
        debt_ebitda_side();
        break;
    case "Enterprise Value (EV)":
        mode_index_side = 18;
        ev_side();
        break;
    case "EV/EBITDA Ratio":
        mode_index_side = 19;
        ev_ebitda_side();
        break;
    case "Reserves per D/A Share":
        mode_index_side = 20;
        pr_dashare_side();
        break;
    case "Production per D/A Share":
        mode_index_side = 21;
        prod_dashare_side();
        break
    }
}



// Opening slide sequence -- comment out to disable

// shift root back to body origin
var overlay_root = svg.append("g")
  .attr("transform", "translate(" + -margin.left + "," + -margin.top + ")");

var click_shield_rect = overlay_root.append("rect")
      .attr("width", 1600)
      .attr("height", 890)
      .style("fill", "rgb(239,239,239)")
      .style("opacity", 1);

var slides_root = overlay_root.append("g")
    .classed("label", true)
    .attr("transform", "translate( 275, 100 )");
    
//red - bottom - third slide

var drag_box = d3.behavior.drag()
    .origin(Object)
    .on("drag", dragmove_box);

var box_x_position = 0;
var box_y_position = 0;

function dragmove_box() {
  box_x_position += d3.event.dx;
  box_y_position += d3.event.dy;
  red_slide_root.attr("transform", "translate(" + box_x_position +  "," + box_y_position + ") scale(.8)");
}

var red_slide_root = slides_root.append("g")
  .attr("transform", "translate( 0,0 )")
  .call(drag_box)
  .style("cursor", "all-scroll");

red_slide_root.append("rect")
      .attr("width", 700)
      .attr("height", 500)
      .style("fill", "white")
      .style("stroke", "rgb(140,140,140)")
      .style("stroke-width", "10px")
      .transition().delay(3000).duration(1000).style("stroke", clr_oil);
      
var video_button = red_slide_root.append("g")
    .attr("transform", "translate( 25, 30)")
    .on("click", function() { OpenInNewTab("http://youtu.be/WxEnakWeR6I");}  );

video_button.append("rect")
    .attr("x", -2)
    .attr("y", -22 )
    .attr("width", 165)
    .attr("height", 35)
    .style("fill", "rgb(170,170,170)");
    
video_button.append("rect")
    .attr("x", 0)
    .attr("y", -20 )
    .attr("width", 160 )
    .attr("height", 30 )
    .style("fill", "black");
    
video_button.append("text")
      .attr("x", 80)
      .attr("y", 1 )
      .style("fill", "white")
      .style("font-size", "16px")
      .style("font-weight", "600")
      .attr("text-anchor", "middle")
      .text("Quick Start Video")
      .style("cursor", "pointer");

/*red_slide_root.append("text")
    .attr("x", 20)
    .attr("y", 30)
    .style("cursor", "pointer")
    .attr("text-anchor", "start")
    .style("font-size", "18px")
    .style("font-style", "italic")
    .text("DRAG PANEL as needed")
    .on("click", function() { red_slide_root.style("visibility", "hidden");}  );*/
    
    
    
    function OpenInNewTab(url) {
  var win = window.open(url, '_blank');
  win.focus();
}
      
red_slide_root.append("text")
    .attr("x", 670)
    .attr("y", 30)
    .style("cursor", "pointer")
    .attr("text-anchor", "end")
    .style("font-size", "24px")
    .style("font-family", "EB Garamond")
    .text("HIDE")
    .on("click", function() {
      red_slide_root.style("visibility", "hidden");
      info_button.style("visibility", "visible");
    });
    
    
red_slide_root.append("text")
    .attr("x", 670)
    .attr("y", 55)
    .attr("text-anchor", "end")
    .style("cursor", "pointer")
    .style("font-size", "20px")
    .style("font-style", "italic")
    .style("font-family", "Quattrocento Sans")
    .text("Drag Panel as Needed");
    
var quick_start_array = [

    "THREE 'MUST-KNOWS' - try right away.",
    " ",
    "1. CLICK IN EMPTY AREA of main graph to TOGGLE (show/hide) selection tools.",
    "   ",
    "2. CLICK ON BARS of a company in main graph to load side graph/data panel.",
    "     ",
    "3. MAIN GRAPH MODES button toggles to SIDE GRAPH. Try modes in both.",
    "         ",
    "           ",
    "AND SOME OTHER THINGS for reference -",
    "             ",
    "-ZOOM IN as needed. HIDE selections tools for spacious graph.",
    "                 ",
    "-MOUSEOVER EVERYTHING to discover interactive features.",
    "                  ",
    "-For OIL PRICE STRESS-TESTING, use 'override' in Income Metrics Mode.",
    "                     ",
    "-DRAG the right-side data panel up and down for convenience.",
    "                       ",
    "* (asterisk) = two-stream reporting (ngl production included in gas)",
    "+ (plus sign) = meaningful international production included",
    "BO = barrel of oil (crude oil, condensate or bitumen), MCF = 1000 cubic feet of natural gas",
    "BOE = barrel of oil equivalent (6 x mcfe), MCFE = mcf equivalent (1/6 of boe)",
    "GAS = natural gas, NGL = natural gas liquids, LIQUIDS = oil plus ngl",
    "PR = proved reserves, (PD = proved developed and PUD = proved undeveloped)",
    "M = thousands, MM = millions, B = billions"
];

    
var quick_start_array_scale = d3.scale.ordinal()
    .rangePoints([0,quick_start_array.length * 15],0)
    .domain(quick_start_array);

var quick_start_root = red_slide_root.append("g")
    .classed("label", true)
    .attr("transform", "translate( 0, 0 )");
    
var quick_start_labels = quick_start_root.append("g")
      .attr("transform", "translate(25, 80)")
      .selectAll("label")
      .data(quick_start_array)
      .enter().append("text")
      .attr("x", 0)
      .attr("y", function(d) { return quick_start_array_scale(d) ;})
      .style("font-variant", "normal")
      .style("font-size", function(d,i) {
        if (i == 0 || i == 9) {return "23px";}
        else if(i > 18)  {return "16px";}
        else  {return "17px";} })
      .text(function (d) {return d;})
      .style("fill", function(d,i) {if (i > 0 && i < 9) {return clr_oil;} else return "black";});


      
//blue - top - first slide


var blue_slide_root = slides_root.append("g")
  .attr("transform", "translate( 20,20 )")
      .on("click", function() {
        d3.select("body").style("background-color", "white");
        d3.select("#links").style("display", "block");
        d3.select(this).style("visibility", "hidden");
        click_shield_rect.style("visibility", "hidden");
        side_panel_data.style("visibility", "visible");
        load_main_graph();
        side_graph();
        load_pie_graphs();
        red_slide_root.transition().duration(2000).delay(3000).attr("transform", "translate( -250,380 ) scale(.8)");
      }  ) ;

blue_slide_root.append("rect")
      .attr("transform", "translate( -10,-10 )")
      .attr("width", 680)
      .attr("height", 480)
      .style("fill", "rgb(165,165,165)")
      .style("stroke", "rgb(165,165,165)")
      .style("stroke-width", "10px")
      .transition().delay(3000).duration(1000).style("stroke", clr_ngl);
      
blue_slide_root.append("rect")
      .attr("width", 660)
      .attr("height", 460)
      .style("fill", "rgb(190,190,190)")
      .style("stroke", "rgb(140,140,140)")
      .style("stroke-width", "10px")
      .transition().delay(3000).duration(1000).style("stroke", clr_gas);

      
      



var bbop_text_root = blue_slide_root.append("g")
    .attr("transform", "translate (330, 230)");
    
    
    //bbop_text_root.transition().delay(3500).duration(2000).attr("transform", "translate (330, 380)");
        bbop_text_root.transition().delay(3500).duration(1000).style("opacity", 0);

    
var blue_bbop_text1 = bbop_text_root.append("text")
    .attr("x", -240)
    .attr("y", 0)
    .attr("text-anchor", "start")
    .style("font-size", "45px")
    .style("font-weight", "normal")
    .style("font-variant", "normal")
    .style("font-family", "Quattrocento Sans")
    .text("b(B")
    .style("fill", "white");
    
var blue_bbop_text2 = bbop_text_root.append("text")
    .attr("x", -140)
    .attr("y", 0)
    .attr("text-anchor", "start")
    .style("font-size", "45px")
    .style("font-weight", "normal")
    .style("font-variant", "normal")
    .style("font-family", "Quattrocento Sans")
    .text("P).data_interactive")
    .style("fill", "white");
    
bbop_text_root.append("circle")
    .attr("r", 11)
    .attr("cx", -157)
    .attr("cy", -17)//-13
    .style("stroke", clr_oil)
    .style("stroke-width", "3")
    .style("fill", clr_gas)
    .transition().delay(2500).duration(1000).ease("elastic")
      .attr("r", 200)
      .transition().delay(3500).duration(0)
      .attr("r",11);
      
bbop_text_root.append("circle")
    .attr("r",11)
    .attr("cx", -157)
    .attr("cy", -17)//-13
    .style("stroke", clr_oil)
    .style("stroke-width", "3")
    .style("fill", clr_ngl)
    .transition().delay(2000).duration(1000).ease("elastic")
      //.style("opacity", ".5")
      .attr("r", 100)
      .transition().delay(3500).duration(0)
      .attr("r",11);
      
      
      
bbop_text_root.append("circle")
    .attr("r", 11)
    .attr("cx", -157)
    .attr("cy", -17)//-13
    .style("stroke", clr_oil)
    .style("stroke-width", "3")
    .style("fill", "white")
    .transition().delay(1500).duration(1000).ease("elastic")
      .attr("r", 50)
      .transition().delay(3500).duration(0)
      .attr("r", 11);



var SEE_text_root = blue_slide_root.append("g")
    .style("opacity", 0);
    
    SEE_text_root.transition().delay(4000).duration(1000)
        .style("opacity", 1);
    
var blue_shale_text = SEE_text_root.append("text")
    .attr("x", 60)
    .attr("y", 100)
    .style("font-family", "EB Garamond")
    .style("font-size", "50px")
    .style("font-weight","400")
    .text("SHALE")
    .style("fill", "white");
    //.style("stroke", "black");
    
var blue_equities_text = SEE_text_root.append("text")
    .attr("x", 60)
    .attr("y", 150)
    .style("font-family", "EB Garamond")
    .style("font-size", "50px")
    .style("font-weight","400")
    .text("EQUITIES")
    .style("fill", "white");

    
var blue_explorer_text = SEE_text_root.append("text")
    .attr("x", 60)
    .attr("y", 200)
    .style("font-family", "EB Garamond")
    .style("font-size", "50px")
    .style("font-weight","400")
    .text("EXPLORER")
    .style("fill", "white");
    
var blue_firstline_text = SEE_text_root.append("text")
    .attr("x", 330)
    .attr("y", 250)
    .attr("text-anchor", "middle")
    .style("font-family", "EB Garamond")
    .style("font-size", "28px")
    .style("font-weight","400")
    .style("font-variant","normal")
    .text("Interactive Visual Database")
    //.text("A Data-Viz Encylcopedia of Public Companies")
    .style("fill", "black");
    
var blue_firstline_text = SEE_text_root.append("text")
    .attr("x", 330)
    .attr("y", 280)
    .attr("text-anchor", "middle")
    .style("font-family", "EB Garamond")
    .style("font-size", "28px")
    .style("font-weight","400")
    .style("font-variant","normal")
    .text(" of 40 Public Companies Operating in U.S. Shales")
    .style("fill", "black");
    
var bottom_text_root = blue_slide_root.append("g")
    .attr("transform", "translate (330, 320)")
    .style("opacity", 0);
    
    bottom_text_root.transition().delay(4000).duration(2000).style("opacity", 1);
    
bottom_text_root.append("text")
      .attr("x",0)
    .attr("y", 5)
    .attr("text-anchor", "middle")
    .style("font-family", "Quattrocento Sans")
    .style("font-size", "22px")
    .style("font-weight","400")
    .style("font-variant","normal")
    .text("Q2 2015 Data")
    .style("fill", "black");
    
bottom_text_root.append("text")
      .attr("x",0)
    .attr("y", 25)
    .attr("text-anchor", "middle")
    .style("font-family", "Quattrocento Sans")
    .style("font-size", "15px")
    .style("font-weight","400")
    .style("font-variant","normal")
    .text("Data curated pursuant to defined policy for optimal clarity and comparability")
    .style("fill", "black");
    
bottom_text_root.append("text")
      .attr("x",0)
    .attr("y", 80)
    .attr("text-anchor", "middle")
    .style("font-family", "EB Garamond")
    .style("font-size", "16px")
    .style("font-weight","400")
    .style("font-variant","normal")
    .text("Use subject to disclaimer - all rights reserved 2015")
    .style("fill", "black");
    
bottom_text_root.append("text")
    .attr("x", 0)
    .attr("y", 105)
    .attr("text-anchor", "middle")
    .style("font-family", "Quattrocento Sans")
    .style("cursor", "pointer")
    .style("font-size", "20px")
    .style("font-weight","600")
    .text("CLICK to acknowledge")
    .style("fill", "black");
    
  
    



      
      
function load_main_graph()   {
  
  var company = group.selectAll("h")
      .data(current_data, function(d){return d.company;})
    .enter().append("g")
      .attr("class", "company")
      .attr("transform", function(d) { return " scale(0,0), translate( 0, 0)"; })
      .on("click",function() {
        side_data = d3.select(this).datum();
        side_graph();

      });
  
      company.transition().duration(3000)
      .delay(function(d, i) { return i * 300; })
      .attr("transform", function(d) { return "scale(1,1), translate(" + x(d.company) + ",0)"; });

      
      company.selectAll("rect")
      .data(function(d) { return d.values.prods; })
      .enter().append("rect")
      .attr("width", x_prods.rangeBand())
      .attr("x", function(d) { return x_prods(d.product); })
      .attr("y", function(d) { return y(d.mboed); })
      .attr("height", function(d) { return height - y(d.mboed); })
      .style("fill", function(d) { return colors_prods(d.product); })
      .on("mouseover", show_rule);
      
}


</script>

<div style="font-family: Quattrocento Sans;  font-size:19px; font-weight:500">Prior Quarterly Data - <a href="2015_Q1/2015_Q1_max.html" target="_blank">Q1 2015</a></div>
<div style="font-family: Quattrocento Sans;  font-size:19px; font-weight:500">Prior Quarterly Data -  <a href="2014_Q4/2014_Q4_max.html" target="_blank">Q4 2014</a></div>


<div  id="links" style="display:none; font-family: REB Garamond;  font-size:20px; font-weight:500">Contact: rob@shaleequitiesexplorer.com</div>

<div id="disclose" style="font-family: EB Garamond; display: block">
      DISCLAIMER and WAIVER OF LIABILITY: This resource is made available at no cost, subject to an absolute, unqualified and unlimited waiver of liability for any damages asserted to be consequent to its use. Although the most diligent efforts have been made for accuracy, error is always possible, and the user acknowledges, as a condition of use, that no responsible investment or professional decision can be made without consulting the financial or operational data provided by the companies themselves in their own official reports and communications. The user further acknowledges that the data in this resource has been actively curated pursuant to a defined data policy in the interest of optimal comparability and precision, and necessarily reflects many usages and decisions about which there is inherently room for reasonable disagreement. Thus values assigned to items in this resource may, and often do, differ from similarly named items in a company's own reporting and communications, or as used by other persons in industry and media, and the user acknowledges that a proper understanding of the data presented in this resource can only be obtained by consulting the defined data policy.</div>
      
<a href="https://twitter.com/Shale_Explorer" class="twitter-follow-button" data-show-count="false" data-size="large">Follow @Shale_Explorer</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

</body>
</html>


  
